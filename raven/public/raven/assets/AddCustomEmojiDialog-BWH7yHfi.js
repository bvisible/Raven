var H=Object.defineProperty,O=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var k=(r,s,a)=>s in r?H(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a,x=(r,s)=>{for(var a in s||(s={}))J.call(s,a)&&k(r,a,s[a]);if(v)for(var a of v(s))K.call(s,a)&&k(r,a,s[a]);return r},h=(r,s)=>O(r,T(s));var g=(r,s,a)=>new Promise((c,m)=>{var y=o=>{try{d(a.next(o))}catch(l){m(l)}},n=o=>{try{d(a.throw(o))}catch(l){m(l)}},d=o=>o.done?c(o.value):Promise.resolve(o.value).then(y,n);d((a=a.apply(r,s)).next())});import{j as e,a6 as M,aa as P,au as U,aM as W,av as Y,r as F,h as G,u as Q,bJ as X,bB as Z,S as p,E as S,L as _,aH as C,bC as ee,p as A,b as R,c as L,a as se,ay as ae,o as B,_ as f,d as re}from"./index-Bzdyr4lv.js";const te=({open:r,onClose:s})=>e.jsx(M,{open:r,onOpenChange:s,children:e.jsxs(P,{children:[e.jsx(U,{children:"Add Emoji"}),e.jsx(W,{children:e.jsx(Y,{size:"2",children:"Add a custom emoji to your chat."})}),e.jsx(ie,{onClose:s})]})}),ie=({onClose:r})=>{var b,w;const{call:s}=F.useContext(G),[a,c]=F.useState(void 0),{register:m,handleSubmit:y,formState:{errors:n},setValue:d,setError:o,setFocus:l}=Q({defaultValues:{emoji_name:"",keywords:""},mode:"onBlur"}),{createDoc:I,loading:j,error:N}=X(),{upload:q,loading:u,error:D}=Z(),V=i=>g(null,null,function*(){if(!a)return;if(yield E(i.emoji_name)){o("emoji_name",{message:`Emoji ${i.emoji_name} already exists.`},{shouldFocus:!0});return}q(a,{doctype:"Raven Custom Emoji",docname:i.emoji_name,fieldname:"emoji_image"}).then(z=>I("Raven Custom Emoji",h(x({},i),{image:z.file_url}))).then(()=>{r(!0)})}),$=i=>{if(i){c(i);const t=i.name.split(".").slice(0,-1).join(".");d("emoji_name",t,{shouldValidate:!0}),l("emoji_name")}else c(void 0)},E=i=>g(null,null,function*(){const t=yield s.get("frappe.client.get_count",{doctype:"Raven Custom Emoji",filters:{emoji_name:i}});return(t==null?void 0:t.message)>0});return e.jsx("form",{onSubmit:y(V),children:e.jsxs(p,{children:[e.jsx(S,{error:N}),e.jsx(S,{error:D}),e.jsxs(p,{gap:"0",children:[e.jsx(_,{htmlFor:"emoji_image",children:"Emoji"}),e.jsx(C,{children:"An image of 128px by 128px works best."}),e.jsx(ee,{file:a,onFileChange:$,accept:{"image/*":[".jpeg",".jpg",".png",".svg",".gif"]},maxFileSize:1,hideIfLimitReached:!0})]}),e.jsxs(p,{children:[e.jsxs(A,{children:[e.jsx(_,{htmlFor:"emoji_name",isRequired:!0,children:"Emoji Name"}),e.jsx(R,h(x({id:"emoji_name"},m("emoji_name",{required:"Name is required",maxLength:{value:20,message:"Name must be less than 20 characters"},validate:i=>g(null,null,function*(){return(yield E(i))?"Emoji name already exists":!0})})),{placeholder:"e.g. jawdrop","aria-invalid":n.emoji_name?"true":"false"}))]}),n.emoji_name&&e.jsx(L,{children:(b=n.emoji_name)==null?void 0:b.message})]}),e.jsxs(p,{children:[e.jsxs(A,{children:[e.jsx(_,{htmlFor:"keywords",children:"Keywords"}),e.jsx(R,h(x({id:"keywords"},m("keywords")),{placeholder:"e.g. shocked, surprised, omg","aria-invalid":n.keywords?"true":"false"}))]}),e.jsx(C,{children:"You will be able to search for this emoji by these keywords. (Optional)"}),n.keywords&&e.jsx(L,{children:(w=n.keywords)==null?void 0:w.message})]}),e.jsxs(se,{gap:"3",mt:"4",justify:"end",children:[e.jsx(ae,{disabled:j||u,children:e.jsx(B,{variant:"soft",color:"gray",children:f("Cancel")})}),e.jsxs(B,{type:"submit",disabled:j||u,children:[j||u&&e.jsx(re,{}),j||u?f("Saving"):f("Save")]})]})]})})};export{te as A};
