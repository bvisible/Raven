var H=Object.defineProperty,U=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var C=(e,n,i)=>n in e?H(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,d=(e,n)=>{for(var i in n||(n={}))R.call(n,i)&&C(e,i,n[i]);if(w)for(var i of w(n))z.call(n,i)&&C(e,i,n[i]);return e},u=(e,n)=>U(e,V(n));var h=(e,n)=>{var i={};for(var r in e)R.call(e,r)&&n.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&w)for(var r of w(e))n.indexOf(r)<0&&z.call(e,r)&&(i[r]=e[r]);return i};import{r as l,j as s,bN as q,ct as J,b3 as K,b4 as Q,co as X,b6 as k,b7 as Y,i as x,b9 as v,v as L,p as E,aj as O,E as Z,b8 as D,a as m,aA as ee,x as se,a7 as re,n as B,cu as ie,cv as ne,a3 as f,ak as ae,al as te,cw as oe,an as le,ao as j,cx as ce,cy as M,cz as A,cA as pe,cB as P,cC as de,h as ue,ax as me,cD as he,ac as xe}from"./index-DLbNAGlT.js";import{u as F}from"./useDoctypeMeta-Zs7XFBWn.js";import{r as je}from"./skeleton-BDAZ3z87.js";var ge="AspectRatio",I=l.forwardRef((e,n)=>{const a=e,{ratio:i=1/1,style:r}=a,t=h(a,["ratio","style"]);return s.jsx("div",{style:{position:"relative",width:"100%",paddingBottom:`${100/i}%`},"data-radix-aspect-ratio-wrapper":"",children:s.jsx(q.div,u(d({},t),{ref:n,style:u(d({},r),{position:"absolute",top:0,right:0,bottom:0,left:0})}))})});I.displayName=ge;var we=I;const fe=we,ve=["start","center","end","baseline","stretch"],ye=["horizontal","vertical"],ke=["1","2","3"],_e={orientation:{type:"enum",className:"rt-r-orientation",values:ye,default:"horizontal",responsive:!0},size:{type:"enum",className:"rt-r-size",values:ke,default:"2",responsive:!0},trim:u(d({},J.trim),{className:"rt-r-trim"})},be={align:{type:"enum",className:"rt-r-ai",values:ve,responsive:!0}},Ne=d(d(d({},X),Q),K),S=l.forwardRef((e,n)=>{const t=k(e,_e,Y),{className:i}=t,r=h(t,["className"]);return l.createElement(x,{asChild:!0},l.createElement("dl",u(d({},r),{ref:n,className:v("rt-DataListRoot",i)})))});S.displayName="DataList.Root";const T=l.forwardRef((e,n)=>{const t=k(e,be),{className:i}=t,r=h(t,["className"]);return l.createElement("div",u(d({},r),{ref:n,className:v("rt-DataListItem",i)}))});T.displayName="DataList.Item";const W=l.forwardRef((e,n)=>{const a=k(e,Ne),{className:i,color:r}=a,t=h(a,["className","color"]);return l.createElement("dt",u(d({},t),{"data-accent-color":r,ref:n,className:v("rt-DataListLabel",i)}))});W.displayName="DataList.Label";const G=l.forwardRef((t,r)=>{var a=t,{children:e,className:n}=a,i=h(a,["children","className"]);return l.createElement("dd",u(d({},i),{ref:r,className:v(n,"rt-DataListValue")}),e)});G.displayName="DataList.Value";const $e=(e,n)=>{const{data:i,error:r,isLoading:t,mutate:a}=L("raven.api.document_link.get_preview_data",{doctype:e,docname:n},void 0,{shouldRetryOnError:!1});return{data:i==null?void 0:i.message,error:r,isLoading:t,mutate:a}},Ae=({doctype:e,docname:n})=>{const{data:i,error:r,isLoading:t,mutate:a}=$e(e,n),c=l.useMemo(()=>{if(i&&i.raven_document_link)return i.raven_document_link;const p=e.toLowerCase().split(" ").join("-");return`${window.location.origin}/app/${p}/${n}`},[i,e,n]);return s.jsx(E,{className:"max-w-[550px] min-w-[75px] py-2",children:t?s.jsx(je,{className:"w-96 h-32 rounded-md"}):r?s.jsx(O,{children:s.jsx(Z,{error:r})}):s.jsx(Ce,{data:i,doctype:e,docname:n,route:c,mutate:a})})},Ce=({data:e,doctype:n,route:i,docname:r,mutate:t})=>{var _,b;const a=o=>{const N=["preview_image","preview_title","id","raven_document_link"];return Object.keys(o).reduce(($,y)=>(N.includes(y)||($[y]=o[y]),$),{})},c=()=>{f.promise(()=>g(i),{loading:"Copying link...",success:"Link copied!",error:"Failed to copy link"})},p=o=>{f.promise(()=>g(e[o]),{loading:`Copying ${o}...`,success:`${o} copied!`,error:`Failed to copy ${o}`,duration:1e3})},g=o=>navigator.clipboard.writeText(o);return s.jsx(O,{children:s.jsxs(D,{gap:"2",children:[s.jsxs(m,{justify:"between",align:"start",children:[s.jsxs(m,{gap:"2",align:"center",width:"100%",children:[(e==null?void 0:e.preview_image)&&s.jsx(E,{width:"12%",className:"pl-0.5",children:s.jsx(fe,{ratio:1/1,children:s.jsx("img",{src:e.preview_image,alt:e==null?void 0:e.preview_title,style:{objectFit:"cover",width:"100%",height:"100%",backgroundColor:"var(--gray-5)",borderRadius:"var(--radius-4)"}})})}),s.jsxs(D,{gap:"1",width:"100%",children:[s.jsxs(m,{gap:"1",children:[s.jsx(ee,{variant:"surface",children:n}),s.jsx(x,{size:"2",color:"gray",className:"cursor-copy",onClick:()=>p("ID"),children:e==null?void 0:e.id})]}),s.jsx(se,{as:"h3",size:"3",className:"leading-4 pl-0.5 my-0",children:(_=e==null?void 0:e.preview_title)!=null?_:r})]})]}),s.jsxs(m,{gap:"3",align:"center",children:[s.jsx(re,{content:"Open in new tab",delayDuration:800,children:s.jsx(B,{size:"1",title:"Open in new tab","aria-label":"Open in new tab",color:"gray",asChild:!0,variant:"ghost",children:s.jsx("a",{href:i,target:"_blank",children:s.jsx(ie,{size:"18"})})})}),s.jsx(Re,{doctype:n,docname:r,onCopyLinkClick:c,mutate:t})]})]}),s.jsx(S,{size:"2",className:"gap-1 pl-0.5",children:e&&((b=Object.keys(a(e)))==null?void 0:b.map((o,N)=>s.jsxs(T,{align:"center",children:[s.jsx(W,{minWidth:"88px",className:"font-medium pr-2",children:o}),s.jsx(G,{children:typeof e[o]=="string"?ne(e[o]):e[o]})]},o)))})]})})},Re=({doctype:e,docname:n,onCopyLinkClick:i,mutate:r})=>s.jsxs(ae,{children:[s.jsx(te,{children:s.jsx(B,{size:"1",title:"More actions","aria-label":"More actions",color:"gray",variant:"ghost",children:s.jsx(oe,{size:"20"})})}),s.jsxs(le,{children:[s.jsx(j,{onSelect:i,children:s.jsxs(m,{gap:"2",align:"center",pr:"4",children:[s.jsx(ce,{size:"16"}),"Copy Link"]})}),s.jsx(Le,{doctype:e,docname:n}),s.jsx(ze,{doctype:e,docname:n,mutate:r})]})]}),ze=({doctype:e,docname:n,mutate:i})=>{var c;const{doc:r}=F(e),[t,a]=l.useState(!1);return!r||!(r!=null&&r.__workflow_docs)||(r==null?void 0:r.__workflow_docs.length)===0?null:s.jsxs(M,{open:t,onOpenChange:a,children:[s.jsx(A,{children:s.jsxs(m,{gap:"2",align:"center",children:[s.jsx(de,{size:"16"}),"Workflow"]})}),s.jsx(P,{children:s.jsx(De,{doctype:e,docname:n,workflow:(c=r==null?void 0:r.__workflow_docs)==null?void 0:c[0],mutate:i})})]})},De=({doctype:e,docname:n,mutate:i})=>{const{data:r,mutate:t}=L("frappe.model.workflow.get_transitions",{doc:{doctype:e,name:n}},`workflow.get_transitions.${e}.${n}`,{revalidateIfStale:!1,revalidateOnFocus:!1,shouldRetryOnError:!1}),{call:a}=l.useContext(ue),c=p=>{a.post("frappe.model.workflow.apply_workflow",{doc:{doctype:e,name:n},action:p}).then(()=>{i(),t(),f.success("Workflow transition applied successfully")}).catch(g=>{f.error("Failed to apply workflow transition",{description:xe(g)})})};return(r==null?void 0:r.message.length)===0?s.jsx(j,{disabled:!0,children:"No transitions available"}):s.jsx(s.Fragment,{children:r==null?void 0:r.message.map(p=>s.jsxs(j,{onClick:()=>c(p.action),children:[s.jsx(x,{size:"2",weight:"medium",children:p.action}),s.jsxs(me,{gap:"1",children:[s.jsx(x,{size:"1",className:"font-light",children:p.state}),s.jsx(he,{size:"16",opacity:.7}),s.jsx(x,{size:"1",className:"font-light",children:p.next_state})]})]},p.name))})},Le=({doctype:e,docname:n})=>{var t;const{doc:i}=F(e),r=a=>{let c=`doctype=${encodeURIComponent(e)}&name=${encodeURIComponent(n)}`;a&&(c+=`&format=${a}`),c+="&trigger_print=0",window.open(`/printview?${c}`,"_blank")};return s.jsxs(M,{children:[s.jsx(A,{children:s.jsxs(m,{gap:"2",align:"center",children:[s.jsx(pe,{size:"16"}),"Print"]})}),s.jsxs(P,{children:[(t=i==null?void 0:i.__print_formats)==null?void 0:t.map(a=>s.jsx(j,{onClick:()=>r(a.name),children:a.name},a.name)),s.jsx(j,{onClick:()=>r(),children:"Standard"})]})]})};export{Ae as D};
