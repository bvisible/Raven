var K=Object.defineProperty,T=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var P=(i,a,n)=>a in i?K(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n,h=(i,a)=>{for(var n in a||(a={}))B.call(a,n)&&P(i,n,a[n]);if(O)for(var n of O(a))H.call(a,n)&&P(i,n,a[n]);return i},j=(i,a)=>T(i,$(a));var M=(i,a,n)=>new Promise((l,s)=>{var r=t=>{try{m(n.next(t))}catch(o){s(o)}},u=t=>{try{m(n.throw(t))}catch(o){s(o)}},m=t=>t.done?l(t.value):Promise.resolve(t.value).then(r,u);m((n=n.apply(i,a)).next())});import{aQ as X,az as Y,u as G,r as S,ah as J,j as e,ai as Q,o as z,d as q,a as _,i as A,aP as C,aS as w,O as Z,p as g,v as W,aJ as N,L as v,b,c as f,aH as y,V as ee,S as ae,aD as se,aE as ne,aF as ie,aG as I,bY as R,bZ as E,w as le,cY as oe,b_ as F,bX as re,a3 as L}from"./index-Bzdyr4lv.js";import{P as te,S as ce,a as de}from"./SettingsContentContainer-Bb1q0MED.js";import{u as pe}from"./useRavenSettings-CSKb1EiJ.js";import{m as ue,b as me,P as D,f as U}from"./tabs-CE6-Nr0L.js";const he=()=>{const i=X()||Y(),{ravenSettings:a,mutate:n}=pe(),l=G({disabled:!i}),{handleSubmit:s,control:r,watch:u,reset:m}=l;S.useEffect(()=>{a&&m(a)},[a]);const{updateDoc:t,loading:o}=J(),x=d=>{L.promise(t("Raven Settings",null,h(h({},a!=null?a:{}),d)).then(p=>{n(p,{revalidate:!1})}),{loading:"Updating...",success:()=>"Settings updated",error:"There was an error."})};S.useEffect(()=>{const d=p=>{p.key==="s"&&(p.metaKey||p.ctrlKey)&&(p.preventDefault(),l.handleSubmit(x)())};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[]);const k=u("enable_ai_integration");return e.jsx(te,{children:e.jsx(Q,j(h({},l),{children:e.jsx("form",{onSubmit:s(x),children:e.jsxs(ce,{children:[e.jsx(de,{title:"AI Settings",description:"Configure AI providers to use AI features in Raven.",actions:e.jsxs(z,{type:"submit",disabled:o||!i,children:[o&&e.jsx(q,{className:"text-white"}),o?"Saving":"Save"]})}),e.jsx(_,{direction:"column",gap:"2",children:e.jsx(A,{as:"label",size:"2",children:e.jsxs(_,{gap:"2",children:[e.jsx(C,{control:r,defaultValue:a==null?void 0:a.enable_ai_integration,name:"enable_ai_integration",render:({field:d})=>e.jsx(w,{checked:!!d.value,name:d.name,disabled:d.disabled,onCheckedChange:p=>d.onChange(p?1:0)})}),"Enable AI Integration"]})})}),e.jsx(Z,{size:"4"}),k?e.jsxs(ue,{defaultValue:"openai",children:[e.jsxs(me,{children:[e.jsx(D,{value:"openai",children:"OpenAI"}),e.jsx(D,{value:"local",children:"Local LLM"})]}),e.jsxs(g,{mt:"4",children:[e.jsx(U,{value:"openai",children:e.jsx(_e,{})}),e.jsx(U,{value:"local",children:e.jsx(xe,{})})]})]}):null]})})}))})},_e=()=>{var u,m,t;const{data:i}=W("raven.api.ai_features.get_open_ai_version"),{watch:a,control:n,register:l,formState:{errors:s}}=N(),r=a("enable_openai_services");return e.jsxs(_,{direction:"column",gap:"4",children:[e.jsx(_,{direction:"column",gap:"2",children:e.jsx(A,{as:"label",size:"2",children:e.jsxs(_,{gap:"2",children:[e.jsx(C,{control:n,name:"enable_openai_services",render:({field:o})=>e.jsx(w,{checked:!!o.value,name:o.name,disabled:o.disabled,onCheckedChange:x=>o.onChange(x?1:0)})}),"Enable OpenAI Services"]})})}),r?e.jsxs(e.Fragment,{children:[e.jsxs(g,{children:[e.jsx(v,{htmlFor:"openai_organisation_id",isRequired:!0,children:"OpenAI Organization ID"}),e.jsx(b,j(h({maxLength:140,className:"w-48 sm:w-96",id:"openai_organisation_id",autoComplete:"off",required:!0,placeholder:"org-************************"},l("openai_organisation_id",{required:r?"Please add your OpenAI Organization ID":!1,maxLength:{value:140,message:"ID cannot be more than 140 characters."}})),{"aria-invalid":s.openai_organisation_id?"true":"false"})),(s==null?void 0:s.openai_organisation_id)&&e.jsx(f,{children:(u=s.openai_organisation_id)==null?void 0:u.message})]}),e.jsxs(g,{children:[e.jsx(v,{htmlFor:"openai_api_key",isRequired:!0,children:"OpenAI API Key"}),e.jsx(b,j(h({className:"w-48 sm:w-96",id:"openai_api_key",required:!0,type:"password",autoComplete:"off",placeholder:"••••••••••••••••••••••••••••••••"},l("openai_api_key",{required:r?"Please add your OpenAI API Key":!1})),{"aria-invalid":s.openai_api_key?"true":"false"})),(s==null?void 0:s.openai_api_key)&&e.jsx(f,{children:(m=s.openai_api_key)==null?void 0:m.message})]}),e.jsxs(g,{children:[e.jsx(v,{htmlFor:"openai_project_id",children:"OpenAI Project ID"}),e.jsx(b,j(h({maxLength:140,className:"w-48 sm:w-96",id:"openai_project_id",autoComplete:"off",placeholder:"proj_************************"},l("openai_project_id",{maxLength:{value:140,message:"ID cannot be more than 140 characters."}})),{"aria-invalid":s.openai_project_id?"true":"false"})),(s==null?void 0:s.openai_project_id)&&e.jsx(f,{children:(t=s.openai_project_id)==null?void 0:t.message}),e.jsx(y,{children:"If not set, the integration will use the default project."})]})]}):null,i&&e.jsxs(A,{color:"gray",size:"2",children:["OpenAI Python SDK Version: ",i.message]})]})},xe=()=>{var d,p;const{watch:i,control:a,register:n,formState:{errors:l}}=N(),s=i("enable_local_llm"),r=i("local_llm_provider"),u=i("local_llm_api_url"),{call:m,loading:t}=ee("raven.api.ai_features.test_llm_configuration"),[o,x]=S.useState(null),k=()=>M(null,null,function*(){if(!u){L.error("Please enter an API URL");return}try{const c=yield m({provider:"Local LLM",api_url:u,local_llm_provider:r});x({success:c.message.success,message:c.message.message}),c.message.success?L.success("Connection successful!"):L.error(c.message.message)}catch(c){L.error("Failed to test connection"),x({success:!1,message:"Failed to test connection"})}});return e.jsxs(_,{direction:"column",gap:"4",children:[e.jsx(_,{direction:"column",gap:"2",children:e.jsx(A,{as:"label",size:"2",children:e.jsxs(_,{gap:"2",children:[e.jsx(C,{control:a,name:"enable_local_llm",render:({field:c})=>e.jsx(w,{checked:!!c.value,name:c.name,disabled:c.disabled,onCheckedChange:V=>c.onChange(V?1:0)})}),"Enable Local LLM"]})})}),s?e.jsxs(e.Fragment,{children:[e.jsxs(ae,{gap:"1",children:[e.jsx(v,{htmlFor:"local_llm_provider",children:"Local LLM Provider"}),e.jsx(C,{control:a,name:"local_llm_provider",render:({field:c})=>e.jsxs(se,{value:c.value,onValueChange:c.onChange,children:[e.jsx(ne,{placeholder:"Select Provider",className:"w-48 sm:w-96"}),e.jsxs(ie,{children:[e.jsx(I,{value:"LM Studio",children:"LM Studio"}),e.jsx(I,{value:"Ollama",children:"Ollama"}),e.jsx(I,{value:"LocalAI",children:"LocalAI"}),e.jsx(I,{value:"OpenAI Compatible",children:"OpenAI Compatible"})]})]})}),e.jsx(y,{children:"Select your local LLM provider"})]}),e.jsxs(g,{children:[e.jsx(v,{htmlFor:"local_llm_api_url",isRequired:!0,children:"Local LLM API URL"}),e.jsxs(_,{gap:"2",align:"end",children:[e.jsx(b,j(h({className:"w-48 sm:w-96",id:"local_llm_api_url",required:s===1,autoComplete:"off",placeholder:"http://localhost:11434/v1"},n("local_llm_api_url",{required:s?"Please add your Local LLM API URL":!1})),{"aria-invalid":l.local_llm_api_url?"true":"false"})),e.jsxs(z,{type:"button",variant:"soft",className:"not-cal",onClick:k,disabled:t||!u,children:[t&&e.jsx(q,{className:"text-gray-900"}),"Test Connection"]})]}),(l==null?void 0:l.local_llm_api_url)&&e.jsx(f,{children:(d=l.local_llm_api_url)==null?void 0:d.message}),e.jsx(y,{children:"Enter the API endpoint URL for your local LLM service"})]}),r==="OpenAI Compatible"&&e.jsxs(g,{children:[e.jsx(v,{htmlFor:"openai_compatible_api_key",children:"OpenAI Compatible API Key"}),e.jsx(b,j(h({className:"w-48 sm:w-96",id:"openai_compatible_api_key",type:"password",autoComplete:"off",placeholder:"••••••••••••••••••••••••••••••••"},n("openai_compatible_api_key")),{"aria-invalid":l.openai_compatible_api_key?"true":"false"})),(l==null?void 0:l.openai_compatible_api_key)&&e.jsx(f,{children:(p=l.openai_compatible_api_key)==null?void 0:p.message}),e.jsx(y,{children:"Enter the API key for your OpenAI compatible service"})]}),o&&e.jsxs(R,{color:o.success?"green":"red",size:"1",children:[e.jsx(E,{children:o.success?e.jsx(le,{}):e.jsx(oe,{})}),e.jsx(F,{children:o.message})]}),e.jsxs(R,{size:"1",children:[e.jsx(E,{children:e.jsx(re,{})}),e.jsxs(F,{children:[r==="LM Studio"&&"Make sure LM Studio is running with the server enabled on the specified URL.",r==="Ollama"&&"Make sure Ollama is running. Default URL is usually http://localhost:11434/v1",r==="LocalAI"&&"Make sure LocalAI is running on the specified URL.",r==="OpenAI Compatible"&&"Make sure your OpenAI compatible service is running on the specified URL and that you have provided a valid API key.",!r&&"Select a provider to see specific instructions."]})]})]}):null]})},fe=he;export{fe as Component};
