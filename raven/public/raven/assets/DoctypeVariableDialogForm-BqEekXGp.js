var J=Object.defineProperty,Q=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var R=(i,t,s)=>t in i?J(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,f=(i,t)=>{for(var s in t||(t={}))X.call(t,s)&&R(i,s,t[s]);if(O)for(var s of O(t))K.call(t,s)&&R(i,s,t[s]);return i},v=(i,t)=>Q(i,G(t));import{r as g,j as e,p as x,L as _,aD as N,aE as A,aF as M,aG as b,aA as U,u as W,ai as Z,S as m,ax as j,ay as ee,o as S,aJ as w,aP as D,bt as se,c as k,i as T,aS as $,b as V,aH as F,bu as B,h as ne,v as ie,bY as z,b_ as H,cX as te,aq as re,ar as le,at as ae,m as oe,be as ce,bg as de}from"./index-DhM1aug3.js";import{u as C}from"./useDoctypeMeta-Df8LdZCO.js";import{b as q}from"./validations-DJFqvO1k.js";const we=({doctype:i,onAdd:t,defaultValues:s})=>{const r=W({defaultValues:v(f({},s),{child_table_name:s!=null&&s.child_table_name?s==null?void 0:s.child_table_name:i})}),{handleSubmit:a}=r,h=n=>{n.child_table_name===i?t(v(f({},n),{child_table_name:""})):t(n)};return e.jsx("form",{onSubmit:a(h),children:e.jsx(Z,v(f({},r),{children:e.jsxs(m,{gap:"4",className:"max-h-[75vh] overflow-y-auto px-0.5",children:[e.jsxs(m,{gap:"4",children:[e.jsxs(j,{children:[e.jsx(he,{doctype:i}),e.jsx(xe,{doctype:i})]}),e.jsx(je,{}),e.jsx(j,{children:e.jsx(pe,{doctype:i})})]}),e.jsxs(j,{justify:"end",children:[e.jsx(ee,{children:e.jsx(S,{variant:"soft",color:"gray",children:"Close"})}),e.jsx(S,{type:"button",onClick:a(h),children:"Add"})]})]})}))})},he=({doctype:i})=>{const{control:t,setValue:s}=w(),{doc:r}=C(i),a=g.useMemo(()=>{var n;return r?(n=r.fields)==null?void 0:n.filter(c=>c.fieldtype==="Table"||c.fieldtype==="Table MultiSelect"):[]},[r]),h=()=>{s("fieldname",""),s("description",""),s("options",""),s("type","string"),s("required",0)};return e.jsxs(x,{width:"50%",children:[e.jsx(_,{isRequired:!0,htmlFor:"child_table_name",children:"DocType"}),e.jsx(D,{control:t,name:"child_table_name",rules:{onChange:h},render:({field:n})=>e.jsxs(N,{required:!0,value:n.value,onValueChange:n.onChange,disabled:(a==null?void 0:a.length)===0,children:[e.jsx(A,{className:"w-full"}),e.jsxs(M,{children:[e.jsx(b,{value:i,children:i}),a==null?void 0:a.map(c=>{var l,d;return e.jsxs(b,{value:(l=c.fieldname)!=null?l:"",children:[(d=c.options)!=null?d:""," (",c.fieldname,")"]},c.fieldname)})]})]})})]})},ue=["Autocomplete","Attach","Attach Image","Check","Code","Currency","Data","Date","Datetime","Float","HTML Editor","Markdown Editor","Int","JSON","Select","Text","Text Editor","Time","Phone","Percent","Long Text","Small Text","Rating","Link","Dynamic Link"],xe=({doctype:i})=>{const{control:t,watch:s,setValue:r}=w(),a=s("child_table_name"),{field:{value:h,onChange:n}}=se({control:t,name:"fieldname",rules:{required:"Field is required"}}),{doc:c}=C(i),l=g.useMemo(()=>{var u,p;if(i===a)return i;let o=(p=(u=c==null?void 0:c.fields)==null?void 0:u.find(y=>y.fieldname===a))==null?void 0:p.options;return o||i},[c,i,a]),d=o=>{var Y,E,I,L,P;n((Y=o.fieldname)!=null?Y:"");let u=(I=(E=o.label)!=null?E:o.fieldname)!=null?I:"",p="",y="string";o.fieldtype==="Select"&&(p=(L=o.options)!=null?L:""),q(["Int","Rating"],o.fieldtype)&&(y="integer"),q(["Float","Currency","Percent"],o.fieldtype)&&(y="number"),o.fieldtype==="Percent"&&(u=`${o.label} in percentage (between 0 and 100)`),o.fieldtype==="Check"&&(y="boolean"),o.fieldtype==="Date"&&(u=`${o.label} in YYYY-MM-DD format`),o.fieldtype==="Datetime"&&(u=`${o.label} in YYYY-MM-DD HH:mm:ss format`),o.fieldtype==="Time"&&(u=`${o.label} in HH:mm:ss format`),r("description",u),r("options",p),r("type",y),r("required",(P=o.reqd)!=null?P:0)};return e.jsx(me,{doctype:l,value:h,onFieldSelect:d})},me=({doctype:i,value:t,onFieldSelect:s})=>{const{doc:r}=C(i),a=g.useMemo(()=>{var n;return r?(n=r.fields)==null?void 0:n.filter(c=>q(ue,c.fieldtype)):[]},[r]),h=n=>{s(a==null?void 0:a.find(c=>c.fieldname===n))};return e.jsxs(x,{width:"50%",children:[e.jsx(_,{isRequired:!0,htmlFor:"fieldname",children:"Field"}),e.jsxs(N,{value:t,onValueChange:h,required:!0,children:[e.jsx(A,{placeholder:"Select Field",className:"w-full",name:"fieldname"}),e.jsx(M,{children:a==null?void 0:a.map(n=>{var c;return e.jsxs(b,{value:(c=n.fieldname)!=null?c:"",children:[n.label," (",n.fieldname,") ",e.jsx(U,{size:"1",color:"gray",children:n.fieldtype})]},n.fieldname)})})]})]})},je=()=>{var h,n,c;const{control:i,register:t,formState:{errors:s},watch:r}=w(),a=r("do_not_ask_ai");return e.jsxs(m,{gap:"4",children:[e.jsxs(j,{children:[e.jsx(x,{width:"50%",children:e.jsxs(m,{gap:"4",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(_,{isRequired:!0,children:"Variable Type"}),e.jsx(D,{control:i,name:"type",rules:{required:"Type is required"},render:({field:l})=>e.jsxs(N,{required:!0,value:l.value,onValueChange:d=>l.onChange(d),children:[e.jsx(A,{placeholder:"Select a variable type",className:"w-full"}),e.jsxs(M,{children:[e.jsx(b,{value:"string",children:"String"}),e.jsx(b,{value:"integer",children:"Integer"}),e.jsx(b,{value:"number",children:"Number"}),e.jsx(b,{value:"boolean",children:"Boolean"})]})]})})]}),s.type&&e.jsx(k,{children:(h=s.type)==null?void 0:h.message})]}),e.jsx(x,{children:e.jsx(D,{control:i,name:"required",render:({field:l})=>e.jsx(T,{as:"label",size:"2",children:e.jsxs(j,{children:[e.jsx($,{checked:!!l.value,onCheckedChange:d=>l.onChange(d?1:0)}),"Required"]})})})}),e.jsx(x,{children:e.jsx(D,{control:i,name:"do_not_ask_ai",render:({field:l})=>e.jsx(T,{as:"label",size:"2",children:e.jsxs(j,{children:[e.jsx($,{checked:!!l.value,onCheckedChange:d=>l.onChange(d?1:0)}),"Do not ask AI to fill this field?"]})})})})]})}),e.jsx(x,{width:"50%",children:e.jsxs(m,{gap:"1",children:[e.jsxs(x,{children:[e.jsx(_,{htmlFor:"default_value",isRequired:!!a,children:"Default Value"}),e.jsx(V,f({},t("default_value",{required:a?"Default value is required if AI is not asked to fill this field":!1})))]}),s.default_value&&e.jsx(k,{children:(n=s.default_value)==null?void 0:n.message}),e.jsx(F,{children:"You can specify a default value for this variable. If the AI does not fill this field, then the default value will be used."})]})})]}),e.jsxs(m,{gap:"1",children:[e.jsxs(x,{children:[e.jsx(_,{htmlFor:"description",isRequired:!0,children:"Description"}),e.jsx(B,v(f({},t("description",{required:!0})),{placeholder:"Enter a description for this variable"}))]}),s.description&&e.jsx(k,{children:(c=s.description)==null?void 0:c.message}),e.jsx(F,{children:"This is used to describe what this variable is used for. A better description will help the AI Bot perform better."})]})]})},pe=({doctype:i})=>{var l;const{register:t,watch:s,formState:{errors:r}}=w(),a=s("fieldname"),h=s("child_table_name"),{doc:n}=C(i),c=g.useMemo(()=>{var o,u;if(i===h)return i;let d=(u=(o=n==null?void 0:n.fields)==null?void 0:o.find(p=>p.fieldname===h))==null?void 0:u.options;return d||i},[n,i,h,a]);return e.jsxs(m,{gap:"1",width:"100%",children:[e.jsxs(x,{width:"100%",children:[e.jsx(_,{htmlFor:"options",children:"Options"}),e.jsx(B,v(f({},t("options")),{rows:5,placeholder:"Add options separated by a new line."}))]}),r.options&&e.jsx(k,{children:(l=r.options)==null?void 0:l.message}),e.jsxs(F,{children:["You can limit the values that the bot can fill in this field by adding options.",e.jsx("br",{}),"This helps the bot to make less mistakes."]}),e.jsx(x,{pt:"2",children:a&&e.jsx(fe,{doctype:c,fieldname:a})})]})},fe=({doctype:i,fieldname:t})=>{const{doc:s}=C(i),r=g.useMemo(()=>{var l,d,o;return s&&(o=(d=(l=s.fields)==null?void 0:l.find(u=>u.fieldtype==="Link"&&u.fieldname===t))==null?void 0:d.options)!=null?o:""},[s,t]),{setValue:a}=w(),{db:h}=g.useContext(ne),{data:n}=ie("frappe.desk.reportview.get_count",{doctype:r,limit:21},r?void 0:null),c=()=>{h.getDocList(r,{fields:["name"]}).then(l=>{a("options",l.map(d=>d.name).join(`
`))})};return!r||!n||(n==null?void 0:n.message)===0?null:(n==null?void 0:n.message)===21?e.jsx(z,{className:"block",size:"1",children:e.jsxs(j,{align:"center",width:"100%",justify:"between",children:[e.jsxs(H,{weight:"medium",children:["Quickly import ",r,"s?"]}),e.jsx(x,{children:e.jsx(be,{doctype:r})})]})}):e.jsx(z,{className:"block",size:"1",children:e.jsxs(j,{align:"center",width:"100%",justify:"between",children:[e.jsxs(H,{children:["There are only ",n==null?void 0:n.message," options in ",r,".",e.jsx("br",{}),"Do you want to autofill these as options?"]}),e.jsx(x,{children:e.jsx(S,{type:"button",variant:"surface",className:"not-cal",onClick:c,children:"Auto Fill Options"})})]})})},be=({doctype:i})=>{var c;const[t,s]=g.useState(""),{data:r}=te(i,t,void 0,15),{setValue:a,getValues:h}=w(),n=l=>{const d=h("options")||"";let o=[];if(d?o=d.split(`
`):o=[],!o.includes(l)){const u=[...o,l];a("options",u.join(`
`))}};return e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(S,{type:"button",variant:"surface",className:"not-cal",children:["Select ",i,"s"]})}),e.jsx(ae,{width:"360px",children:e.jsxs(m,{children:[e.jsx(V,{value:t,onChange:l=>s(l.target.value),children:e.jsx(oe,{side:"left",children:e.jsx(ce,{})})}),e.jsx(de,{style:{height:360},children:(c=r==null?void 0:r.message)==null?void 0:c.slice(0,15).map(l=>e.jsxs(m,{gap:"0",role:"button",className:"hover:bg-gray-2 px-2 py-1.5 rounded-md cursor-pointer",onClick:()=>n(l.value),children:[e.jsx(T,{size:"2",weight:"medium",children:l.value}),l.description&&e.jsx(T,{size:"1",weight:"light",children:l.description})]},l.value))})]})})]})};export{we as D,ue as V,me as a};
