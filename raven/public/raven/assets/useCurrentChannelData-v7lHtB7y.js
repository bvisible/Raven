const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmojiPicker-CriLUiO4.js","assets/index-Y1VVLmGB.js","assets/index-2ZZXDwaa.css","assets/AddCustomEmojiDialog-CXqDAMVy.js","assets/ImageViewer-C4L6eoeI.js"])))=>i.map(i=>d[i]);
var po=Object.defineProperty,mo=Object.defineProperties;var go=Object.getOwnPropertyDescriptors;var ct=Object.getOwnPropertySymbols;var wr=Object.prototype.hasOwnProperty,yr=Object.prototype.propertyIsEnumerable;var br=(e,t,n)=>t in e?po(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,N=(e,t)=>{for(var n in t||(t={}))wr.call(t,n)&&br(e,n,t[n]);if(ct)for(var n of ct(t))yr.call(t,n)&&br(e,n,t[n]);return e},E=(e,t)=>mo(e,go(t));var pe=(e,t)=>{var n={};for(var r in e)wr.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&ct)for(var r of ct(e))t.indexOf(r)<0&&yr.call(e,r)&&(n[r]=e[r]);return n};var Ke=(e,t,n)=>new Promise((r,s)=>{var o=c=>{try{a(n.next(c))}catch(d){s(d)}},i=c=>{try{a(n.throw(c))}catch(d){s(d)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,i);a((n=n.apply(e,t)).next())});import{dv as xo,a3 as _,G as nn,v as ze,V as Ie,j as l,dw as W,a as v,ac as de,r as C,U as $e,dx as bt,a7 as Be,n as Ee,M as P,dy as Xr,bm as Fn,bx as it,dz as bo,dA as wo,da as yo,dB as vo,bD as Co,dC as jo,dD as ko,i as T,dE as Ao,dF as Jr,dG as To,dH as dt,cx as No,dI as Wn,dJ as rn,dK as So,dL as Eo,bp as Zr,bq as Mo,h as lt,dM as Ro,dN as Lo,dO as _o,dP as Oo,bF as es,e as ye,aq as zo,ar as Ho,bE as Po,p as D,at as Do,ab as sn,d as Io,aI as ts,bd as $o,aB as Bo,dQ as Uo,dR as Fo,dS as on,dT as Wo,dU as Vo,a6 as Vn,aa as Kn,dV as ns,au as Yn,av as rs,dW as qn,o as ve,ay as ss,dX as os,P as ln,dY as is,s as ls,dZ as Ko,a8 as as,d_ as Yo,O as Gn,d$ as qo,e0 as Go,E as cs,bg as Qo,dn as an,a4 as Qn,e1 as Xo,aA as Ct,aS as Jo,bv as Zo,bw as ei,e2 as ds,am as us,e3 as hs,f as fs,e4 as vr,e5 as ti,e6 as Cr,S as _e,ax as ni,e7 as ri,e8 as si,e9 as oi,ea as ii,aj as ps,Q as li,cw as ai,eb as ci,cv as di,ec as ms,ed as gs,ee as xs,ef as bs,eg as ui,cS as hi,dp as fi,a5 as pi,eh as mi,ei as gi,d6 as xi}from"./index-Y1VVLmGB.js";import{u as bi}from"./useGetUserRecords-rC2GEIep.js";import{M as Xn,m as ws,d as wi,e as U,B as yi,N as cn,P as Ue,f as ce,h as vi,i as Ci,k as ji,l as ki,n as Ai,o as Me,q as Ti,D as jt,r as kt,s as Ni,v as Si,w as we,y as Ei,T as Ne,F as ae,z as Se,A as Mi,G as Ri,H as Li,I as _i,J as Oi,R as At,K as ys,L as zi,u as Hi,S as Pi,C as Di,O as Ii,c as $i,Q as Bi,E as Ui,g as Fi,x as Wi,a as Vi,j as Ki,t as Yi,b as qi,p as Gi}from"./index-BkzImaoJ.js";import{u as Qi}from"./useRavenSettings-wwOXHUnJ.js";import{p as Jn,s as Zn,C as er}from"./hover-card-DAJxBtG1.js";import{Q as Xi}from"./preferences-OovuPCdt.js";import{D as vs}from"./DoctypeLinkRenderer-DZkTaZxv.js";import{u as Cs}from"./useDebounce-BM-qfvIa.js";const Ji=xo;function Zi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function An(e,t){return Array(t+1).join(e)}function el(e){return e.replace(/^\n*/,"")}function tl(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}var nl=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function tr(e){return nr(e,nl)}var js=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function ks(e){return nr(e,js)}function rl(e){return Ts(e,js)}var As=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function sl(e){return nr(e,As)}function ol(e){return Ts(e,As)}function nr(e,t){return t.indexOf(e.nodeName)>=0}function Ts(e,t){return e.getElementsByTagName&&t.some(function(n){return e.getElementsByTagName(n).length})}var Y={};Y.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}};Y.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+`
`}};Y.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var r=Number(t.nodeName.charAt(1));if(n.headingStyle==="setext"&&r<3){var s=An(r===1?"=":"-",e.length);return`

`+e+`
`+s+`

`}else return`

`+An("#",r)+" "+e+`

`}};Y.blockquote={filter:"blockquote",replacement:function(e){return e=e.replace(/^\n+|\n+$/g,""),e=e.replace(/^/gm,"> "),`

`+e+`

`}};Y.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return n.nodeName==="LI"&&n.lastElementChild===t?`
`+e:`

`+e+`

`}};Y.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var r=n.bulletListMarker+"   ",s=t.parentNode;if(s.nodeName==="OL"){var o=s.getAttribute("start"),i=Array.prototype.indexOf.call(s.children,t);r=(o?Number(o)+i:i+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?`
`:"")}};Y.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};Y.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){for(var r=t.firstChild.getAttribute("class")||"",s=(r.match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,i=n.fence.charAt(0),a=3,c=new RegExp("^"+i+"{3,}","gm"),d;d=c.exec(o);)d[0].length>=a&&(a=d[0].length+1);var u=An(i,a);return`

`+u+s+`
`+o.replace(/\n$/,"")+`
`+u+`

`}};Y.horizontalRule={filter:"hr",replacement:function(e,t,n){return`

`+n.hr+`

`}};Y.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=Tt(t.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+r+")"}};Y.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,n){var r=t.getAttribute("href"),s=Tt(t.getAttribute("title"));s&&(s=' "'+s+'"');var o,i;switch(n.linkReferenceStyle){case"collapsed":o="["+e+"][]",i="["+e+"]: "+r+s;break;case"shortcut":o="["+e+"]",i="["+e+"]: "+r+s;break;default:var a=this.references.length+1;o="["+e+"]["+a+"]",i="["+a+"]: "+r+s}return this.references.push(i),o},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};Y.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}};Y.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}};Y.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];r.indexOf(n)!==-1;)n=n+"`";return n+t+e+t+n}};Y.image={filter:"img",replacement:function(e,t){var n=Tt(t.getAttribute("alt")),r=t.getAttribute("src")||"",s=Tt(t.getAttribute("title")),o=s?' "'+s+'"':"";return r?"!["+n+"]("+r+o+")":""}};function Tt(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function Ns(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}Ns.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=hn(this.array,e,this.options))||(t=hn(this._keep,e,this.options))||(t=hn(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function hn(e,t,n){for(var r=0;r<e.length;r++){var s=e[r];if(il(s,t,n))return s}}function il(e,t,n){var r=e.filter;if(typeof r=="string"){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(e,t,n))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function ll(e){var t=e.element,n=e.isBlock,r=e.isVoid,s=e.isPre||function(h){return h.nodeName==="PRE"};if(!(!t.firstChild||s(t))){for(var o=null,i=!1,a=null,c=jr(a,t,s);c!==t;){if(c.nodeType===3||c.nodeType===4){var d=c.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!i&&d[0]===" "&&(d=d.substr(1)),!d){c=fn(c);continue}c.data=d,o=c}else if(c.nodeType===1)n(c)||c.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,i=!1):r(c)||s(c)?(o=null,i=!0):o&&(i=!1);else{c=fn(c);continue}var u=jr(a,c,s);a=c,c=u}o&&(o.data=o.data.replace(/ $/,""),o.data||fn(o))}}function fn(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function jr(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var rr=typeof window!="undefined"?window:{};function al(){var e=rr.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch(n){}return t}function cl(){var e=function(){};return dl()?e.prototype.parseFromString=function(t){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(t),n.close(),n}:e.prototype.parseFromString=function(t){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(t),n.close(),n},e}function dl(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){rr.ActiveXObject&&(e=!0)}return e}var ul=al()?rr.DOMParser:cl();function hl(e,t){var n;if(typeof e=="string"){var r=fl().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");n=r.getElementById("turndown-root")}else n=e.cloneNode(!0);return ll({element:n,isBlock:tr,isVoid:ks,isPre:t.preformattedCode?pl:null}),n}var pn;function fl(){return pn=pn||new ul,pn}function pl(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function ml(e,t){return e.isBlock=tr(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=gl(e),e.flankingWhitespace=xl(e,t),e}function gl(e){return!ks(e)&&!sl(e)&&/^\s*$/i.test(e.textContent)&&!rl(e)&&!ol(e)}function xl(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=bl(e.textContent);return n.leadingAscii&&kr("left",e,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&kr("right",e,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}}function bl(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function kr(e,t,n){var r,s,o;return e==="left"?(r=t.previousSibling,s=/ $/):(r=t.nextSibling,s=/^ /),r&&(r.nodeType===3?o=s.test(r.nodeValue):n.preformattedCode&&r.nodeName==="CODE"?o=!1:r.nodeType===1&&!tr(r)&&(o=s.test(r.textContent))),o}var wl=Array.prototype.reduce,yl=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Nt(e){if(!(this instanceof Nt))return new Nt(e);var t={rules:Y,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(n,r){return r.isBlock?`

`:""},keepReplacement:function(n,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(n,r){return r.isBlock?`

`+n+`

`:n}};this.options=Zi({},t,e),this.rules=new Ns(this.options)}Nt.prototype={turndown:function(e){if(!jl(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=Ss.call(this,new hl(e,this.options));return vl.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return yl.reduce(function(t,n){return t.replace(n[0],n[1])},e)}};function Ss(e){var t=this;return wl.call(e.childNodes,function(n,r){r=new ml(r,t.options);var s="";return r.nodeType===3?s=r.isCode?r.nodeValue:t.escape(r.nodeValue):r.nodeType===1&&(s=Cl.call(t,r)),Es(n,s)},"")}function vl(e){var t=this;return this.rules.forEach(function(n){typeof n.append=="function"&&(e=Es(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function Cl(e){var t=this.rules.forNode(e),n=Ss.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function Es(e,t){var n=tl(e),r=el(t),s=Math.max(e.length-n.length,t.length-r.length),o=`

`.substring(0,s);return n+o+r}function jl(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}const kl=(e,t)=>()=>{if(e){if(t){navigator.clipboard.writeText(t),_.success("Text copied to clipboard");return}if(e.message_type==="Text"){let o=e.text.replace(/^\s*[\r\n]/gm,"");var r=new Nt({codeBlockStyle:"fenced"});r.addRule("links",{filter:"a",replacement:function(i,a,c){var d;return(d=a.textContent)!=null?d:i}});var s=r.turndown(o);s?(navigator.clipboard.writeText(s),_.success("Text copied to clipboard")):_.error("Could not copy text")}else(e.message_type==="Image"||e.message_type==="File")&&(e.file.startsWith("http")||e.file.startsWith("https")?navigator.clipboard.writeText(e.file):navigator.clipboard.writeText(window.location.origin+e.file),_.success("Link copied"))}};function Al(e){return nn({attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19.164 19.547c-1.641-2.5-3.669-3.285-6.164-3.484v1.437c0 .534-.208 1.036-.586 1.414-.756.756-2.077.751-2.823.005l-6.293-6.207c-.191-.189-.298-.444-.298-.713s.107-.524.298-.712l6.288-6.203c.754-.755 2.073-.756 2.829.001.377.378.585.88.585 1.414v1.704c4.619.933 8 4.997 8 9.796v1c0 .442-.29.832-.714.958-.095.027-.19.042-.286.042-.331 0-.646-.165-.836-.452zm-7.141-5.536c2.207.056 4.638.394 6.758 2.121-.768-3.216-3.477-5.702-6.893-6.08-.504-.056-.888-.052-.888-.052v-3.497l-5.576 5.496 5.576 5.5v-3.499l1.023.011z"},child:[]}]})(e)}const Tl=({message:e})=>{var s,o;const{data:t}=ze("raven.api.raven_poll.get_poll",{message_id:e==null?void 0:e.name},`poll_data_${e==null?void 0:e.poll_id}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1}),{call:n}=Ie("raven.api.raven_poll.retract_vote"),r=()=>n({poll_id:e==null?void 0:e.poll_id}).then(()=>{_("Vote retracted")}).catch(i=>{_.error("Could not retract vote",{description:de(i)})});return t&&((s=t.message)==null?void 0:s.current_user_votes.length)>0?l.jsx(W,{onSelect:r,disabled:!!((o=t.message)!=null&&o.poll.is_disabled),children:l.jsxs(v,{gap:"2",children:[l.jsx(Al,{size:"18"}),"Retract vote"]})}):null};function Nl(e){return nn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M320 320 192 192m0 128 128-128"},child:[]}]})(e)}function Md(e){return nn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(e)}function Sl(e){return nn({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M368 192h-16v-80a96 96 0 1 0-192 0v80h-16a64.07 64.07 0 0 0-64 64v176a64.07 64.07 0 0 0 64 64h224a64.07 64.07 0 0 0 64-64V256a64.07 64.07 0 0 0-64-64zm-48 0H192v-80a64 64 0 1 1 128 0z"},child:[]}]})(e)}const El=({message:e})=>{var o,i;const{currentUser:t}=C.useContext($e),{data:n}=ze("raven.api.raven_poll.get_poll",{message_id:e==null?void 0:e.name},`poll_data_${e==null?void 0:e.poll_id}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1}),{call:r}=Ie("raven.api.raven_poll.close_poll"),s=()=>r({poll_id:e==null?void 0:e.poll_id}).then(()=>{_.success("Poll closed")}).catch(a=>{_.error("Could not close poll",{description:de(a)})});return n&&((o=n.message)==null?void 0:o.poll.owner)===t&&!((i=n.message)!=null&&i.poll.is_disabled)?l.jsxs(l.Fragment,{children:[l.jsx(W,{onSelect:s,children:l.jsxs(v,{gap:"2",children:[l.jsx(Nl,{size:"18"}),"Close Poll"]})}),l.jsx(bt,{})]}):null},sr="bg-gray-2 dark:bg-gray-2 hover:bg-gray-4 dark:hover:bg-gray-5 text-gray-12 hover:text-gray-12",qe=C.forwardRef((s,r)=>{var o=s,{className:e,tooltip:t}=o,n=pe(o,["className","tooltip"]);return l.jsx(Be,{content:t,children:l.jsx(Ee,N({size:"2",className:P(sr,e),ref:r},n))})}),Ms=e=>{const t=Fn(),{workspaceID:n}=it(),{call:r}=Ie("raven.api.threads.create_thread");return()=>{r({message_id:e}).then(o=>{_.success("Thread created"),t(`/${n}/${o.message.channel_id}/thread/${o.message.thread_id}`)}).catch(()=>{_.error("Failed to create thread")})}},Ml=({messageID:e})=>{const t=Ms(e);return l.jsx(qe,{tooltip:"Create a thread","aria-label":"Create a thread",onClick:t,children:l.jsx(Xr,{size:"16"})})},Rl=({messageID:e})=>{const t=Ms(e);return l.jsx(W,{onSelect:t,children:l.jsxs(v,{gap:"2",align:"center",width:"100%",children:[l.jsx(Xr,{size:"18"}),"Create Thread"]})})},Ll=e=>l.jsxs(bo,{children:[l.jsx(wo,{children:l.jsxs(v,{gap:"2",align:"center",children:[l.jsx(yo,{size:"18"}),"Actions"]})}),l.jsx(vo,{children:l.jsx(_l,N({},e))})]}),_l=e=>{const{data:t}=Co("Raven Message Action",{fields:["name","action_name"],filters:[["enabled","=",1]],orderBy:{field:"action",order:"asc"}},void 0,{revalidateOnFocus:!1}),n=jo(ko);return l.jsx(l.Fragment,{children:t&&t.length>0?t==null?void 0:t.map(r=>l.jsx(W,{onClick:()=>n({actionID:r.name,messageID:e.messageID}),children:l.jsx(T,{size:"2",weight:"medium",children:r.action_name})},r.name)):l.jsx(W,{disabled:!0,children:"No Actions Available"})})},Rs=({message:e,onDelete:t,onEdit:n,onReply:r,onForward:s,showThreadButton:o,onAttachDocument:i,onViewReaction:a,selectedText:c})=>{var p;const d=kl(e,c),{currentUser:u}=C.useContext($e),h=u===(e==null?void 0:e.owner)&&!(e!=null&&e.is_bot_message),f=Object.keys(JSON.parse((p=e==null?void 0:e.message_reactions)!=null?p:"{}")).length!==0;return l.jsx(Ao,{children:e?l.jsxs(l.Fragment,{children:[e&&e.message_type==="Poll"&&l.jsx(Tl,{message:e}),e&&e.message_type==="Poll"&&l.jsx(El,{message:e}),l.jsx(W,{onSelect:r,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Jr,{size:"18"}),"Reply"]})}),l.jsx(W,{onSelect:s,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(To,{size:"18"}),"Forward"]})}),e&&!e.is_thread&&o&&l.jsx(Rl,{messageID:e.name}),l.jsx(Ol,{message:e}),l.jsx(bt,{}),l.jsxs(dt,{children:[(e.text||c)&&l.jsx(W,{onSelect:d,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(No,{size:"18"}),"Copy ",c?"Selected Text":""]})}),["File","Image"].includes(e.message_type)&&l.jsxs(dt,{children:[l.jsx(W,{onSelect:d,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Wn,{size:"18"}),"Copy link"]})}),l.jsx(W,{asChild:!0,children:l.jsx("a",{download:!0,href:e.file,children:l.jsxs(v,{gap:"2",children:[l.jsx(rn,{size:"18"}),"Download"]})})}),l.jsx(W,{onSelect:i,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(So,{size:"18"}),"Attach File to Document"]})})]}),o&&l.jsx(Hl,{message:e}),l.jsx(zl,{message:e})]}),f&&l.jsxs(dt,{children:[l.jsx(bt,{}),l.jsx(W,{onSelect:a,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Eo,{size:"18"}),"View Reactions"]})})]}),l.jsx(Ll,{messageID:e.name}),h&&l.jsxs(dt,{children:[l.jsx(bt,{}),e.text?l.jsx(W,{onSelect:n,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Zr,{size:"18"}),"Edit"]})}):null,l.jsx(W,{color:"red",onSelect:t,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Mo,{size:"18"}),"Delete"]})})]})]}):null})},Ol=({message:e})=>{const{workspaceID:t,threadID:n}=it(),r=()=>{let s="raven";window.location.origin.endsWith("/")||(s="/"+s),n===e.channel_id?navigator.clipboard.writeText(`${window.location.origin}${s}/${encodeURIComponent(t!=null?t:"channels")}/threads/${encodeURIComponent(n)}?message_id=${encodeURIComponent(e.name)}`):navigator.clipboard.writeText(`${window.location.origin}${s}/${encodeURIComponent(t!=null?t:"channels")}/${encodeURIComponent(e.channel_id)}?message_id=${encodeURIComponent(e.name)}`),_.success("Message link copied to clipboard")};return l.jsx(W,{onSelect:r,children:l.jsxs(v,{gap:"2",width:"100%",children:[l.jsx(Wn,{size:"18"}),"Copy Message Link"]})})},zl=({message:e})=>{const{currentUser:t}=C.useContext($e),n=JSON.parse(e._liked_by?e._liked_by:"[]").includes(t),{call:r}=C.useContext(lt),s=()=>{r.post("raven.api.raven_message.save_message",{message_id:e.name,add:n?"No":"Yes"}).then(()=>{n?_("Message unsaved"):_.success("Message saved")}).catch(o=>{_.error("Could not perform the action",{description:de(o)})})};return l.jsx(W,{onSelect:s,children:l.jsxs(v,{gap:"2",width:"100%",children:[!n&&l.jsx(_o,{size:"18"}),n&&l.jsx(Oo,{size:"18"}),n?"Unsave":"Save"," Message"]})})},Hl=({message:e})=>{const t=e.is_pinned,{call:n}=C.useContext(lt),r=()=>{n.post("raven.api.raven_channel.toggle_pin_message",{channel_id:e.channel_id,message_id:e.name}).then(()=>{_.success(`Message ${t?"unpinned":"pinned"}`)}).catch(s=>{_.error("Could not perform the action",{description:de(s)})})};return l.jsx(W,{onSelect:r,children:l.jsxs(v,{gap:"2",width:"100%",children:[t?l.jsx(Lo,{size:"18"}):l.jsx(Ro,{size:"18"}),t?"Unpin":"Pin"]})})},Tn=({timestamp:e,timeFormat:t="hh:mm A"})=>{const{tooltipContent:n,time:r}=C.useMemo(()=>{const s=es(e);return{tooltipContent:s.format("Do MMMM [at] hh:mm A"),time:s.format(t)}},[e,t]);return l.jsx(Be,{content:n,children:l.jsx(ye,{asChild:!0,size:"1",color:"gray",children:l.jsx("span",{children:r})})})},Pl=({timestamp:e})=>{const{tooltipContent:t,time:n}=C.useMemo(()=>{const r=es(e);return{tooltipContent:r.format("Do MMMM [at] hh:mm A"),time:r.format("hh:mm")}},[e]);return l.jsx(Be,{content:t,children:l.jsx(ye,{asChild:!0,style:{fontSize:"0.68rem"},color:"gray",className:"tabular-nums",children:l.jsx("span",{children:n})})})},Dl=C.lazy(()=>ts(()=>import("./EmojiPicker-CriLUiO4.js"),__vite__mapDeps([0,1,2,3]))),Ls=({saveReaction:e,isOpen:t,setIsOpen:n,iconButtonProps:r,iconSize:s="18"})=>{const o=()=>{n(!1)},i=(a,c,d)=>{e(a,c,d),o()};return l.jsx(zo,{open:t,onOpenChange:n,children:l.jsxs(v,{children:[l.jsx(Be,{content:"Add reaction",children:l.jsx(Ho,{children:l.jsx(Ee,E(N({variant:"soft",size:"2",color:"gray","aria-label":"pick emoji"},r),{className:P(sr,r==null?void 0:r.className),children:l.jsx(Po,{size:s})}))})}),l.jsx(Ji,{children:l.jsx(D,{className:"z-10",children:l.jsx(Do,{className:`${sn} p-0`,children:l.jsx(C.Suspense,{fallback:l.jsx(Io,{}),children:l.jsx(Dl,{onSelect:i})})})})})]})})},_s=()=>{const{call:e}=C.useContext(lt),{mutate:t}=$o(),{name:n}=Bo();return C.useCallback((s,o,i=!1,a)=>{const c=d=>{var f,p,g;const h=((f=d==null?void 0:d.message.messages)!=null?f:[]).map(m=>{var y;if(m.name!==s.name)return m;const b=JSON.parse((y=m.message_reactions)!=null?y:"{}"),x=i&&a!=null?a:o;if(b[x]){const j=b[x].users.includes(n),A=b[x].count;j?A===1?delete b[x]:(b[x].users=b[x].users.filter(k=>k!==n),b[x].count=b[x].count-1):(b[x].users.push(n),b[x].count=b[x].count+1)}else b[x]={reaction:o,users:[n],count:1,emoji_name:a!=null?a:""};return E(N({},m),{message_reactions:JSON.stringify(b)})});return{message:{has_new_messages:(p=d==null?void 0:d.message.has_new_messages)!=null?p:!1,has_old_messages:(g=d==null?void 0:d.message.has_old_messages)!=null?g:!0,messages:h}}};return t({path:`get_messages_for_channel_${s.channel_id}`},d=>Ke(null,null,function*(){return e.post("raven.api.reactions.react",{message_id:s.name,reaction:o,is_custom:i,emoji_name:a}).then(()=>c(d))}),{optimisticData:d=>c(d),rollbackOnError:!0,revalidate:!1})},[])},Os=({message:e,message_reactions:t})=>{const{currentUser:n}=C.useContext($e),r=_s(),s=C.useCallback((a,c=!1,d)=>{e&&r(e,a,c,d).catch(u=>{_.error("Could not react to message.",{description:de(u)})})},[e]),o=bi(),i=C.useMemo(()=>{const a=JSON.parse(t!=null?t:"{}");return Object.entries(a).map(([c,d])=>E(N({},d),{emoji_name:c}))},[t]);return i.length===0?null:l.jsxs(v,{gap:"1",mt:"1",wrap:"wrap",children:[i.map(a=>l.jsx($l,{reaction:a,onReactionClick:s,currentUser:n,allUsers:o},a.reaction)),l.jsx(Il,{saveReaction:s})]})},Il=({saveReaction:e})=>{const[t,n]=C.useState(!1);return l.jsx(Ls,{saveReaction:e,isOpen:t,setIsOpen:n,iconButtonProps:{size:"1",className:"bg-gray-3 dark:bg-gray-5 py-0.5 w-[3ch] text-gray-10 dark:text-gray-11 h-full rounded-md",variant:"soft",color:"gray"},iconSize:"15"})},$l=({reaction:e,onReactionClick:t,currentUser:n,allUsers:r})=>{const{reaction:s,users:o,count:i,emoji_name:a}=e,c=C.useCallback(()=>{t(s,e.is_custom,a)},[t,s]),{label:d,currentUserReacted:u}=C.useMemo(()=>({label:`${Uo(o,i,n,r)} reacted with ${a}`,currentUserReacted:o.includes(n)}),[r,i,n,e,o]);return l.jsx(Be,{content:l.jsx("span",{className:"my-0 max-w-96",children:d}),children:l.jsx("button",{onClick:c,className:P("w-fit sm:h-full text-xs py-0.5 cursor-pointer rounded-md min-w-[4ch] border font-semibold",u?"bg-blue-50 border-blue-500 dark:border-gray-9 dark:bg-gray-7 sm:dark:hover:bg-gray-7":"bg-gray-3 border-gray-3 sm:hover:bg-gray-2 sm:hover:border-gray-8 dark:bg-gray-5 sm:dark:hover:bg-gray-5 sm:dark:hover:border-gray-9"),children:l.jsxs(T,{as:"span",className:P("flex items-center gap-1 min-w-[3ch] tabular-nums h-[1.2rem] text-gray-12",u?"text-blue-800 dark:text-gray-12":"text-gray-12"),children:[e.is_custom?l.jsx("img",{src:s,alt:s,loading:"lazy",className:"w-[1.1rem] h-[1.1rem] object-contain object-center"}):l.jsx("span",{className:"-mb-1 w-[1.1rem] h-[1.1rem]",children:l.jsx("em-emoji",{native:s,set:"apple",size:"1.2em"})}),i]})})})};var Bl=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Ge=e=>{let t=0;for(let n=0;n<e.length;n++){let r=e[n],s=Bl.indexOf(r);t=t*83+s}return t},mn=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},gn=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},Ul=e=>e<0?-1:1,xn=(e,t)=>Ul(e)*Math.pow(Math.abs(e),t),Ar=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},Fl=e=>{if(!e||e.length<6)throw new Ar("The blurhash string must be at least 6 characters");let t=Ge(e[0]),n=Math.floor(t/9)+1,r=t%9+1;if(e.length!==4+2*r*n)throw new Ar(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*r*n}`)},Wl=e=>{let t=e>>16,n=e>>8&255,r=e&255;return[mn(t),mn(n),mn(r)]},Vl=(e,t)=>{let n=Math.floor(e/361),r=Math.floor(e/19)%19,s=e%19;return[xn((n-9)/9,2)*t,xn((r-9)/9,2)*t,xn((s-9)/9,2)*t]},Kl=(e,t,n,r)=>{Fl(e),r=r|1;let s=Ge(e[0]),o=Math.floor(s/9)+1,i=s%9+1,a=(Ge(e[1])+1)/166,c=new Array(i*o);for(let h=0;h<c.length;h++)if(h===0){let f=Ge(e.substring(2,6));c[h]=Wl(f)}else{let f=Ge(e.substring(4+h*2,6+h*2));c[h]=Vl(f,a*r)}let d=t*4,u=new Uint8ClampedArray(d*n);for(let h=0;h<n;h++)for(let f=0;f<t;f++){let p=0,g=0,m=0;for(let j=0;j<o;j++)for(let A=0;A<i;A++){let k=Math.cos(Math.PI*f*A/t)*Math.cos(Math.PI*h*j/n),R=c[A+j*i];p+=R[0]*k,g+=R[1]*k,m+=R[2]*k}let b=gn(p),x=gn(g),y=gn(m);u[4*f+0+h*d]=b,u[4*f+1+h*d]=x,u[4*f+2+h*d]=y,u[4*f+3+h*d]=255}return u},Yl=Kl,ql=Object.defineProperty,Gl=Object.defineProperties,Ql=Object.getOwnPropertyDescriptors,St=Object.getOwnPropertySymbols,zs=Object.prototype.hasOwnProperty,Hs=Object.prototype.propertyIsEnumerable,Tr=(e,t,n)=>t in e?ql(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nn=(e,t)=>{for(var n in t||(t={}))zs.call(t,n)&&Tr(e,n,t[n]);if(St)for(var n of St(t))Hs.call(t,n)&&Tr(e,n,t[n]);return e},Sn=(e,t)=>Gl(e,Ql(t)),Ps=(e,t)=>{var n={};for(var r in e)zs.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&St)for(var r of St(e))t.indexOf(r)<0&&Hs.call(e,r)&&(n[r]=e[r]);return n},Ds=class extends C.PureComponent{constructor(){super(...arguments),this.canvas=null,this.handleRef=e=>{this.canvas=e,this.draw()},this.draw=()=>{let{hash:e,height:t,punch:n,width:r}=this.props;if(this.canvas){let s=Yl(e,r,t,n),o=this.canvas.getContext("2d"),i=o.createImageData(r,t);i.data.set(s),o.putImageData(i,0,0)}}}componentDidUpdate(){this.draw()}render(){let e=this.props,{hash:t,height:n,width:r}=e,s=Ps(e,["hash","height","width"]);return C.createElement("canvas",Sn(Nn({},s),{height:n,width:r,ref:this.handleRef}))}};Ds.defaultProps={height:128,width:128};var Xl={position:"absolute",top:0,bottom:0,left:0,right:0,width:"100%",height:"100%"},Is=class extends C.PureComponent{componentDidUpdate(){if(this.props.resolutionX<=0)throw new Error("resolutionX must be larger than zero");if(this.props.resolutionY<=0)throw new Error("resolutionY must be larger than zero")}render(){let e=this.props,{hash:t,height:n,width:r,punch:s,resolutionX:o,resolutionY:i,style:a}=e,c=Ps(e,["hash","height","width","punch","resolutionX","resolutionY","style"]);return C.createElement("div",Sn(Nn({},c),{style:Sn(Nn({display:"inline-block",height:n,width:r},a),{position:"relative"})}),C.createElement(Ds,{hash:t,height:i,width:o,punch:s,style:Xl}))}};Is.defaultProps={height:128,width:128,resolutionX:32,resolutionY:32};const Jl=C.lazy(()=>ts(()=>import("./ImageViewer-C4L6eoeI.js"),__vite__mapDeps([4,1,2]))),Zl=C.memo(({message:e,isScrolling:t=!1,user:n})=>{var b;const[r,s]=C.useState(!1),o=Fo(),i=on(e.file),[a,c]=C.useState(!0),{height:d,width:u}=C.useMemo(()=>{if(!a)return{height:"0",width:"0"};let x="200",y="300";return e.thumbnail_height&&(x=String(o?e.thumbnail_height/2:e.thumbnail_height)),e.thumbnail_width&&(y=String(o?e.thumbnail_width/2:e.thumbnail_width)),{height:x,width:y}},[e.thumbnail_height,e.thumbnail_width,o,a]),h=C.useRef(null),f=()=>{c(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},200)},[p,g]=C.useState(!1),m=()=>{g(!0)};return l.jsxs(v,{direction:"column",gap:"1",children:[l.jsxs(v,{className:"py-1 items-center",children:[l.jsx(Ee,{size:"1",variant:"ghost",color:"gray",radius:"large",className:"pl-0 pr-[6px] font-bold hover:bg-transparent text-accent-a11 hover:text-gray-12","aria-label":`Click to ${a?"hide":"show"} image`,title:`${a?"Hide":"Show"} image`,onClick:()=>a?c(!1):f(),children:a?l.jsx(Wo,{size:"20",className:"pt-[1px]"}):l.jsx(Vo,{size:"20",className:"pt-[1px]"})}),l.jsx(ye,{href:e.file,size:"1",color:"gray",target:"_blank",children:i})]}),l.jsxs(D,{ref:h,className:"relative rounded-md cursor-pointer transition-all duration-300 ease-ease-out-circ overflow-hidden",role:"button",onClick:()=>s(!t&&!0),style:{height:d+"px",width:u+"px"},children:[l.jsx(D,{className:" absolute top-0 z-0 left-0",style:{height:d+"px",width:u+"px"},children:e.blurhash&&e.blurhash.length===28&&!p?l.jsx(Is,{hash:e.blurhash,width:u+"px",height:d+"px"}):l.jsx(D,{style:{height:d+"px",width:u+"px"},className:"bg-gray-3 z-0 dark:bg-gray-5 rounded-md"})}),l.jsx("img",{src:e.file,loading:"lazy",className:"z-50 absolute top-0 left-0 rounded-md shadow-md object-cover",height:d,style:{maxHeight:d+"px",maxWidth:u+"px",minHeight:d+"px",minWidth:u+"px"},onLoad:m,width:u,alt:`Image file sent by ${e.owner} at ${e.creation}`,onContextMenu:x=>{x.stopPropagation()}})]}),!t&&l.jsx(Vn,{open:r,onOpenChange:s,children:l.jsxs(Kn,{className:P(sn,"sm:max-w-[88vw]",o&&"fixed inset-0 w-full h-full max-w-none p-0 rounded-none bg-black overflow-hidden"),children:[o&&l.jsx(Ee,{size:"3",variant:"ghost",color:"gray",className:"fixed top-4 right-4 z-10 text-white",onClick:()=>s(!1),children:l.jsx(ns,{size:"24"})}),l.jsx(Yn,{size:"3",className:"h-0 invisible sm:h-auto sm:visible",children:i}),l.jsxs(rs,{color:"gray",size:"1",className:"h-0 invisible sm:h-auto sm:visible",children:[(b=n==null?void 0:n.full_name)!=null?b:e.owner," on ",l.jsx(qn,{date:e.creation})]}),l.jsx(D,{className:P("w-full mx-auto items-center flex justify-center",o?"h-[100dvh] absolute inset-0":"my-4"),children:l.jsx(C.Suspense,{fallback:l.jsx("img",{src:e.file,loading:"lazy",width:"100%",className:P("object-contain",o?"h-[100dvh] w-full":"rounded-md shadow-md max-h-[90vh] sm:max-h-[600px]"),alt:`Image file sent by ${e.owner} at ${e.creation}`}),children:l.jsx(Jl,{children:l.jsx("img",{src:e.file,loading:"lazy",width:"100%",className:P("object-contain",o?"h-[100dvh] w-full":"rounded-md shadow-md max-h-[90vh] sm:max-h-[600px]"),alt:`Image file sent by ${e.owner} at ${e.creation}`})})})}),!o&&l.jsxs(v,{justify:"end",gap:"2",mt:"3",children:[l.jsx(ve,{variant:"soft",color:"gray",asChild:!0,children:l.jsxs(ye,{className:"no-underline",href:e.file,download:!0,children:[l.jsx(rn,{}),"Download"]})}),l.jsx(ss,{children:l.jsx(ve,{color:"gray",variant:"soft",children:"Close"})})]})]})})]})}),ea=C.memo(r=>{var s=r,{message:e,user:t}=s,n=pe(s,["message","user"]);var f;const o=(f=e.file)==null?void 0:f.split("?")[0],i=os(o),a=on(o),c=Ko(i),d=i==="pdf",u=()=>{o.startsWith("http")||o.startsWith("https")?navigator.clipboard.writeText(o):navigator.clipboard.writeText(window.location.origin+o),_.success("Link copied")},h=ln();return l.jsx(D,E(N({},n),{children:c?l.jsxs(v,{gap:"2",direction:"column",children:[l.jsx(ye,{href:e.file,size:"1",download:!0,title:"Download",color:"gray",target:"_blank",children:a}),l.jsx("video",{src:e.file,controls:!0,className:"rounded-md shadow-md max-h-96 max-w-[620px]"})]}):l.jsxs(v,{align:"center",gap:"4",p:"4",className:"border bg-gray-1 dark:bg-gray-3 rounded-md border-gray-4 dark:border-gray-6 w-fit",children:[l.jsxs(v,{align:"center",gap:"2",children:[l.jsx(is,{ext:i}),l.jsx(T,{as:"span",size:"2",className:"text-ellipsis overflow-hidden line-clamp-1",children:a})]}),l.jsxs(v,{align:"center",gap:"2",children:[d&&h&&l.jsx(ta,{message:e,user:t}),l.jsx(Ee,{size:{md:"1",sm:"2"},title:"Copy link",color:"gray",onClick:u,variant:"soft",children:l.jsx(Wn,{className:"text-lg sm:text-base"})}),l.jsx(Ee,{size:{md:"1",sm:"2"},asChild:!0,title:"Download",color:"gray",variant:"soft",children:l.jsx(ye,{className:"no-underline",href:e.file,download:!0,children:h?l.jsx(rn,{className:"text-lg sm:text-base"}):l.jsx(ls,{className:"text-lg sm:text-base"})})})]})]})}))}),ta=({message:e,user:t})=>{const n=on(e.file);return l.jsx(D,{children:l.jsxs(Vn,{children:[l.jsx(as,{children:l.jsx(Ee,{size:{md:"1",sm:"2"},color:"gray",variant:"soft",title:"Preview",children:l.jsx(ls,{className:"text-lg sm:text-base"})})}),l.jsx(Kn,{className:P(sn,"min-w-[64rem]"),size:"4",children:l.jsx(na,{fileName:n,user:t,message:e})})]})})},na=({fileName:e,user:t,message:n})=>{var r;return l.jsxs(l.Fragment,{children:[l.jsx(Yn,{size:"3",children:e}),l.jsxs(rs,{color:"gray",size:"1",children:[(r=t==null?void 0:t.full_name)!=null?r:n.owner," on ",l.jsx(qn,{date:n.creation})]}),l.jsx(D,{my:"4",children:l.jsx("embed",{src:n.file,type:"application/pdf",width:"100%",height:"680px"})}),l.jsxs(v,{justify:"end",gap:"2",mt:"3",children:[l.jsx(ve,{variant:"soft",color:"gray",asChild:!0,children:l.jsxs(ye,{className:"no-underline",href:n.file,download:!0,children:[l.jsx(rn,{size:"18"}),"Download"]})}),l.jsx(ss,{children:l.jsx(ve,{color:"gray",variant:"soft",children:"Close"})})]})]})},ra=({poll:e})=>{const[t,n]=C.useState(!1),r=()=>{n(!1)},s=ln(),o=e.poll.is_disabled?"View Results":"View Votes";return s?l.jsxs(Vn,{open:t,onOpenChange:n,children:[l.jsx(as,{children:l.jsx(ve,{variant:"ghost",size:"1",className:"-mb-2.5 bg-transparent hover:text-accent-10 w-full",children:o})}),l.jsx(Kn,{className:P(sn,"max-h-[80vh]"),children:l.jsx(Nr,{onClose:r,poll:e})})]}):l.jsxs(Yo,{open:t,onOpenChange:n,children:[l.jsx(Gn,{className:"w-full"}),l.jsx(qo,{asChild:!0,children:l.jsx(ve,{variant:"ghost",size:"1",className:"bg-transparent hover:text-accent-10 w-full",children:o})}),l.jsx(Go,{children:l.jsx("div",{className:"h-[80vh]",children:l.jsx(Nr,{onClose:r,poll:e})})})]})},Nr=({onClose:e,poll:t})=>{const{data:n,error:r}=ze("raven.api.raven_poll.get_all_votes",{poll_id:t.poll.name},`poll_votes_${t.poll.name}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1});return l.jsxs(v,{direction:"column",gap:"2",children:[l.jsx(cs,{error:r}),n&&n.message&&l.jsx(sa,{votesData:n.message,poll:t})]})},sa=({votesData:e,poll:t})=>l.jsxs(v,{direction:"column",children:[l.jsx(Yn,{children:l.jsxs(v,{justify:"between",align:"baseline",children:[l.jsx(T,{children:"Poll Votes"}),l.jsxs(T,{size:"2",color:"gray",className:"not-cal",children:[t.poll.total_votes," votes"]})]})}),l.jsx(Gn,{className:"w-full"}),l.jsx(Qo,{className:"h-[76vh]",type:"scroll",children:l.jsxs(v,{direction:"column",className:"py-4 pr-3",gap:"2",children:[l.jsx(T,{size:"3",weight:"bold",children:t.poll.question}),e&&Object.keys(e).map(n=>{var o;const r=e[n],s=(o=t.poll.options.find(i=>i.name===n))==null?void 0:o.option;return l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between py-2",children:[l.jsxs(v,{children:[l.jsx(T,{size:"1",children:s}),l.jsxs(T,{size:"1",color:"gray",className:"ml-1",children:["- ",r.percentage.toFixed(2),"%"]})]}),l.jsxs(T,{size:"1",color:"gray",children:[r.count," vote",r.count>1?"s":""]})]},n),l.jsx(v,{direction:"column",gap:"2",className:"bg-gray-100 dark:bg-gray-3 rounded-md py-2 px-2",children:r.users.map(i=>l.jsx("div",{className:"group",children:l.jsx(oa,{user_id:i})},i))})]})})]})})]}),oa=({user_id:e})=>{const t=an(e);return l.jsxs(v,{gap:"2",children:[l.jsx(Qn,{alt:t==null?void 0:t.full_name,src:t==null?void 0:t.user_image,size:"2"}),l.jsx("div",{className:"flex flex-col text-ellipsis justify-center border-b border-gray-6 w-full pb-2 group-last:pb-0 group-last:border-b-0",children:l.jsx(T,{as:"span",className:"block",weight:"medium",size:"2",children:t==null?void 0:t.full_name})})]})},ia=r=>{var s=r,{message:e,user:t}=s,n=pe(s,["message","user"]);const{data:o,error:i,mutate:a}=ze("raven.api.raven_poll.get_poll",{message_id:e.name},`poll_data_${e.poll_id}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1});return Xo("Raven Poll",e.poll_id,()=>{a()}),l.jsxs(D,E(N({},n),{pt:"1",children:[l.jsx(cs,{error:i}),o&&l.jsx(la,{data:o.message,messageID:e.name})]}))},la=({data:e,messageID:t})=>l.jsx(v,{align:"center",gap:"4",p:"2",className:`bg-gray-2
        shadow-sm
        dark:bg-gray-3
        min-w-64
        max-w-[420px]
        w-full
        rounded-md
        ${e.poll.is_disabled?"":"group-hover:bg-accent-a2 dark:group-hover:bg-gray-4 group-hover:transition-all group-hover:delay-100"}`,children:l.jsxs(v,{direction:"column",gap:"2",p:"2",className:"w-full",children:[l.jsxs(v,{direction:"column",gap:"2",children:[l.jsxs(v,{justify:"between",align:"center",gap:"2",children:[l.jsx(T,{size:"2",weight:"medium",children:e.poll.question}),e.poll.is_anonymous?l.jsx(Ct,{color:"blue",className:"w-fit",children:"Anonymous"}):null]}),e.poll.is_disabled?l.jsxs(Ct,{color:"gray",className:"w-fit mb-2",children:[l.jsx(Sl,{}),"Poll is now closed. No more votes will be accepted."]}):null,e.poll.end_date&&!e.poll.is_disabled&&l.jsxs(T,{size:"1",color:"gray",children:["This poll will end on ",new Date(e.poll.end_date).toLocaleString(),"."]})]}),e.current_user_votes.length>0?l.jsx(aa,{data:e}):l.jsx(l.Fragment,{children:e.poll.is_multi_choice?l.jsx(ua,{data:e,messageID:t}):l.jsx(da,{data:e,messageID:t})}),e.poll.is_anonymous?null:l.jsx(ra,{poll:e})]})}),aa=({data:e})=>l.jsxs(v,{direction:"column",gap:"2",className:"w-full",children:[e.poll.options.map(t=>l.jsx(ca,{data:e,option:t},t.name)),l.jsxs(T,{as:"span",size:"1",color:"gray",className:"px-2",children:[e.poll.total_votes," vote",e.poll.total_votes>1?"s":""]})]}),ca=({data:e,option:t})=>{const[n,r]=C.useState(!1);C.useEffect(()=>{r(!0)},[e]);const s=C.useMemo(()=>e.current_user_votes.some(a=>a.option===t.name),[e.current_user_votes,t.name]),o=C.useMemo(()=>{var c;return(d=>{if(e.poll.is_multi_choice){const u=e.poll.options.reduce((h,f)=>{var p;return h+((p=f.votes)!=null?p:0)},0);return d/u*100}else return d/e.poll.total_votes*100})((c=t.votes)!=null?c:0)},[t.votes,e]),i=`${o}%`;return l.jsxs(v,{justify:"between",align:"center",className:"relative",children:[l.jsx(D,{position:"absolute",top:"0",left:"0","data-is-current-user-vote":s,className:`bg-gray-5
                            dark:bg-gray-6
                            h-full
                            rounded-sm
                            data-[is-current-user-vote=true]:bg-accent-a5
                            dark:data-[is-current-user-vote=true]:bg-accent-a6`,style:{width:n?i:0,transition:"width 0.5s ease-in-out"}}),l.jsx(T,{as:"span",size:"2",className:"px-2 py-1 z-10 overflow-hidden text-ellipsis",weight:s?"bold":"regular",children:t.option}),l.jsxs(T,{as:"span",size:"2",className:"px-2 py-1 z-10 w-[6ch] text-right",weight:s?"bold":"regular",children:[o.toFixed(1),"%"]})]},t.name)},da=({data:e,messageID:t})=>{const{call:n}=Ie("raven.api.raven_poll.add_vote"),r=s=>Ke(null,null,function*(){return n({message_id:t,option_id:s.name}).then(()=>{_.success("Your vote has been submitted!")}).catch(o=>{_.error("There was an error submitting your vote.",{description:de(o)})})});return l.jsx(Zo,{children:e.poll.options.map(s=>l.jsx("div",{children:l.jsx(T,{as:"label",size:"2",className:"block w-full",children:l.jsxs(v,{gap:"2",p:"2",className:`rounded-sm w-full ${e.poll.is_disabled?"":"hover:bg-accent-a2 dark:hover:bg-gray-5"}`,children:[l.jsx(ei,{disabled:!!e.poll.is_disabled,value:s.name,onClick:()=>r(s),className:"shrink-0"}),l.jsx("div",{className:"min-w-0 flex-1",children:l.jsx("span",{className:"break-words overflow-hidden block",children:s.option})})]})})},s.name))})},ua=({data:e,messageID:t})=>{const[n,r]=C.useState([]),s=(a,c)=>{r(c?d=>[...d,a]:d=>d.filter(u=>u!==a))},{call:o}=Ie("raven.api.raven_poll.add_vote"),i=()=>Ke(null,null,function*(){if(!n.length){_.error("Please select at least one option");return}return o({message_id:t,option_id:n}).then(()=>{_.success("Your vote has been submitted!")}).catch(a=>{_.error("There was an error submitting your vote.",{description:de(a)})})});return l.jsxs("div",{children:[e.poll.options.map(a=>l.jsx("div",{children:l.jsx(T,{as:"label",size:"2",className:"block w-full",children:l.jsxs(v,{gap:"2",p:"2",className:`rounded-sm w-full ${e.poll.is_disabled?"":"hover:bg-accent-a2 dark:hover:bg-gray-5"}`,children:[l.jsx(Jo,{disabled:!!e.poll.is_disabled,value:a.name,onCheckedChange:c=>s(a.name,c),className:"shrink-0"}),l.jsx("div",{className:"min-w-0 flex-1",children:l.jsx("span",{className:"break-words overflow-hidden block",children:a.option})})]})})},a.name)),l.jsxs(v,{justify:"between",align:"center",gap:"2",children:[l.jsx(T,{size:"1",className:"text-gray-500 px-2 py-1",children:e.poll.is_disabled?"This poll is closed and no longer accepting votes":"To view the poll results, please submit your choice(s)"}),!e.poll.is_disabled&&l.jsx(ve,{size:"1",variant:"soft",style:{alignSelf:"flex-end"},onClick:i,children:"Submit"})]})]})},ha=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,fa=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,pa=Xn.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:e}){return["mark",U(this.options.HTMLAttributes,e),0]},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[wi({find:ha,type:this.type})]},addPasteRules(){return[ws({find:fa,type:this.type})]}}),ma=yi.extend({renderHTML({HTMLAttributes:e}){return["strong",U(e,{class:"rt-Strong"}),0]}}),ga=e=>{var s,o,i,a;const{ravenSettings:t}=Qi(),n=((i=(o=(s=window==null?void 0:window.frappe)==null?void 0:s.boot)==null?void 0:o.versions)==null?void 0:i.hrms)!==void 0,{data:r}=ze("raven.api.raven_users.is_user_on_leave",{user:e},t!=null&&t.show_if_a_user_is_on_leave&&n?["is_user_on_leave",e]:null,{dedupingInterval:6*60*60*1e3,revalidateOnFocus:!1});return(a=r==null?void 0:r.message)!=null?a:!1},$s=({userID:e})=>ga(e)?l.jsx(Ct,{color:"yellow",variant:"surface",children:"On Leave"}):null,xa=({node:e})=>{var d,u,h;const t=an(e.attrs.id),n=ds(e.attrs.id),r=t==null?void 0:t.availability_status,s=t==null?void 0:t.custom_status,{call:o}=C.useContext(lt),i=Fn(),{workspaceID:a}=it(),c=()=>{t&&o.post("raven.api.raven_channel.create_direct_message_channel",{user_id:t==null?void 0:t.name}).then(f=>{i(`/${a}/${f==null?void 0:f.message}`)}).catch(f=>{_.error("Could not create a DM channel",{description:de(f)})})};return l.jsx(cn,{as:"span",children:l.jsxs(Jn,{children:[l.jsx(Zn,{children:l.jsxs(ye,{size:{sm:"3",md:"2"},onClick:c,className:"cursor-pointer",children:["@",(d=t==null?void 0:t.full_name)!=null?d:e.attrs.label]})}),l.jsx(er,{size:"1",children:l.jsxs(v,{gap:"2",align:"center",children:[l.jsx(Qn,{src:t==null?void 0:t.user_image,alt:(u=t==null?void 0:t.full_name)!=null?u:e.attrs.label,size:"4"}),l.jsxs(v,{direction:"column",children:[l.jsxs(v,{gap:"3",align:"center",children:[l.jsx(T,{className:"text-gray-12",weight:"bold",size:"3",children:(h=t==null?void 0:t.full_name)!=null?h:e.attrs.label}),r&&r!=="Invisible"&&l.jsx(v,{className:"text-gray-10 text-xs flex gap-1 items-center",children:us(r)}),!r&&n&&l.jsxs(v,{gap:"1",align:"center",children:[l.jsx(hs,{color:"green",size:"8"}),l.jsx(T,{className:"text-gray-10",size:"1",children:"Online"})]})]}),t&&l.jsx($s,{userID:t.name}),s?l.jsx(T,{className:"text-gray-11",size:"2",children:s}):t&&l.jsx(T,{className:"text-gray-11",size:"1",children:t==null?void 0:t.name})]})]})})]})})},ba=({node:e})=>l.jsx(cn,{as:"span",children:l.jsx(ye,{asChild:!0,size:{sm:"3",md:"2"},children:l.jsxs(fs,{to:`/channel/${e.attrs.id}`,children:["#",e.attrs.label]})})}),wa="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",ya="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",En="numeric",Mn="ascii",Rn="alpha",Xe="asciinumeric",Qe="alphanumeric",Ln="domain",Bs="emoji",va="scheme",Ca="slashscheme",bn="whitespace";function ja(e,t){return e in t||(t[e]=[]),t[e]}function Le(e,t,n){t[En]&&(t[Xe]=!0,t[Qe]=!0),t[Mn]&&(t[Xe]=!0,t[Rn]=!0),t[Xe]&&(t[Qe]=!0),t[Rn]&&(t[Qe]=!0),t[Qe]&&(t[Ln]=!0),t[Bs]&&(t[Ln]=!0);for(const r in t){const s=ja(r,n);s.indexOf(e)<0&&s.push(e)}}function ka(e,t){const n={};for(const r in t)t[r].indexOf(e)>=0&&(n[r]=!0);return n}function G(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}G.groups={};G.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let r=0;r<t.jr.length;r++){const s=t.jr[r][0],o=t.jr[r][1];if(o&&s.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,r){for(let s=0;s<e.length;s++)this.tt(e[s],t,n,r)},tr(e,t,n,r){r=r||G.groups;let s;return t&&t.j?s=t:(s=new G(t),n&&r&&Le(t,n,r)),this.jr.push([e,s]),s},ts(e,t,n,r){let s=this;const o=e.length;if(!o)return s;for(let i=0;i<o-1;i++)s=s.tt(e[i]);return s.tt(e[o-1],t,n,r)},tt(e,t,n,r){r=r||G.groups;const s=this;if(t&&t.j)return s.j[e]=t,t;const o=t;let i,a=s.go(e);if(a?(i=new G,Object.assign(i.j,a.j),i.jr.push.apply(i.jr,a.jr),i.jd=a.jd,i.t=a.t):i=new G,o){if(r)if(i.t&&typeof i.t=="string"){const c=Object.assign(ka(i.t,r),n);Le(o,c,r)}else n&&Le(o,n,r);i.t=o}return s.j[e]=i,i}};const S=(e,t,n,r,s)=>e.ta(t,n,r,s),I=(e,t,n,r,s)=>e.tr(t,n,r,s),Sr=(e,t,n,r,s)=>e.ts(t,n,r,s),w=(e,t,n,r,s)=>e.tt(t,n,r,s),xe="WORD",_n="UWORD",Us="ASCIINUMERICAL",Fs="ALPHANUMERICAL",rt="LOCALHOST",On="TLD",zn="UTLD",wt="SCHEME",De="SLASH_SCHEME",or="NUM",Hn="WS",ir="NL",Je="OPENBRACE",Ze="CLOSEBRACE",Et="OPENBRACKET",Mt="CLOSEBRACKET",Rt="OPENPAREN",Lt="CLOSEPAREN",_t="OPENANGLEBRACKET",Ot="CLOSEANGLEBRACKET",zt="FULLWIDTHLEFTPAREN",Ht="FULLWIDTHRIGHTPAREN",Pt="LEFTCORNERBRACKET",Dt="RIGHTCORNERBRACKET",It="LEFTWHITECORNERBRACKET",$t="RIGHTWHITECORNERBRACKET",Bt="FULLWIDTHLESSTHAN",Ut="FULLWIDTHGREATERTHAN",Ft="AMPERSAND",Wt="APOSTROPHE",Vt="ASTERISK",ke="AT",Kt="BACKSLASH",Yt="BACKTICK",qt="CARET",Ae="COLON",lr="COMMA",Gt="DOLLAR",ie="DOT",Qt="EQUALS",ar="EXCLAMATION",te="HYPHEN",et="PERCENT",Xt="PIPE",Jt="PLUS",Zt="POUND",tt="QUERY",cr="QUOTE",Ws="FULLWIDTHMIDDLEDOT",dr="SEMI",le="SLASH",nt="TILDE",en="UNDERSCORE",Vs="EMOJI",tn="SYM";var Ks=Object.freeze({__proto__:null,ALPHANUMERICAL:Fs,AMPERSAND:Ft,APOSTROPHE:Wt,ASCIINUMERICAL:Us,ASTERISK:Vt,AT:ke,BACKSLASH:Kt,BACKTICK:Yt,CARET:qt,CLOSEANGLEBRACKET:Ot,CLOSEBRACE:Ze,CLOSEBRACKET:Mt,CLOSEPAREN:Lt,COLON:Ae,COMMA:lr,DOLLAR:Gt,DOT:ie,EMOJI:Vs,EQUALS:Qt,EXCLAMATION:ar,FULLWIDTHGREATERTHAN:Ut,FULLWIDTHLEFTPAREN:zt,FULLWIDTHLESSTHAN:Bt,FULLWIDTHMIDDLEDOT:Ws,FULLWIDTHRIGHTPAREN:Ht,HYPHEN:te,LEFTCORNERBRACKET:Pt,LEFTWHITECORNERBRACKET:It,LOCALHOST:rt,NL:ir,NUM:or,OPENANGLEBRACKET:_t,OPENBRACE:Je,OPENBRACKET:Et,OPENPAREN:Rt,PERCENT:et,PIPE:Xt,PLUS:Jt,POUND:Zt,QUERY:tt,QUOTE:cr,RIGHTCORNERBRACKET:Dt,RIGHTWHITECORNERBRACKET:$t,SCHEME:wt,SEMI:dr,SLASH:le,SLASH_SCHEME:De,SYM:tn,TILDE:nt,TLD:On,UNDERSCORE:en,UTLD:zn,UWORD:_n,WORD:xe,WS:Hn});const me=/[a-z]/,Ye=new RegExp("\\p{L}","u"),wn=new RegExp("\\p{Emoji}","u"),ge=/\d/,yn=/\s/,Er="\r",vn=`
`,Aa="",Ta="",Cn="";let ut=null,ht=null;function Na(e=[]){const t={};G.groups=t;const n=new G;ut==null&&(ut=Mr(wa)),ht==null&&(ht=Mr(ya)),w(n,"'",Wt),w(n,"{",Je),w(n,"}",Ze),w(n,"[",Et),w(n,"]",Mt),w(n,"(",Rt),w(n,")",Lt),w(n,"<",_t),w(n,">",Ot),w(n,"",zt),w(n,"",Ht),w(n,"",Pt),w(n,"",Dt),w(n,"",It),w(n,"",$t),w(n,"",Bt),w(n,"",Ut),w(n,"&",Ft),w(n,"*",Vt),w(n,"@",ke),w(n,"`",Yt),w(n,"^",qt),w(n,":",Ae),w(n,",",lr),w(n,"$",Gt),w(n,".",ie),w(n,"=",Qt),w(n,"!",ar),w(n,"-",te),w(n,"%",et),w(n,"|",Xt),w(n,"+",Jt),w(n,"#",Zt),w(n,"?",tt),w(n,'"',cr),w(n,"/",le),w(n,";",dr),w(n,"~",nt),w(n,"_",en),w(n,"\\",Kt),w(n,"",Ws);const r=I(n,ge,or,{[En]:!0});I(r,ge,r);const s=I(r,me,Us,{[Xe]:!0}),o=I(r,Ye,Fs,{[Qe]:!0}),i=I(n,me,xe,{[Mn]:!0});I(i,ge,s),I(i,me,i),I(s,ge,s),I(s,me,s);const a=I(n,Ye,_n,{[Rn]:!0});I(a,me),I(a,ge,o),I(a,Ye,a),I(o,ge,o),I(o,me),I(o,Ye,o);const c=w(n,vn,ir,{[bn]:!0}),d=w(n,Er,Hn,{[bn]:!0}),u=I(n,yn,Hn,{[bn]:!0});w(n,Cn,u),w(d,vn,c),w(d,Cn,u),I(d,yn,u),w(u,Er),w(u,vn),I(u,yn,u),w(u,Cn,u);const h=I(n,wn,Vs,{[Bs]:!0});w(h,"#"),I(h,wn,h),w(h,Aa,h);const f=w(h,Ta);w(f,"#"),I(f,wn,h);const p=[[me,i],[ge,s]],g=[[me,null],[Ye,a],[ge,o]];for(let m=0;m<ut.length;m++)je(n,ut[m],On,xe,p);for(let m=0;m<ht.length;m++)je(n,ht[m],zn,_n,g);Le(On,{tld:!0,ascii:!0},t),Le(zn,{utld:!0,alpha:!0},t),je(n,"file",wt,xe,p),je(n,"mailto",wt,xe,p),je(n,"http",De,xe,p),je(n,"https",De,xe,p),je(n,"ftp",De,xe,p),je(n,"ftps",De,xe,p),Le(wt,{scheme:!0,ascii:!0},t),Le(De,{slashscheme:!0,ascii:!0},t),e=e.sort((m,b)=>m[0]>b[0]?1:-1);for(let m=0;m<e.length;m++){const b=e[m][0],y=e[m][1]?{[va]:!0}:{[Ca]:!0};b.indexOf("-")>=0?y[Ln]=!0:me.test(b)?ge.test(b)?y[Xe]=!0:y[Mn]=!0:y[En]=!0,Sr(n,b,b,y)}return Sr(n,"localhost",rt,{ascii:!0}),n.jd=new G(tn),{start:n,tokens:Object.assign({groups:t},Ks)}}function Ys(e,t){const n=Sa(t.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let o=0,i=0;for(;i<r;){let a=e,c=null,d=0,u=null,h=-1,f=-1;for(;i<r&&(c=a.go(n[i]));)a=c,a.accepts()?(h=0,f=0,u=a):h>=0&&(h+=n[i].length,f++),d+=n[i].length,o+=n[i].length,i++;o-=h,i-=f,d-=h,s.push({t:u.t,v:t.slice(o-d,o),s:o-d,e:o})}return s}function Sa(e){const t=[],n=e.length;let r=0;for(;r<n;){let s=e.charCodeAt(r),o,i=s<55296||s>56319||r+1===n||(o=e.charCodeAt(r+1))<56320||o>57343?e[r]:e.slice(r,r+2);t.push(i),r+=i.length}return t}function je(e,t,n,r,s){let o;const i=t.length;for(let a=0;a<i-1;a++){const c=t[a];e.j[c]?o=e.j[c]:(o=new G(r),o.jr=s.slice(),e.j[c]=o),e=o}return o=new G(n),o.jr=s.slice(),e.j[t[i-1]]=o,o}function Mr(e){const t=[],n=[];let r=0,s="0123456789";for(;r<e.length;){let o=0;for(;s.indexOf(e[r+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let i=parseInt(e.substring(r,r+o),10);i>0;i--)n.pop();r+=o}else n.push(e[r]),r++}return t}const st={defaultProtocol:"http",events:null,format:Rr,formatHref:Rr,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function ur(e,t=null){let n=Object.assign({},st);e&&(n=Object.assign(n,e instanceof ur?e.o:e));const r=n.ignoreTags,s=[];for(let o=0;o<r.length;o++)s.push(r[o].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=s}ur.prototype={o:st,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const r=t!=null;let s=this.o[e];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:st[e],typeof s=="function"&&r&&(s=s(t,n))):typeof s=="function"&&r&&(s=s(t,n.t,n)),s)},getObj(e,t,n){let r=this.o[e];return typeof r=="function"&&t!=null&&(r=r(t,n.t,n)),r},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function Rr(e){return e}function qs(e,t){this.t="token",this.v=e,this.tk=t}qs.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),r=e.get("format",t,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=st.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),r=e.get("formatHref",n,this),s=e.get("tagName",n,t),o=this.toFormattedString(e),i={},a=e.get("className",n,t),c=e.get("target",n,t),d=e.get("rel",n,t),u=e.getObj("attributes",n,t),h=e.getObj("events",n,t);return i.href=r,a&&(i.class=a),c&&(i.target=c),d&&(i.rel=d),u&&Object.assign(i,u),{tagName:s,attributes:i,content:o,eventListeners:h}}};function dn(e,t){class n extends qs{constructor(s,o){super(s,o),this.t=e}}for(const r in t)n.prototype[r]=t[r];return n.t=e,n}const Lr=dn("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),_r=dn("text"),Ea=dn("nl"),ft=dn("url",{isLink:!0,toHref(e=st.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==rt&&e[1].t===Ae}}),ee=e=>new G(e);function Ma({groups:e}){const t=e.domain.concat([Ft,Vt,ke,Kt,Yt,qt,Gt,Qt,te,or,et,Xt,Jt,Zt,le,tn,nt,en]),n=[Wt,Ae,lr,ie,ar,et,tt,cr,dr,_t,Ot,Je,Ze,Mt,Et,Rt,Lt,zt,Ht,Pt,Dt,It,$t,Bt,Ut],r=[Ft,Wt,Vt,Kt,Yt,qt,Gt,Qt,te,Je,Ze,et,Xt,Jt,Zt,tt,le,tn,nt,en],s=ee(),o=w(s,nt);S(o,r,o),S(o,e.domain,o);const i=ee(),a=ee(),c=ee();S(s,e.domain,i),S(s,e.scheme,a),S(s,e.slashscheme,c),S(i,r,o),S(i,e.domain,i);const d=w(i,ke);w(o,ke,d),w(a,ke,d),w(c,ke,d);const u=w(o,ie);S(u,r,o),S(u,e.domain,o);const h=ee();S(d,e.domain,h),S(h,e.domain,h);const f=w(h,ie);S(f,e.domain,h);const p=ee(Lr);S(f,e.tld,p),S(f,e.utld,p),w(d,rt,p);const g=w(h,te);w(g,te,g),S(g,e.domain,h),S(p,e.domain,h),w(p,ie,f),w(p,te,g);const m=w(p,Ae);S(m,e.numeric,Lr);const b=w(i,te),x=w(i,ie);w(b,te,b),S(b,e.domain,i),S(x,r,o),S(x,e.domain,i);const y=ee(ft);S(x,e.tld,y),S(x,e.utld,y),S(y,e.domain,i),S(y,r,o),w(y,ie,x),w(y,te,b),w(y,ke,d);const j=w(y,Ae),A=ee(ft);S(j,e.numeric,A);const k=ee(ft),R=ee();S(k,t,k),S(k,n,R),S(R,t,k),S(R,n,R),w(y,le,k),w(A,le,k);const L=w(a,Ae),B=w(c,Ae),F=w(B,le),M=w(F,le);S(a,e.domain,i),w(a,ie,x),w(a,te,b),S(c,e.domain,i),w(c,ie,x),w(c,te,b),S(L,e.domain,k),w(L,le,k),w(L,tt,k),S(M,e.domain,k),S(M,t,k),w(M,le,k);const z=[[Je,Ze],[Et,Mt],[Rt,Lt],[_t,Ot],[zt,Ht],[Pt,Dt],[It,$t],[Bt,Ut]];for(let q=0;q<z.length;q++){const[J,se]=z[q],Z=w(k,J);w(R,J,Z),w(Z,se,k);const V=ee(ft);S(Z,t,V);const Q=ee();S(Z,n),S(V,t,V),S(V,n,Q),S(Q,t,V),S(Q,n,Q),w(V,se,k),w(Q,se,k)}return w(s,rt,y),w(s,ir,Ea),{start:s,tokens:Ks}}function Ra(e,t,n){let r=n.length,s=0,o=[],i=[];for(;s<r;){let a=e,c=null,d=null,u=0,h=null,f=-1;for(;s<r&&!(c=a.go(n[s].t));)i.push(n[s++]);for(;s<r&&(d=c||a.go(n[s].t));)c=null,a=d,a.accepts()?(f=0,h=a):f>=0&&f++,s++,u++;if(f<0)s-=u,s<r&&(i.push(n[s]),s++);else{i.length>0&&(o.push(jn(_r,t,i)),i=[]),s-=f,u-=f;const p=h.t,g=n.slice(s-u,s);o.push(jn(p,t,g))}}return i.length>0&&o.push(jn(_r,t,i)),o}function jn(e,t,n){const r=n[0].s,s=n[n.length-1].e,o=t.slice(r,s);return new e(o,n)}const La=typeof console!="undefined"&&console&&console.warn||(()=>{}),_a="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",H={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Oa(){return G.groups={},H.scanner=null,H.parser=null,H.tokenQueue=[],H.pluginQueue=[],H.customSchemes=[],H.initialized=!1,H}function Or(e,t=!1){if(H.initialized&&La(`linkifyjs: already initialized - will not register custom scheme "${e}" ${_a}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);H.customSchemes.push([e,t])}function za(){H.scanner=Na(H.customSchemes);for(let e=0;e<H.tokenQueue.length;e++)H.tokenQueue[e][1]({scanner:H.scanner});H.parser=Ma(H.scanner.tokens);for(let e=0;e<H.pluginQueue.length;e++)H.pluginQueue[e][1]({scanner:H.scanner,parser:H.parser});return H.initialized=!0,H}function hr(e){return H.initialized||za(),Ra(H.parser.start,e,Ys(H.scanner.start,e))}hr.scan=Ys;function Gs(e,t=null,n=null){if(t&&typeof t=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const r=new ur(n),s=hr(e),o=[];for(let i=0;i<s.length;i++){const a=s[i];a.isLink&&(!t||a.t===t)&&r.check(a)&&o.push(a.toFormattedObject(r))}return o}function Ha(e){return e.length===1?e[0].isLink:e.length===3&&e[1].isLink?["()","[]"].includes(e[0].value+e[2].value):!1}function Pa(e){return new Ue({key:new ce("autolink"),appendTransaction:(t,n,r)=>{const s=t.some(d=>d.docChanged)&&!n.doc.eq(r.doc),o=t.some(d=>d.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,a=vi(n.doc,[...t]);if(Ci(a).forEach(({newRange:d})=>{const u=ji(r.doc,d,p=>p.isTextblock);let h,f;if(u.length>1?(h=u[0],f=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ")):u.length&&r.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(h=u[0],f=r.doc.textBetween(h.pos,d.to,void 0," ")),h&&f){const p=f.split(" ").filter(x=>x!=="");if(p.length<=0)return!1;const g=p[p.length-1],m=h.pos+f.lastIndexOf(g);if(!g)return!1;const b=hr(g).map(x=>x.toObject(e.defaultProtocol));if(!Ha(b))return!1;b.filter(x=>x.isLink).map(x=>E(N({},x),{from:m+x.start+1,to:m+x.end+1})).filter(x=>r.schema.marks.code?!r.doc.rangeHasMark(x.from,x.to,r.schema.marks.code):!0).filter(x=>e.validate(x.value)).filter(x=>e.shouldAutoLink(x.value)).forEach(x=>{ki(x.from,x.to,r.doc).some(y=>y.mark.type===e.type)||i.addMark(x.from,x.to,e.type.create({href:x.href}))})}}),!!i.steps.length)return i}})}function Da(e){return new Ue({key:new ce("handleClickLink"),props:{handleClick:(t,n,r)=>{var s,o;if(r.button!==0||!t.editable)return!1;let i=r.target;const a=[];for(;i.nodeName!=="DIV";)a.push(i),i=i.parentNode;if(!a.find(f=>f.nodeName==="A"))return!1;const c=Ai(t.state,e.type.name),d=r.target,u=(s=d==null?void 0:d.href)!==null&&s!==void 0?s:c.href,h=(o=d==null?void 0:d.target)!==null&&o!==void 0?o:c.target;return d&&u?(window.open(u,h),!0):!1}}})}function Ia(e){return new Ue({key:new ce("handlePasteLink"),props:{handlePaste:(t,n,r)=>{const{state:s}=t,{selection:o}=s,{empty:i}=o;if(i)return!1;let a="";r.content.forEach(d=>{a+=d.textContent});const c=Gs(a,{defaultProtocol:e.defaultProtocol}).find(d=>d.isLink&&d.value===a);return!a||!c?!1:e.editor.commands.setMark(e.type,{href:c.href})}}})}const $a=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function Re(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!e||e.replace($a,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Ba=Xn.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(e=>{if(typeof e=="string"){Or(e);return}Or(e.scheme,e.optionalSlashes)})},onDestroy(){Oa()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!Re(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}},addAttributes(){return{href:{default:null,parseHTML(e){return e.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:n=>!!Re(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:t=>!!Re(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",U(this.options.HTMLAttributes,e),0]:["a",U(this.options.HTMLAttributes,E(N({},e),{href:""})),0]},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Re(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,e).setMeta("preventAutolink",!0).run():!1},toggleLink:e=>({chain:t})=>{const{href:n}=e;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Re(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ws({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:r}=this.options,s=Gs(e).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!Re(i,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(o=>t.push({text:o.value,data:{href:o.href},index:o.start}))}return t},type:this.type,getAttributes:e=>{var t;return{href:(t=e.data)===null||t===void 0?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;return this.options.autolink&&e.push(Pa({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!Re(s,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&e.push(Da({type:this.type})),this.options.linkOnPaste&&e.push(Ia({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),e}}),Ua=Ba.extend({renderHTML({HTMLAttributes:e}){return["a",U(e,{class:"rt-Text rt-reset rt-Link rt-underline-auto break-all"}),0]}}).configure({openOnClick:!1}),Fa=Xn.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["u",U(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Wa=Fa.extend({renderHTML({HTMLAttributes:e}){return["span",U(e,{class:"rt-Text rt-reset rt-Link rt-underline-always text-gray-12","data-accent-color":"gray"}),0]}}),Va=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Ka=Me.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",U(this.options.HTMLAttributes,e)]},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[Ti({find:Va,type:this.type,getAttributes:e=>{const[,,t,n,r]=e;return{src:n,alt:t,title:r}}})]}});function Ya(e){var t;const{char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:o,startOfLine:i,$position:a}=e,c=r&&!s,d=Ni(n),u=new RegExp(`\\s${d}$`),h=i?"^":"",f=s?"":d,p=c?new RegExp(`${h}${d}.*?(?=\\s${f}|$)`,"gm"):new RegExp(`${h}(?:^)?${d}[^\\s${f}]*`,"gm"),g=((t=a.nodeBefore)===null||t===void 0?void 0:t.isText)&&a.nodeBefore.text;if(!g)return null;const m=a.pos-g.length,b=Array.from(g.matchAll(p)).pop();if(!b||b.input===void 0||b.index===void 0)return null;const x=b.input.slice(Math.max(0,b.index-1),b.index),y=new RegExp(`^[${o==null?void 0:o.join("")}\0]?$`).test(x);if(o!==null&&!y)return null;const j=m+b.index;let A=j+b[0].length;return c&&u.test(g.slice(A-1,A+1))&&(b[0]+=" ",A+=1),j<a.pos&&A>=a.pos?{range:{from:j,to:A},query:b[0].slice(n.length),text:b[0]}:null}const qa=new ce("suggestion");function Ga({pluginKey:e=qa,editor:t,char:n="@",allowSpaces:r=!1,allowToIncludeChar:s=!1,allowedPrefixes:o=[" "],startOfLine:i=!1,decorationTag:a="span",decorationClass:c="suggestion",command:d=()=>null,items:u=()=>[],render:h=()=>({}),allow:f=()=>!0,findSuggestionMatch:p=Ya}){let g;const m=h==null?void 0:h(),b=new Ue({key:e,view(){return{update:(x,y)=>Ke(this,null,function*(){var j,A,k,R,L,B,F;const M=(j=this.key)===null||j===void 0?void 0:j.getState(y),z=(A=this.key)===null||A===void 0?void 0:A.getState(x.state),q=M.active&&z.active&&M.range.from!==z.range.from,J=!M.active&&z.active,se=M.active&&!z.active,Z=!J&&!se&&M.query!==z.query,V=J||q&&Z,Q=Z||q,ne=se||q&&Z;if(!V&&!Q&&!ne)return;const oe=ne&&!V?M:z,he=x.dom.querySelector(`[data-decoration-id="${oe.decorationId}"]`);g={editor:t,range:oe.range,query:oe.query,text:oe.text,items:[],command:fe=>d({editor:t,range:oe.range,props:fe}),decorationNode:he,clientRect:he?()=>{var fe;const{decorationId:Pe}=(fe=this.key)===null||fe===void 0?void 0:fe.getState(t.state),Ce=x.dom.querySelector(`[data-decoration-id="${Pe}"]`);return(Ce==null?void 0:Ce.getBoundingClientRect())||null}:null},V&&((k=m==null?void 0:m.onBeforeStart)===null||k===void 0||k.call(m,g)),Q&&((R=m==null?void 0:m.onBeforeUpdate)===null||R===void 0||R.call(m,g)),(Q||V)&&(g.items=yield u({editor:t,query:oe.query})),ne&&((L=m==null?void 0:m.onExit)===null||L===void 0||L.call(m,g)),Q&&((B=m==null?void 0:m.onUpdate)===null||B===void 0||B.call(m,g)),V&&((F=m==null?void 0:m.onStart)===null||F===void 0||F.call(m,g))}),destroy:()=>{var x;g&&((x=m==null?void 0:m.onExit)===null||x===void 0||x.call(m,g))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(x,y,j,A){const{isEditable:k}=t,{composing:R}=t.view,{selection:L}=x,{empty:B,from:F}=L,M=N({},y);if(M.composing=R,k&&(B||t.view.composing)){(F<y.range.from||F>y.range.to)&&!R&&!y.composing&&(M.active=!1);const z=p({char:n,allowSpaces:r,allowToIncludeChar:s,allowedPrefixes:o,startOfLine:i,$position:L.$from}),q=`id_${Math.floor(Math.random()*4294967295)}`;z&&f({editor:t,state:A,range:z.range,isActive:y.active})?(M.active=!0,M.decorationId=y.decorationId?y.decorationId:q,M.range=z.range,M.query=z.query,M.text=z.text):M.active=!1}else M.active=!1;return M.active||(M.decorationId=null,M.range={from:0,to:0},M.query=null,M.text=null),M}},props:{handleKeyDown(x,y){var j;const{active:A,range:k}=b.getState(x.state);return A&&((j=m==null?void 0:m.onKeyDown)===null||j===void 0?void 0:j.call(m,{view:x,event:y,range:k}))||!1},decorations(x){const{active:y,range:j,decorationId:A}=b.getState(x);return y?jt.create(x.doc,[kt.inline(j.from,j.to,{nodeName:a,class:c,"data-decoration-id":A})]):null}}});return b}const Qa=new ce("mention"),zr=Me.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({options:e,node:t}){var n;return`${e.suggestion.char}${(n=t.attrs.label)!==null&&n!==void 0?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:e,node:t}){var n;return["span",U(this.HTMLAttributes,e.HTMLAttributes),`${e.suggestion.char}${(n=t.attrs.label)!==null&&n!==void 0?n:t.attrs.id}`]},suggestion:{char:"@",pluginKey:Qa,command:({editor:e,range:t,props:n})=>{var r,s,o;const i=e.view.state.selection.$to.nodeAfter;((r=i==null?void 0:i.text)===null||r===void 0?void 0:r.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run(),(o=(s=e.view.dom.ownerDocument.defaultView)===null||s===void 0?void 0:s.getSelection())===null||o===void 0||o.collapseToEnd()},allow:({state:e,range:t})=>{const n=e.doc.resolve(t.from),r=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",U({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})];const n=N({},this.options);n.HTMLAttributes=U({"data-type":this.name},this.options.HTMLAttributes,t);const r=this.options.renderHTML({options:n,node:e});return typeof r=="string"?["span",U({"data-type":this.name},this.options.HTMLAttributes,t),r]:r},renderText({node:e}){return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel({options:this.options,node:e})):this.options.renderText({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:t})=>{let n=!1;const{selection:r}=t,{empty:s,anchor:o}=r;return s?(t.doc.nodesBetween(o-1,o,(i,a)=>{if(i.type.name===this.name)return n=!0,e.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",a,a+i.nodeSize),!1}),n):!1})}},addProseMirrorPlugins(){return[Ga(N({editor:this.editor},this.options.suggestion))]}});var Pn,Dn;if(typeof WeakMap!="undefined"){let e=new WeakMap;Pn=t=>e.get(t),Dn=(t,n)=>(e.set(t,n),n)}else{const e=[];let n=0;Pn=r=>{for(let s=0;s<e.length;s+=2)if(e[s]==r)return e[s+1]},Dn=(r,s)=>(n==10&&(n=0),e[n++]=r,e[n++]=s)}var $=class{constructor(e,t,n,r){this.width=e,this.height=t,this.map=n,this.problems=r}findCell(e){for(let t=0;t<this.map.length;t++){const n=this.map[t];if(n!=e)continue;const r=t%this.width,s=t/this.width|0;let o=r+1,i=s+1;for(let a=1;o<this.width&&this.map[t+a]==n;a++)o++;for(let a=1;i<this.height&&this.map[t+this.width*a]==n;a++)i++;return{left:r,top:s,right:o,bottom:i}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,n){const{left:r,right:s,top:o,bottom:i}=this.findCell(e);return t=="horiz"?(n<0?r==0:s==this.width)?null:this.map[o*this.width+(n<0?r-1:s)]:(n<0?o==0:i==this.height)?null:this.map[r+this.width*(n<0?o-1:i)]}rectBetween(e,t){const{left:n,right:r,top:s,bottom:o}=this.findCell(e),{left:i,right:a,top:c,bottom:d}=this.findCell(t);return{left:Math.min(n,i),top:Math.min(s,c),right:Math.max(r,a),bottom:Math.max(o,d)}}cellsInRect(e){const t=[],n={};for(let r=e.top;r<e.bottom;r++)for(let s=e.left;s<e.right;s++){const o=r*this.width+s,i=this.map[o];n[i]||(n[i]=!0,!(s==e.left&&s&&this.map[o-1]==i||r==e.top&&r&&this.map[o-this.width]==i)&&t.push(i))}return t}positionAt(e,t,n){for(let r=0,s=0;;r++){const o=s+n.child(r).nodeSize;if(r==e){let i=t+e*this.width;const a=(e+1)*this.width;for(;i<a&&this.map[i]<s;)i++;return i==a?o-1:this.map[i]}s=o}}static get(e){return Pn(e)||Dn(e,Xa(e))}};function Xa(e){if(e.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+e.type.name);const t=Ja(e),n=e.childCount,r=[];let s=0,o=null;const i=[];for(let d=0,u=t*n;d<u;d++)r[d]=0;for(let d=0,u=0;d<n;d++){const h=e.child(d);u++;for(let g=0;;g++){for(;s<r.length&&r[s]!=0;)s++;if(g==h.childCount)break;const m=h.child(g),{colspan:b,rowspan:x,colwidth:y}=m.attrs;for(let j=0;j<x;j++){if(j+d>=n){(o||(o=[])).push({type:"overlong_rowspan",pos:u,n:x-j});break}const A=s+j*t;for(let k=0;k<b;k++){r[A+k]==0?r[A+k]=u:(o||(o=[])).push({type:"collision",row:d,pos:u,n:b-k});const R=y&&y[k];if(R){const L=(A+k)%t*2,B=i[L];B==null||B!=R&&i[L+1]==1?(i[L]=R,i[L+1]=1):B==R&&i[L+1]++}}}s+=b,u+=m.nodeSize}const f=(d+1)*t;let p=0;for(;s<f;)r[s++]==0&&p++;p&&(o||(o=[])).push({type:"missing",row:d,n:p}),u++}(t===0||n===0)&&(o||(o=[])).push({type:"zero_sized"});const a=new $(t,n,r,o);let c=!1;for(let d=0;!c&&d<i.length;d+=2)i[d]!=null&&i[d+1]<n&&(c=!0);return c&&Za(a,i,e),a}function Ja(e){let t=-1,n=!1;for(let r=0;r<e.childCount;r++){const s=e.child(r);let o=0;if(n)for(let i=0;i<r;i++){const a=e.child(i);for(let c=0;c<a.childCount;c++){const d=a.child(c);i+d.attrs.rowspan>r&&(o+=d.attrs.colspan)}}for(let i=0;i<s.childCount;i++){const a=s.child(i);o+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}t==-1?t=o:t!=o&&(t=Math.max(t,o))}return t}function Za(e,t,n){e.problems||(e.problems=[]);const r={};for(let s=0;s<e.map.length;s++){const o=e.map[s];if(r[o])continue;r[o]=!0;const i=n.nodeAt(o);if(!i)throw new RangeError(`No cell with offset ${o} found`);let a=null;const c=i.attrs;for(let d=0;d<c.colspan;d++){const u=(s+d)%e.width,h=t[u*2];h!=null&&(!c.colwidth||c.colwidth[d]!=h)&&((a||(a=ec(c)))[d]=h)}a&&e.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:a})}}function ec(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let n=0;n<e.colspan;n++)t.push(0);return t}function K(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const n in e.nodes){const r=e.nodes[n],s=r.spec.tableRole;s&&(t[s]=r)}}return t}var Te=new ce("selectingCells");function Fe(e){for(let t=e.depth-1;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return e.node(0).resolve(e.before(t+1));return null}function tc(e){for(let t=e.depth;t>0;t--){const n=e.node(t).type.spec.tableRole;if(n==="cell"||n==="header_cell")return e.node(t)}return null}function re(e){const t=e.selection.$head;for(let n=t.depth;n>0;n--)if(t.node(n).type.spec.tableRole=="row")return!0;return!1}function un(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&t.node.type.spec.tableRole=="cell")return t.$anchor;const n=Fe(t.$head)||nc(t.$head);if(n)return n;throw new RangeError(`No cell found around position ${t.head}`)}function nc(e){for(let t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n)}for(let t=e.nodeBefore,n=e.pos;t;t=t.lastChild,n--){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n-t.nodeSize)}}function In(e){return e.parent.type.spec.tableRole=="row"&&!!e.nodeAfter}function rc(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function fr(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function Qs(e,t,n){const r=e.node(-1),s=$.get(r),o=e.start(-1),i=s.nextCell(e.pos-o,t,n);return i==null?null:e.node(0).resolve(o+i)}function Oe(e,t,n=1){const r=E(N({},e),{colspan:e.colspan-n});return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(t,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function Xs(e,t,n=1){const r=E(N({},e),{colspan:e.colspan+n});if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(t,0,0)}return r}function sc(e,t,n){const r=K(t.type.schema).header_cell;for(let s=0;s<e.height;s++)if(t.nodeAt(e.map[n+s*e.width]).type!=r)return!1;return!0}var O=class be extends we{constructor(t,n=t){const r=t.node(-1),s=$.get(r),o=t.start(-1),i=s.rectBetween(t.pos-o,n.pos-o),a=t.node(0),c=s.cellsInRect(i).filter(u=>u!=n.pos-o);c.unshift(n.pos-o);const d=c.map(u=>{const h=r.nodeAt(u);if(!h)throw RangeError(`No cell with offset ${u} found`);const f=o+u+1;return new Ei(a.resolve(f),a.resolve(f+h.content.size))});super(d[0].$from,d[0].$to,d),this.$anchorCell=t,this.$headCell=n}map(t,n){const r=t.resolve(n.map(this.$anchorCell.pos)),s=t.resolve(n.map(this.$headCell.pos));if(In(r)&&In(s)&&fr(r,s)){const o=this.$anchorCell.node(-1)!=r.node(-1);return o&&this.isRowSelection()?be.rowSelection(r,s):o&&this.isColSelection()?be.colSelection(r,s):new be(r,s)}return Ne.between(r,s)}content(){const t=this.$anchorCell.node(-1),n=$.get(t),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},i=[];for(let c=s.top;c<s.bottom;c++){const d=[];for(let u=c*n.width+s.left,h=s.left;h<s.right;h++,u++){const f=n.map[u];if(o[f])continue;o[f]=!0;const p=n.findCell(f);let g=t.nodeAt(f);if(!g)throw RangeError(`No cell with offset ${f} found`);const m=s.left-p.left,b=p.right-s.right;if(m>0||b>0){let x=g.attrs;if(m>0&&(x=Oe(x,0,m)),b>0&&(x=Oe(x,x.colspan-b,b)),p.left<s.left){if(g=g.type.createAndFill(x),!g)throw RangeError(`Could not create cell with attrs ${JSON.stringify(x)}`)}else g=g.type.create(x,g.content)}if(p.top<s.top||p.bottom>s.bottom){const x=E(N({},g.attrs),{rowspan:Math.min(p.bottom,s.bottom)-Math.max(p.top,s.top)});p.top<s.top?g=g.type.createAndFill(x):g=g.type.create(x,g.content)}d.push(g)}i.push(t.child(c).copy(ae.from(d)))}const a=this.isColSelection()&&this.isRowSelection()?t:i;return new Se(ae.from(a),1,1)}replace(t,n=Se.empty){const r=t.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){const{$from:a,$to:c}=s[i],d=t.mapping.slice(r);t.replace(d.map(a.pos),d.map(c.pos),i?Se.empty:n)}const o=we.findFrom(t.doc.resolve(t.mapping.slice(r).map(this.to)),-1);o&&t.setSelection(o)}replaceWith(t,n){this.replace(t,new Se(ae.from(n),0,0))}forEachCell(t){const n=this.$anchorCell.node(-1),r=$.get(n),s=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let i=0;i<o.length;i++)t(n.nodeAt(o[i]),s+o[i])}isColSelection(){const t=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(t,n)>0)return!1;const r=t+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(t,n=t){const r=t.node(-1),s=$.get(r),o=t.start(-1),i=s.findCell(t.pos-o),a=s.findCell(n.pos-o),c=t.node(0);return i.top<=a.top?(i.top>0&&(t=c.resolve(o+s.map[i.left])),a.bottom<s.height&&(n=c.resolve(o+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=c.resolve(o+s.map[a.left])),i.bottom<s.height&&(t=c.resolve(o+s.map[s.width*(s.height-1)+i.right-1]))),new be(t,n)}isRowSelection(){const t=this.$anchorCell.node(-1),n=$.get(t),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),o=n.colCount(this.$headCell.pos-r);if(Math.min(s,o)>0)return!1;const i=s+this.$anchorCell.nodeAfter.attrs.colspan,a=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==n.width}eq(t){return t instanceof be&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,n=t){const r=t.node(-1),s=$.get(r),o=t.start(-1),i=s.findCell(t.pos-o),a=s.findCell(n.pos-o),c=t.node(0);return i.left<=a.left?(i.left>0&&(t=c.resolve(o+s.map[i.top*s.width])),a.right<s.width&&(n=c.resolve(o+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=c.resolve(o+s.map[a.top*s.width])),i.right<s.width&&(t=c.resolve(o+s.map[s.width*(i.top+1)-1]))),new be(t,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,n){return new be(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,r=n){return new be(t.resolve(n),t.resolve(r))}getBookmark(){return new oc(this.$anchorCell.pos,this.$headCell.pos)}};O.prototype.visible=!1;we.jsonID("cell",O);var oc=class Js{constructor(t,n){this.anchor=t,this.head=n}map(t){return new Js(t.map(this.anchor),t.map(this.head))}resolve(t){const n=t.resolve(this.anchor),r=t.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&fr(n,r)?new O(n,r):we.near(r,1)}};function ic(e){if(!(e.selection instanceof O))return null;const t=[];return e.selection.forEachCell((n,r)=>{t.push(kt.node(r,r+n.nodeSize,{class:"selectedCell"}))}),jt.create(e.doc,t)}function lc({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let n=e.pos,r=t.pos,s=e.depth;for(;s>=0&&!(e.after(s+1)<e.end(s));s--,n++);for(let o=t.depth;o>=0&&!(t.before(o+1)>t.start(o));o--,r--);return n==r&&/row|table/.test(e.node(s).type.spec.tableRole)}function ac({$from:e,$to:t}){let n,r;for(let s=e.depth;s>0;s--){const o=e.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){n=o;break}}for(let s=t.depth;s>0;s--){const o=t.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){r=o;break}}return n!==r&&t.parentOffset===0}function cc(e,t,n){const r=(t||e).selection,s=(t||e).doc;let o,i;if(r instanceof Mi&&(i=r.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")o=O.create(s,r.from);else if(i=="row"){const a=s.resolve(r.from+1);o=O.rowSelection(a,a)}else if(!n){const a=$.get(r.node),c=r.from+1,d=c+a.map[a.width*a.height-1];o=O.create(s,c+1,d)}}else r instanceof Ne&&lc(r)?o=Ne.create(s,r.from):r instanceof Ne&&ac(r)&&(o=Ne.create(s,r.$from.start(),r.$from.end()));return o&&(t||(t=e.tr)).setSelection(o),t}var dc=new ce("fix-tables");function Zs(e,t,n,r){const s=e.childCount,o=t.childCount;e:for(let i=0,a=0;i<o;i++){const c=t.child(i);for(let d=a,u=Math.min(s,i+3);d<u;d++)if(e.child(d)==c){a=d+1,n+=c.nodeSize;continue e}r(c,n),a<s&&e.child(a).sameMarkup(c)?Zs(e.child(a),c,n+1,r):c.nodesBetween(0,c.content.size,r,n+1),n+=c.nodeSize}}function eo(e,t){let n;const r=(s,o)=>{s.type.spec.tableRole=="table"&&(n=uc(e,s,o,n))};return t?t.doc!=e.doc&&Zs(t.doc,e.doc,0,r):e.doc.descendants(r),n}function uc(e,t,n,r){const s=$.get(t);if(!s.problems)return r;r||(r=e.tr);const o=[];for(let c=0;c<s.height;c++)o.push(0);for(let c=0;c<s.problems.length;c++){const d=s.problems[c];if(d.type=="collision"){const u=t.nodeAt(d.pos);if(!u)continue;const h=u.attrs;for(let f=0;f<h.rowspan;f++)o[d.row+f]+=d.n;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,Oe(h,h.colspan-d.n,d.n))}else if(d.type=="missing")o[d.row]+=d.n;else if(d.type=="overlong_rowspan"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,E(N({},u.attrs),{rowspan:u.attrs.rowspan-d.n}))}else if(d.type=="colwidth mismatch"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,E(N({},u.attrs),{colwidth:d.colwidth}))}else if(d.type=="zero_sized"){const u=r.mapping.map(n);r.delete(u,u+t.nodeSize)}}let i,a;for(let c=0;c<o.length;c++)o[c]&&(i==null&&(i=c),a=c);for(let c=0,d=n+1;c<s.height;c++){const u=t.child(c),h=d+u.nodeSize,f=o[c];if(f>0){let p="cell";u.firstChild&&(p=u.firstChild.type.spec.tableRole);const g=[];for(let b=0;b<f;b++){const x=K(e.schema)[p].createAndFill();x&&g.push(x)}const m=(c==0||i==c-1)&&a==c?d+1:h-1;r.insert(r.mapping.map(m),g)}d=h}return r.setMeta(dc,{fixTables:!0})}function ue(e){const t=e.selection,n=un(e),r=n.node(-1),s=n.start(-1),o=$.get(r),i=t instanceof O?o.rectBetween(t.$anchorCell.pos-s,t.$headCell.pos-s):o.findCell(n.pos-s);return E(N({},i),{tableStart:s,map:o,table:r})}function to(e,{map:t,tableStart:n,table:r},s){let o=s>0?-1:0;sc(t,r,s+o)&&(o=s==0||s==t.width?null:0);for(let i=0;i<t.height;i++){const a=i*t.width+s;if(s>0&&s<t.width&&t.map[a-1]==t.map[a]){const c=t.map[a],d=r.nodeAt(c);e.setNodeMarkup(e.mapping.map(n+c),null,Xs(d.attrs,s-t.colCount(c))),i+=d.attrs.rowspan-1}else{const c=o==null?K(r.type.schema).cell:r.nodeAt(t.map[a+o]).type,d=t.positionAt(i,s,r);e.insert(e.mapping.map(n+d),c.createAndFill())}}return e}function hc(e,t){if(!re(e))return!1;if(t){const n=ue(e);t(to(e.tr,n,n.left))}return!0}function fc(e,t){if(!re(e))return!1;if(t){const n=ue(e);t(to(e.tr,n,n.right))}return!0}function pc(e,{map:t,table:n,tableStart:r},s){const o=e.mapping.maps.length;for(let i=0;i<t.height;){const a=i*t.width+s,c=t.map[a],d=n.nodeAt(c),u=d.attrs;if(s>0&&t.map[a-1]==c||s<t.width-1&&t.map[a+1]==c)e.setNodeMarkup(e.mapping.slice(o).map(r+c),null,Oe(u,s-t.colCount(c)));else{const h=e.mapping.slice(o).map(r+c);e.delete(h,h+d.nodeSize)}i+=u.rowspan}}function mc(e,t){if(!re(e))return!1;if(t){const n=ue(e),r=e.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;pc(r,n,s),s!=n.left;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw RangeError("No table found");n.table=o,n.map=$.get(o)}t(r)}return!0}function gc(e,t,n){var r;const s=K(t.type.schema).header_cell;for(let o=0;o<e.width;o++)if(((r=t.nodeAt(e.map[o+n*e.width]))==null?void 0:r.type)!=s)return!1;return!0}function no(e,{map:t,tableStart:n,table:r},s){var o;let i=n;for(let d=0;d<s;d++)i+=r.child(d).nodeSize;const a=[];let c=s>0?-1:0;gc(t,r,s+c)&&(c=s==0||s==t.height?null:0);for(let d=0,u=t.width*s;d<t.width;d++,u++)if(s>0&&s<t.height&&t.map[u]==t.map[u-t.width]){const h=t.map[u],f=r.nodeAt(h).attrs;e.setNodeMarkup(n+h,null,E(N({},f),{rowspan:f.rowspan+1})),d+=f.colspan-1}else{const h=c==null?K(r.type.schema).cell:(o=r.nodeAt(t.map[u+c*t.width]))==null?void 0:o.type,f=h==null?void 0:h.createAndFill();f&&a.push(f)}return e.insert(i,K(r.type.schema).row.create(null,a)),e}function xc(e,t){if(!re(e))return!1;if(t){const n=ue(e);t(no(e.tr,n,n.top))}return!0}function bc(e,t){if(!re(e))return!1;if(t){const n=ue(e);t(no(e.tr,n,n.bottom))}return!0}function wc(e,{map:t,table:n,tableStart:r},s){let o=0;for(let d=0;d<s;d++)o+=n.child(d).nodeSize;const i=o+n.child(s).nodeSize,a=e.mapping.maps.length;e.delete(o+r,i+r);const c=new Set;for(let d=0,u=s*t.width;d<t.width;d++,u++){const h=t.map[u];if(!c.has(h)){if(c.add(h),s>0&&h==t.map[u-t.width]){const f=n.nodeAt(h).attrs;e.setNodeMarkup(e.mapping.slice(a).map(h+r),null,E(N({},f),{rowspan:f.rowspan-1})),d+=f.colspan-1}else if(s<t.height&&h==t.map[u+t.width]){const f=n.nodeAt(h),p=f.attrs,g=f.type.create(E(N({},p),{rowspan:f.attrs.rowspan-1}),f.content),m=t.positionAt(s+1,d,n);e.insert(e.mapping.slice(a).map(r+m),g),d+=p.colspan-1}}}}function yc(e,t){if(!re(e))return!1;if(t){const n=ue(e),r=e.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;wc(r,n,s),s!=n.top;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw RangeError("No table found");n.table=o,n.map=$.get(n.table)}t(r)}return!0}function Hr(e){const t=e.content;return t.childCount==1&&t.child(0).isTextblock&&t.child(0).childCount==0}function vc({width:e,height:t,map:n},r){let s=r.top*e+r.left,o=s,i=(r.bottom-1)*e+r.left,a=s+(r.right-r.left-1);for(let c=r.top;c<r.bottom;c++){if(r.left>0&&n[o]==n[o-1]||r.right<e&&n[a]==n[a+1])return!0;o+=e,a+=e}for(let c=r.left;c<r.right;c++){if(r.top>0&&n[s]==n[s-e]||r.bottom<t&&n[i]==n[i+e])return!0;s++,i++}return!1}function Pr(e,t){const n=e.selection;if(!(n instanceof O)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=ue(e),{map:s}=r;if(vc(s,r))return!1;if(t){const o=e.tr,i={};let a=ae.empty,c,d;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){const f=s.map[u*s.width+h],p=r.table.nodeAt(f);if(!(i[f]||!p))if(i[f]=!0,c==null)c=f,d=p;else{Hr(p)||(a=a.append(p.content));const g=o.mapping.map(f+r.tableStart);o.delete(g,g+p.nodeSize)}}if(c==null||d==null)return!0;if(o.setNodeMarkup(c+r.tableStart,null,E(N({},Xs(d.attrs,d.attrs.colspan,r.right-r.left-d.attrs.colspan)),{rowspan:r.bottom-r.top})),a.size){const u=c+1+d.content.size,h=Hr(d)?c+1:u;o.replaceWith(h+r.tableStart,u+r.tableStart,a)}o.setSelection(new O(o.doc.resolve(c+r.tableStart))),t(o)}return!0}function Dr(e,t){const n=K(e.schema);return Cc(({node:r})=>n[r.type.spec.tableRole])(e,t)}function Cc(e){return(t,n)=>{var r;const s=t.selection;let o,i;if(s instanceof O){if(s.$anchorCell.pos!=s.$headCell.pos)return!1;o=s.$anchorCell.nodeAfter,i=s.$anchorCell.pos}else{if(o=tc(s.$from),!o)return!1;i=(r=Fe(s.$from))==null?void 0:r.pos}if(o==null||i==null||o.attrs.colspan==1&&o.attrs.rowspan==1)return!1;if(n){let a=o.attrs;const c=[],d=a.colwidth;a.rowspan>1&&(a=E(N({},a),{rowspan:1})),a.colspan>1&&(a=E(N({},a),{colspan:1}));const u=ue(t),h=t.tr;for(let p=0;p<u.right-u.left;p++)c.push(d?E(N({},a),{colwidth:d&&d[p]?[d[p]]:null}):a);let f;for(let p=u.top;p<u.bottom;p++){let g=u.map.positionAt(p,u.left,u.table);p==u.top&&(g+=o.nodeSize);for(let m=u.left,b=0;m<u.right;m++,b++)m==u.left&&p==u.top||h.insert(f=h.mapping.map(g+u.tableStart,1),e({node:o,row:p,col:m}).createAndFill(c[b]))}h.setNodeMarkup(i,e({node:o,row:u.top,col:u.left}),c[0]),s instanceof O&&h.setSelection(new O(h.doc.resolve(s.$anchorCell.pos),f?h.doc.resolve(f):void 0)),n(h)}return!0}}function jc(e,t){return function(n,r){if(!re(n))return!1;const s=un(n);if(s.nodeAfter.attrs[e]===t)return!1;if(r){const o=n.tr;n.selection instanceof O?n.selection.forEachCell((i,a)=>{i.attrs[e]!==t&&o.setNodeMarkup(a,null,E(N({},i.attrs),{[e]:t}))}):o.setNodeMarkup(s.pos,null,E(N({},s.nodeAfter.attrs),{[e]:t})),r(o)}return!0}}function kc(e){return function(t,n){if(!re(t))return!1;if(n){const r=K(t.schema),s=ue(t),o=t.tr,i=s.map.cellsInRect(e=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:e=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=i.map(c=>s.table.nodeAt(c));for(let c=0;c<i.length;c++)a[c].type==r.header_cell&&o.setNodeMarkup(s.tableStart+i[c],r.cell,a[c].attrs);if(o.steps.length==0)for(let c=0;c<i.length;c++)o.setNodeMarkup(s.tableStart+i[c],r.header_cell,a[c].attrs);n(o)}return!0}}function Ir(e,t,n){const r=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(let s=0;s<r.length;s++){const o=t.table.nodeAt(r[s]);if(o&&o.type!==n.header_cell)return!1}return!0}function ot(e,t){return t=t||{useDeprecatedLogic:!1},t.useDeprecatedLogic?kc(e):function(n,r){if(!re(n))return!1;if(r){const s=K(n.schema),o=ue(n),i=n.tr,a=Ir("row",o,s),c=Ir("column",o,s),u=(e==="column"?a:e==="row"?c:!1)?1:0,h=e=="column"?{left:0,top:u,right:1,bottom:o.map.height}:e=="row"?{left:u,top:0,right:o.map.width,bottom:1}:o,f=e=="column"?c?s.cell:s.header_cell:e=="row"?a?s.cell:s.header_cell:s.cell;o.map.cellsInRect(h).forEach(p=>{const g=p+o.tableStart,m=i.doc.nodeAt(g);m&&i.setNodeMarkup(g,f,m.attrs)}),r(i)}return!0}}ot("row",{useDeprecatedLogic:!0});ot("column",{useDeprecatedLogic:!0});var Ac=ot("cell",{useDeprecatedLogic:!0});function Tc(e,t){if(t<0){const n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(let r=e.index(-1)-1,s=e.before();r>=0;r--){const o=e.node(-1).child(r),i=o.lastChild;if(i)return s-1-i.nodeSize;s-=o.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const n=e.node(-1);for(let r=e.indexAfter(-1),s=e.after();r<n.childCount;r++){const o=n.child(r);if(o.childCount)return s+1;s+=o.nodeSize}}return null}function $r(e){return function(t,n){if(!re(t))return!1;const r=Tc(un(t),e);if(r==null)return!1;if(n){const s=t.doc.resolve(r);n(t.tr.setSelection(Ne.between(s,rc(s))).scrollIntoView())}return!0}}function Nc(e,t){const n=e.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return t&&t(e.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function pt(e,t){const n=e.selection;if(!(n instanceof O))return!1;if(t){const r=e.tr,s=K(e.schema).cell.createAndFill().content;n.forEachCell((o,i)=>{o.content.eq(s)||r.replace(r.mapping.map(i+1),r.mapping.map(i+o.nodeSize-1),new Se(s,0,0))}),r.docChanged&&t(r)}return!0}function Sc(e){if(!e.size)return null;let{content:t,openStart:n,openEnd:r}=e;for(;t.childCount==1&&(n>0&&r>0||t.child(0).type.spec.tableRole=="table");)n--,r--,t=t.child(0).content;const s=t.child(0),o=s.type.spec.tableRole,i=s.type.schema,a=[];if(o=="row")for(let c=0;c<t.childCount;c++){let d=t.child(c).content;const u=c?0:Math.max(0,n-1),h=c<t.childCount-1?0:Math.max(0,r-1);(u||h)&&(d=$n(K(i).row,new Se(d,u,h)).content),a.push(d)}else if(o=="cell"||o=="header_cell")a.push(n||r?$n(K(i).row,new Se(t,n,r)).content:t);else return null;return Ec(i,a)}function Ec(e,t){const n=[];for(let s=0;s<t.length;s++){const o=t[s];for(let i=o.childCount-1;i>=0;i--){const{rowspan:a,colspan:c}=o.child(i).attrs;for(let d=s;d<s+a;d++)n[d]=(n[d]||0)+c}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=t.length&&t.push(ae.empty),n[s]<r){const o=K(e).cell.createAndFill(),i=[];for(let a=n[s];a<r;a++)i.push(o);t[s]=t[s].append(ae.from(i))}return{height:t.length,width:r,rows:t}}function $n(e,t){const n=e.createAndFill();return new Ri(n).replace(0,n.content.size,t).doc}function Mc({width:e,height:t,rows:n},r,s){if(e!=r){const o=[],i=[];for(let a=0;a<n.length;a++){const c=n[a],d=[];for(let u=o[a]||0,h=0;u<r;h++){let f=c.child(h%c.childCount);u+f.attrs.colspan>r&&(f=f.type.createChecked(Oe(f.attrs,f.attrs.colspan,u+f.attrs.colspan-r),f.content)),d.push(f),u+=f.attrs.colspan;for(let p=1;p<f.attrs.rowspan;p++)o[a+p]=(o[a+p]||0)+f.attrs.colspan}i.push(ae.from(d))}n=i,e=r}if(t!=s){const o=[];for(let i=0,a=0;i<s;i++,a++){const c=[],d=n[a%t];for(let u=0;u<d.childCount;u++){let h=d.child(u);i+h.attrs.rowspan>s&&(h=h.type.create(E(N({},h.attrs),{rowspan:Math.max(1,s-h.attrs.rowspan)}),h.content)),c.push(h)}o.push(ae.from(c))}n=o,t=s}return{width:e,height:t,rows:n}}function Rc(e,t,n,r,s,o,i){const a=e.doc.type.schema,c=K(a);let d,u;if(s>t.width)for(let h=0,f=0;h<t.height;h++){const p=n.child(h);f+=p.nodeSize;const g=[];let m;p.lastChild==null||p.lastChild.type==c.cell?m=d||(d=c.cell.createAndFill()):m=u||(u=c.header_cell.createAndFill());for(let b=t.width;b<s;b++)g.push(m);e.insert(e.mapping.slice(i).map(f-1+r),g)}if(o>t.height){const h=[];for(let g=0,m=(t.height-1)*t.width;g<Math.max(t.width,s);g++){const b=g>=t.width?!1:n.nodeAt(t.map[m+g]).type==c.header_cell;h.push(b?u||(u=c.header_cell.createAndFill()):d||(d=c.cell.createAndFill()))}const f=c.row.create(null,ae.from(h)),p=[];for(let g=t.height;g<o;g++)p.push(f);e.insert(e.mapping.slice(i).map(r+n.nodeSize-2),p)}return!!(d||u)}function Br(e,t,n,r,s,o,i,a){if(i==0||i==t.height)return!1;let c=!1;for(let d=s;d<o;d++){const u=i*t.width+d,h=t.map[u];if(t.map[u-t.width]==h){c=!0;const f=n.nodeAt(h),{top:p,left:g}=t.findCell(h);e.setNodeMarkup(e.mapping.slice(a).map(h+r),null,E(N({},f.attrs),{rowspan:i-p})),e.insert(e.mapping.slice(a).map(t.positionAt(i,g,n)),f.type.createAndFill(E(N({},f.attrs),{rowspan:p+f.attrs.rowspan-i}))),d+=f.attrs.colspan-1}}return c}function Ur(e,t,n,r,s,o,i,a){if(i==0||i==t.width)return!1;let c=!1;for(let d=s;d<o;d++){const u=d*t.width+i,h=t.map[u];if(t.map[u-1]==h){c=!0;const f=n.nodeAt(h),p=t.colCount(h),g=e.mapping.slice(a).map(h+r);e.setNodeMarkup(g,null,Oe(f.attrs,i-p,f.attrs.colspan-(i-p))),e.insert(g+f.nodeSize,f.type.createAndFill(Oe(f.attrs,0,i-p))),d+=f.attrs.rowspan-1}}return c}function Fr(e,t,n,r,s){let o=n?e.doc.nodeAt(n-1):e.doc;if(!o)throw new Error("No table found");let i=$.get(o);const{top:a,left:c}=r,d=c+s.width,u=a+s.height,h=e.tr;let f=0;function p(){if(o=n?h.doc.nodeAt(n-1):h.doc,!o)throw new Error("No table found");i=$.get(o),f=h.mapping.maps.length}Rc(h,i,o,n,d,u,f)&&p(),Br(h,i,o,n,c,d,a,f)&&p(),Br(h,i,o,n,c,d,u,f)&&p(),Ur(h,i,o,n,a,u,c,f)&&p(),Ur(h,i,o,n,a,u,d,f)&&p();for(let g=a;g<u;g++){const m=i.positionAt(g,c,o),b=i.positionAt(g,d,o);h.replace(h.mapping.slice(f).map(m+n),h.mapping.slice(f).map(b+n),new Se(s.rows[g-a],0,0))}p(),h.setSelection(new O(h.doc.resolve(n+i.positionAt(a,c,o)),h.doc.resolve(n+i.positionAt(u-1,d-1,o)))),t(h)}var Lc=Si({ArrowLeft:mt("horiz",-1),ArrowRight:mt("horiz",1),ArrowUp:mt("vert",-1),ArrowDown:mt("vert",1),"Shift-ArrowLeft":gt("horiz",-1),"Shift-ArrowRight":gt("horiz",1),"Shift-ArrowUp":gt("vert",-1),"Shift-ArrowDown":gt("vert",1),Backspace:pt,"Mod-Backspace":pt,Delete:pt,"Mod-Delete":pt});function yt(e,t,n){return n.eq(e.selection)?!1:(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function mt(e,t){return(n,r,s)=>{if(!s)return!1;const o=n.selection;if(o instanceof O)return yt(n,r,we.near(o.$headCell,t));if(e!="horiz"&&!o.empty)return!1;const i=ro(s,e,t);if(i==null)return!1;if(e=="horiz")return yt(n,r,we.near(n.doc.resolve(o.head+t),t));{const a=n.doc.resolve(i),c=Qs(a,e,t);let d;return c?d=we.near(c,1):t<0?d=we.near(n.doc.resolve(a.before(-1)),-1):d=we.near(n.doc.resolve(a.after(-1)),1),yt(n,r,d)}}}function gt(e,t){return(n,r,s)=>{if(!s)return!1;const o=n.selection;let i;if(o instanceof O)i=o;else{const c=ro(s,e,t);if(c==null)return!1;i=new O(n.doc.resolve(c))}const a=Qs(i.$headCell,e,t);return a?yt(n,r,new O(i.$anchorCell,a)):!1}}function _c(e,t){const n=e.state.doc,r=Fe(n.resolve(t));return r?(e.dispatch(e.state.tr.setSelection(new O(r))),!0):!1}function Oc(e,t,n){if(!re(e.state))return!1;let r=Sc(n);const s=e.state.selection;if(s instanceof O){r||(r={width:1,height:1,rows:[ae.from($n(K(e.state.schema).cell,n))]});const o=s.$anchorCell.node(-1),i=s.$anchorCell.start(-1),a=$.get(o).rectBetween(s.$anchorCell.pos-i,s.$headCell.pos-i);return r=Mc(r,a.right-a.left,a.bottom-a.top),Fr(e.state,e.dispatch,i,a,r),!0}else if(r){const o=un(e.state),i=o.start(-1);return Fr(e.state,e.dispatch,i,$.get(o.node(-1)).findCell(o.pos-i),r),!0}else return!1}function zc(e,t){var n;if(t.ctrlKey||t.metaKey)return;const r=Wr(e,t.target);let s;if(t.shiftKey&&e.state.selection instanceof O)o(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&r&&(s=Fe(e.state.selection.$anchor))!=null&&((n=kn(e,t))==null?void 0:n.pos)!=s.pos)o(s,t),t.preventDefault();else if(!r)return;function o(c,d){let u=kn(e,d);const h=Te.getState(e.state)==null;if(!u||!fr(c,u))if(h)u=c;else return;const f=new O(c,u);if(h||!e.state.selection.eq(f)){const p=e.state.tr.setSelection(f);h&&p.setMeta(Te,c.pos),e.dispatch(p)}}function i(){e.root.removeEventListener("mouseup",i),e.root.removeEventListener("dragstart",i),e.root.removeEventListener("mousemove",a),Te.getState(e.state)!=null&&e.dispatch(e.state.tr.setMeta(Te,-1))}function a(c){const d=c,u=Te.getState(e.state);let h;if(u!=null)h=e.state.doc.resolve(u);else if(Wr(e,d.target)!=r&&(h=kn(e,t),!h))return i();h&&o(h,d)}e.root.addEventListener("mouseup",i),e.root.addEventListener("dragstart",i),e.root.addEventListener("mousemove",a)}function ro(e,t,n){if(!(e.state.selection instanceof Ne))return null;const{$head:r}=e.state.selection;for(let s=r.depth-1;s>=0;s--){const o=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:o.childCount))return null;if(o.type.spec.tableRole=="cell"||o.type.spec.tableRole=="header_cell"){const a=r.before(s),c=t=="vert"?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(c)?a:null}}return null}function Wr(e,t){for(;t&&t!=e.dom;t=t.parentNode)if(t.nodeName=="TD"||t.nodeName=="TH")return t;return null}function kn(e,t){const n=e.posAtCoords({left:t.clientX,top:t.clientY});return n&&n?Fe(e.state.doc.resolve(n.pos)):null}var Hc=class{constructor(t,n){this.node=t,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Bn(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,Bn(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function Bn(e,t,n,r,s,o){var i;let a=0,c=!0,d=t.firstChild;const u=e.firstChild;if(u){for(let h=0,f=0;h<u.childCount;h++){const{colspan:p,colwidth:g}=u.child(h).attrs;for(let m=0;m<p;m++,f++){const b=s==f?o:g&&g[m],x=b?b+"px":"";if(a+=b||r,b||(c=!1),d)d.style.width!=x&&(d.style.width=x),d=d.nextSibling;else{const y=document.createElement("col");y.style.width=x,t.appendChild(y)}}}for(;d;){const h=d.nextSibling;(i=d.parentNode)==null||i.removeChild(d),d=h}c?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var X=new ce("tableColumnResizing");function Pc({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:n=100,View:r=Hc,lastColumnResizable:s=!0}={}){const o=new Ue({key:X,state:{init(i,a){var c,d;const u=(d=(c=o.spec)==null?void 0:c.props)==null?void 0:d.nodeViews,h=K(a.schema).table.name;return r&&u&&(u[h]=(f,p)=>new r(f,n,p)),new Dc(-1,!1)},apply(i,a){return a.apply(i)}},props:{attributes:i=>{const a=X.getState(i);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(i,a)=>{Ic(i,a,e,s)},mouseleave:i=>{$c(i)},mousedown:(i,a)=>{Bc(i,a,t,n)}},decorations:i=>{const a=X.getState(i);if(a&&a.activeHandle>-1)return Kc(i,a.activeHandle)},nodeViews:{}}});return o}var Dc=class vt{constructor(t,n){this.activeHandle=t,this.dragging=n}apply(t){const n=this,r=t.getMeta(X);if(r&&r.setHandle!=null)return new vt(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new vt(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&t.docChanged){let s=t.mapping.map(n.activeHandle,-1);return In(t.doc.resolve(s))||(s=-1),new vt(s,n.dragging)}return n}};function Ic(e,t,n,r){if(!e.editable)return;const s=X.getState(e.state);if(s&&!s.dragging){const o=Fc(t.target);let i=-1;if(o){const{left:a,right:c}=o.getBoundingClientRect();t.clientX-a<=n?i=Vr(e,t,"left",n):c-t.clientX<=n&&(i=Vr(e,t,"right",n))}if(i!=s.activeHandle){if(!r&&i!==-1){const a=e.state.doc.resolve(i),c=a.node(-1),d=$.get(c),u=a.start(-1);if(d.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==d.width-1)return}so(e,i)}}}function $c(e){if(!e.editable)return;const t=X.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&so(e,-1)}function Bc(e,t,n,r){var s;if(!e.editable)return!1;const o=(s=e.dom.ownerDocument.defaultView)!=null?s:window,i=X.getState(e.state);if(!i||i.activeHandle==-1||i.dragging)return!1;const a=e.state.doc.nodeAt(i.activeHandle),c=Uc(e,i.activeHandle,a.attrs);e.dispatch(e.state.tr.setMeta(X,{setDragging:{startX:t.clientX,startWidth:c}}));function d(h){o.removeEventListener("mouseup",d),o.removeEventListener("mousemove",u);const f=X.getState(e.state);f!=null&&f.dragging&&(Wc(e,f.activeHandle,Kr(f.dragging,h,n)),e.dispatch(e.state.tr.setMeta(X,{setDragging:null})))}function u(h){if(!h.which)return d(h);const f=X.getState(e.state);if(f&&f.dragging){const p=Kr(f.dragging,h,n);Yr(e,f.activeHandle,p,r)}}return Yr(e,i.activeHandle,c,r),o.addEventListener("mouseup",d),o.addEventListener("mousemove",u),t.preventDefault(),!0}function Uc(e,t,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const o=e.domAtPos(t);let a=o.node.childNodes[o.offset].offsetWidth,c=n;if(r)for(let d=0;d<n;d++)r[d]&&(a-=r[d],c--);return a/c}function Fc(e){for(;e&&e.nodeName!="TD"&&e.nodeName!="TH";)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}function Vr(e,t,n,r){const s=n=="right"?-r:r,o=e.posAtCoords({left:t.clientX+s,top:t.clientY});if(!o)return-1;const{pos:i}=o,a=Fe(e.state.doc.resolve(i));if(!a)return-1;if(n=="right")return a.pos;const c=$.get(a.node(-1)),d=a.start(-1),u=c.map.indexOf(a.pos-d);return u%c.width==0?-1:d+c.map[u-1]}function Kr(e,t,n){const r=t.clientX-e.startX;return Math.max(n,e.startWidth+r)}function so(e,t){e.dispatch(e.state.tr.setMeta(X,{setHandle:t}))}function Wc(e,t,n){const r=e.state.doc.resolve(t),s=r.node(-1),o=$.get(s),i=r.start(-1),a=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1,c=e.state.tr;for(let d=0;d<o.height;d++){const u=d*o.width+a;if(d&&o.map[u]==o.map[u-o.width])continue;const h=o.map[u],f=s.nodeAt(h).attrs,p=f.colspan==1?0:a-o.colCount(h);if(f.colwidth&&f.colwidth[p]==n)continue;const g=f.colwidth?f.colwidth.slice():Vc(f.colspan);g[p]=n,c.setNodeMarkup(i+h,null,E(N({},f),{colwidth:g}))}c.docChanged&&e.dispatch(c)}function Yr(e,t,n,r){const s=e.state.doc.resolve(t),o=s.node(-1),i=s.start(-1),a=$.get(o).colCount(s.pos-i)+s.nodeAfter.attrs.colspan-1;let c=e.domAtPos(s.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&Bn(o,c.firstChild,c,r,a,n)}function Vc(e){return Array(e).fill(0)}function Kc(e,t){var n;const r=[],s=e.doc.resolve(t),o=s.node(-1);if(!o)return jt.empty;const i=$.get(o),a=s.start(-1),c=i.colCount(s.pos-a)+s.nodeAfter.attrs.colspan-1;for(let d=0;d<i.height;d++){const u=c+d*i.width;if((c==i.width-1||i.map[u]!=i.map[u+1])&&(d==0||i.map[u]!=i.map[u-i.width])){const h=i.map[u],f=a+h+o.nodeAt(h).nodeSize-1,p=document.createElement("div");p.className="column-resize-handle",(n=X.getState(e))!=null&&n.dragging&&r.push(kt.node(a+h,a+h+o.nodeAt(h).nodeSize,{class:"column-resize-dragging"})),r.push(kt.widget(f,p))}}return jt.create(e.doc,r)}function Yc({allowTableNodeSelection:e=!1}={}){return new Ue({key:Te,state:{init(){return null},apply(t,n){const r=t.getMeta(Te);if(r!=null)return r==-1?null:r;if(n==null||!t.docChanged)return n;const{deleted:s,pos:o}=t.mapping.mapResult(n);return s?null:o}},props:{decorations:ic,handleDOMEvents:{mousedown:zc},createSelectionBetween(t){return Te.getState(t.state)!=null?t.state.selection:null},handleTripleClick:_c,handleKeyDown:Lc,handlePaste:Oc},appendTransaction(t,n,r){return cc(r,eo(r,n),e)}})}function Un(e,t){return t?["width",`${Math.max(t,e)}px`]:["min-width",`${e}px`]}function qr(e,t,n,r,s,o){var i;let a=0,c=!0,d=t.firstChild;const u=e.firstChild;if(u!==null)for(let h=0,f=0;h<u.childCount;h+=1){const{colspan:p,colwidth:g}=u.child(h).attrs;for(let m=0;m<p;m+=1,f+=1){const b=s===f?o:g&&g[m],x=b?`${b}px`:"";if(a+=b||r,b||(c=!1),d){if(d.style.width!==x){const[y,j]=Un(r,b);d.style.setProperty(y,j)}d=d.nextSibling}else{const y=document.createElement("col"),[j,A]=Un(r,b);y.style.setProperty(j,A),t.appendChild(y)}}}for(;d;){const h=d.nextSibling;(i=d.parentNode)===null||i===void 0||i.removeChild(d),d=h}c?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}class qc{constructor(t,n){this.node=t,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),qr(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,qr(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return t.type==="attributes"&&(t.target===this.table||this.colgroup.contains(t.target))}}function Gc(e,t,n,r){let s=0,o=!0;const i=[],a=e.firstChild;if(!a)return{};for(let h=0,f=0;h<a.childCount;h+=1){const{colspan:p,colwidth:g}=a.child(h).attrs;for(let m=0;m<p;m+=1,f+=1){const b=n===f?r:g&&g[m];s+=b||t,b||(o=!1);const[x,y]=Un(t,b);i.push(["col",{style:`${x}: ${y}`}])}}const c=o?`${s}px`:"",d=o?"":`${s}px`;return{colgroup:["colgroup",{},...i],tableWidth:c,tableMinWidth:d}}function Gr(e,t){return e.createAndFill()}function Qc(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const r=e.nodes[n];r.spec.tableRole&&(t[r.spec.tableRole]=r)}),e.cached.tableNodeTypes=t,t}function Xc(e,t,n,r,s){const o=Qc(e),i=[],a=[];for(let d=0;d<n;d+=1){const u=Gr(o.cell);if(u&&a.push(u),r){const h=Gr(o.header_cell);h&&i.push(h)}}const c=[];for(let d=0;d<t;d+=1)c.push(o.row.createChecked(null,r&&d===0?i:a));return o.table.createChecked(null,c)}function Jc(e){return e instanceof O}const xt=({editor:e})=>{const{selection:t}=e.state;if(!Jc(t))return!1;let n=0;const r=Oi(t.ranges[0].$from,o=>o.type.name==="table");return r==null||r.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(n+=1)}),n===t.ranges.length?(e.commands.deleteTable(),!0):!1},Zc=Me.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:qc,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:e,HTMLAttributes:t}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=Gc(e,this.options.cellMinWidth);return["table",U(this.options.HTMLAttributes,t,{style:r?`width: ${r}`:`min-width: ${s}`}),n,["tbody",0]]},addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:o})=>{const i=Xc(o.schema,e,t,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(i).scrollIntoView().setSelection(Ne.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>hc(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>fc(e,t),deleteColumn:()=>({state:e,dispatch:t})=>mc(e,t),addRowBefore:()=>({state:e,dispatch:t})=>xc(e,t),addRowAfter:()=>({state:e,dispatch:t})=>bc(e,t),deleteRow:()=>({state:e,dispatch:t})=>yc(e,t),deleteTable:()=>({state:e,dispatch:t})=>Nc(e,t),mergeCells:()=>({state:e,dispatch:t})=>Pr(e,t),splitCell:()=>({state:e,dispatch:t})=>Dr(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>ot("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>ot("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>Ac(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>Pr(e,t)?!0:Dr(e,t),setCellAttribute:(e,t)=>({state:n,dispatch:r})=>jc(e,t)(n,r),goToNextCell:()=>({state:e,dispatch:t})=>$r(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>$r(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&eo(e),!0),setCellSelection:e=>({tr:t,dispatch:n})=>{if(n){const r=O.create(t.doc,e.anchorCell,e.headCell);t.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:xt,"Mod-Backspace":xt,Delete:xt,"Mod-Delete":xt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Pc({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Yc({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:Li(_i(e,"tableRole",t))}}}),ed=Me.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",U(this.options.HTMLAttributes,e),0]}}),td=Me.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",U(this.options.HTMLAttributes,e),0]}}),nd=Me.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",U(this.options.HTMLAttributes,e),0]}}),rd=Me.create({name:"details",group:"block",content:"block+",atom:!0,addAttributes(){return{"data-summary":{default:""}}},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:e,node:t}){return["details",U(e)]},addNodeView(){return At(sd)}}),sd=({node:e})=>l.jsx(cn,{children:l.jsxs("details",{children:[l.jsx("summary",{className:"text-gray-11 text-sm",children:e.attrs["data-summary"]}),l.jsx("div",{className:"font-mono pl-4",children:l.jsx(ys,{})})]})}),od=Me.create({name:"timestamp-renderer",group:"inline",inline:!0,content:"inline*",atom:!0,addAttributes(){return{class:{default:"timestamp"},"data-timestamp-start":{default:""},"data-timestamp-end":{default:""},"data-timestamp-start-all-day":{default:"false"},"data-timestamp-end-all-day":{default:"false"}}},parseHTML(){return[{tag:"span.timestamp"}]},renderHTML({HTMLAttributes:e,node:t}){return["span",U(e),0]},addNodeView(){return At(id)}}),id=({node:e})=>{const t=e.attrs["data-timestamp-start"],n=e.attrs["data-timestamp-end"],r=e.attrs["data-timestamp-start-all-day"]==="true"||e.attrs["data-timestamp-start-all-day"]===!0,{icon:s,label:o}=C.useMemo(()=>{let i="",a=l.jsx(Cr,{});const c=vr(t),d=n?vr(n):"",u=ti(),h=c.isSame(u,"day"),f=c.isSame(u.add(1,"day"),"day"),p=c.isSame(u.subtract(1,"day"),"day"),g=c.isSame(u,"year");if(d)c.isSame(d,"day")?h?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" today":f?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" tomorrow":p?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" yesterday":i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" on Do MMM":r?i=c.format("Do MMM")+" - "+d.format("Do MMM"):i=c.format("hh:mm A [on] Do MMM")+" - "+d.format("hh:mm A [on] Do MMM");else if(r)h?i="Today":f?i="Tomorrow":p?i="Yesterday":g?i=c.format("Do MMMM"):i=c.format("Do MMMM YYYY");else{h?i=c.format("hh:mm A")+" today":f?i=c.format("hh:mm A")+" tomorrow":p?i=c.format("hh:mm A")+" yesterday":g?i=c.format("hh:mm A [on] Do MMM"):i=c.format("hh:mm A [on] Do MMM YYYY");const m=c.hour();m<=11&&m>=5?a=l.jsx(ri,{}):m>11&&m<=16?a=l.jsx(si,{}):m>16&&m<19?a=l.jsx(oi,{}):(m>=19||m<=4)&&(a=l.jsx(ii,{}))}return{icon:a,label:i}},[t,n]);return l.jsx(cn,{as:"span",children:l.jsxs(Jn,{children:[l.jsx(Zn,{children:l.jsxs(T,{as:"span",className:"bg-accent-3 px-0.5 text-accent-11",children:[l.jsx(Cr,{className:"mr-1 -mb-0.5"}),l.jsx(ys,{as:"span"})]})}),l.jsx(er,{size:"1",className:"rounded-sm dark:bg-gray-4 py-2 px-2",children:l.jsx(_e,{children:l.jsxs(ni,{align:"center",children:[s,l.jsx(T,{as:"span",size:"2",weight:"medium",children:o})]})})})]})})},ld=C.memo(({messageID:e})=>{const{editor:t}=zi(),n=t==null?void 0:t.getJSON(),r=C.useMemo(()=>{if(!n)return null;let o="";const i=a=>{var c,d;if(o)return o;if(Array.isArray(a))for(const u of a)typeof u=="object"&&i(u);else if((a==null?void 0:a.type)==="link"){const u=(c=a==null?void 0:a.attrs)==null?void 0:c.href;u!=null&&u.startsWith("mailto")||(o=(d=a==null?void 0:a.attrs)==null?void 0:d.href)}else for(const u in a)typeof(a==null?void 0:a[u])=="object"&&i(a==null?void 0:a[u])};return i(n),o},[n]);return r?ud(r)?r.includes("dQw4w9WgXcQ")?null:l.jsx(fd,{href:r,messageID:e}):l.jsx(ad,{href:r,messageID:e}):null}),ad=({href:e,messageID:t})=>{var a;const{data:n,isLoading:r}=ze("raven.api.preview_links.get_preview_link",{urls:JSON.stringify([e])},e?`link_preview_${e}`:null,{revalidateOnFocus:!1,revalidateOnReconnect:!1,shouldRetryOnError:!1}),{call:s}=Ie("raven.api.preview_links.hide_link_preview"),o=()=>{s({message_id:t})},i=(a=n==null?void 0:n.message)==null?void 0:a[0];if(r)return l.jsx(cd,{});if(i&&i.site_name&&i.description){const c=i.absolute_image||i.image;return l.jsxs(D,{pt:"2",maxWidth:{md:"580px"},position:"relative",className:"group/linkpreview sm:max-w-[580px] max-w-[356px]",children:[l.jsx(ps,{asChild:!0,className:"p-0 sm:p-3",children:l.jsxs("a",{href:e,target:"_blank",className:"flex sm:items-center flex-col sm:flex-row sm:gap-4 gap-0 sm:pr-4",children:[c&&l.jsx("img",{src:c,alt:i.title,className:"sm:max-w-[220px] w-full h-full object-cover sm:object-center sm:h-auto sm:-ml-3 sm:-mt-3 sm:-mb-3",style:{display:"block",backgroundColor:"var(--gray-5)"}}),l.jsxs(_e,{className:"gap-1.5 sm:p-0 py-3 px-3",children:[l.jsxs(_e,{className:"sm:gap-1 gap-0.5",children:[l.jsx(T,{weight:"bold",className:"block",size:"2",children:i.title}),l.jsx(T,{size:"1",children:i.site_name})]}),l.jsx(T,{as:"p",size:"1",className:"line-clamp-3",children:i.description})]})]})}),l.jsx("div",{className:"absolute top-4 right-2 z-10 group-hover/linkpreview:visible invisible sm:block hidden",children:l.jsx(Be,{content:"Hide link preview",children:l.jsx(Ee,{size:"1",color:"gray","aria-label":"Hide link preview",className:"bg-black/40 text-white rounded-md",variant:"ghost",onClick:o,children:l.jsx(ns,{size:"20"})})})})]})}return null},cd=()=>l.jsx(D,{pt:"2",maxWidth:{md:"580px"},className:"sm:max-w-[580px] max-w-[356px]",children:l.jsx(ps,{asChild:!0,className:"p-0 sm:p-3",children:l.jsxs("div",{className:"animate-pulse flex sm:items-center flex-col sm:flex-row sm:gap-4 gap-0",children:[l.jsx("div",{className:"sm:max-w-[220px] w-full h-[160px] sm:h-[120px] bg-gray-200 sm:-ml-3 sm:-mt-3 sm:-mb-3"}),l.jsxs(_e,{className:"gap-1.5 sm:p-0 py-3 px-3 flex-1",children:[l.jsxs(_e,{className:"sm:gap-1 gap-0.5",children:[l.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),l.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]}),l.jsxs("div",{className:"space-y-1.5",children:[l.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),l.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),l.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})]})})}),dd=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,ud=e=>e.match(dd),Qr=e=>e?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",hd=e=>{if(e.includes("/embed/"))return e;if(e.includes("youtu.be")){const r=e.split("/").pop();return r?`${Qr()}${r}`:null}const n=/(?:v=|shorts\/)([-\w]+)/gm.exec(e);return!n||!n[1]?null:`${Qr()}${n[1]}`},fd=({href:e,messageID:t})=>{const n=hd(e);return n?l.jsx("div",{"data-youtube-video":!0,className:"pt-2",children:l.jsx("iframe",{width:"480",height:"270",src:n,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; modestbranding=1",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}):null},He=$i(Fi);He.register("html",Wi);He.register("css",Vi);He.register("js",Ki);He.register("ts",Yi);He.register("json",qi);He.register("python",Gi);const pd=i=>{var a=i,{message:e,user:t,isScrolling:n=!1,showMiniImage:r=!1,showLinkPreview:s=!0}=a,o=pe(a,["message","user","isScrolling","showMiniImage","showLinkPreview"]);const c=Hi({content:e.text,editable:!1,editorProps:{attributes:{class:P("tiptap-renderer")}},enableCoreExtensions:!0,extensions:[Pi.configure({heading:!1,codeBlock:!1,bold:!1,italic:!1,orderedList:{HTMLAttributes:{class:"list-decimal pl-6"}},bulletList:{HTMLAttributes:{class:"list-disc pl-4"}},listItem:{HTMLAttributes:{class:"rt-Text leading-relaxed text-base sm:text-sm"}},paragraph:{HTMLAttributes:{class:"rt-Text text-base sm:text-sm"}},code:{HTMLAttributes:{class:"pt-0.5 px-1 pb-px bg-[var(--gray-a3)] dark:bg-[#0d0d0d] text-[var(--ruby-a11)] dark-[var(--accent-a3)] text text-xs font-mono rounded border border-gray-4 dark:border-gray-6"}}}),pa.configure({multicolor:!0,HTMLAttributes:{class:"bg-[var(--yellow-6)] dark:bg-[var(--yellow-11)] px-2 py-1"}}),Wa,Di.configure({lowlight:He}),ma,Ua,Ii,Zc.configure({HTMLAttributes:{class:"rt-TableRootTable border-l border-r border-t border-gray-4 dark:border-gray-7 my-2"}}).extend({renderHTML({node:d,HTMLAttributes:u}){return["div",{class:"table-wrapper rt-TableRoot rt-r-size-1 rt-variant-ghost"},["table",U(u,d.attrs,{class:"rt-TableRootTable border-l border-r border-t border-gray-4 dark:border-gray-7 my-2"}),0]]}}),nd.configure({HTMLAttributes:{class:"rt-TableRow"}}),td.configure({HTMLAttributes:{class:"rt-TableHeader px-2 py-1 bg-accent-2 dark:bg-gray-3 border-r border-b border-gray-4 dark:border-gray-7"}}),ed.configure({HTMLAttributes:{class:"rt-TableCell py-1 px-2 border-r border-gray-4 dark:border-gray-7"}}),Ka.configure({HTMLAttributes:{class:r?"w-auto h-16 max-h-16":"w-full max-w-48 sm:max-w-96 mt-1 h-auto"},inline:!0}),zr.extend({name:"userMention",addNodeView(){return At(xa)}}).configure({suggestion:{char:"@",pluginKey:new ce("userMention")}}),zr.extend({name:"channelMention",HTMLAttributes:{class:"mention"},addNodeView(){return At(ba)}}).configure({suggestion:{char:"#",pluginKey:new ce("channelMention")}}),rd,od]});return l.jsx(D,E(N({className:P("overflow-x-hidden text-ellipsis",o.className)},o),{children:l.jsxs(Bi.Provider,{value:{editor:c},children:[l.jsx(Ui,{contentEditable:!1,editor:c,readOnly:!0}),s&&l.jsx(ld,{messageID:e.name})]})}))},oo=({message:e,onReply:t,onEdit:n,isEmojiPickerOpen:r,setIsEmojiPickerOpen:s,showThreadButton:o=!0,alignToRight:i=!1})=>{var m,b,x;const{currentUser:a}=C.useContext($e),c=li(Xi),d=a===(e==null?void 0:e.owner)&&!(e!=null&&e.is_bot_message),u=C.useRef(null),h=y=>{y.preventDefault();var j=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:y.clientX,clientY:y.clientY,screenX:y.screenX,screenY:y.screenY,buttons:2});y.target.dispatchEvent(j)},f=_s(),p=(y,j=!1,A)=>{e&&f(e,y,j,A).catch(k=>{_.error("Could not react to message.",{description:de(k)})})},g=(x=(b=(m=window.frappe)==null?void 0:m.boot)==null?void 0:b.chat_style)!=null?x:"Simple";return l.jsx(D,{ref:u,className:P("absolute group-hover:visible group-hover:transition-all ease-ease-out-quad group-hover:delay-100 z-50 p-1 shadow-md rounded-md bg-white dark:bg-gray-1 invisible",g==="Left-Right"?i?"-top-10 right-0":"-top-10 left-0":"-top-6 right-4"),children:l.jsxs(v,{gap:"1",children:[c.map(y=>l.jsx(qe,{className:"text-base",tooltip:`React with ${y}`,"aria-label":`React with ${y}`,onClick:()=>{p(y)},children:y},y)),l.jsx(Ls,{isOpen:r,setIsOpen:s,saveReaction:p}),d&&e.message_type==="Text"?l.jsx(qe,{onClick:n,tooltip:"Edit message","aria-label":"Edit message",children:l.jsx(Zr,{size:"18"})}):l.jsx(qe,{tooltip:"Reply","aria-label":"Reply to this message",onClick:t,children:l.jsx(Jr,{size:"18"})}),e&&!e.is_thread&&o&&l.jsx(Ml,{messageID:e.name}),l.jsx(qe,{"aria-label":"More actions",variant:"soft",tooltip:"More actions",onClick:h,className:sr,children:l.jsx(ai,{size:"18"})})]})})},io=s=>{var o=s,{message:e,children:t,className:n}=o,r=pe(o,["message","children","className"]);var a,c,d,u,h;const i=an(e.owner);return l.jsxs(v,E(N({className:P("p-2 items-start bg-white border border-gray-5 shadow-sm dark:bg-gray-3 dark:border-gray-6 rounded-md overflow-hidden",n)},r),{children:[l.jsxs(v,{gap:"1",direction:"column",className:"border-l-2 pl-2 border-gray-8",children:[l.jsxs(v,{gap:"2",align:"center",children:[l.jsx(T,{as:"span",size:"1",weight:"medium",truncate:!0,children:(a=i==null?void 0:i.full_name)!=null?a:e.owner}),l.jsx(Gn,{orientation:"vertical"}),l.jsx(T,{as:"span",size:"1",color:"gray",children:e.creation&&l.jsx(qn,{date:e.creation})})]}),l.jsx(D,{className:"max-w-[75vw]",children:e.message_type==="Poll"?l.jsxs(T,{as:"span",size:"2",className:"line-clamp-2 flex items-center",children:[l.jsx(ci,{size:"14",className:"inline mr-1"}),"Poll: ",(d=(c=e.content)==null?void 0:c.split(`
`))==null?void 0:d[0]]}):["File","Image"].includes((u=e.message_type)!=null?u:"Text")?l.jsxs(v,{gap:"2",align:"center",children:[e.message_type==="File"&&e.file&&l.jsx(is,{ext:os(e.file),size:"18"}),e.message_type==="Image"&&l.jsx("img",{src:e.file,alt:`Image sent by ${e.owner}`,height:"30",width:"30",className:"object-cover rounded-md"}),l.jsx(T,{as:"span",size:"2",children:on(e.file)})]}):l.jsx(T,{as:"span",size:"2",className:"line-clamp-2 text-ellipsis",children:di((h=e.content)!=null?h:"")})})]}),t]}))};function lo(e,t=300,n={}){const r=C.useRef(null),s=C.useCallback(o=>{r.current?(clearTimeout(r.current),r.current=null,e&&e(o)):r.current=setTimeout(()=>{n.onSingleTap&&n.onSingleTap(o),r.current=null},t)},[e,t,n.onSingleTap]);return e?{onClick:s}:{}}const ao=e=>{const t=C.useRef(null);return C.useEffect(()=>{const n=r=>{t.current&&!t.current.contains(r.target)&&e()};return document.addEventListener("click",n,!0),()=>{document.removeEventListener("click",n,!0)}},[t]),t},co=({thread:e})=>{const{workspaceID:t}=it();return l.jsx("div",{className:"mt-2",children:l.jsxs(v,{justify:"between",align:"center",gap:"2",className:"w-fit px-3 py-2 border border-gray-4 rounded-md shadow-[0_20px_30px_-10px_rgba(0,0,0,0.1)]",children:[l.jsx(md,{thread:e}),l.jsx(ve,{size:"1",asChild:!0,color:"gray",variant:"ghost",className:"not-cal w-fit hover:bg-transparent hover:underline cursor-pointer",children:l.jsx(fs,{to:`/${t}/${e.channel_id}/thread/${e.name}`,children:"View Thread"})})]})})},md=({thread:e})=>{var n;const{data:t}=ze("raven.api.threads.get_number_of_replies",{thread_id:e.name},["thread_reply_count",e.name],{revalidateOnFocus:!1,shouldRetryOnError:!1});return l.jsxs(v,{gap:"1",align:"center",children:[l.jsx(T,{size:"1",className:"font-semibold text-accent-a11",children:(n=t==null?void 0:t.message)!=null?n:0}),l.jsx(T,{size:"1",className:"font-semibold text-accent-a11",children:(t==null?void 0:t.message)===1?"Reply":"Replies"})]})},gd=({message:e,user:t,isActive:n,isHighlighted:r,onReplyMessageClick:s,onDelete:o,showThreadButton:i,onEdit:a,onReply:c,onForward:d,onViewReaction:u,onAttachToDocument:h})=>{var Pe,Ce,We;const{name:f,owner:p,is_bot_message:g,bot:m,creation:b,message_reactions:x,is_continuation:y,linked_message:j,replied_message_details:A}=e,{currentUser:k}=C.useContext($e),R=C.useMemo(()=>typeof A=="string"?JSON.parse(A):A,[A]),L=ln(),[B,F]=C.useState(!1),M=Cs(B,L?400:200),[z,q]=C.useState(!1),J=lo(at=>{L||F(!B)}),se=ao(()=>{L||F(!1)}),Z=()=>{L&&F(!0)},V=()=>{L&&F(!1)},ne=((We=(Ce=(Pe=window.frappe)==null?void 0:Pe.boot)==null?void 0:Ce.chat_style)!=null?We:"Simple")==="Left-Right"&&k===p&&!g,[oe,he]=C.useState(""),fe=at=>{if(at){const Ve=document.getSelection();Ve&&he(Ve.toString().trim())}else he("")};return l.jsx("div",{className:P("flex py-0.5",ne?"justify-end mr-4":"justify-start"),children:l.jsxs(v,{align:"start",gap:"2",children:[!ne&&l.jsx(xd,{message:e,user:t,isActive:n,className:"mt-[5px]"}),l.jsxs(ms,{modal:!1,onOpenChange:fe,children:[l.jsx(gs,E(N({},J),{ref:se,onMouseEnter:Z,onMouseLeave:V,className:"group",children:l.jsxs(_e,{gap:"0",align:"end",children:[ne&&!y&&l.jsx(D,{className:"text-right pr-1 pb-0.5",children:l.jsx(Tn,{timestamp:b})}),l.jsxs(v,{direction:"column",className:P("relative w-fit sm:max-w-[32rem] max-w-[80vw] bg-gray-2 dark:bg-gray-3 p-3 gap-1 rounded-md",r?"bg-yellow-50 hover:bg-yellow-50 dark:bg-yellow-300/20 dark:hover:bg-yellow-300/20":!L&&B?"bg-gray-2 dark:bg-gray-3":""),children:[!y&&!ne?l.jsxs(v,{align:"center",gap:"2",children:[l.jsx(ho,{user:t,userID:p,isActive:n}),l.jsx(Tn,{timestamp:b})]}):null,e.is_forwarded===1&&l.jsxs(v,{className:"text-gray-10 text-xs",gap:"1",align:"center",children:[l.jsx(xs,{size:"12"})," forwarded"]}),e.is_pinned===1&&l.jsxs(v,{className:"text-accent-9 text-xs",gap:"1",align:"center",children:[l.jsx(bs,{size:"12"})," Pinned"]}),j&&A&&l.jsx(io,{className:"sm:max-w-[32rem] max-w-[80vw] cursor-pointer mb-1",role:"button",onClick:()=>s(j),message:R}),l.jsx(fo,{message:e,user:t}),e.link_doctype&&e.link_document&&l.jsx(D,{className:P(e.is_continuation?"ml-0.5":"-ml-0.5"),children:l.jsx(vs,{doctype:e.link_doctype,docname:e.link_document})}),e.is_edited===1&&l.jsx(T,{size:"1",className:"text-gray-10",children:"(edited)"}),(x==null?void 0:x.length)&&l.jsx(Os,{message:e,message_reactions:x}),e.is_thread===1?l.jsx(co,{thread:e}):null,(M||z)&&l.jsx(oo,{message:e,onDelete:o,isEmojiPickerOpen:z,setIsEmojiPickerOpen:q,onEdit:a,onReply:c,onForward:d,showThreadButton:i,onAttachDocument:h,alignToRight:ne})]})]})})),l.jsx(Rs,{message:e,onDelete:o,showThreadButton:i,onEdit:a,selectedText:oe,onReply:c,onForward:d,onViewReaction:u,onAttachDocument:h})]})]})})},xd=o=>{var i=o,{message:e,className:t,user:n,isActive:r}=i,s=pe(i,["message","className","user","isActive"]);return l.jsx(D,E(N({className:P(e.is_continuation?"flex items-center w-[38px] sm:w-[34px]":"",t)},s),{children:e.is_continuation?null:l.jsx(uo,{userID:e.owner,user:n,isActive:r})}))},Ld=({message:e,setDeleteMessage:t,isHighlighted:n,onReplyMessageClick:r,setEditMessage:s,replyToMessage:o,forwardMessage:i,onAttachDocument:a,setReactionMessage:c,showThreadButton:d=!0})=>{var Ve,pr,mr;const{name:u,owner:h,is_bot_message:f,bot:p,creation:g,message_reactions:m,is_continuation:b,linked_message:x,replied_message_details:y}=e,{user:j,isActive:A}=wd(f&&p?p:h),k=()=>{t(e)},R=()=>{s(e)},L=()=>{o(e)},B=()=>{i(e)},F=()=>{a(e)},M=()=>{c(e)},z=ln(),[q,J]=C.useState(!1),se=Cs(q,z?400:200),Z=()=>{z&&J(!0)},V=()=>{z&&J(!1)},Q=lo(gr=>{z||J(!q)}),ne=ao(()=>{z||J(!1)}),oe=C.useMemo(()=>typeof y=="string"?JSON.parse(y):y,[y]),[he,fe]=C.useState(!1),Pe=(mr=(pr=(Ve=window.frappe)==null?void 0:Ve.boot)==null?void 0:pr.chat_style)!=null?mr:"Simple",[Ce,We]=C.useState(""),at=gr=>{if(gr){const xr=document.getSelection();xr&&We(xr.toString().trim())}else We("")};return l.jsx(l.Fragment,{children:Pe==="Left-Right"?l.jsx(gd,{message:e,user:j,isActive:A,isHighlighted:n,onReplyMessageClick:r,onDelete:k,showThreadButton:d,onEdit:R,onReply:L,onForward:B,onViewReaction:M,onAttachToDocument:F}):l.jsxs(D,{className:"relative",children:[!e.is_continuation&&e.is_thread?l.jsx("div",{className:`absolute
                        border-l
                        border-b
                        border-gray-5
                        h-[calc(100%-66px)]
                        rounded-bl-lg
                        w-6
                        top-[42px]
                        left-6 z-0`}):null,l.jsxs(ms,{modal:!1,onOpenChange:at,children:[l.jsx(gs,E(N({},Q),{ref:ne,onMouseEnter:Z,onMouseLeave:V,className:P(`group
                            sm:hover:bg-gray-2
                            active:bg-gray-2
                            sm:hover:transition-all
                            active:hover:transition-all
                            sm:hover:delay-100
                            active:hover:delay-100
                            select-none
                            sm:select-auto
                            sm:dark:hover:bg-gray-3
                            dark:active:bg-gray-4
                            data-[state=open]:bg-accent-2
                            dark:data-[state=open]:bg-gray-4
                            data-[state=open]:shadow-sm
                            transition-colors
                            px-1
                            py-1.5
                            sm:p-1.5
                            rounded-md`,b?"":"pt-2.5 sm:pt-3",n?"bg-yellow-50 hover:bg-yellow-50 dark:bg-yellow-300/20 dark:hover:bg-yellow-300/20":!z&&q?"bg-gray-2 dark:bg-gray-3":"",he?"bg-gray-2 dark:bg-gray-3":""),children:l.jsxs(v,{className:"gap-2.5 sm:gap-3 items-start",children:[l.jsx(bd,{message:e,user:j,isActive:A}),l.jsxs(v,{direction:"column",className:"gap-0.5 w-[90%]",justify:"center",children:[b?null:l.jsxs(v,{align:"center",gap:"2",mt:"-1",children:[l.jsx(ho,{user:j,userID:h,isActive:A}),l.jsx(Tn,{timestamp:g})]}),e.is_forwarded===1&&l.jsxs(v,{className:"text-gray-10 text-xs",gap:"1",align:"center",children:[l.jsx(xs,{size:"12"})," forwarded"]}),e.is_pinned===1&&l.jsxs(v,{className:"text-accent-9 text-xs",gap:"1",align:"center",children:[l.jsx(bs,{size:"12"})," Pinned"]}),x&&y&&l.jsx(io,{className:"sm:min-w-[28rem] cursor-pointer mb-1",role:"button",onClick:()=>r(x),message:oe}),l.jsx(fo,{message:e,user:j}),e.link_doctype&&e.link_document&&l.jsx(D,{className:P(e.is_continuation?"ml-0.5":"-ml-0.5"),children:l.jsx(vs,{doctype:e.link_doctype,docname:e.link_document})}),e.is_edited===1&&l.jsx(T,{size:"1",className:"text-gray-10",children:"(edited)"}),(m==null?void 0:m.length)&&l.jsx(Os,{message:e,message_reactions:m}),e.is_thread===1?l.jsx(co,{thread:e}):null]}),(se||he)&&l.jsx(oo,{message:e,onDelete:k,isEmojiPickerOpen:he,setIsEmojiPickerOpen:fe,onEdit:R,onReply:L,onForward:B,showThreadButton:d,onAttachDocument:F})]})})),l.jsx(Rs,{message:e,onDelete:k,showThreadButton:d,onEdit:R,onReply:L,onForward:B,onViewReaction:M,selectedText:Ce,onAttachDocument:F})]})]})})},bd=o=>{var i=o,{message:e,className:t,user:n,isActive:r}=i,s=pe(i,["message","className","user","isActive"]);return l.jsx(D,E(N({className:P(e.is_continuation?"invisible group-hover:visible flex items-center w-[32px]":"",t)},s),{children:e.is_continuation?l.jsx(D,{className:"-mt-0.5",children:l.jsx(Pl,{timestamp:e.creation})}):l.jsx(uo,{userID:e.owner,user:n,isActive:r})}))},wd=e=>{const t=an(e),n=ds(e);return{user:t,isActive:n}},uo=C.memo(({user:e,userID:t,isActive:n=!1})=>{var a,c;const r=(a=e==null?void 0:e.full_name)!=null?a:t,s=(e==null?void 0:e.type)==="Bot",o=C.useMemo(()=>{var d;return ui((d=e==null?void 0:e.full_name)!=null?d:t)},[e==null?void 0:e.full_name,t]),i=e==null?void 0:e.availability_status;return l.jsx(hi,{accentColor:o,children:l.jsxs("span",{className:"relative inline-block",children:[l.jsx(fi,{src:e==null?void 0:e.user_image,alt:(c=e==null?void 0:e.full_name)!=null?c:t,loading:"lazy",fallback:pi(r),size:"2",radius:"medium"}),i&&i==="Away"&&l.jsx("span",{className:P("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-[#FFAA33] shadow-md"})}),i&&i==="Do not disturb"&&l.jsx("span",{className:P("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-[#D22B2B] shadow-md"})}),i!=="Away"&&i!=="Do not disturb"&&n&&l.jsx("span",{className:P("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-green-600 shadow-md"})}),s&&l.jsx("span",{className:"absolute block translate-x-1/2 translate-y-1/2 transform rounded-full bottom-0.5 right-0.5",children:l.jsx(mi,{className:"text-accent-11 dark:text-accent-11",size:"16px"})})]})})}),ho=C.memo(({user:e,userID:t,isActive:n})=>{const{isBot:r,fullName:s,userImage:o,availabilityStatus:i,customStatus:a}=C.useMemo(()=>{var c,d;return{fullName:(c=e==null?void 0:e.full_name)!=null?c:t,availabilityStatus:e==null?void 0:e.availability_status,customStatus:e==null?void 0:e.custom_status,userImage:(d=e==null?void 0:e.user_image)!=null?d:"",isBot:(e==null?void 0:e.type)==="Bot"}},[e,t]);return l.jsxs(Jn,{children:[l.jsx(Zn,{children:l.jsxs(T,{className:"text-gray-12 flex items-center gap-1",weight:"medium",size:"2",children:[s," ",r&&l.jsx(Ct,{color:"gray",className:"font-semibold px-1 py-0",children:"Bot"})]})}),l.jsx(er,{size:"1",children:l.jsxs(_e,{children:[l.jsxs(v,{gap:"2",align:"center",children:[l.jsx(Qn,{src:o,alt:s,size:"4",isBot:r}),l.jsxs(v,{direction:"column",children:[l.jsxs(v,{gap:"3",align:"center",children:[l.jsx(T,{className:"text-gray-12",weight:"bold",size:"3",children:s}),i&&i!=="Invisible"&&l.jsx(v,{className:"text-gray-10 text-xs flex gap-1 items-center",children:us(i)}),!i&&n&&l.jsxs(v,{gap:"1",align:"center",children:[l.jsx(hs,{color:"green",size:"8"}),l.jsx(T,{className:"text-gray-10",size:"1",children:"Online"})]})]}),e&&!r&&l.jsx($s,{userID:e.name}),a?l.jsx(T,{className:"text-gray-11",size:"1",children:a}):e&&!r&&l.jsx(T,{className:"text-gray-11",size:"1",children:e==null?void 0:e.name})]})]}),l.jsx(yd,{userID:t})]})})]})}),yd=({userID:e})=>{const{call:t}=C.useContext(lt),n=Fn(),{workspaceID:r}=it(),s=()=>{e&&t.post("raven.api.raven_channel.create_direct_message_channel",{user_id:e}).then(o=>{n(`/${r}/${o==null?void 0:o.message}`)}).catch(o=>{_.error("Could not create a DM channel",{description:de(o)})})};return l.jsxs(ve,{variant:"soft",className:"not-cal",size:"1",onClick:s,children:[l.jsx(gi,{size:"14"})," Message"]})},fo=s=>{var o=s,{message:e,user:t,forceHideLinkPreview:n=!1}=o,r=pe(o,["message","user","forceHideLinkPreview"]);return l.jsxs(D,E(N({className:"flex flex-col gap-1"},r),{children:[e.text?l.jsx(pd,{message:E(N({},e),{message_type:"Text"}),user:t,showLinkPreview:n?!1:!e.hide_link_preview}):null,e.message_type==="Image"&&l.jsx(Zl,{message:e,user:t}),e.message_type==="File"&&l.jsx(ea,{message:e,user:t}),e.message_type==="Poll"&&l.jsx(ia,{message:e,user:t})]}))},_d=e=>{const{channels:t,dm_channels:n,error:r,isLoading:s}=C.useContext(xi);return{channel:C.useMemo(()=>{if(e){const i=t==null?void 0:t.find(c=>c.name===e);if(i)return{channelData:i,type:"channel"};const a=n==null?void 0:n.find(c=>c.name===e);return a?{channelData:a,type:"dm"}:void 0}else return},[e,t]),error:r,isLoading:s}};export{Tn as D,pa as H,Ka as I,Ba as L,uo as M,io as R,Ga as S,pd as T,ho as U,fo as a,Fa as b,zr as c,od as d,Pl as e,Ld as f,Md as g,ga as h,_d as u};
