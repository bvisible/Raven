var se=Object.defineProperty,te=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var $=(e,a,s)=>a in e?se(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,l=(e,a)=>{for(var s in a||(a={}))I.call(a,s)&&$(e,s,a[s]);if(y)for(var s of y(a))D.call(a,s)&&$(e,s,a[s]);return e},u=(e,a)=>te(e,re(a));var w=(e,a)=>{var s={};for(var r in e)I.call(e,r)&&a.indexOf(r)<0&&(s[r]=e[r]);if(e!=null&&y)for(var r of y(e))a.indexOf(r)<0&&D.call(e,r)&&(s[r]=e[r]);return s};import{aT as z,r as o,aU as B,aV as V,aW as oe,aX as ne,aY as ce,aZ as le,a_ as ie,a$ as de,b0 as ue,b1 as me,b2 as P,b3 as he,b4 as pe,b5 as Ce,b6 as G,b7 as be,b8 as M,b9 as _,ba as xe,bb as fe,j as t,S as F,x as U,bc as L,h as ve,bd as ke,V as ge,i as H,ax as je,b as we,m as Se,be as ye,o as Ee,bf as Ne,E as _e,a3 as T,ac as Fe,bg as Re,aA as $e}from"./index-93kECIxS.js";import{D as Ie}from"./DoctypeLinkRenderer-Dma5sl5s.js";import{u as De}from"./useDoctypeMeta-C0Qoed5I.js";import{P as Pe,S as Te,a as ze}from"./SettingsContentContainer-Df6uZS-7.js";import"./skeleton-C4uoHUPj.js";const{useDirection:Be}=oe,R="CheckboxGroup",[Ve,q]=z(R,[B,V]),A=B(),O=V(),[Ge,Me]=Ve(R),X=o.forwardRef((e,a)=>{const f=e,{__scopeCheckboxGroup:s,name:r,defaultValue:c,value:n,required:d=!1,disabled:m=!1,orientation:i,dir:p,loop:b=!0,onValueChange:h}=f,v=w(f,["__scopeCheckboxGroup","name","defaultValue","value","required","disabled","orientation","dir","loop","onValueChange"]),k=A(s),g=Be(p),[S=[],x]=ne({prop:n,defaultProp:c,onChange:h}),E=o.useCallback(j=>x((N=[])=>[...N,j]),[x]),C=o.useCallback(j=>x((N=[])=>N.filter(ae=>ae!==j)),[x]);return o.createElement(Ge,{scope:s,name:r,required:d,disabled:m,value:S,onItemCheck:E,onItemUncheck:C},o.createElement(ce,u(l({asChild:!0},k),{orientation:i,dir:g,loop:b}),o.createElement(le.div,u(l({role:"group","data-disabled":m?"":void 0,dir:g},v),{ref:a}))))});X.displayName=R;const Y="CheckboxGroupItem",K=o.forwardRef((e,a)=>{var v;const k=e,{__scopeCheckboxGroup:s,disabled:r}=k,c=w(k,["__scopeCheckboxGroup","disabled"]),n=Me(Y,s),d=n.disabled||r,m=A(s),i=O(s),p=o.useRef(null),b=ie(a,p),h=(v=n.value)==null?void 0:v.includes(c.value);return o.createElement(de,u(l({asChild:!0},m),{focusable:!d,active:h}),o.createElement(ue,u(l(l({name:n.name,disabled:d,required:n.required,checked:h},i),c),{ref:b,onCheckedChange:g=>{g?n.onItemCheck(e.value):n.onItemUncheck(e.value)}})))});K.displayName=Y;const Ue="CheckboxGroupIndicator",W=o.forwardRef((e,a)=>{const n=e,{__scopeCheckboxGroup:s}=n,r=w(n,["__scopeCheckboxGroup"]),c=O(s);return o.createElement(me,u(l(l({},c),r),{ref:a}))});W.displayName=Ue;const Le=X,He=K,qe=W,Ae=["1","2","3"],Oe=["surface","classic"],Xe=u(l(l(u(l({},Ce),{size:{type:"enum",className:"rt-r-size",values:Ae,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:Oe,default:"surface"}}),pe),he),{columns:u(l({},P.columns),{default:"repeat(auto-fit, minmax(200px, 1fr))"}),gap:u(l({},P.gap),{default:"4"})}),Z="CheckboxCards",[Ye]=z(Z,[q]),J=q(),[Ke,We]=Ye(Z),Q=o.forwardRef((e,a)=>{const m=G(e,Xe,be),{__scopeCheckboxCards:s,className:r,color:c}=m,n=w(m,["__scopeCheckboxCards","className","color"]),d=J(s);return o.createElement(Ke,{scope:s,size:e.size,highContrast:e.highContrast},o.createElement(M,{asChild:!0},o.createElement(Le,u(l(u(l({},d),{"data-accent-color":c}),n),{ref:a,className:_("rt-CheckboxCardsRoot",r)}))))});Q.displayName="CheckboxCards.Root";const ee=o.forwardRef((d,n)=>{var m=d,{__scopeCheckboxCards:e,children:a,className:s,style:r}=m,c=w(m,["__scopeCheckboxCards","children","className","style"]);const i=We("CheckboxCardsItem",e),p=J(e),{className:b}=G({size:i==null?void 0:i.size,variant:"surface",highContrast:i==null?void 0:i.highContrast},xe);return o.createElement("label",{className:_("rt-BaseCard","rt-CheckboxCardsItem",s),style:r},a,o.createElement(He,u(l(l({},p),c),{ref:n,className:_("rt-reset","rt-BaseCheckboxRoot","rt-CheckboxCardCheckbox",b)}),o.createElement(qe,u(l({},p),{asChild:!0,className:"rt-BaseCheckboxIndicator"}),o.createElement(fe,null))))});ee.displayName="CheckboxCards.Item";const Ze=e=>{const[a,s]=o.useState(""),[r,c]=o.useState("");return t.jsxs(M,{columns:"2",gap:"4",children:[t.jsxs(F,{children:[t.jsx(U,{size:"3",className:"not-cal",children:"Configure"}),t.jsx(L,{label:"Select a DocType",doctype:"DocType",filters:[["issingle","=",0],["istable","=",0]],value:a,setValue:s}),a&&t.jsx(Qe,{doctype:a,docname:r})]}),a&&t.jsx(ta,{doctype:a,docname:r,setDocname:c})]})},Je=["Section Break","Column Break","Tab Break","HTML","Table","Table MultiSelect","Button","Image","Fold","Heading","Table","Table MultiSelect"],Qe=({doctype:e,docname:a})=>{const{doc:s,mutate:r}=De(e),{previewFields:c,eligibleFields:n}=o.useMemo(()=>{var i,p,b;const d=(p=(i=s==null?void 0:s.fields)==null?void 0:i.filter(h=>!Je.includes(h.fieldtype)&&h.fieldname))!=null?p:[];return{previewFields:(b=d==null?void 0:d.filter(h=>h.in_preview))!=null?b:[],eligibleFields:d}},[s]);return s?t.jsx(ea,{doctype:e,docname:a,eligibleFields:n,previewFields:c,mutateMeta:r}):null},ea=({doctype:e,docname:a,eligibleFields:s,previewFields:r,mutateMeta:c})=>{const[n,d]=o.useState(""),m=o.useMemo(()=>{const C=n.toLowerCase();return s.filter(f=>{var j;return(j=f.fieldname)==null?void 0:j.toLowerCase().includes(C)})},[s,n]),[i,p]=o.useState(r.map(C=>{var f;return(f=C.fieldname)!=null?f:""})),[b,h]=o.useState(!1),v=C=>{p(C),h(!0)},{mutate:k}=ke(),{call:g,loading:S,error:x}=ge("raven.api.document_link.update_preview_fields"),E=()=>{g({doctype:e,fields:i}).then(()=>{T.success("Fields updated"),h(!1),c(),k(`raven.api.document_link.get_preview_data?doctype=${encodeURIComponent(e)}&docname=${encodeURIComponent(a)}`)}).catch(C=>{T.error(Fe(C))})};return t.jsxs(F,{children:[r.length===0&&t.jsx("div",{children:t.jsxs(H,{size:"2",children:["No fields have been selected for preview, hence we would show all mandatory fields of ",e," in the preview."]})}),t.jsxs(je,{align:"center",pt:"2",children:[t.jsx(we,{placeholder:"Search fields",className:"w-full",size:"2",value:n,onChange:C=>d(C.target.value),children:t.jsx(Se,{children:t.jsx(ye,{})})}),t.jsx(Ee,{className:"not-cal",type:"button",onClick:E,disabled:!b||S,children:S?t.jsxs(t.Fragment,{children:[t.jsx(Ne,{})," Updating..."]}):"Update and Preview"})]}),x&&t.jsx(_e,{error:x}),t.jsx(aa,{eligibleFields:m,selectedFields:i,setSelectedFields:v})]})},aa=({eligibleFields:e,selectedFields:a,setSelectedFields:s})=>t.jsx(Re,{className:"h-[60vh]",children:t.jsx(Q,{defaultValue:a,onValueChange:s,gap:"1",size:"1",children:e.map(r=>t.jsx(sa,{field:r},r.fieldname))})}),sa=({field:e})=>{var a;return t.jsxs(ee,{value:(a=e.fieldname)!=null?a:"",children:[t.jsx(H,{children:e.label}),t.jsx($e,{children:e.fieldtype})]})},ta=({doctype:e,docname:a,setDocname:s})=>{const{db:r}=o.useContext(ve);return o.useEffect(()=>{r.getLastDoc(e).then(c=>{s(c.name)})},[e]),t.jsxs(F,{children:[t.jsx(U,{size:"3",className:"not-cal",children:"Preview"}),t.jsx(L,{label:"Select a Document",doctype:e,value:a,setValue:s}),a&&t.jsx(Ie,{doctype:e,docname:a})]})},ra=()=>t.jsx(Pe,{children:t.jsxs(Te,{children:[t.jsx(ze,{title:"Document Previews",description:"Customise how document links are displayed in the chat. You can add/remove fields to be displayed in the preview."}),t.jsx(Ze,{})]})}),ua=ra;export{ua as Component};
