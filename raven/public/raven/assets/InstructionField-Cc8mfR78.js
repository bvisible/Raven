var ee=Object.defineProperty,ae=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var R=(a,t,s)=>t in a?ee(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,u=(a,t)=>{for(var s in t||(t={}))D.call(t,s)&&R(a,s,t[s]);if(y)for(var s of y(t))V.call(t,s)&&R(a,s,t[s]);return a},d=(a,t)=>ae(a,te(t));var x=(a,t)=>{var s={};for(var r in a)D.call(a,r)&&t.indexOf(r)<0&&(s[r]=a[r]);if(a!=null&&y)for(var r of y(a))t.indexOf(r)<0&&V.call(a,r)&&(s[r]=a[r]);return s};import{r as m,aX as I,j as e,bN as S,bM as se,bT as g,aT as re,aU as M,a$ as ne,bO as oe,aY as ie,bS as le,b6 as ce,b7 as ue,b9 as A,aJ as _,S as w,a as k,i as j,aP as de,aS as pe,aH as me,O as he,p as T,ax as G,L as Y,bu as ge,c as ve,v as xe,bD as fe,aq as be,ar as je,o as N,at as ye,E as Te,aA as Ce,bG as Ie,a7 as _e,bV as we,a3 as Ne}from"./index-3Ycoded3.js";import{m as Se,d as Ge,P as L,f as F,b as Pe,T as z}from"./table-DrC99LcT.js";import{p as Ee,i as Re}from"./radio-cards-BIWkPNcn.js";var O="Toggle",H=m.forwardRef((a,t)=>{const c=a,{pressed:s,defaultPressed:r,onPressedChange:o}=c,n=x(c,["pressed","defaultPressed","onPressedChange"]),[i,l]=I({prop:s,onChange:o,defaultProp:r!=null?r:!1,caller:O});return e.jsx(S.button,d(u({type:"button","aria-pressed":i,"data-state":i?"on":"off","data-disabled":a.disabled?"":void 0},n),{ref:t,onClick:se(a.onClick,()=>{a.disabled||l(!i)})}))});H.displayName=O;var b="ToggleGroup",[q]=re(b,[M]),B=M(),E=g.forwardRef((a,t)=>{const o=a,{type:s}=o,r=x(o,["type"]);if(s==="single"){const n=r;return e.jsx(De,d(u({},n),{ref:t}))}if(s==="multiple"){const n=r;return e.jsx(Ve,d(u({},n),{ref:t}))}throw new Error(`Missing prop \`type\` expected on \`${b}\``)});E.displayName=b;var[J,U]=q(b),De=g.forwardRef((a,t)=>{const c=a,{value:s,defaultValue:r,onValueChange:o=()=>{}}=c,n=x(c,["value","defaultValue","onValueChange"]),[i,l]=I({prop:s,defaultProp:r!=null?r:"",onChange:o,caller:b});return e.jsx(J,{scope:a.__scopeToggleGroup,type:"single",value:g.useMemo(()=>i?[i]:[],[i]),onItemActivate:l,onItemDeactivate:g.useCallback(()=>l(""),[l]),children:e.jsx(X,d(u({},n),{ref:t}))})}),Ve=g.forwardRef((a,t)=>{const v=a,{value:s,defaultValue:r,onValueChange:o=()=>{}}=v,n=x(v,["value","defaultValue","onValueChange"]),[i,l]=I({prop:s,defaultProp:r!=null?r:[],onChange:o,caller:b}),c=g.useCallback(h=>l((f=[])=>[...f,h]),[l]),p=g.useCallback(h=>l((f=[])=>f.filter(Z=>Z!==h)),[l]);return e.jsx(J,{scope:a.__scopeToggleGroup,type:"multiple",value:i,onItemActivate:c,onItemDeactivate:p,children:e.jsx(X,d(u({},n),{ref:t}))})});E.displayName=b;var[ke,Fe]=q(b),X=g.forwardRef((a,t)=>{const f=a,{__scopeToggleGroup:s,disabled:r=!1,rovingFocus:o=!0,orientation:n,dir:i,loop:l=!0}=f,c=x(f,["__scopeToggleGroup","disabled","rovingFocus","orientation","dir","loop"]),p=B(s),v=oe(i),h=u({role:"group",dir:v},c);return e.jsx(ke,{scope:s,rovingFocus:o,disabled:r,children:o?e.jsx(ie,d(u({asChild:!0},p),{orientation:n,dir:v,loop:l,children:e.jsx(S.div,d(u({},h),{ref:t}))})):e.jsx(S.div,d(u({},h),{ref:t}))})}),C="ToggleGroupItem",K=g.forwardRef((a,t)=>{const s=U(C,a.__scopeToggleGroup),r=Fe(C,a.__scopeToggleGroup),o=B(a.__scopeToggleGroup),n=s.value.includes(a.value),i=r.disabled||a.disabled,l=d(u({},a),{pressed:n,disabled:i}),c=g.useRef(null);return r.rovingFocus?e.jsx(ne,d(u({asChild:!0},o),{focusable:!i,active:n,ref:c,children:e.jsx($,d(u({},l),{ref:t}))})):e.jsx($,d(u({},l),{ref:t}))});K.displayName=C;var $=g.forwardRef((a,t)=>{const c=a,{__scopeToggleGroup:s,value:r}=c,o=x(c,["__scopeToggleGroup","value"]),n=U(C,s),i={role:"radio","aria-checked":a.pressed,"aria-pressed":void 0},l=n.type==="single"?i:void 0;return e.jsx(H,d(u(u({},l),o),{ref:t,onPressedChange:p=>{p?n.onItemActivate(r):n.onItemDeactivate(r)}}))}),ze=E,$e=K;const Me=["1","2","3"],Ae=["surface","classic"],Ye=u({disabled:{type:"boolean",className:"disabled",default:!1},size:{type:"enum",className:"rt-r-size",values:Me,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:Ae,default:"surface"}},le),Q=m.forwardRef((a,t)=>{const h=ce(a,Ye,ue),{className:s,children:r,radius:o,value:n,defaultValue:i,onValueChange:l}=h,c=x(h,["className","children","radius","value","defaultValue","onValueChange"]),[p,v]=I({prop:n,onChange:l,defaultProp:i});return m.createElement(ze,d(u({"data-disabled":a.disabled||void 0,"data-radius":o,ref:t,className:A("rt-SegmentedControlRoot",s),onValueChange:f=>{f&&v(f)}},c),{type:"single",value:p,asChild:!1,disabled:!!a.disabled}),r,m.createElement("div",{className:"rt-SegmentedControlIndicator"}))});Q.displayName="SegmentedControl.Root";const P=m.forwardRef((o,r)=>{var n=o,{children:a,className:t}=n,s=x(n,["children","className"]);return m.createElement($e,d(u({ref:r,className:A("rt-reset","rt-SegmentedControlItem",t)},s),{disabled:!1,asChild:!1}),m.createElement("span",{className:"rt-SegmentedControlItemSeparator"}),m.createElement("span",{className:"rt-SegmentedControlItemLabel"},m.createElement("span",{className:"rt-SegmentedControlItemLabelActive"},a),m.createElement("span",{className:"rt-SegmentedControlItemLabelInactive","aria-hidden":!0},a)))});P.displayName="SegmentedControl.Item";const We=({allowUsingTemplate:a,instructionRequired:t,autoFocus:s})=>{const{watch:r,control:o}=_(),n=r("dynamic_instructions");return e.jsxs(w,{gap:"4",children:[e.jsxs(k,{direction:"column",gap:"2",children:[e.jsx(j,{as:"label",size:"2",children:e.jsxs(k,{gap:"2",children:[e.jsx(de,{control:o,name:"dynamic_instructions",render:({field:i})=>e.jsx(pe,{checked:!!i.value,onCheckedChange:l=>i.onChange(l?1:0)})}),"Dynamic Instructions"]})}),e.jsxs(me,{size:"2",children:["Dynamic Instructions allow you to embed Jinja tags in your instruction to the bot.",e.jsx("br",{}),e.jsx("br",{}),"Instructions would be different based on the user who is calling the bot or the data in your system as they are computed every time the bot is called."]})]}),n?e.jsx(Oe,{autoFocus:s,instructionRequired:t,allowUsingTemplate:a}):e.jsx(W,{autoFocus:s,instructionRequired:t,allowUsingTemplate:a})]})},Le=[{variable:"first_name",description:"The first name of the user"},{variable:"full_name",description:"The full name of the user"},{variable:"email",description:"The email of the user"},{variable:"user",description:"The user ID (same as user_id)"},{variable:"user_id",description:"The ID of the user"},{variable:"company",description:"The default company in the system"},{variable:"currency",description:"The default currency of the company"},{variable:"employee_id",description:"The ID of the employee"},{variable:"employee_company",description:"The company of the employee (value in Employee DocType)"},{variable:"department",description:"The department of the employee"},{variable:"language",description:'The user language (lowercase, e.g., "en", "fr")'},{variable:"lang",description:'The user language (uppercase, e.g., "EN", "FR")'},{variable:"time_zone",description:"The user time zone"},{variable:"current_date",description:"The current date (YYYY-MM-DD)"},{variable:"current_time",description:"The current time (datetime object)"},{variable:"channel_id",description:"The current Raven channel ID (if in a channel)"},{variable:"thread_id",description:"The current Raven thread ID (if in a thread)"}],Oe=({allowUsingTemplate:a,instructionRequired:t,autoFocus:s})=>{const[r,o]=m.useState("editor");return e.jsxs(w,{gap:"4",children:[e.jsxs(Q,{defaultValue:"editor",value:r,onValueChange:o,children:[e.jsx(P,{value:"editor",children:"Editor"}),e.jsx(P,{value:"preview",children:"Preview"})]}),r==="editor"?e.jsx(W,{className:"w-full",allowUsingTemplate:a,autoFocus:s,instructionRequired:t}):e.jsx(Be,{}),e.jsx(he,{className:"w-full"}),e.jsxs(j,{size:"2",children:["Here are some variables you can use in your instruction. Simply copy by clicking on the variable.",e.jsx("br",{}),"You can also use standard Jinja variables available in the system."]}),e.jsxs(Se,{variant:"surface",children:[e.jsx(Ge,{children:e.jsxs(L,{children:[e.jsx(F,{children:"Variable"}),e.jsx(F,{children:"Description"})]})}),e.jsx(Pe,{children:Le.map(n=>e.jsx(He,{variable:n.variable,description:n.description},n.variable))})]})]})},He=({variable:a,description:t,withoutJinja:s=!1})=>e.jsxs(L,{children:[e.jsx(z,{children:e.jsx(qe,{text:a,withoutJinja:s})}),e.jsx(z,{children:t})]}),qe=({text:a,withoutJinja:t=!1})=>{const[s,r]=m.useState(""),o=n=>{n.preventDefault(),window.navigator.clipboard.writeText(t?a:"{{ "+a+" }}").then(()=>{r("Copied!"),setTimeout(()=>{r("")},1e3)}).catch(()=>{Ne.error("Failed to copy to clipboard")})};return e.jsx(_e,{content:s,open:s!=="",onOpenChange:n=>{n&&(r("Copy to clipboard"),setTimeout(()=>{r("")},1e3))},children:e.jsx(we,{role:"button",onClick:o,"aria-label":"Copy to clipboard",className:"cursor-pointer",children:a})})},Be=()=>{const{watch:a}=_(),t=a("instruction"),{data:s}=xe("raven.api.ai_features.get_instruction_preview",{instruction:t});return e.jsx(T,{className:"border-2 px-2 py-1 rounded-md bg-gray-3",children:s?e.jsx(j,{size:"2",className:"whitespace-pre-wrap",children:s.message}):null})},W=r=>{var o=r,{allowUsingTemplate:a,instructionRequired:t}=o,s=x(o,["allowUsingTemplate","instructionRequired"]);var v;const{register:n,watch:i,formState:{errors:l}}=_(),c=i("dynamic_instructions"),p=c?"You are an assistant running on an ERP. The current user's name is {{ first_name }} and the current company is {{ company }}.":"You are an assistant running on an ERP. You can answer questions about the company.";return e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(G,{justify:"between",children:[e.jsx(Y,{htmlFor:"instruction",isRequired:!0,children:"Instruction"}),a&&e.jsx(Je,{})]}),e.jsx(ge,u(d(u({id:"instruction"},n("instruction",{required:t?"Instruction is required":!1,validate:h=>!c&&h.includes("{{")?"You cannot include Jinja tags without enabling dynamic instructions.":!0})),{rows:10,resize:"vertical",placeholder:p,"aria-invalid":l.instruction?"true":"false"}),s))]}),l.instruction&&e.jsx(ve,{size:"2",children:(v=l.instruction)==null?void 0:v.message})]})},Je=()=>{const{setValue:a,getValues:t,watch:s}=_(),r=s("dynamic_instructions"),{data:o,error:n}=fe("Raven Bot Instruction Template",{fields:["template_name","dynamic_instructions","instruction"],filters:r?void 0:[["dynamic_instructions","=",0]]}),[i,l]=m.useState(""),c=p=>{p==="replace"?a("instruction",i):a("instruction",t("instruction")+i)};return e.jsxs(be,{onOpenChange:()=>l(""),children:[e.jsx(je,{children:e.jsx(N,{variant:"ghost",size:"1",className:"not-cal font-medium",children:"Import from Template"})}),e.jsx(ye,{width:"300px",className:"z-50",children:e.jsxs(w,{gap:"6",children:[e.jsx(Te,{error:n}),e.jsxs(T,{children:[e.jsx(Y,{htmlFor:"template",children:"Select a template"}),o&&o.length===0&&e.jsx(j,{size:"2",color:"gray",children:"No templates found"}),e.jsx(Ee,{columns:"1",name:"template",value:i,onValueChange:l,className:"max-h-96 overflow-y-auto",gap:"2",children:o==null?void 0:o.map(p=>e.jsx(Re,{value:p.instruction,className:"px-3 py-3",children:e.jsxs(G,{width:"100%",children:[e.jsx(j,{children:p.template_name}),p.dynamic_instructions?e.jsx(T,{children:e.jsxs(Ce,{color:"purple",children:[e.jsx(Ie,{})," Dynamic"]})}):null]})},p.name))})]}),e.jsxs(G,{justify:"end",children:[e.jsx(N,{type:"button",color:"gray",variant:"soft",onClick:()=>c("replace"),disabled:!i,children:"Replace"}),e.jsx(N,{type:"button",variant:"soft",disabled:!i,onClick:()=>c("append"),children:"Add"})]})]})})]})};export{We as I,He as V};
