const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddWorkspaceMemberModalContent-BigFH0g1.js","assets/index-3Ycoded3.js","assets/index-Cu2eObZh.css","assets/MultipleUserCombobox-IoCkQqjI.js","assets/index-BLAThYMl.js","assets/table-DrC99LcT.js","assets/TableLoader-BVWP7Tbp.js","assets/Skeleton-D01F4Rww.js","assets/useGetUserRecords-C-fgbSkZ.js","assets/hover-card-DvDR9bGa.js"])))=>i.map(i=>d[i]);
var ae=Object.defineProperty;var A=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var T=(a,n,s)=>n in a?ae(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,_=(a,n)=>{for(var s in n||(n={}))ne.call(n,s)&&T(a,s,n[s]);if(A)for(var s of A(n))re.call(n,s)&&T(a,s,n[s]);return a};import{r as d,aw as te,j as e,S as v,b as ce,m as le,be as oe,ax as j,a4 as U,i as u,aS as R,U as ie,E as y,v as de,bl as $,a6 as L,a8 as W,o as w,bi as xe,aa as H,M as I,au as P,av as V,d as S,ab as ue,ce as je,bd as Y,V as me,l as he,ay as fe,_ as B,aI as ge,a7 as Me,cF as _e,bF as pe,O as N,bg as D,a3 as m,ak as ve,al as we,n as Ce,bk as be,an as Ne,ah as G,ao as k,cG as X,br as ye,cH as Se,ac as z}from"./index-3Ycoded3.js";import{X as q}from"./index-BLAThYMl.js";import{b as J,d as K,P as C,f as g,m as Q,T as M}from"./table-DrC99LcT.js";import{T as ke}from"./TableLoader-BVWP7Tbp.js";import{u as ze}from"./useGetUserRecords-C-fgbSkZ.js";import{p as E,s as F,C as O}from"./hover-card-DvDR9bGa.js";const Ae=({currentMembers:a,onChange:n})=>{const{users:s}=d.useContext(te),[r,t]=d.useState(""),c=(l,i,b)=>{const p=a.filter(f=>f.user!==l);p.push({user:l,is_admin:b&&i?1:0,is_member:i?1:0}),n(p)},o=d.useMemo(()=>s.filter(l=>l.full_name.toLowerCase().includes(r.toLowerCase())),[s,r]),h=a.reduce((l,i)=>(l[i.user]={is_admin:!!i.is_admin,is_member:!!i.is_member},l),{});return e.jsxs(v,{children:[e.jsx(Te,{onSearch:t}),e.jsx(v,{className:"max-h-[600px] overflow-y-auto transition-height duration-300",children:e.jsx(q,{style:{height:"540px"},data:o,components:{Table:l=>e.jsx(Q,_({size:"1"},l)),TableHead:K,TableBody:J,TableRow:l=>e.jsx(C,_({className:"hover:bg-gray-2"},l))},fixedHeaderContent:()=>e.jsxs(C,{children:[e.jsx(g,{className:"w-[50%]",children:"User"}),e.jsx(g,{className:"w-[25%]",children:"Member"}),e.jsx(g,{className:"w-[25%]",children:"Admin"})]}),itemContent:(l,i)=>e.jsx(Re,{member:i,membership:h[i.name],onMemberChange:c},i.name)})})]})},Te=({onSearch:a})=>{const[n,s]=d.useState("");return d.useEffect(()=>{const r=setTimeout(()=>{a(n)},250);return()=>clearTimeout(r)},[n]),e.jsx(ce,{placeholder:"Search",value:n,onChange:r=>s(r.target.value),children:e.jsx(le,{children:e.jsx(oe,{})})})},Re=({member:a,onMemberChange:n,membership:s})=>{var r,t;return e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-[50%]",onClick:()=>n(a.name,!(s!=null&&s.is_member),s==null?void 0:s.is_admin),children:e.jsx(j,{justify:"between",children:e.jsxs(j,{align:"center",children:[e.jsx(U,{size:"2",loading:"eager",src:a.user_image,alt:(r=a.full_name)!=null?r:a.name}),e.jsx(u,{as:"span",weight:"medium",children:(t=a.full_name)!=null?t:a.name})]})})}),e.jsx(M,{className:"w-[25%]",children:e.jsx("div",{className:"flex h-full justify-start items-center px-2",children:e.jsx(R,{name:`member-${a.name}`,checked:s==null?void 0:s.is_member,onCheckedChange:c=>n(a.name,!!c,s==null?void 0:s.is_admin)})})}),e.jsx(M,{className:"w-[25%]",children:e.jsx("div",{className:"flex h-full justify-start items-center px-2",children:e.jsx(R,{checked:s==null?void 0:s.is_admin,disabled:!(s!=null&&s.is_member),onCheckedChange:c=>n(a.name,s==null?void 0:s.is_member,!!c)})})})]})},Be=d.lazy(()=>ge(()=>import("./AddWorkspaceMemberModalContent-BigFH0g1.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),Z=a=>de("raven.api.workspaces.fetch_workspace_members",{workspace:a},["workspace_members",a],{revalidateOnFocus:!1,errorRetryCount:2}),Ke=({workspaceID:a})=>{const{data:n,isLoading:s,error:r}=Z(a),{currentUser:t}=d.useContext(ie),c=d.useMemo(()=>{var o;return(o=n==null?void 0:n.message.some(h=>h.user===t&&h.is_admin))!=null?o:!1},[n,t]);return e.jsxs(v,{children:[e.jsxs(j,{justify:"end",children:[e.jsx(Le,{workspaceID:a}),e.jsx(Ie,{workspaceID:a})]}),s&&!r&&e.jsx(ke,{columns:2}),e.jsx(y,{error:r}),n&&e.jsx(De,{members:n.message,isAdmin:c,workspaceID:a})]})},De=({members:a,isAdmin:n,workspaceID:s})=>{const r=ze();return e.jsx(q,{useWindowScroll:!0,data:a,components:{Table:t=>e.jsx(Q,_({variant:"surface",className:"rounded-sm"},t)),TableHead:K,TableBody:J,TableRow:t=>e.jsx(C,_({className:"group hover:bg-gray-2 dark:hover:bg-gray-3 [&:has([data-state='open'])]:bg-gray-2 dark:[&:has([data-state='open'])]:bg-gray-3"},t))},fixedHeaderContent:()=>e.jsxs(C,{children:[e.jsx(g,{children:"Name"}),e.jsx(g,{children:"Joined"}),n?e.jsx(g,{}):null]}),itemContent:(t,c)=>e.jsx(Ee,{users:r,member:c,isAdmin:n,workspaceID:s})})},Ee=({users:a,member:n,isAdmin:s,workspaceID:r})=>{var c,o;const t=a[n.user];return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsxs(j,{align:"center",children:[e.jsx(U,{src:t==null?void 0:t.user_image,alt:(c=t==null?void 0:t.full_name)!=null?c:n.user,size:"2"}),e.jsx(u,{as:"span",children:(o=t==null?void 0:t.full_name)!=null?o:n.user}),n.is_admin?e.jsx(Me,{content:"Admin",children:e.jsx(u,{as:"span",className:"h-full flex items-center",children:e.jsx(_e,{fontSize:18,color:"#FFC53D"})})}):null]})}),e.jsx(M,{children:e.jsx(u,{as:"span",className:"flex items-center h-full",children:pe(n.creation).format("Do MMMM YYYY")})}),s?e.jsx(M,{align:"center",children:e.jsx(Fe,{member:n,workspaceID:r})}):null]})},Fe=({member:a,workspaceID:n})=>{const{mutate:s}=Y(),r=()=>{s(["workspace_members",n])};return e.jsx("div",{className:"flex items-center gap-2 justify-center h-full",children:e.jsxs(ve,{children:[e.jsx(we,{children:e.jsx(Ce,{variant:"ghost",color:"gray",size:"3",children:e.jsx(be,{fontSize:16})})}),e.jsxs(Ne,{className:"min-w-36",children:[a.is_admin?e.jsx($e,{memberID:a.name,onUpdate:r}):e.jsx(Ue,{memberID:a.name,onUpdate:r}),e.jsx(Oe,{memberID:a.name,onUpdate:r})]})]})})},Oe=({memberID:a,onUpdate:n})=>{const{deleteDoc:s}=ye(),r=()=>{s("Raven Workspace Member",a).then(()=>{n(),m.success("Member removed")}).catch(t=>{m.error("Failed to remove member",{description:z(t),duration:4e3})})};return e.jsxs(k,{onClick:r,color:"red",children:[e.jsx(Se,{fontSize:16}),"Remove Member"]})},Ue=({memberID:a,onUpdate:n})=>{const{updateDoc:s}=G(),r=()=>{s("Raven Workspace Member",a,{is_admin:!0}).then(()=>{n(),m.success("Success")}).catch(t=>{m.error("Failed to make add admin",{description:z(t),duration:4e3})})};return e.jsxs(k,{onClick:r,children:[e.jsx(X,{fontSize:16}),"Make Admin"]})},$e=({memberID:a,onUpdate:n})=>{const{updateDoc:s}=G(),r=()=>{s("Raven Workspace Member",a,{is_admin:!1}).then(()=>{n(),m.success("Success")}).catch(t=>{m.error("Failed to remove admin",{description:z(t),duration:4e3})})};return e.jsxs(k,{onClick:r,children:[e.jsx(X,{fontSize:16}),"Remove Admin"]})},Le=({workspaceID:a})=>{const[n,{off:s},r]=$(),{data:t,isLoading:c,error:o}=Z(a);return e.jsxs(L,{open:n,onOpenChange:r,children:[e.jsx(W,{children:e.jsxs(w,{className:"not-cal",color:"gray",size:"2",variant:"soft",type:"button",children:[e.jsx(xe,{fontSize:16})," Manage Members"]})}),e.jsxs(H,{className:I(ue,"w-full max-w-2xl"),children:[e.jsx(P,{children:"Manage Members"}),e.jsx(V,{children:"Add or remove members from your workspace."}),c&&e.jsx(S,{}),e.jsx(y,{error:o}),t&&e.jsx(We,{workspaceID:a,onClose:s,members:t.message})]})]})},We=({workspaceID:a,onClose:n,members:s})=>{const[r,t]=d.useState(s.map(x=>({user:x.user,is_admin:x!=null&&x.is_admin?1:0,is_member:1}))),[c,o]=d.useState(!1),h=x=>{o(!0),t(x)},{mutate:l}=Y(),[i,b]=d.useState([]),{call:p,loading:f,error:ee}=me("raven.api.workspaces.update_workspace_members"),se=()=>{p({workspace:a,members:r}).then(x=>{m.success("Members updated"),l(["workspace_members",a]),x.errors?b(x.errors):n()})};return e.jsxs(v,{className:"pt-4",children:[e.jsx(y,{error:ee}),i.length>0&&e.jsx(he,{children:i.map(x=>e.jsx(u,{children:x},x))}),e.jsx(Ae,{currentMembers:r,onChange:h}),e.jsxs(j,{justify:"between",pt:"4",className:"h-full",children:[e.jsx(He,{members:r}),e.jsxs(j,{children:[e.jsx(fe,{children:e.jsx(w,{size:"2",variant:"soft",type:"button",color:"gray",disabled:f,children:"Cancel"})}),e.jsxs(w,{size:"2",type:"button",onClick:se,disabled:!c||f,children:[f?e.jsx(S,{className:"text-white"}):null,f?B("Saving"):B("Save")]})]})]})]})},He=({members:a})=>{const{admins:n,memberIDs:s}=d.useMemo(()=>{const r=a.filter(c=>c.is_member).sort((c,o)=>c.user.localeCompare(o.user));return{admins:r.filter(c=>c.is_admin),memberIDs:r}},[a]);return e.jsxs(j,{align:"center",children:[e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(u,{as:"span",size:"2",className:"text-gray-11 h-full flex items-center underline underline-offset-4 decoration-gray-8",children:[s.length," members"]})}),e.jsxs(O,{className:"w-72",children:[e.jsx(u,{size:"2",weight:"medium",children:"Members"}),e.jsx(N,{className:"my-2",size:"4"}),e.jsx(D,{className:"max-h-64 w-full",children:e.jsx("ul",{children:s.map(r=>e.jsx("li",{children:e.jsx(u,{as:"span",size:"2",color:"gray",className:"h-full flex items-center",children:r.user})},r.user))})})]})]}),e.jsx(N,{orientation:"vertical"}),e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(u,{as:"span",size:"2",className:"text-gray-11 h-full flex items-center underline underline-offset-4 decoration-gray-8",children:[n.length," admins"]})}),e.jsxs(O,{className:"w-72",children:[e.jsx(u,{size:"2",weight:"medium",children:"Admins"}),e.jsx(N,{className:"my-2",size:"4"}),e.jsx(D,{className:"max-h-64 w-full",children:e.jsx("ul",{children:n.map(r=>e.jsx("li",{children:e.jsx(u,{as:"span",size:"2",color:"gray",className:"h-full flex items-center",children:r.user})},r.user))})})]})]})]})},Ie=({workspaceID:a})=>{const[n,{off:s},r]=$();return e.jsxs(L,{open:n,onOpenChange:r,children:[e.jsx(W,{children:e.jsxs(w,{size:"2",variant:"soft",type:"button",className:"not-cal",children:[e.jsx(je,{fontSize:16}),"Add Members"]})}),e.jsxs(H,{className:I("w-full static"),children:[e.jsx(P,{children:"Add Members"}),e.jsx(V,{children:"Add members to your workspace."}),e.jsx(d.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(Be,{workspaceID:a,onClose:s})})]})]})};export{Ke as W,Z as u};
