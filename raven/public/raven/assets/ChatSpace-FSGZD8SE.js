const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ViewFilesContent-_Og0En4I.js","assets/index-R8dcyEON.js","assets/index-C_bAo5WJ.css","assets/useDebounce-DCdcqx-R.js","assets/usePagination-Ck6FOBNo.js","assets/TableLoader-CDpXHPyy.js","assets/Skeleton-DFPQynXy.js","assets/table-HDqE5ITd.js","assets/hover-card-B0cTsQeu.js","assets/TypingIndicator-CmuFNghj.js","assets/index-BQr9T4g4.js","assets/useCurrentChannelData-B_RQzLTH.js","assets/useGetUserRecords-DZmPiqFl.js","assets/useRavenSettings-BruiZaC6.js","assets/preferences-D9zjGYzN.js","assets/DoctypeLinkRenderer-H9xZNCg1.js","assets/useDoctypeMeta-BavVHbAP.js","assets/skeleton-CumY7mT4.js","assets/useCurrentChannelData-BsL46_d-.css","assets/EmptyState-DGSqNDea.js","assets/DateSeparator-CKn_TvrF.js","assets/tabs-DQGMkBAG.js","assets/tiptap-CwkfU7Sh.css"])))=>i.map(i=>d[i]);
var gn=Object.defineProperty,pn=Object.defineProperties;var vn=Object.getOwnPropertyDescriptors;var Ue=Object.getOwnPropertySymbols;var js=Object.prototype.hasOwnProperty,ms=Object.prototype.propertyIsEnumerable;var us=(s,n,r)=>n in s?gn(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r,A=(s,n)=>{for(var r in n||(n={}))js.call(n,r)&&us(s,r,n[r]);if(Ue)for(var r of Ue(n))ms.call(n,r)&&us(s,r,n[r]);return s},q=(s,n)=>pn(s,vn(n));var ss=(s,n)=>{var r={};for(var i in s)js.call(s,i)&&n.indexOf(i)<0&&(r[i]=s[i]);if(s!=null&&Ue)for(var i of Ue(s))n.indexOf(i)<0&&ms.call(s,i)&&(r[i]=s[i]);return r};var K=(s,n,r)=>new Promise((i,t)=>{var c=l=>{try{d(r.next(l))}catch(x){t(x)}},o=l=>{try{d(r.throw(l))}catch(x){t(x)}},d=l=>l.done?i(l.value):Promise.resolve(l.value).then(c,o);d((r=r.apply(s,n)).next())});import{j as e,a,S as Bs,i as j,ah as Le,o as b,d as I,a3 as V,aB as Ls,r as h,bd as Ne,dR as Rs,bx as ce,eT as fn,dX as $s,p as k,ej as yn,M as qe,n as ue,dV as bn,L as Ae,ax as Cn,aS as _e,u as Is,P as T,ai as Vs,au as J,E as R,aP as Us,b as Ye,m as je,bo as se,c as Oe,ay as rs,a6 as Y,a8 as Re,bp as gs,aa as Z,ab as U,d_ as E,d$ as ge,e0 as G,aI as _n,d6 as is,v as ke,be as Ze,aD as le,aE as te,aF as ae,c6 as D,c7 as ee,aG as N,dY as be,b8 as ls,a4 as me,eU as Es,bg as Gs,e as qs,dS as wn,cZ as Hs,bm as $e,bl as de,V as Xe,a0 as Be,a1 as Qe,a2 as Ke,ac as Ws,ad as De,ae as ts,ag as es,el as Nn,U as pe,dn as as,O as xe,cG as kn,cF as Js,br as Ys,ak as Zs,al as Xs,cw as Sn,an as Qs,ao as he,cH as Fn,aQ as Ks,eV as ps,eW as vs,eX as He,eG as We,eY as Je,Q as cs,Y as os,eZ as zn,Z as Ds,bY as Mn,bZ as On,aR as An,b_ as Tn,bq as fs,e_ as Pn,G as Bn,bu as ys,aL as Ln,bk as Rn,e$ as $n,c1 as In,d9 as Vn,f0 as Un,dp as En,aM as Gn,av as qn,dM as Hn,f as en,W as sn,x as nn,aC as Wn,a7 as Ee,_ as Fe,e2 as Jn,eS as Yn,aA as ze,eN as Zn,dC as Xn,F as Qn,X as Kn}from"./index-R8dcyEON.js";import{u as Ie,A as bs,a as rn,b as Dn,c as er}from"./EmptyState-DGSqNDea.js";import{u as sr,a as nr,b as rr,F as ir,C as lr,T as tr,c as ar,J as cr,H as Cs,d as Ge}from"./TypingIndicator-CmuFNghj.js";import{R as or,u as ln,g as dr,h as hr}from"./useCurrentChannelData-B_RQzLTH.js";import{P as tn}from"./PageHeader-Cvif8IbT.js";import{u as ds}from"./useDebounce-DCdcqx-R.js";import{u as an}from"./useGetUserRecords-DZmPiqFl.js";import{M as cn}from"./MessageBox-DwF1N2Dn.js";import{m as on,b as dn,P as Te,f as Pe}from"./tabs-DQGMkBAG.js";import{i as ns}from"./switch-IKFuDpkN.js";import{T as xr}from"./preferences-D9zjGYzN.js";import"./index-BQr9T4g4.js";/* empty css                      */import"./DoctypeLinkRenderer-H9xZNCg1.js";import"./useDoctypeMeta-BavVHbAP.js";import"./skeleton-CumY7mT4.js";import"./DateSeparator-CKn_TvrF.js";import"./useRavenSettings-BruiZaC6.js";import"./hover-card-B0cTsQeu.js";const ur=({channelID:s,isArchived:n,isMemberAdmin:r})=>n===1?e.jsx(jr,{channelID:s,isMemberAdmin:r}):null,jr=({channelID:s,isMemberAdmin:n})=>e.jsx(a,{direction:"column",align:"center",className:"border border-gray-6 rounded-md bg-surface animate-fadein sm:mb-0 mb-2",p:"4",children:e.jsxs(Bs,{justify:"center",align:"center",children:[e.jsx(j,{as:"span",color:"gray",children:"This channel has been archived."}),n===1?e.jsx(mr,{channelID:s}):null]})}),mr=({channelID:s})=>{const{updateDoc:n,loading:r}=Le(),i=()=>K(null,null,function*(){return n("Raven Channel",s,{is_archived:0}).then(()=>{V.success("Channel restored.")}).catch(t=>{V.error(t.message)})});return e.jsxs(b,{size:"2",disabled:r,color:"gray",variant:"soft",className:"not-cal",onClick:i,children:[r&&e.jsx(I,{}),"Restore Channel"]})},hn=({channelData:s})=>{const{name:n}=Ls(),{channelMembers:r,isLoading:i}=Ie(s.name),t=h.useMemo(()=>{var y;if(s.is_direct_message===1&&"peer_user_id"in s){const M=s.peer_user_id;return((y=r==null?void 0:r[M])==null?void 0:y.type)==="Bot"}return!1},[s,r]),{onUserType:c,stopTyping:o}=sr(s.name),[d,l]=h.useState(null),x=y=>{l(y)},m=()=>{l(null)},{mutate:u}=Ne(),v=h.useRef(null),w=y=>{u({path:`get_messages_for_channel_${s.name}`},M=>{var hs,xs;if(M&&(M!=null&&M.message.has_new_messages))return M;const ie=(hs=M==null?void 0:M.message.messages)!=null?hs:[],ye=[...ie];return y.forEach(Se=>{const Ve=ie.findIndex(mn=>mn.name===Se.name);Ve!==-1?ye[Ve]=q(A({},Se),{_liked_by:"",is_pinned:0,is_continuation:0}):ye.push(q(A({},Se),{_liked_by:"",is_pinned:0,is_continuation:0}))}),{message:{messages:ye.sort((Se,Ve)=>new Date(Ve.creation).getTime()-new Date(Se.creation).getTime()),has_new_messages:!1,has_old_messages:(xs=M==null?void 0:M.message.has_old_messages)!=null?xs:!1}}},{revalidate:!1}).then(()=>{var M,ie;(ie=v.current)==null||ie.scrollTo(0,(M=v.current)==null?void 0:M.scrollHeight)}),o(),m()},f=h.useMemo(()=>{var y;return n&&r&&(y=r[n])!=null?y:null},[n,r]),z=h.useRef(null),C=h.useCallback(()=>{var y;(y=z.current)==null||y.onUpArrow()},[]),S=h.useRef(null),O=Rs(),P=h.useCallback(()=>{O||setTimeout(()=>{var y;(y=S.current)==null||y.focusEditor()},50)},[O]),{fileInputRef:X,files:F,setFiles:ne,removeFile:_,uploadFiles:re,addFile:ve,fileUploadProgress:B,compressImages:fe,setCompressImages:g}=nr(s.name),{sendMessage:H,loading:Q}=rr(s.name,re,w,d),oe=({selectedMessage:y})=>y?e.jsx(or,{justify:"between",align:"center",className:"m-2",message:y,children:e.jsx(ue,{color:"gray",size:"1",variant:"soft",onClick:m,children:e.jsx(bn,{size:"20"})})}):null,{canUserSendMessage:p,shouldShowJoinBox:$}=h.useMemo(()=>{if(s.is_archived)return{canUserSendMessage:!1,shouldShowJoinBox:!1};if(s.type==="Open")return{canUserSendMessage:!0,shouldShowJoinBox:!1};if(f)return{canUserSendMessage:!0,shouldShowJoinBox:!1};const y=(s==null?void 0:s.is_direct_message)===1||(s==null?void 0:s.is_self_message)===1;return!f&&!y&&s&&!i?{shouldShowJoinBox:!0,canUserSendMessage:!1}:{canUserSendMessage:!1,shouldShowJoinBox:!1}},[f,s,i]),{threadID:L}=ce(),W=h.useCallback(y=>fn($s(y.name))==="image",[F]);return e.jsx(pr,{children:e.jsxs(ir,{files:F,ref:X,onFileChange:ne,width:L?"w-[calc((100vw-var(--sidebar-width)-var(--space-8))/2)]":void 0,maxFiles:10,maxFileSize:1e7,children:[e.jsx(lr,{channelID:s.name,scrollRef:v,ref:z,onModalClose:P,pinnedMessagesString:s.pinned_messages_string,replyToMessage:x,isBot:t}),p&&e.jsxs(Bs,{children:[e.jsx(tr,{channel:s.name}),e.jsx(ar,{channelID:s.name,fileProps:{fileInputRef:X,addFile:ve},ref:S,onUpArrow:C,clearReplyMessage:m,channelMembers:r,onUserType:c,replyMessage:d,sessionStorageKey:`tiptap-${s.name}`,onMessageSend:H,messageSending:Q,slotBefore:e.jsxs(a,{direction:"column",justify:"center",hidden:!d&&!F.length,children:[d&&e.jsx(oe,{selectedMessage:d}),F&&F.length>0&&e.jsx(a,{gap:"2",width:"100%",align:"stretch",px:"2",p:"2",wrap:"wrap",children:F.map(y=>e.jsx(k,{className:"grow-0",children:e.jsx(yn,{file:y,uploadProgress:B,removeFile:()=>_(y.fileID)})},y.fileID))}),F.length!==0&&F.some(y=>W(y))&&e.jsx(gr,{compressImages:fe,setCompressImages:g})]})},s.name)]}),$?e.jsx(cr,{channelData:s,user:n}):null,e.jsx(ur,{channelID:s.name,isArchived:s.is_archived,isMemberAdmin:f==null?void 0:f.is_admin})]})})},gr=({compressImages:s,setCompressImages:n})=>e.jsx("div",{className:"px-3",children:e.jsx(Ae,{size:"2",weight:"regular",children:e.jsxs(Cn,{align:"center",gap:"2",children:[e.jsx(_e,{checked:s,onCheckedChange:()=>{n(!s)}}),"Compress Images"]})})}),pr=({children:s})=>{const{threadID:n}=ce();return e.jsx("div",{className:qe("flex flex-col overflow-hidden px-2 pt-16 justify-end h-full",n?"sm:pl-4":"sm:px-4"),children:s})},_s=({channelID:s,channelName:n,type:r,onClose:i})=>{var z;const t=Is({defaultValues:{channel_name:n}}),{control:c,handleSubmit:o,setValue:d,formState:{errors:l}}=t,{updateDoc:x,loading:m,error:u}=Le(),v=C=>K(null,null,function*(){return x("Raven Channel",s!=null?s:null,{channel_name:C.channel_name}).then(()=>{V.success("Channel name updated"),i()})}),w=h.useCallback(C=>{var S;d("channel_name",(S=C.target.value)==null?void 0:S.toLowerCase().replace(" ","-"))},[d]),f=T();return e.jsx(Vs,q(A({},t),{children:e.jsxs("form",{onSubmit:o(v),children:[e.jsx(J,{children:"Rename this channel"}),e.jsxs(a,{gap:"2",direction:"column",width:"100%",children:[e.jsx(R,{error:u}),e.jsxs(k,{width:"100%",children:[e.jsx(Ae,{htmlFor:"channel_name",isRequired:!0,children:"Name"}),e.jsx(Us,{name:"channel_name",control:c,rules:{required:"Please add a channel name",maxLength:{value:50,message:"Channel name cannot be more than 50 characters."},minLength:{value:3,message:"Channel name cannot be less than 3 characters."},pattern:{value:/^[a-zA-Z0-9][a-zA-Z0-9-]*$/,message:"Channel name can only contain letters, numbers and hyphens."}},render:({field:C,fieldState:{error:S}})=>e.jsxs(Ye,q(A({maxLength:50,required:!0,autoFocus:f,placeholder:"e.g. wedding-gone-wrong, joffrey-tributes",color:S?"red":void 0},C),{"aria-invalid":S?"true":"false",onChange:w,children:[e.jsx(je,{side:"left",children:e.jsx(se,{type:r})}),e.jsx(je,{side:"right",children:e.jsx(j,{size:"2",weight:"light",color:"gray",children:50-C.value.length})})]}))}),(l==null?void 0:l.channel_name)&&e.jsx(Oe,{children:(z=l.channel_name)==null?void 0:z.message})]})]}),e.jsxs(a,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(rs,{disabled:m,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{type:"submit",disabled:m,children:[m&&e.jsx(I,{className:"text-white"}),m?"Saving":"Save"]})]})]})}))},xn=c=>{var o=c,{channelID:s,channel_name:n,channelType:r,buttonVisible:i=!1}=o,t=ss(o,["channelID","channel_name","channelType","buttonVisible"]);const[d,l]=h.useState(!1),x=()=>{l(!1)};return T()?e.jsxs(Y,{open:d,onOpenChange:l,children:[e.jsx(Re,{children:e.jsx(ue,q(A({variant:"ghost",color:"gray",className:qe(i?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},t),{children:e.jsx(gs,{size:"14"})}))}),e.jsx(Z,{className:U,children:e.jsx(_s,{channelID:s,channelName:n,onClose:x,type:r})})]}):e.jsxs(E,{open:d,onOpenChange:l,children:[e.jsx(ge,{asChild:!0,children:e.jsx(ue,q(A({variant:"ghost",color:"gray",className:qe(i?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},t),{children:e.jsx(gs,{size:"14"})}))}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(_s,{channelID:s,channelName:n,onClose:x,type:r})})})]})},ws=h.lazy(()=>_n(()=>import("./ViewFilesContent-_Og0En4I.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),vr=({open:s,setOpen:n})=>T()?e.jsx(Y,{open:s,onOpenChange:n,children:e.jsx(Z,{className:`${U} min-w-[64rem]`,children:e.jsx(h.Suspense,{fallback:e.jsx(a,{align:"center",justify:"center",className:"h-64",children:e.jsx(I,{})}),children:e.jsx(ws,{})})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(G,{children:e.jsx(h.Suspense,{fallback:e.jsx(a,{align:"center",justify:"center",className:"h-[80vh]",children:e.jsx(I,{})}),children:e.jsx(ws,{})})})}),fr=({open:s,setOpen:n})=>{const r=h.useCallback(()=>{n(!1)},[n]);return T()?e.jsx(Y,{open:s,onOpenChange:n,children:e.jsx(Z,{className:"static",children:e.jsx(bs,{onClose:r})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-96 px-1 overflow-auto",children:e.jsx(bs,{onClose:r})})})})},yr=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:r,isSaved:i,input:t,fromFilter:c,withFilter:o,inFilter:d})=>{var B,fe;const[l,x]=h.useState(t),m=ds(l),{channels:u,dm_channels:v}=h.useContext(is),[w,f]=h.useState(c),[z,C]=h.useState(d||((B=v.find(g=>g.peer_user_id==o))==null?void 0:B.name)),[S,O]=h.useState(),[P,X]=h.useState(),F=an(),ne=g=>{x(g.target.value)},{data:_,error:re,isLoading:ve}=ke("raven.api.search.get_search_result",{filter_type:"File",search_text:m,from_user:w==="any"?void 0:w,in_channel:z==="any"?void 0:z,saved:i,date:S,file_type:P==="any"?void 0:P,message_type:P==="any"||P===void 0?void 0:P==="image"?"Image":"File",my_channel_only:n},void 0,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(a,{direction:"column",gap:"2",children:[e.jsxs(a,{align:"center",gap:"2",children:[e.jsxs(Ye,{style:{width:"80%"},onChange:ne,type:"text",placeholder:"Search messages",value:l,autoFocus:!0,children:[e.jsx(je,{side:"left",children:e.jsx(Ze,{})}),e.jsx(je,{side:"right",children:ve&&e.jsx(I,{})})]}),e.jsxs(le,{value:P,onValueChange:X,children:[e.jsx(te,{placeholder:"File Type",className:"min-w-[20%]"}),e.jsx(ae,{className:"z-50",children:e.jsxs(D,{children:[e.jsx(ee,{children:"File Type"}),e.jsx(N,{value:"any",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(k,{width:"16px",children:"ðŸ¤·ðŸ»â€â™€ï¸"}),"Any"]})}),e.jsx(N,{value:"pdf",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(be,{ext:"pdf"}),"PDF"]})}),e.jsx(N,{value:"doc",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(be,{ext:"doc"}),"Documents (.doc)"]})}),e.jsx(N,{value:"ppt",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(be,{ext:"ppt"}),"Presentations (.ppt)"]})}),e.jsx(N,{value:"xls",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(be,{ext:"xls"}),"Spreadsheets (.xls)"]})}),e.jsx(N,{value:"image",children:e.jsxs(a,{align:"center",gap:"1",children:[e.jsx(be,{ext:"jpg"}),"Images"]})})]})})]})]}),e.jsxs(ls,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(le,{value:w,onValueChange:f,children:[e.jsx(te,{placeholder:"From",id:"from-filter"}),e.jsxs(ae,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(D,{children:[e.jsx(ee,{children:"Message from"}),Object.values(F).map(g=>e.jsx(N,{textValue:g.full_name,value:g.name,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(me,{src:g.user_image,alt:g.full_name}),e.jsx(j,{children:g.full_name})]})},g.name))]})]})]}),e.jsxs(le,{value:z,onValueChange:C,children:[e.jsx(te,{placeholder:"Channel / DM"}),e.jsxs(ae,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(D,{children:[e.jsx(ee,{children:"Channels"}),u.map(g=>e.jsx(N,{value:g.name,children:e.jsxs(a,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(se,{type:g.type}),e.jsx(j,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:g.channel_name})]})},g.name))]}),e.jsx(Es,{}),e.jsxs(D,{children:[e.jsx(ee,{children:"Direct Messages"}),v.map(g=>{var H,Q,oe,p,$,L,W;return e.jsx(N,{value:g.name,textValue:(Q=(H=F[g.peer_user_id])==null?void 0:H.full_name)!=null?Q:g.peer_user_id,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(me,{src:(oe=F[g.peer_user_id])==null?void 0:oe.user_image,alt:($=(p=F[g.peer_user_id])==null?void 0:p.full_name)!=null?$:g.peer_user_id}),e.jsx(j,{children:(W=(L=F[g.peer_user_id])==null?void 0:L.full_name)!=null?W:g.peer_user_id})]})},g.name)})]})]})]}),e.jsxs(le,{value:S,onValueChange:O,children:[e.jsx(te,{placeholder:"Date"}),e.jsx(ae,{className:"z-50",children:e.jsxs(D,{children:[e.jsx(ee,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),un.map(g=>e.jsx(N,{value:g.value,children:g.label},g.value))]})})]}),e.jsx(j,{as:"label",size:"2",children:e.jsxs(a,{gap:"2",children:[e.jsx(_e,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(j,{as:"label",size:"2",children:e.jsxs(a,{gap:"2",children:[e.jsx(_e,{checked:i,onCheckedChange:r})," Saved"]})})]})]}),e.jsxs(Gs,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx(R,{error:re}),((fe=_==null?void 0:_.message)==null?void 0:fe.length)===0&&e.jsx(rn,{}),_!=null&&_.message&&_.message.length>0?e.jsx(a,{direction:"column",gap:"4",children:_.message.map(g=>{var H;return e.jsxs(a,{gap:"3",align:"center",children:[e.jsxs(a,{align:"center",justify:"center",className:"w-[10%] sm:w-[5%]",children:[g.message_type==="File"&&e.jsx(be,{ext:$s(g.file),size:"24"}),g.message_type==="Image"&&e.jsx("img",{src:g.file,alt:"File preview",className:"rounded-md object-cover",style:{width:"36px",height:"36px"}})]}),e.jsxs(a,{direction:"column",className:"w-[94%]",children:[g.file&&e.jsx(qs,{weight:"medium",size:"1",href:g.file,target:"_blank",children:wn(g.file)}),F&&e.jsxs(j,{size:"1",color:"gray",children:["Shared by ",(H=Object.values(F).find(Q=>Q.name===g.owner))==null?void 0:H.full_name," on ",e.jsx(Hs,{date:g.creation})]})]})]},g.name)})}):null]})]})},br=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:r,isSaved:i,input:t,fromFilter:c,inFilter:o,withFilter:d,onClose:l})=>{var H,Q,oe;const[x,m]=h.useState(t),u=ds(x),{channels:v,dm_channels:w}=h.useContext(is),[f,z]=h.useState(c),[C,S]=h.useState(o||((H=w.find(p=>p.peer_user_id==d))==null?void 0:H.name)),[O,P]=h.useState(),X=$e(),F=(p,$,L)=>{l();let W=`/channel/${p}`;L&&(W=`/${L}/${p}`),X({pathname:W,search:`message_id=${$}`})},ne=(p,$,L)=>K(null,null,function*(){F($,p,L)}),_=an(),re=p=>{m(p.target.value)},ve=h.useMemo(()=>{const p=C!==void 0,$=f!=="any"&&f!==void 0,L=O!=="any"&&O!==void 0;return u.length>2||p||$||L||n===!0},[u,C,f,n,O]),{data:B,error:fe,isLoading:g}=ke("raven.api.search.get_search_result",{filter_type:"Message",search_text:u,from_user:f==="any"?void 0:f,in_channel:C==="any"?void 0:C,saved:i,date:O==="any"?void 0:O,my_channel_only:n},ve?void 0:null,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(a,{direction:"column",gap:"2",children:[e.jsxs(Ye,{onChange:re,type:"text",placeholder:"Search messages",value:x,autoFocus:!0,children:[e.jsx(je,{side:"left",children:e.jsx(Ze,{})}),e.jsx(je,{side:"right",children:g&&e.jsx(I,{})})]}),e.jsxs(ls,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(le,{value:f,onValueChange:z,children:[e.jsx(te,{placeholder:"From",id:"from-filter"}),e.jsxs(ae,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(D,{children:[e.jsx(ee,{children:"Message from"}),Object.values(_).map(p=>e.jsx(N,{textValue:p.full_name,value:p.name,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(me,{src:p.user_image,alt:p.full_name}),e.jsx(j,{children:p.full_name})]})},p.name))]})]})]}),e.jsxs(le,{value:C,onValueChange:S,children:[e.jsx(te,{placeholder:"Channel / DM"}),e.jsxs(ae,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(D,{children:[e.jsx(ee,{children:"Channels"}),v.map(p=>e.jsx(N,{value:p.name,children:e.jsxs(a,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(se,{type:p.type}),e.jsx(j,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:p.channel_name})]})},p.name))]}),e.jsx(Es,{}),e.jsxs(D,{children:[e.jsx(ee,{children:"Direct Messages"}),w.map(p=>{var $,L,W,y,M,ie,ye;return e.jsx(N,{value:p.name,textValue:(L=($=_[p.peer_user_id])==null?void 0:$.full_name)!=null?L:p.peer_user_id,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(me,{src:(W=_[p.peer_user_id])==null?void 0:W.user_image,alt:(M=(y=_[p.peer_user_id])==null?void 0:y.full_name)!=null?M:p.peer_user_id}),e.jsx(j,{children:(ye=(ie=_[p.peer_user_id])==null?void 0:ie.full_name)!=null?ye:p.peer_user_id})]})},p.name)})]})]})]}),e.jsxs(le,{value:O,onValueChange:P,children:[e.jsx(te,{placeholder:"Date"}),e.jsx(ae,{className:"z-50",children:e.jsxs(D,{children:[e.jsx(ee,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),un.map(p=>e.jsx(N,{value:p.value,children:p.label},p.value))]})})]}),e.jsx(j,{as:"label",size:"2",children:e.jsxs(a,{gap:"2",children:[e.jsx(_e,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(j,{as:"label",size:"2",children:e.jsxs(a,{gap:"2",children:[e.jsx(_e,{checked:i,onCheckedChange:r})," Saved"]})})]})]}),e.jsxs(Gs,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx(R,{error:fe}),((Q=B==null?void 0:B.message)==null?void 0:Q.length)===0&&e.jsx(rn,{}),(oe=B==null?void 0:B.message)!=null&&oe.length&&(B==null?void 0:B.message.length)>0?e.jsx(a,{direction:"column",gap:"2",children:B.message.map(p=>e.jsx(cn,{message:q(A({},p),{message_type:"Text",is_continuation:0,is_reply:0,_liked_by:"[]"}),handleScrollToMessage:ne},p.name))}):!ve&&e.jsx(k,{className:"text-center",py:"8",children:e.jsx(j,{size:"2",className:"text-gray-11",children:"Add a search query above to see results."})})]})]})};function Cr(s){const{isOpen:n,onClose:r}=s,i=c=>{c||r()};return T()?e.jsx(Y,{open:n,onOpenChange:i,children:e.jsx(Z,{className:U,style:{width:"80vw",maxWidth:"80vw"},children:e.jsx(Ns,A({},s))})}):e.jsx(E,{open:n,onClose:r,children:e.jsx(G,{children:e.jsx("div",{className:"h-[75vh] pb-24 overflow-y-scroll",children:e.jsx(Ns,A({},s))})})})}const Ns=s=>{const[n,{toggle:r}]=de(),[i,{toggle:t}]=de(),{tabIndex:c,input:o,fromFilter:d,withFilter:l,inFilter:x,onClose:m}=s;return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Search Results"}),e.jsx(a,{direction:"column",gap:"2",children:e.jsxs(on,{defaultValue:c.toString(),children:[e.jsxs(dn,{children:[e.jsx(Te,{value:"0",children:"Messages"}),e.jsx(Te,{value:"1",children:"Files"})]}),e.jsxs(k,{pt:"3",pb:"2",children:[e.jsx(Pe,{value:"0",children:e.jsx(br,{onToggleMyChannels:r,isOnlyInMyChannels:n,onToggleSaved:t,isSaved:i,input:o,fromFilter:d,inFilter:x,withFilter:l,onClose:m})}),e.jsx(Pe,{value:"1",children:e.jsx(yr,{onToggleMyChannels:r,isOnlyInMyChannels:n,onToggleSaved:t,isSaved:i,input:o,fromFilter:d,inFilter:x,withFilter:l})})]})]})})]})},un=[{label:"Today",value:Ce(0)},{label:"Yesterday",value:Ce(-1)},{label:"Last 7 days",value:Ce(-6)},{label:"Last 30 days",value:Ce(-29)},{label:"Last three months",value:Ce(-89)},{label:"Last 12 months",value:Ce(-364)}];function Ce(s){const n=new Date;n.setDate(n.getDate()+s);const r=n.getFullYear(),i=(n.getMonth()+1).toString().padStart(2,"0"),t=n.getDate().toString().padStart(2,"0");return`${r}-${i}-${t} 00:00:00`}const ks=({onClose:s,channelData:n,isDrawer:r,closeDetailsModal:i})=>{const{call:t,loading:c,error:o}=Xe("raven.api.raven_channel.leave_channel"),d=$e(),{mutate:l}=h.useContext(is),x=()=>K(null,null,function*(){return t({channel_id:n==null?void 0:n.name}).then(()=>{V("You have left the channel"),s(),l(),d("../"),i()}).catch(w=>{V.error("Could not leave channel",{description:Ws(w)})})}),m=r?J:Be,u=r?h.Fragment:Qe,v=r?h.Fragment:Ke;return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsxs(a,{gap:"1",children:[e.jsx(j,{children:"Leave "}),e.jsx(se,{type:n==null?void 0:n.type,className:"mt-1"}),e.jsxs(j,{children:[n==null?void 0:n.channel_name,"?"]})]})}),e.jsxs(a,{direction:"column",gap:"2",children:[e.jsx(R,{error:o}),(n==null?void 0:n.type)==="Private"?e.jsx(j,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to see any of its messages. To rejoin, youâ€™ll need to be invited."}):e.jsx(j,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to send anymore messages, you will have to rejoin the channel to continue participation."})]}),e.jsxs(a,{gap:"3",mt:"4",justify:"end",children:[e.jsx(u,{children:e.jsx(b,{variant:"soft",color:"gray",onClick:s,children:"Cancel"})}),e.jsx(v,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:x,disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Leaving":"Leave"]})})]})]})},_r=({channelData:s,onClose:n})=>{const[r,i]=h.useState(!1),t=()=>{i(!1)};return T()?e.jsxs(De,{open:r,onOpenChange:i,children:[e.jsx(ts,{children:e.jsx(b,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(es,{className:U,children:e.jsx(ks,{onClose:t,closeDetailsModal:n,channelData:s})})]}):e.jsxs(E,{open:r,onOpenChange:i,children:[e.jsx(ge,{asChild:!0,children:e.jsx(b,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(ks,{onClose:t,isDrawer:!0,closeDetailsModal:n,channelData:s})})})]})},wr=({channelID:s,channelMember:n})=>{const{mutate:r}=Ne(),i=Nn(),{call:t}=Xe("raven.api.notification.toggle_push_notification_for_channel"),c=()=>{n&&t({member:n==null?void 0:n.channel_member_name,allow_notifications:n!=null&&n.allow_notifications?0:1}).then(o=>{o&&o.message&&r(["channel_members",s],d=>({message:q(A({},d.message),{[n.name]:q(A({},d.message[n.name]),{allow_notifications:o.message.allow_notifications})})}),{revalidate:!1})}).catch(()=>{V.error("Failed to update notification settings")})};return n?e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(a,{justify:"between",children:[e.jsxs(a,{direction:"column",gap:"1",children:[e.jsx(j,{as:"label",weight:"medium",htmlFor:"channel_push",size:"2",children:"Push Notifications"}),i?null:e.jsx(j,{size:"1",color:"gray",children:"Push notification is not enabled for the site. Please contact your administrator."})]}),e.jsx(a,{gap:"2",children:e.jsx(ns,{size:"2",checked:!!n.allow_notifications,id:"channel_push",onCheckedChange:c,disabled:!i})})]})}):null},Nr=({channelData:s,channelMembers:n,onClose:r})=>{var d;const{currentUser:i}=h.useContext(pe),t=as(s.owner),{channelMember:c,isAdmin:o}=h.useMemo(()=>{const l=n[i];return{channelMember:l,isAdmin:(l==null?void 0:l.is_admin)==1}},[n,i]);return e.jsxs(a,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(a,{justify:"between",children:[e.jsxs(a,{direction:"column",children:[e.jsx(j,{weight:"medium",size:"2",children:"Channel name"}),e.jsxs(a,{gap:"1",pt:"1",align:"center",children:[e.jsx(se,{type:s.type,size:"14"}),e.jsx(j,{size:"2",children:s==null?void 0:s.channel_name})]})]}),e.jsx(xn,{channelID:s.name,channel_name:s.channel_name,className:"",channelType:s.type,disabled:s.is_archived==1&&!o})]})}),e.jsx(wr,{channelID:s.name,channelMember:c}),e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(a,{direction:"column",gap:"4",children:[e.jsxs(a,{justify:"between",children:[e.jsxs(a,{direction:"column",gap:"1",children:[e.jsx(j,{weight:"medium",size:"2",children:"Channel description"}),e.jsx(j,{size:"1",color:"gray",children:s&&s.channel_description&&s.channel_description.length>0?s.channel_description:"No description"})]}),e.jsx(Dn,{channelData:s,is_in_box:!0,disabled:s.is_archived==1&&!o})]}),e.jsx(xe,{className:"w-full"}),e.jsxs(a,{direction:"column",gap:"1",children:[e.jsx(j,{weight:"medium",size:"2",children:"Created by"}),e.jsxs(a,{gap:"1",children:[(s==null?void 0:s.owner)&&e.jsx(j,{size:"1",children:(d=t==null?void 0:t.full_name)!=null?d:s==null?void 0:s.owner}),s.creation&&e.jsxs(j,{size:"1",color:"gray",as:"span",children:["on ",e.jsx(Hs,{date:s==null?void 0:s.creation})]})]})]}),c&&Object.keys(n).length>1&&(s==null?void 0:s.type)!="Open"&&s.is_archived==0&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-full"}),e.jsx(_r,{channelData:s,onClose:r})]})]})})]})},kr=({user:s,channelID:n,updateMembers:r})=>{const{updateDoc:i,loading:t,reset:c}=Le(),{data:o}=ke("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:n,user_id:s.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),d=l=>K(null,null,function*(){var x;return i("Raven Channel Member",(x=o==null?void 0:o.message.name)!=null?x:"",{is_admin:l}).then(()=>{V.success("Member has been made an admin"),r(),c()}).catch(m=>{V.error("Failed to update member status",{description:Ws(m)}),c()})});return s.is_admin?e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>d(0),children:[e.jsx(kn,{}),t?"Updating member status...":"Dismiss admin"]}):e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>d(1),children:[e.jsx(Js,{}),t?"Updating member status...":"Make channel admin"]})},Ss=({onClose:s,member:n})=>{const{deleteDoc:r,error:i,loading:t}=Ys(),{channelID:c}=ce(),{channel:o}=ln(c!=null?c:""),{mutate:d}=Ne(),l=o==null?void 0:o.channelData,{data:x,error:m}=ke("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:c,user_id:n==null?void 0:n.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),u=()=>K(null,null,function*(){return r("Raven Channel Member",x==null?void 0:x.message.name).then(()=>{V.success("Removed"),s(),d(["channel_members",c])})});return T()?e.jsxs(e.Fragment,{children:[e.jsx(Be,{children:e.jsxs(a,{gap:"1",children:[e.jsxs(j,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(l==null?void 0:l.type)&&e.jsx(se,{type:l==null?void 0:l.type,className:"mt-1"}),e.jsxs(j,{children:[l==null?void 0:l.channel_name,"?"]})]})}),e.jsxs(a,{direction:"column",gap:"2",children:[e.jsx(R,{error:m}),e.jsx(R,{error:i}),e.jsx(j,{size:"2",children:"This person will no longer have access to the channel."})]}),e.jsxs(a,{gap:"3",mt:"4",justify:"end",children:[e.jsx(Qe,{children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(Ke,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:u,disabled:t,children:[t&&e.jsx(I,{className:"text-white"}),t?"Removing":"Remove"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(a,{gap:"1",children:[e.jsxs(j,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(l==null?void 0:l.type)&&e.jsx(se,{type:l==null?void 0:l.type,className:"mt-1"}),e.jsxs(j,{children:[l==null?void 0:l.channel_name,"?"]})]})}),e.jsxs(a,{direction:"column",gap:"2",children:[e.jsx(R,{error:m}),e.jsx(R,{error:i}),e.jsx(j,{size:"1",children:"This person will no longer have access to the channel and can only rejoin by invitation."})]}),e.jsxs(a,{gap:"3",mt:"4",justify:"end",children:[e.jsx(b,{variant:"soft",color:"gray",onClick:s,children:"Cancel"}),e.jsxs(b,{variant:"solid",color:"red",onClick:u,disabled:t,children:[t&&e.jsx(I,{className:"text-white"}),t?"Removing":"Remove"]})]})]})},Sr=()=>{const[s,n]=h.useState(null),r=h.useCallback(()=>{n(null)},[]);return{member:s,setRemoveMember:n,isOpen:s!==null,onClose:r}},Fr=({member:s,isOpen:n,onClose:r})=>T()?e.jsx(De,{open:n,onOpenChange:r,children:e.jsx(es,{className:U,children:s&&e.jsx(Ss,{onClose:r,member:s})})}):e.jsx(E,{open:n,children:e.jsx(G,{children:e.jsx("div",{className:"min-h-48",children:s&&e.jsx(Ss,{onClose:r,member:s})})})}),zr=({channelData:s,updateMembers:n,selectedMember:r})=>{const o=Sr(),{setRemoveMember:i}=o,t=ss(o,["setRemoveMember"]),c=()=>{i(r)};return e.jsxs(e.Fragment,{children:[e.jsxs(Zs,{children:[e.jsx(Xs,{children:e.jsx(b,{variant:"ghost",color:"gray",className:"hover:bg-slate-3 cursor-pointer",size:"1",children:e.jsx(Sn,{fontSize:"1rem"})})}),e.jsxs(Qs,{className:"z-50",children:[e.jsx(he,{children:e.jsx(kr,{user:r,channelID:s.name,updateMembers:n})}),e.jsxs(he,{color:"red",onClick:c,className:"flex items-center gap-2",children:[e.jsx(Fn,{}),"Remove from channel"]})]})]}),e.jsx(Fr,A({},t))]})},Mr=({channelData:s,channelMembers:n,activeUsers:r,updateMembers:i})=>{const[t,c]=h.useState(""),o=ds(t,50),d=m=>{c(m.target.value)},{currentUser:l}=h.useContext(pe),x=h.useMemo(()=>!!n[l],[l,n]);return e.jsxs(a,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsxs(a,{gap:"2",justify:"between",children:[e.jsx("div",{className:"w-full sm:w-full",children:e.jsx(Ye,{autoFocus:!0,placeholder:"Find members",onChange:d,value:t,children:e.jsx(je,{side:"left",children:e.jsx(Ze,{})})})}),x&&s.type!=="Open"&&s.is_archived==0&&e.jsx("div",{children:e.jsx(er,{channelData:s,variant:"soft",size:"2"})})]}),e.jsx(Or,{channelData:s,channelMembers:n,activeUsers:r,updateMembers:i,input:o})]})},Or=({channelData:s,channelMembers:n,activeUsers:r,updateMembers:i,input:t})=>{const{currentUser:c}=h.useContext(pe),o=h.useMemo(()=>{const l=Object.values(n);if(!t)return l;const x=t.toLowerCase();return l.filter(m=>{var u;return(u=m==null?void 0:m.full_name)==null?void 0:u.toLowerCase().includes(x)})},[t,n]),d=h.useMemo(()=>!!(n[c]&&(n[c].is_admin==1||Ks())),[c,n]);return e.jsx(k,{className:"overflow-hidden overflow-y-scroll",children:e.jsx(a,{direction:"column",gap:"2",children:o.length>0?e.jsx(a,{direction:"column",children:o.map(l=>{var x,m;return e.jsx(k,{className:"hover:bg-slate-3 rounded-md",children:e.jsxs(a,{justify:"between",className:"pr-3",children:[e.jsxs(a,{className:"p-2",gap:"3",children:[e.jsx(me,{src:(x=l.user_image)!=null?x:"",alt:l.full_name,size:"2",isActive:r.includes(l.name),availabilityStatus:l.availability_status}),e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(j,{size:"2",weight:"medium",children:l.first_name}),r.includes(l.name)?e.jsx(ps,{color:"green"}):e.jsx(ps,{}),e.jsxs(a,{gap:"1",children:[e.jsx(j,{weight:"light",size:"1",children:l.full_name}),l.name===c&&e.jsx(j,{weight:"light",size:"1",children:"(You)"}),((m=n[l.name])==null?void 0:m.is_admin)==1&&e.jsx(a,{align:"center",children:e.jsx(Js,{color:"#FFC53D"})})]})]})]}),n[c]&&d&&(s==null?void 0:s.type)!=="Open"&&s.is_archived==0&&e.jsx(a,{align:"center",children:e.jsx(zr,{channelData:s,updateMembers:i,selectedMember:l})})]})},l.name)})}):e.jsx(k,{className:"text-center h-10",children:e.jsxs(j,{size:"1",children:["No matches found for ",e.jsx("strong",{children:t})]})})})})},Fs=({onClose:s,onCloseViewDetails:n,channelData:r,isDrawer:i})=>{const{updateDoc:t,loading:c,error:o}=Le(),d=$e(),l=()=>{var v;t("Raven Channel",(v=r==null?void 0:r.name)!=null?v:"",{is_archived:1}).then(()=>{s(),n(),d(`/${r.workspace}`),V("Channel archived")})},x=i?J:Be,m=i?h.Fragment:Qe,u=i?h.Fragment:Ke;return e.jsxs(e.Fragment,{children:[i?e.jsx(x,{children:"Archive this channel? "}):e.jsx(Be,{children:"Archive this channel? "}),e.jsxs(a,{direction:"column",gap:"4",children:[e.jsx(R,{error:o}),e.jsxs(j,{size:"2",children:["Please understand that when you archive ",e.jsx("strong",{children:r==null?void 0:r.channel_name}),":"]}),e.jsx(a,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(j,{size:"2",children:"It will be removed from your channel list"})}),e.jsx("li",{children:e.jsx(j,{size:"2",children:"No one will be able to send messages to this channel"})})]})}),e.jsx(j,{size:"2",children:"You will still be able to find the channelâ€™s contents via search. And you can always unarchive the channel in the future, if you want."})]}),e.jsxs(a,{gap:"3",mt:"4",justify:"end",children:[e.jsx(m,{children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(u,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:l,disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Archiving":"Archive"]})})]})]})},Ar=({onClose:s,channelData:n,allowSettingChange:r})=>{const[i,t]=h.useState(!1),c=()=>{t(!1)};return T()?e.jsxs(De,{open:i,onOpenChange:t,children:[e.jsx(ts,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!r,children:[e.jsx(vs,{}),"Archive channel"]})}),e.jsx(es,{className:U,children:e.jsx(Fs,{onClose:c,onCloseViewDetails:s,channelData:n})})]}):e.jsxs(E,{open:i,onOpenChange:t,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!r,children:[e.jsx(vs,{}),"Archive channel"]})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Fs,{onClose:c,isDrawer:!0,onCloseViewDetails:s,channelData:n})})})]})},we=({onClose:s,channelData:n,newChannelType:r})=>{const{mutate:i}=Ne(),{updateDoc:t,loading:c,error:o}=Le(),d=l=>{var x;t("Raven Channel",(x=n==null?void 0:n.name)!=null?x:null,{type:l}).then(()=>{i(["channel_members",n.name]),V.success("Channel changed to "+l.toLocaleLowerCase()),s()})};return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:["Change to a ",r.toLocaleLowerCase()," channel?"]}),e.jsxs(a,{gap:"2",direction:"column",width:"100%",children:[e.jsx(R,{error:o}),r==="Public"&&e.jsxs(a,{direction:"column",gap:"4",children:[e.jsxs(j,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a public channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(j,{size:"1",children:"Anyone from your organisation can join this channel and view its message history."})}),e.jsx("li",{children:e.jsx(j,{size:"1",children:"If you make this channel private, it will be visible to anyone who has joined the channel up until that point."})})]})]}),r==="Private"&&e.jsxs(a,{direction:"column",gap:"4",children:[e.jsxs(j,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a private channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(j,{size:"1",children:"No changes will be made to the channel's history or members"})}),e.jsx("li",{children:e.jsx(j,{size:"1",children:"All files shared in this channel will become private and will be accessible only to the channel members"})})]})]}),r==="Open"&&e.jsxs(a,{direction:"column",gap:"4",children:[e.jsxs(j,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a open channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(j,{size:"1",children:"Everyone from your organisation will become a channel member and will be able to view its message history."})}),e.jsx("li",{children:e.jsx(j,{size:"1",children:"If you later intend to make this private you will have to manually remove members that should not have access to this channel."})})]})]})]}),e.jsxs(a,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(rs,{disabled:c,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{onClick:()=>d(r),disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Saving":`Change to ${r.toLocaleLowerCase()}`]})]})]})},Tr=({channelData:s,allowSettingChange:n})=>e.jsxs(e.Fragment,{children:[s.type==="Public"&&e.jsxs(e.Fragment,{children:[e.jsx(zs,{channelData:s,allowSettingChange:n}),e.jsx(xe,{className:"w-full"})]}),s.type==="Public"&&e.jsx(Ms,{channelData:s,allowSettingChange:n}),s.type==="Private"&&e.jsxs(e.Fragment,{children:[e.jsx(zs,{channelData:s,allowSettingChange:n}),e.jsx(xe,{className:"w-full"})]}),s.type==="Private"&&e.jsx(Os,{channelData:s,allowSettingChange:n}),s.type==="Open"&&e.jsxs(e.Fragment,{children:[e.jsx(Ms,{channelData:s,allowSettingChange:n}),e.jsx(xe,{className:"w-full"})]}),s.type==="Open"&&e.jsx(Os,{channelData:s,allowSettingChange:n})]}),zs=({channelData:s,allowSettingChange:n})=>{const[r,i]=h.useState(!1),t=()=>{i(!1)};return T()?e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(He,{}):e.jsx(We,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(Z,{className:U,children:e.jsx(we,{newChannelType:s.type==="Public"?"Private":"Public",onClose:t,channelData:s})})]}):e.jsxs(E,{open:r,onOpenChange:i,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(He,{}):e.jsx(We,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(we,{newChannelType:s.type==="Public"?"Private":"Public",onClose:t,channelData:s})})})]})},Ms=({channelData:s,allowSettingChange:n})=>{const[r,i]=h.useState(!1),t=()=>{i(!1)};return T()?e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(We,{}):e.jsx(Je,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(Z,{className:U,children:e.jsx(we,{newChannelType:s.type==="Open"?"Public":"Open",onClose:t,channelData:s})})]}):e.jsxs(E,{open:r,onOpenChange:i,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(We,{}):e.jsx(Je,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(we,{newChannelType:s.type==="Open"?"Public":"Open",onClose:t,channelData:s})})})]})},Os=({channelData:s,allowSettingChange:n})=>{const[r,i]=h.useState(!1),t=()=>{i(!1)};return T()?e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(He,{}):e.jsx(Je,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(Z,{className:U,children:e.jsx(we,{newChannelType:s.type==="Open"?"Private":"Open",onClose:t,channelData:s})})]}):e.jsxs(E,{open:r,onOpenChange:i,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(He,{}):e.jsx(Je,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(we,{newChannelType:s.type==="Open"?"Private":"Open",onClose:t,channelData:s})})})]})},As=({onClose:s,onCloseParent:n,isDrawer:r,channelData:i})=>{const{mutate:t}=Ne(),{deleteDoc:c,error:o,loading:d,reset:l}=Ys(),x=()=>{s(),l()},m=$e(),u=cs(os),v=zn(Ds),w=()=>{i!=null&&i.name&&c("Raven Channel",i.name).then(()=>{t(["channel_members",i.name],void 0,{revalidate:!1}),s(),n(),v(),m(u?`/${u}`:"/"),V(`Channel ${i.channel_name} deleted.`)})},[f,z]=h.useState(!1),C=r?J:Be,S=r?h.Fragment:Qe,O=r?h.Fragment:Ke;return e.jsxs(e.Fragment,{children:[e.jsx(C,{children:"Delete this channel?"}),e.jsxs(a,{direction:"column",gap:"4",children:[e.jsx(R,{error:o}),e.jsxs(Mn,{color:"red",size:"1",children:[e.jsx(On,{children:e.jsx(An,{size:"18"})}),e.jsx(Tn,{children:"This action is permanent and cannot be undone."})]}),e.jsx(j,{size:"2",children:"When you delete a channel, all messages from this channel will be removed immediately."}),e.jsx(a,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(j,{as:"span",size:"2",children:"All messages, including files and images will be removed"})}),e.jsx("li",{children:e.jsx(j,{as:"span",size:"2",children:"You can archive this channel instead to preserve your messages"})})]})}),e.jsx(j,{size:"2",as:"label",children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(_e,{onClick:()=>z(!f),color:"red"}),"Yes, I understand, permanently delete this channel"]})})]}),e.jsxs(a,{gap:"3",mt:"4",justify:"end",children:[e.jsx(S,{children:e.jsx(b,{variant:"soft",color:"gray",onClick:x,children:"Cancel"})}),e.jsx(O,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:w,disabled:!f||d,children:[d&&e.jsx(I,{className:"text-white"}),d?"Deleting":"Delete"]})})]})]})},Pr=({onClose:s,channelData:n,allowSettingChange:r})=>{const[i,t]=h.useState(!1),c=()=>{t(!1)};return T()?e.jsxs(De,{open:i,onOpenChange:t,children:[e.jsx(ts,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none rounded-b-md",disabled:!r,children:[e.jsx(fs,{}),"Delete channel"]})}),e.jsx(es,{className:U,children:e.jsx(As,{onClose:c,onCloseParent:s,channelData:n})})]}):e.jsxs(E,{open:i,onOpenChange:t,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none",disabled:!r,children:[e.jsx(fs,{}),"Delete channel"]})}),e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(As,{onClose:c,isDrawer:!0,onCloseParent:s,channelData:n})})})]})},Br=({onClose:s,channelData:n,allowSettingChange:r})=>e.jsx("div",{className:"h-96",children:e.jsxs(a,{direction:"column",gap:"3",children:[e.jsx(k,{className:"rounded-md border border-gray-6",children:e.jsxs(a,{direction:"column",children:[e.jsx(Tr,{channelData:n,allowSettingChange:r}),e.jsx(xe,{className:"w-full"}),e.jsx(Ar,{onClose:s,channelData:n,allowSettingChange:r}),e.jsx(xe,{className:"w-full"}),e.jsx(Pr,{onClose:s,channelData:n,allowSettingChange:r})]})}),e.jsxs(a,{direction:"column",gap:"1",children:[e.jsx(j,{size:"1",weight:"light",className:"px-1",children:"Only channel admins or Raven admins are allowed to change the channel settings"}),e.jsx(j,{size:"1",weight:"light",className:"px-1",children:"General channel cannot be modified/ removed"})]})]})}),Lr=({open:s,setOpen:n,channelData:r})=>T()?e.jsx(Y,{open:s,onOpenChange:n,children:e.jsx(Z,{className:U,children:e.jsx(Ts,{open:s,setOpen:n,channelData:r})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(G,{children:e.jsx(Ts,{open:s,setOpen:n,channelData:r})})}),Ts=({setOpen:s,channelData:n})=>{var u;const{data:r}=Pn(),i=(u=r==null?void 0:r.message)!=null?u:[],{channelMembers:t,mutate:c}=Ie(n.name),o=Object.keys(t).length,{currentUser:d}=h.useContext(pe),l=n.type,x=h.useCallback(()=>{s(!1)},[s]),m=h.useMemo(()=>{var v;return!!(((v=t[d])==null?void 0:v.is_admin)==1||t[d]&&Ks())},[t,d]);return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(a,{align:"center",gap:"2",children:[e.jsx(se,{className:"mt-1",type:l}),e.jsx(j,{children:n.channel_name})]})}),e.jsx(on,{defaultValue:"About",children:e.jsxs(a,{direction:"column",gap:"4",children:[e.jsxs(dn,{children:[e.jsx(Te,{value:"About",children:"About"}),e.jsx(Te,{value:"Members",children:e.jsxs(a,{gap:"2",children:[e.jsx(j,{children:"Members"}),e.jsx(j,{children:o})]})}),e.jsx(Te,{value:"Settings",children:"Settings"})]}),e.jsxs(k,{children:[e.jsx(Pe,{value:"About",children:e.jsx(Nr,{channelData:n,channelMembers:t,onClose:x})}),e.jsx(Pe,{value:"Members",children:e.jsx(Mr,{channelData:n,channelMembers:t,activeUsers:i,updateMembers:c})}),e.jsx(Pe,{value:"Settings",children:e.jsx(Br,{channelData:n,onClose:x,allowSettingChange:m})})]})]})})]})};function Rr(s){return Bn({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M960.496 415.056l-82.129-18.224c-6.4-20.48-14.784-40.08-24.4-58.927l44.431-74.032c16.592-26.512 24.976-65.52 0-90.512l-45.28-45.248c-24.976-24.992-67.151-20.496-92.623-2.832l-72.032 45.887c-18.689-9.696-38.225-18-58.529-24.56l-18.431-83.12C605.999 33.009 579.343 0 543.999 0h-64c-35.344 0-57.008 33.504-64 64l-20.528 82.128c-21.68 6.912-42.496 15.744-62.336 26.208l-73.84-47.024c-25.456-17.664-67.648-22.16-92.624 2.832l-45.264 45.248c-24.992 25.008-16.608 64 0 90.512l46.752 77.92c-8.767 17.664-16.544 35.936-22.544 55.024l-82.112 18.224C33.007 420.56 0 447.216 0 482.56v64c0 35.344 33.504 57.008 64 64l83.152 20.784c5.745 17.632 12.928 34.56 21.056 50.976l-46.8 78c-16.591 26.496-24.975 65.504 0 90.496l45.28 45.248c24.976 25.008 67.152 20.496 92.624 2.847l74-47.152c19.952 10.528 40.88 19.44 62.704 26.337L416.495 960c7.008 30.496 28.656 64 64 64h64c35.344 0 62-33.007 67.504-63.504l18.464-83.343c20.096-6.496 39.376-14.689 57.84-24.257l72.192 46c25.472 17.664 67.664 22.16 92.624-2.848L898.4 850.8c24.976-25.008 16.592-64 0-90.496l-44.463-74.128c8.944-17.568 16.688-35.84 22.912-54.848L960 610.56c30.496-7.008 64-28.656 64-64v-64c0-35.344-32.992-62-63.504-67.504zm-.465 126.992c-2.72 1.952-7.842 4.635-14.338 6.139l-118.656 29.631-11.008 33.632c-4.975 15.153-11.407 30.529-19.119 45.712l-16.064 31.569 62.688 104.528c4 6.4 5.872 12.127 6.432 15.503l-42.096 42.033c-4.064-1.28-8.688-2.945-10.912-4.464l-105.344-67.184-32.752 16.945c-15.776 8.192-31.969 14.976-48.097 20.192l-34.88 11.28-26.368 119.12c-1.216 6.368-4.624 11.504-6.96 13.344h-57.6c-1.951-2.72-4.623-7.84-6.112-14.32L449.39 827.9l-34.095-10.817c-17.569-5.536-35.088-12.912-52.144-21.904l-32.912-17.376-105.36 67.152c-4.304 2.912-8.912 4.56-13.088 4.56l-41.968-40.847c.56-3.311 2.304-8.783 5.792-14.367l65.456-109.056-15.568-31.344c-7.264-14.784-13.024-28.656-17.504-42.4l-10.992-33.664L79.518 548.46c-7.392-1.68-12.736-4.432-15.52-6.4v-59.504c.032.016.08.032.145.032 1.072 0 6.336-3.745 10.72-4.544l120.72-26.737 11.087-35.28c4.512-14.368 10.672-29.344 18.816-45.775l15.568-31.36-64.767-107.92c-4.016-6.432-5.872-12.16-6.432-15.52l42.08-42.065c4.08 1.312 8.672 2.96 10.88 4.48l107.312 68.4 32.88-17.344c16.88-8.895 34.336-16.239 51.904-21.823l34.016-10.832L478.11 79.501c1.697-7.391 4.416-12.735 6.4-15.52H544c-.433.657 3.68 6.24 4.527 10.865l26.88 121.408 34.848 11.264c16.336 5.28 32.752 12.16 48.72 20.448l32.752 17.008 103.152-65.712c4.32-2.945 8.944-4.576 13.088-4.576l42 40.816c-.56 3.328-2.32 8.816-5.808 14.416l-63.344 105.488 16.16 31.616c8.72 17.056 15.376 33.056 20.32 48.928l11.056 35.344L946.64 477.55c7.153 1.328 12.721 5.456 13.905 7.696zM512.43 319.674c-106.272 0-192.736 86.288-192.736 192.32 0 106.016 86.464 192.304 192.736 192.304s192.736-86.288 192.736-192.304c0-106.032-86.464-192.32-192.736-192.32zm-.432 320.32c-70.576 0-128-57.424-128-128 0-70.592 57.424-128 128-128 70.592 0 128 57.408 128 128 0 70.576-57.424 128-128 128z"},child:[]}]})(s)}const Ps=({onClose:s,channelData:n})=>{var C,S,O,P,X,F,ne;let r=`Meeting with #${n.channel_name}`;const{currentUser:i}=h.useContext(pe),t=Ls(),c=as((C=n.peer_user_id)!=null?C:void 0);n.is_direct_message&&(r=`Meeting between ${(S=c==null?void 0:c.full_name)!=null?S:n.peer_user_id} and ${(O=t==null?void 0:t.full_name)!=null?O:i}`);const o=Is({defaultValues:{channel:n.name,subject:r,duration:"60"}}),{control:d,handleSubmit:l,register:x,setValue:m,formState:{errors:u}}=o;ke("frappe.client.get_value",{doctype:"Google Calendar",fieldname:["name"],filters:{user:i,enable:1}},void 0,{onSuccess:_=>{_.message&&m("google_calendar",_.message.name)}});const{call:v,loading:w,error:f}=Xe("raven.api.events.create_event"),z=_=>K(null,null,function*(){return v(_).then(re=>{V.success("Meeting created",{description:e.jsx(qs,{href:re.message.google_meet_link,underline:"always",className:"cursor-pointer",target:"_blank",rel:"noreferrer",children:re.message.google_meet_link})}),s()})});return e.jsx(Vs,q(A({},o),{children:e.jsxs("form",{onSubmit:l(z),children:[e.jsx(J,{children:"Start a Meeting"}),e.jsxs(a,{gap:"2",direction:"column",width:"100%",children:[e.jsx(R,{error:f}),e.jsx(k,{width:"100%",children:e.jsxs(a,{direction:"column",gap:"2",children:[e.jsxs(k,{children:[e.jsx(Ae,{htmlFor:"subject",isRequired:!0,children:"Subject"}),e.jsx(ys,A({},x("subject",{required:"Subject is required"})))]}),(u==null?void 0:u.subject)&&e.jsx(Oe,{children:(P=u.subject)==null?void 0:P.message})]})}),e.jsxs(a,{gap:"2",children:[e.jsx(k,{width:"100%",children:e.jsxs(a,{direction:"column",gap:"2",children:[e.jsxs(k,{width:"100%",children:[e.jsx(Ae,{htmlFor:"duration",isRequired:!0,children:"Duration"}),e.jsx(Us,{name:"duration",rules:{required:"Duration is required"},control:d,render:({field:_})=>e.jsxs(le,{value:_.value,name:_.name,required:!0,onValueChange:_.onChange,children:[e.jsx(te,{onBlur:_.onBlur,className:"w-full"}),e.jsxs(ae,{children:[e.jsx(N,{value:"15",children:"15 minutes"}),e.jsx(N,{value:"30",children:"30 minutes"}),e.jsx(N,{value:"60",children:"1 hour"}),e.jsx(N,{value:"120",children:"2 hours"})]})]})})]}),(u==null?void 0:u.duration)&&e.jsx(Oe,{children:(X=u.duration)==null?void 0:X.message})]})}),e.jsx(k,{width:"100%",children:e.jsxs(a,{direction:"column",gap:"2",children:[e.jsx(Ln,{name:"google_calendar",label:"Google Calendar",required:!0,dropdownClass:"sm:w-[255px] w-[10rem]",rules:{required:"Calendar is required"},filters:[["enable","=",1],["user","=",i]],doctype:"Google Calendar"}),e.jsx(Oe,{children:(F=o.formState.errors.google_calendar)==null?void 0:F.message})]})})]}),e.jsxs(k,{width:"100%",children:[e.jsxs(Ae,{htmlFor:"description",children:["Description ",e.jsx(j,{as:"span",size:"1",color:"gray",children:" (Optional)"})]}),e.jsx(ys,A({},x("description"))),(u==null?void 0:u.description)&&e.jsx(Oe,{children:(ne=u.description)==null?void 0:ne.message})]})]}),e.jsxs(a,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(rs,{disabled:w,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{type:"submit",disabled:w,children:[w&&e.jsx(I,{className:"text-white"}),w?"Creating":"Create"]})]})]})}))},$r=({isOpen:s,setOpen:n,channelData:r})=>T()?e.jsx(Y,{open:s,onOpenChange:n,children:e.jsx(Z,{className:U,children:e.jsx(Ps,{channelData:r,onClose:()=>n(!1)})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(G,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Ps,{channelData:r,onClose:()=>n(!1)})})})}),Me="16",jn=({channelData:s})=>{const{channelID:n}=ce(),{currentUser:r}=h.useContext(pe),{channelMembers:i}=Ie(s.name),[t,{on:c},o]=de(!1),[d,{on:l},x]=de(!1),[m,{on:u,off:v}]=de(!1),[w,{on:f},z]=de(!1),[C,{on:S},O]=de(!1),P=h.useMemo(()=>s.type==="Open"||s.is_archived===1||s.is_direct_message===1?!1:!!i[r],[s,i,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(Zs,{children:[e.jsx(Xs,{children:e.jsx(ue,{color:"gray",className:"bg-transparent text-gray-12 hover:bg-gray-3",children:e.jsx(Rn,{})})}),e.jsxs(Qs,{className:"min-w-48",children:[e.jsx(he,{onClick:S,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx($n,{size:Me}),"Start a Meeting"]})}),e.jsx(he,{onClick:u,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(Ze,{size:Me}),"Search"]})}),e.jsx(he,{onClick:c,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(In,{size:Me}),"View Files"]})}),s.is_direct_message===0&&e.jsxs(e.Fragment,{children:[e.jsx(Vn,{}),P&&e.jsx(he,{onClick:l,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(Un,{size:Me}),"Add Members"]})}),e.jsx(he,{onClick:f,children:e.jsxs(a,{gap:"2",align:"center",children:[e.jsx(Rr,{size:Me}),"Channel Settings"]})})]})]})]}),e.jsx(vr,{open:t,setOpen:o}),e.jsx(fr,{open:d,setOpen:x}),e.jsx(Cr,{isOpen:m,onClose:v,tabIndex:0,input:"",inFilter:n}),e.jsx(Lr,{open:w,setOpen:z,channelData:s}),e.jsx($r,{isOpen:C,setOpen:O,channelData:s})]})},Ir=({channelData:s})=>{const{channelMembers:n}=Ie(s.name),r=Object.keys(n).length,i=Math.min(r-3,9);return e.jsxs("div",{className:"flex items-center -space-x-1 rtl:space-x-reverse animate-fadein",children:[Object.entries(n).map(([t,c],o)=>{var d,l;if(o<3)return e.jsx(me,{src:(d=c.user_image)!=null?d:void 0,alt:(l=c.full_name)!=null?l:c.name,radius:"full",variant:"solid",className:"border border-gray-2"},t)}),r>3&&e.jsx("span",{className:"inline-block",children:e.jsx(En,{fallback:`${i}+`,size:"1",variant:"soft",color:"gray",radius:"full",className:"border border-slate-4 text-[10px]"})})]})},Vr=({onClose:s})=>{var l;const{channelID:n}=ce(),{data:r,error:i}=ke("raven.api.raven_message.get_pinned_messages",{channel_id:n},void 0,{revalidateOnFocus:!1}),t=$e(),{workspaceID:c}=ce(),o=(x,m,u)=>{let v="";m?v=`/${m}`:v=`/${c}`,t({pathname:`${v}/${x}`,search:`message_id=${u}`})},d=(x,m,u)=>{o(m,u,x),s()};return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(a,{justify:"between",align:"center",children:[e.jsx(j,{children:"Pinned Messages"}),e.jsx(ue,{variant:"ghost",color:"gray","aria-label":"Close",onClick:s,children:e.jsx(dr,{size:"20"})})]})}),e.jsx(Gn,{children:e.jsx(qn,{children:"Pinned Messages"})}),e.jsx(R,{error:i}),e.jsx(a,{direction:"column",gap:"3",justify:"start",children:(l=r==null?void 0:r.message)==null?void 0:l.map(x=>e.jsx(cn,{message:x,handleScrollToMessage:d},x.name))})]})},Ur=({pinnedMessagesString:s})=>{const n=s?s.split(`
`).length:0,[r,i]=h.useState(!1),t=()=>{i(!1)};return n?e.jsxs(Y,{open:r,onOpenChange:i,children:[e.jsx(Re,{children:e.jsxs(b,{size:"1",variant:"soft",color:"gray","aria-label":"View pinned messages",title:"View pinned messages",children:[e.jsx(Hn,{size:"14"}),n]})}),e.jsx(Z,{className:qe(U,"sm:min-w-[720px]"),children:e.jsx(Vr,{onClose:t})})]}):null},Er=({channelData:s})=>{var r;const n=cs(os);return e.jsxs(tn,{children:[e.jsxs(a,{align:"center",children:[e.jsx(en,{to:`/${n}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(sn,{size:"24",className:"block text-gray-12"})}),e.jsxs(a,{gap:"4",align:"center",className:"group animate-fadein pr-4",children:[e.jsxs(a,{gap:"1",align:"center",children:[e.jsx(se,{type:s.type,size:"18"}),e.jsx(nn,{size:{initial:"4",sm:"5"},className:"mb-0.5 text-ellipsis line-clamp-1",children:s.channel_name})]}),e.jsx(xn,{channelID:s.name,channel_name:s.channel_name,channelType:s.type,disabled:s.is_archived==1,buttonVisible:!!s.pinned_messages_string}),e.jsx(Ur,{pinnedMessagesString:(r=s.pinned_messages_string)!=null?r:""})]})]}),e.jsxs(a,{gap:"2",align:"center",className:"animate-fadein",children:[e.jsx(Ir,{channelData:s}),e.jsx(jn,{channelData:s})]})]})},Gr=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Er,{channelData:s}),e.jsx(hn,{channelData:s})]});function qr(){const[s,n]=Wn(xr),[r,i]=h.useState(!1),[t,c]=h.useState(!1),o=h.useRef(null),{call:d}=Xe("nora.api.tts.generate_audio"),l=h.useCallback(()=>{o.current&&(o.current.pause(),o.current.currentTime=0,o.current=null),i(!1)},[]),x=h.useCallback(m=>K(null,null,function*(){if(m.trim()){l(),c(!0);try{const u=yield d({text:m});if(u!=null&&u.success&&(u!=null&&u.audio_url)){const v=new Audio(u.audio_url);o.current=v,v.onplay=()=>{i(!0),c(!1)},v.onended=()=>{i(!1),o.current=null},v.onerror=()=>{console.error("TTS audio playback error"),i(!1),c(!1),o.current=null},yield v.play()}else console.error("TTS generation failed:",u==null?void 0:u.error),c(!1)}catch(u){console.error("TTS API error:",u),c(!1)}}}),[d,l]);return{isPlaying:r,isLoading:t,generateAndPlay:x,stop:l,ttsEnabled:s,setTTSEnabled:n}}const Hr=({compact:s=!1})=>{const{ttsEnabled:n,setTTSEnabled:r,isPlaying:i,stop:t}=qr(),c=o=>{r(o),!o&&i&&t()};return s?e.jsxs(a,{align:"center",gap:"2",children:[e.jsx(Ee,{content:n?Fe("Disable TTS"):Fe("Enable TTS"),children:e.jsxs(a,{align:"center",gap:"1",children:[n?e.jsx(Cs,{size:"14",className:"text-gray-11"}):e.jsx(Ge,{size:"14",className:"text-gray-11"}),e.jsx(ns,{size:"1",checked:n,onCheckedChange:c})]})}),i&&e.jsx(Ee,{content:Fe("Stop audio"),children:e.jsx(ue,{size:"1",variant:"ghost",color:"red",onClick:t,children:e.jsx(Ge,{size:"14"})})})]}):e.jsxs(a,{align:"center",gap:"2",children:[e.jsx(Ee,{content:Fe("Auto-read AI messages aloud"),children:e.jsxs(a,{align:"center",gap:"2",children:[n?e.jsx(Cs,{size:"16",className:"text-gray-11"}):e.jsx(Ge,{size:"16",className:"text-gray-11"}),e.jsx(j,{as:"label",size:"2",color:"gray",children:"TTS"}),e.jsx(ns,{size:"1",checked:n,onCheckedChange:c})]})}),i&&e.jsx(Ee,{content:Fe("Stop audio"),children:e.jsx(ue,{size:"1",variant:"ghost",color:"red",onClick:t,children:e.jsx(Ge,{size:"14"})})})]})},Wr=({channelData:s})=>{var w;const{currentUser:n}=h.useContext(pe),{channelMembers:r}=Ie(s.name),i=s.peer_user_id,t=Jn(s.peer_user_id),{isBot:c,fullName:o,userImage:d}=h.useMemo(()=>{var C,S;const f=r==null?void 0:r[i],z=(f==null?void 0:f.type)==="Bot";return{fullName:(C=f==null?void 0:f.full_name)!=null?C:i,userImage:(S=f==null?void 0:f.user_image)!=null?S:"",isBot:z}},[r,i]),l=as(i),x=hr(i),m=(w=o!=null?o:i)!=null?w:Yn(s.channel_name,n),u=T(),v=cs(os);return e.jsxs(tn,{children:[e.jsxs(a,{gap:"3",align:"center",children:[e.jsx(en,{to:`/${v}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(sn,{size:"24",className:"block text-gray-12"})}),e.jsx(me,{alt:m,src:d,isActive:t,availabilityStatus:l==null?void 0:l.availability_status,skeletonSize:"6",isBot:c,size:u?"2":"1"},i),e.jsx(nn,{size:{initial:"4",sm:"5"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[m,!l&&e.jsx(ze,{color:"gray",variant:"soft",children:"Deleted"}),(l==null?void 0:l.enabled)===0&&e.jsx(ze,{color:"gray",variant:"soft",children:"Disabled"}),(l==null?void 0:l.custom_status)&&e.jsx(ze,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:l.custom_status}),x&&e.jsx(ze,{color:"yellow",variant:"surface",children:"On Leave"}),c&&e.jsx(ze,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:"Bot"})]})})]}),e.jsxs(a,{gap:"4",align:"center",children:[c&&e.jsx(Hr,{compact:!0}),e.jsx(jn,{channelData:s})]})]})},Jr=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Wr,{channelData:s}),e.jsx(hn,{channelData:s})]}),Yr=()=>{const{channelID:s}=ce();return e.jsx("div",{className:"scroll-smooth",children:s&&e.jsx(Zr,{channelID:s})})},gi=Yr,Zr=({channelID:s})=>{const{threadID:n}=ce(),r=Rs(),{channel:i,error:t,isLoading:c}=ln(s),{mutate:o,cache:d}=Ne(),[l]=Zn(),x=l.get("message_id"),m=Xn(Ds);return h.useEffect(()=>{m(s);const u=d.get("unread_channel_count");u!=null&&u.data&&(x||o("unread_channel_count",v=>v&&{message:v.message.map(f=>f.name===s?q(A({},f),{unread_count:0}):f)},{revalidate:!1}))},[s,x]),e.jsxs(ls,{columns:n&&!r?"2":"1",gap:"2",rows:"repeat(2, 64px)",width:"auto",className:"dark:bg-gray-2 bg-white h-screen",children:[n&&r?null:e.jsxs(k,{children:[c&&e.jsx(Qn,{}),e.jsx(R,{error:t}),i?i.type==="dm"?e.jsx(Jr,{channelData:i.channelData}):e.jsx(Gr,{channelData:i.channelData}):null]}),e.jsx(Kn,{})]})};export{gi as Component};
