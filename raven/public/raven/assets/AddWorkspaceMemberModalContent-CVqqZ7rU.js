var M=Object.defineProperty,S=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var j=(t,e,o)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,f=(t,e)=>{for(var o in e||(e={}))k.call(e,o)&&j(t,o,e[o]);if(h)for(var o of h(e))y.call(e,o)&&j(t,o,e[o]);return t},g=(t,e)=>S(t,U(e));import{bd as E,V as L,u as F,j as r,ai as V,a as p,E as P,p as W,aP as A,c as B,ay as v,o as C,d as N,r as x,aw as R,a3 as w}from"./index-DLbNAGlT.js";import{u as T}from"./WorkspaceMemberManagement-xL6o0OrL.js";import{M as $}from"./MultipleUserCombobox-DzU3DFmo.js";import"./index-BS11k4sS.js";import"./table-ClMmNz5D.js";import"./TableLoader-CNUDz118.js";import"./Skeleton-DRya5fQA.js";import"./useGetUserRecords-BJmq8J8Y.js";import"./hover-card-Dgjf7T-b.js";const Z=({workspaceID:t,onClose:e})=>{var n;const{mutate:o}=E(),{call:b,error:l,loading:a}=L("raven.api.workspaces.add_workspace_members"),i=F({defaultValues:{add_members:null}}),{handleSubmit:u,control:m}=i,c=s=>{s.add_members&&s.add_members.length>0&&b({workspace:t,members:s.add_members.map(d=>d.name)}).then(()=>{w.success("Members added"),o(["workspace_members",t]),e()}).catch(d=>{w.error(d.message)})};return r.jsx(V,g(f({},i),{children:r.jsxs("form",{onSubmit:u(c),children:[r.jsxs(p,{gap:"2",direction:"column",width:"100%",children:[r.jsx(P,{error:l}),r.jsx(W,{width:"100%",children:r.jsx(p,{direction:"column",gap:"2",children:r.jsxs(p,{direction:"column",gap:"2",children:[r.jsx(A,{control:m,name:"add_members",rules:{validate:s=>s&&s.length>0?!0:"Please select at least one member"},render:({field:{onChange:s,value:d}})=>r.jsx(q,{setSelectedUsers:s,selectedUsers:d!=null?d:[],workspaceID:t,label:""})}),r.jsx(B,{children:(n=i.formState.errors.add_members)==null?void 0:n.message})]})})})]}),r.jsxs(p,{gap:"3",mt:"6",justify:"end",align:"center",children:[r.jsx(v,{disabled:a,children:r.jsx(C,{variant:"soft",color:"gray",children:"Cancel"})}),r.jsxs(C,{type:"button",disabled:a,onClick:u(c),children:[a&&r.jsx(N,{className:"text-white"}),a?"Saving":"Save"]})]})]})}))},q=({workspaceID:t,selectedUsers:e,setSelectedUsers:o,label:b})=>{const l=x.useContext(R),{data:a}=T(t),i=x.useMemo(()=>{var c,n;const m=a==null?void 0:a.message.map(s=>s.user);return(n=(c=l.enabledUsers)==null?void 0:c.filter(s=>!(m!=null&&m.includes(s.name))))!=null?n:[]},[l.enabledUsers,a]),u=x.useCallback((m,c)=>{const n=c.toLowerCase();return i.filter(s=>!m.find(_=>_.name===s.name)&&(s.full_name.toLowerCase().includes(n)||s.name.toLowerCase().includes(n)))},[i]);return r.jsx($,{selectedUsers:e,setSelectedUsers:o,getFilteredUsers:u,label:b})};export{Z as default};
