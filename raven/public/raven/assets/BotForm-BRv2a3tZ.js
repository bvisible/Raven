var ls=Object.defineProperty,cs=Object.defineProperties;var ds=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var Ee=(t,a,s)=>a in t?ls(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,g=(t,a)=>{for(var s in a||(a={}))Le.call(a,s)&&Ee(t,s,a[s]);if(le)for(var s of le(a))De.call(a,s)&&Ee(t,s,a[s]);return t},w=(t,a)=>cs(t,ds(a));var k=(t,a)=>{var s={};for(var n in t)Le.call(t,n)&&a.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&le)for(var n of le(t))a.indexOf(n)<0&&De.call(t,n)&&(s[n]=t[n]);return s};import{r as j,aX as us,j as e,aT as hs,bL as ms,bM as G,bN as ie,a_ as J,bO as xs,bP as ze,bQ as ps,bR as gs,bS as js,b3 as fs,b4 as bs,b6 as vs,b7 as _s,b9 as Me,aJ as F,S as x,p as D,L as E,b as Ve,c as X,bu as ws,i as _,ax as S,aP as P,aS as W,aH as I,aK as $e,h as Ss,bT as ys,e as ve,f as ue,aq as Cs,ar as As,o as oe,at as Ps,bc as Is,bU as Ns,aj as Rs,aA as xe,n as Be,aN as ks,bV as Y,x as We,a6 as Fs,a8 as Es,aa as Ls,au as Ds,av as Ms,bD as Ts,E as Os,ay as Te,v as he,bW as zs,O as de,a7 as Oe,bX as H,bY as se,bZ as ne,b_ as te,aD as Ce,aE as Ae,aF as Pe,aG as L,a as z,b$ as Vs,H as $s,c0 as Bs,c1 as be,c2 as Ws,c3 as Hs}from"./index-Ck93fVfS.js";import{I as Ks}from"./InstructionField-DWDFBrss.js";import{u as pe}from"./useRavenSettings-F70ePwVt.js";import{A as qs}from"./AINotEnabledCallout-xLkSDs0r.js";import{C as ce}from"./CodeBlock-C0VZExOW.js";import{F as Us}from"./FileSourceUploadDialog-Bafo6ghr.js";import{T as Gs}from"./TableLoader-NknXZsmj.js";import{m as He,d as Ke,P as me,f as ae,b as qe,T as re}from"./table-ClxEMtkD.js";import{r as Ys}from"./skeleton-PEVkqgIh.js";import{p as Xs,i as Js}from"./radio-cards-DN2oWF1b.js";import{m as Qs,b as Zs,P as V,f as $}from"./tabs-CB103gaz.js";var Ue=["PageUp","PageDown"],Ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ye={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Q="Slider",[_e,en,sn]=ms(Q),[Xe]=hs(Q,[sn]),[nn,ge]=Xe(Q),Je=j.forwardRef((t,a)=>{const Re=t,{name:s,min:n=0,max:l=100,step:i=1,orientation:r="horizontal",disabled:c=!1,minStepsBetweenThumbs:u=0,defaultValue:d=[n],value:m,onValueChange:p=()=>{},onValueCommit:o=()=>{},inverted:h=!1,form:f}=Re,C=k(Re,["name","min","max","step","orientation","disabled","minStepsBetweenThumbs","defaultValue","value","onValueChange","onValueCommit","inverted","form"]),y=j.useRef(new Set),b=j.useRef(0),M=r==="horizontal"?tn:an,[v=[],R]=us({prop:m,defaultProp:d,onChange:A=>{var q;(q=[...y.current][b.current])==null||q.focus(),p(A)}}),K=j.useRef(v);function Ne(A){const T=dn(v,A);Z(A,T)}function je(A){Z(A,b.current)}function is(){const A=K.current[b.current];v[b.current]!==A&&o(v)}function Z(A,T,{commit:q}={commit:!1}){const ke=xn(i),fe=pn(Math.round((A-n)/i)*i+n,ke),ee=ze(fe,[n,l]);R((U=[])=>{const O=ln(U,ee,T);if(mn(O,u*i)){b.current=O.indexOf(ee);const Fe=String(O)!==String(U);return Fe&&q&&o(O),Fe?O:U}else return U})}return e.jsx(nn,{scope:t.__scopeSlider,name:s,disabled:c,min:n,max:l,valueIndexToChangeRef:b,thumbs:y.current,values:v,orientation:r,form:f,children:e.jsx(_e.Provider,{scope:t.__scopeSlider,children:e.jsx(_e.Slot,{scope:t.__scopeSlider,children:e.jsx(M,w(g({"aria-disabled":c,"data-disabled":c?"":void 0},C),{ref:a,onPointerDown:G(C.onPointerDown,()=>{c||(K.current=v)}),min:n,max:l,inverted:h,onSlideStart:c?void 0:Ne,onSlideMove:c?void 0:je,onSlideEnd:c?void 0:is,onHomeKeyDown:()=>!c&&Z(n,0,{commit:!0}),onEndKeyDown:()=>!c&&Z(l,v.length-1,{commit:!0}),onStepKeyDown:({event:A,direction:T})=>{if(!c){const fe=Ue.includes(A.key)||A.shiftKey&&Ge.includes(A.key)?10:1,ee=b.current,U=v[ee],O=i*fe*T;Z(U+O,ee,{commit:!0})}}}))})})})});Je.displayName=Q;var[Qe,Ze]=Xe(Q,{startEdge:"left",endEdge:"right",size:"width",direction:1}),tn=j.forwardRef((t,a)=>{const M=t,{min:s,max:n,dir:l,inverted:i,onSlideStart:r,onSlideMove:c,onSlideEnd:u,onStepKeyDown:d}=M,m=k(M,["min","max","dir","inverted","onSlideStart","onSlideMove","onSlideEnd","onStepKeyDown"]),[p,o]=j.useState(null),h=J(a,v=>o(v)),f=j.useRef(void 0),C=xs(l),y=C==="ltr",b=y&&!i||!y&&i;function N(v){const R=f.current||p.getBoundingClientRect(),K=[0,R.width],je=Ie(K,b?[s,n]:[n,s]);return f.current=R,je(v-R.left)}return e.jsx(Qe,{scope:t.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:e.jsx(es,w(g({dir:C,"data-orientation":"horizontal"},m),{ref:h,style:w(g({},m.style),{"--radix-slider-thumb-transform":"translateX(-50%)"}),onSlideStart:v=>{const R=N(v.clientX);r==null||r(R)},onSlideMove:v=>{const R=N(v.clientX);c==null||c(R)},onSlideEnd:()=>{f.current=void 0,u==null||u()},onStepKeyDown:v=>{const K=Ye[b?"from-left":"from-right"].includes(v.key);d==null||d({event:v,direction:K?-1:1})}}))})}),an=j.forwardRef((t,a)=>{const C=t,{min:s,max:n,inverted:l,onSlideStart:i,onSlideMove:r,onSlideEnd:c,onStepKeyDown:u}=C,d=k(C,["min","max","inverted","onSlideStart","onSlideMove","onSlideEnd","onStepKeyDown"]),m=j.useRef(null),p=J(a,m),o=j.useRef(void 0),h=!l;function f(y){const b=o.current||m.current.getBoundingClientRect(),N=[0,b.height],v=Ie(N,h?[n,s]:[s,n]);return o.current=b,v(y-b.top)}return e.jsx(Qe,{scope:t.__scopeSlider,startEdge:h?"bottom":"top",endEdge:h?"top":"bottom",size:"height",direction:h?1:-1,children:e.jsx(es,w(g({"data-orientation":"vertical"},d),{ref:p,style:w(g({},d.style),{"--radix-slider-thumb-transform":"translateY(50%)"}),onSlideStart:y=>{const b=f(y.clientY);i==null||i(b)},onSlideMove:y=>{const b=f(y.clientY);r==null||r(b)},onSlideEnd:()=>{o.current=void 0,c==null||c()},onStepKeyDown:y=>{const N=Ye[h?"from-bottom":"from-top"].includes(y.key);u==null||u({event:y,direction:N?-1:1})}}))})}),es=j.forwardRef((t,a)=>{const p=t,{__scopeSlider:s,onSlideStart:n,onSlideMove:l,onSlideEnd:i,onHomeKeyDown:r,onEndKeyDown:c,onStepKeyDown:u}=p,d=k(p,["__scopeSlider","onSlideStart","onSlideMove","onSlideEnd","onHomeKeyDown","onEndKeyDown","onStepKeyDown"]),m=ge(Q,s);return e.jsx(ie.span,w(g({},d),{ref:a,onKeyDown:G(t.onKeyDown,o=>{o.key==="Home"?(r(o),o.preventDefault()):o.key==="End"?(c(o),o.preventDefault()):Ue.concat(Ge).includes(o.key)&&(u(o),o.preventDefault())}),onPointerDown:G(t.onPointerDown,o=>{const h=o.target;h.setPointerCapture(o.pointerId),o.preventDefault(),m.thumbs.has(h)?h.focus():n(o)}),onPointerMove:G(t.onPointerMove,o=>{o.target.hasPointerCapture(o.pointerId)&&l(o)}),onPointerUp:G(t.onPointerUp,o=>{const h=o.target;h.hasPointerCapture(o.pointerId)&&(h.releasePointerCapture(o.pointerId),i(o))})}))}),ss="SliderTrack",ns=j.forwardRef((t,a)=>{const i=t,{__scopeSlider:s}=i,n=k(i,["__scopeSlider"]),l=ge(ss,s);return e.jsx(ie.span,w(g({"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation},n),{ref:a}))});ns.displayName=ss;var we="SliderRange",ts=j.forwardRef((t,a)=>{const o=t,{__scopeSlider:s}=o,n=k(o,["__scopeSlider"]),l=ge(we,s),i=Ze(we,s),r=j.useRef(null),c=J(a,r),u=l.values.length,d=l.values.map(h=>os(h,l.min,l.max)),m=u>1?Math.min(...d):0,p=100-Math.max(...d);return e.jsx(ie.span,w(g({"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0},n),{ref:c,style:w(g({},t.style),{[i.startEdge]:m+"%",[i.endEdge]:p+"%"})}))});ts.displayName=we;var Se="SliderThumb",as=j.forwardRef((t,a)=>{const s=en(t.__scopeSlider),[n,l]=j.useState(null),i=J(a,c=>l(c)),r=j.useMemo(()=>n?s().findIndex(c=>c.ref.current===n):-1,[s,n]);return e.jsx(rn,w(g({},t),{ref:i,index:r}))}),rn=j.forwardRef((t,a)=>{const N=t,{__scopeSlider:s,index:n,name:l}=N,i=k(N,["__scopeSlider","index","name"]),r=ge(Se,s),c=Ze(Se,s),[u,d]=j.useState(null),m=J(a,M=>d(M)),p=u?r.form||!!u.closest("form"):!0,o=ps(u),h=r.values[n],f=h===void 0?0:os(h,r.min,r.max),C=cn(n,r.values.length),y=o==null?void 0:o[c.size],b=y?un(y,f,c.direction):0;return j.useEffect(()=>{if(u)return r.thumbs.add(u),()=>{r.thumbs.delete(u)}},[u,r.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${f}% + ${b}px)`},children:[e.jsx(_e.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(ie.span,w(g({role:"slider","aria-label":t["aria-label"]||C,"aria-valuemin":r.min,"aria-valuenow":h,"aria-valuemax":r.max,"aria-orientation":r.orientation,"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,tabIndex:r.disabled?void 0:0},i),{ref:m,style:h===void 0?{display:"none"}:t.style,onFocus:G(t.onFocus,()=>{r.valueIndexToChangeRef.current=n})}))}),p&&e.jsx(rs,{name:l!=null?l:r.name?r.name+(r.values.length>1?"[]":""):void 0,form:r.form,value:h},n)]})});as.displayName=Se;var on="RadioBubbleInput",rs=j.forwardRef((l,n)=>{var i=l,{__scopeSlider:t,value:a}=i,s=k(i,["__scopeSlider","value"]);const r=j.useRef(null),c=J(r,n),u=gs(a);return j.useEffect(()=>{const d=r.current;if(!d)return;const m=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(m,"value").set;if(u!==a&&o){const h=new Event("input",{bubbles:!0});o.call(d,a),d.dispatchEvent(h)}},[u,a]),e.jsx(ie.input,w(g({style:{display:"none"}},s),{ref:c,defaultValue:a}))});rs.displayName=on;function ln(t=[],a,s){const n=[...t];return n[s]=a,n.sort((l,i)=>l-i)}function os(t,a,s){const i=100/(s-a)*(t-a);return ze(i,[0,100])}function cn(t,a){return a>2?`Value ${t+1} of ${a}`:a===2?["Minimum","Maximum"][t]:void 0}function dn(t,a){if(t.length===1)return 0;const s=t.map(l=>Math.abs(l-a)),n=Math.min(...s);return s.indexOf(n)}function un(t,a,s){const n=t/2,i=Ie([0,50],[0,n]);return(n-i(a)*s)*s}function hn(t){return t.slice(0,-1).map((a,s)=>t[s+1]-a)}function mn(t,a){if(a>0){const s=hn(t);return Math.min(...s)>=a}return!0}function Ie(t,a){return s=>{if(t[0]===t[1]||a[0]===a[1])return a[0];const n=(a[1]-a[0])/(t[1]-t[0]);return a[0]+n*(s-t[0])}}function xn(t){return(String(t).split(".")[1]||"").length}function pn(t,a){const s=Math.pow(10,a);return Math.round(t*s)/s}var gn=Je,jn=ns,fn=ts,bn=as;const vn=["1","2","3"],_n=["classic","surface","soft"],wn=g(g(g({size:{type:"enum",className:"rt-r-size",values:vn,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:_n,default:"surface"}},bs),fs),js),ye=j.forwardRef((t,a)=>{var u,d;const c=vs(t,wn,_s),{className:s,color:n,radius:l,tabIndex:i}=c,r=k(c,["className","color","radius","tabIndex"]);return j.createElement(gn,w(g({"data-accent-color":n,"data-radius":l,ref:a},r),{asChild:!1,className:Me("rt-SliderRoot",s)}),j.createElement(jn,{className:"rt-SliderTrack"},j.createElement(fn,{className:Me("rt-SliderRange",{"rt-high-contrast":t.highContrast}),"data-inverted":r.inverted?"":void 0})),((d=(u=r.value)!=null?u:r.defaultValue)!=null?d:[]).map((m,p)=>j.createElement(bn,g({key:p,className:"rt-SliderThumb"},i!==void 0?{tabIndex:i}:void 0))))});ye.displayName="Slider";const Sn=()=>{var l,i;const{register:t,control:a,formState:{errors:s}}=F(),{ravenSettings:n}=pe();return e.jsxs(x,{gap:"4",children:[e.jsxs(x,{maxWidth:"480px",children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"bot_name",isRequired:!0,children:"Name"}),e.jsx(Ve,w(g({id:"bot_name"},t("bot_name",{required:"Name is required"})),{autoFocus:!0,placeholder:"accounts-bot","aria-invalid":s.bot_name?"true":"false"}))]}),s.bot_name&&e.jsx(X,{children:(l=s.bot_name)==null?void 0:l.message})]}),e.jsxs(x,{children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"description",children:"Description"}),e.jsx(ws,w(g({id:"description"},t("description")),{rows:5,resize:"vertical",placeholder:"A bot to handle accounts","aria-invalid":s.description?"true":"false"}))]}),s.description&&e.jsx(X,{children:(i=s.description)==null?void 0:i.message})]}),e.jsx(qs,{}),e.jsxs(x,{maxWidth:"480px",children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{children:[e.jsx(P,{control:a,disabled:!(n!=null&&n.enable_ai_integration),name:"is_ai_bot",render:({field:r})=>e.jsx(W,{checked:!!r.value,disabled:r.disabled,onCheckedChange:c=>r.onChange(c?1:0)})}),"Is AI Agent"]})}),e.jsx(I,{children:"Check to enable AI features for this bot"})]})]})},yn=t=>{var d;const{control:a}=F(),{fields:s,append:n,remove:l}=$e({control:a,name:"bot_functions"}),{call:i}=j.useContext(Ss),[r,c]=ys.useState(""),u=()=>{r&&i.get("frappe.client.get_value",{doctype:"Raven AI Function",filters:{name:r},fieldname:["type","description"]}).then(m=>{n({function:r,type:m.message.type,description:m.message.description}),c("")})};return e.jsxs(x,{gap:"4",children:[e.jsxs(S,{justify:"between",align:"center",children:[e.jsxs(_,{color:"gray",size:"2",children:["Add functions that the bot can use to create or update documents in the system.",e.jsx("br",{}),"Create functions in the ",e.jsx(ve,{asChild:!0,children:e.jsx(ue,{to:"/settings/functions",children:"function builder"})})," and then add them here."]}),e.jsx(D,{children:e.jsxs(Cs,{children:[e.jsx(As,{children:e.jsx(oe,{size:"2",variant:"soft",children:"Add Function"})}),e.jsx(Ps,{width:"380px",className:"relative overflow-visible",children:e.jsxs(x,{children:[e.jsx(Is,{doctype:"Raven AI Function",value:r,filters:[["name","not in",(d=s.map(m=>m.function))!=null?d:[]]],dropdownClass:"sm:w-[350px]",label:"Function",setValue:c}),e.jsx(S,{justify:"end",children:e.jsx(Ns,{children:e.jsx(oe,{type:"button",onClick:u,children:"Add"})})})]})})]})})]}),e.jsx(x,{children:s==null?void 0:s.map((m,p)=>e.jsx(Rs,{size:"2",children:e.jsxs(S,{justify:"between",align:"center",children:[e.jsxs(x,{gap:"1",children:[e.jsxs(S,{gap:"2",align:"center",children:[e.jsx(ve,{asChild:!0,size:"2",weight:"bold",className:"text-gray-12",children:e.jsx(ue,{to:`/settings/functions/${m.function}`,children:m.function})}),e.jsx(xe,{color:"purple",children:m.type})]}),e.jsx(_,{as:"div",size:"2",color:"gray",children:m.description})]}),e.jsx(Be,{size:"2",color:"red",variant:"ghost",type:"button",title:"Remove","aria-label":"Remove",mr:"1",onClick:()=>l(p),children:e.jsx(ks,{size:"16"})})]})},m.id))})]})},Cn=()=>{const{getValues:t}=F(),a=t("name"),s=a.replace(/-/g,"_"),n=({children:r})=>e.jsx(We,{as:"h3",size:"3",className:"not-cal",weight:"medium",children:r}),l=({children:r})=>e.jsx(_,{as:"p",size:"2",color:"gray",children:r}),i={sendMessage:`${s} = frappe.get_doc("Raven Bot", "${a}")

# Send a message to a channel. Text can be in HTML format.
${s}.send_message(channel_id="channel-name", text="This is a test message.")`,sendMessageInMarkdown:`${s}.send_message(
        channel_id="channel-name",
        text="This is a test message.",
        markdown=True
    )`,sendMessageWithDocumentLink:`${s}.send_message(
            channel_id="channel-name",
            text="This is a test message.",
            link_doctype="DocType",
            link_document="Document Name"
        )`,sendDirectMessage:`${s}.send_direct_message(
            user_id="john.doe@example.com",
            text="This is a test message."
        )`};return e.jsxs(x,{gap:"3",pt:"2",children:[e.jsx(_,{as:"p",size:"3",children:"The following code samples show how to use the bot/agent in a Frappe app or Server Script."}),e.jsxs(x,{gap:"0",children:[e.jsxs(x,{gap:"1",children:[e.jsx(n,{children:"Sending a message to a channel"}),e.jsx(l,{children:"Bots can be used to send messages to channels with HTML formatted content."})]}),e.jsx(ce,{code:i.sendMessage})]}),e.jsxs(x,{gap:"0",children:[e.jsxs(x,{gap:"1",children:[e.jsx(n,{children:"Sending a message to a channel in markdown format"}),e.jsxs(l,{children:["You can send markdown formatted text to a channel by setting the ",e.jsx(Y,{children:"markdown"})," parameter to True."]})]}),e.jsx(ce,{code:i.sendMessageInMarkdown})]}),e.jsxs(x,{gap:"0",children:[e.jsxs(x,{gap:"1",children:[e.jsx(n,{children:"Sending a message with a document link"}),e.jsxs(l,{children:["You can send a message with a link to any document in the system by setting the ",e.jsx(Y,{children:"link_doctype"})," and ",e.jsx(Y,{children:"link_document"})," parameters."]})]}),e.jsx(ce,{code:i.sendMessageWithDocumentLink})]}),e.jsxs(x,{gap:"0",children:[e.jsxs(x,{gap:"1",children:[e.jsx(n,{children:"Sending a direct message to a user"}),e.jsxs(l,{children:["You can send a direct message to a user by calling the ",e.jsx(Y,{children:"send_direct_message"})," method and setting the user_id parameter. This method also accepts markdown and document link parameters."]})]}),e.jsx(ce,{code:i.sendDirectMessage})]})]})},An=t=>{const{control:a}=F(),{fields:s,append:n,remove:l}=$e({control:a,name:"file_sources"}),i=r=>{n({file:r,name:"",creation:"",modified:"",owner:"",docstatus:0,modified_by:""})};return e.jsxs(x,{children:[e.jsxs(S,{justify:"between",align:"center",children:[e.jsx(_,{children:"Files like manuals, sheets etc can be added to the AI agent as instructions."}),e.jsxs(S,{gap:"2",children:[e.jsx(Us,{buttonProps:{variant:"soft",className:"not-cal"},onUpload:i}),e.jsxs(Fs,{children:[e.jsx(Es,{children:e.jsx(oe,{className:"not-cal",type:"button",children:"Select Files"})}),e.jsxs(Ls,{children:[e.jsx(Ds,{children:"Select Files"}),e.jsx(Ms,{size:"2",children:"Select files from the list below."}),e.jsx("div",{className:"mt-4",children:e.jsx(In,{append:i,existingFiles:s.map(r=>r.file)})})]})]})]})]}),e.jsxs(He,{variant:"surface",className:"rounded-sm animate-fadein",children:[e.jsx(Ke,{children:e.jsxs(me,{children:[e.jsx(ae,{children:"Name"}),e.jsx(ae,{children:"Type"}),e.jsx(ae,{})]})}),e.jsx(qe,{children:s==null?void 0:s.map((r,c)=>e.jsx(Pn,{fileID:r.file,onDelete:()=>l(c)},r.name))})]})]})},Pn=({fileID:t,onDelete:a})=>{const{data:s}=he("frappe.client.get_value",{doctype:"Raven AI File Source",filters:t,fieldname:JSON.stringify(["file_name","file_type","file"])},void 0,{revalidateOnFocus:!1}),n=s==null?void 0:s.message;return e.jsxs(me,{className:"hover:bg-gray-2 dark:hover:bg-gray-3",children:[e.jsx(re,{maxWidth:"250px",children:e.jsx(ve,{href:n==null?void 0:n.file,target:"_blank",color:"gray",underline:"always",className:"text-gray-12",children:n==null?void 0:n.file_name})}),e.jsx(re,{maxWidth:"250px",children:e.jsx(xe,{color:"gray",className:"uppercase",children:n==null?void 0:n.file_type})}),e.jsx(re,{maxWidth:"80px",align:"right",children:e.jsx(Be,{onClick:a,type:"button",color:"red",variant:"soft",size:"1",className:"not-cal",title:"Delete","aria-label":"Delete",children:e.jsx(zs,{})})})]})},In=({append:t,existingFiles:a})=>{const[s,n]=j.useState([]),l=d=>{n(m=>m.includes(d)?m.filter(p=>p!==d):[...m,d])},i=()=>{s.forEach(d=>t(d)),n([])},{data:r,isLoading:c,error:u}=Ts("Raven AI File Source",{fields:["name","file_name","file_type","file"]},void 0,{revalidateOnFocus:!1});return e.jsxs(x,{children:[c&&e.jsx(Gs,{columns:2}),u&&e.jsx(Os,{error:u}),e.jsxs(He,{variant:"surface",className:"rounded-sm animate-fadein",children:[e.jsx(Ke,{children:e.jsxs(me,{children:[e.jsx(ae,{children:"Name"}),e.jsx(ae,{children:"Type"})]})}),e.jsx(qe,{children:r==null?void 0:r.map(d=>a.includes(d.name)?null:e.jsxs(me,{className:"hover:bg-gray-2 dark:hover:bg-gray-3",children:[e.jsx(re,{maxWidth:"300px",children:e.jsx(E,{htmlFor:d.name,children:e.jsxs(S,{align:"center",children:[e.jsx(W,{id:d.name,checked:s.includes(d.name),onCheckedChange:m=>l(d.name)}),e.jsx(_,{as:"span",size:"2",className:"text-ellipsis overflow-hidden whitespace-nowrap",children:d.file_name})]})})}),e.jsx(re,{maxWidth:"250px",children:e.jsx(xe,{color:"gray",className:"uppercase",children:d.file_type})})]},d.name))})]}),e.jsxs(S,{justify:"end",gap:"2",pt:"4",children:[e.jsx(Te,{children:e.jsx(oe,{variant:"soft",color:"gray",type:"button",className:"not-cal",children:"Close"})}),e.jsx(Te,{onClick:i,disabled:s.length===0,children:e.jsx(oe,{type:"button",className:"not-cal",children:"Add"})})]})]})},Nn=t=>{var p;const{register:a,control:s,formState:{errors:n},watch:l}=F(),i=l("openai_assistant_id"),r=l("model_provider"),c=l("temperature"),u=l("top_p"),d=r==="Local LLM",m=!r||r==="OpenAI";return e.jsxs(x,{gap:"4",children:[!d&&i&&e.jsxs(x,{maxWidth:"480px",children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"openai_assistant_id",children:"OpenAI Assistant ID"}),e.jsx(Ve,w(g({id:"openai_assistant_id"},a("openai_assistant_id")),{readOnly:!0,placeholder:"asst_*******************","aria-invalid":n.openai_assistant_id?"true":"false"}))]}),n.openai_assistant_id&&e.jsx(X,{children:(p=n.openai_assistant_id)==null?void 0:p.message})]}),e.jsxs(S,{gap:"8",children:[e.jsx(Rn,{}),e.jsx(kn,{})]}),m&&e.jsx(Fn,{}),e.jsx(de,{className:"w-full"}),e.jsxs(x,{maxWidth:"480px",children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{children:[e.jsx(P,{control:s,name:"allow_bot_to_write_documents",render:({field:o})=>e.jsx(W,{checked:!!o.value,onCheckedChange:h=>o.onChange(h?1:0)})}),"Allow Agent to Write Documents"]})}),e.jsx(I,{children:"Checking this will allow the bot to create/update/delete documents in the system."})]}),e.jsx(de,{className:"w-full"}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{gap:"8",children:[e.jsxs(x,{children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{align:"center",children:[e.jsx(P,{control:s,name:"enable_file_search",render:({field:o})=>e.jsx(W,{checked:!!o.value,onCheckedChange:h=>o.onChange(h?1:0)})}),e.jsx("span",{children:"Enable File Search"}),e.jsx(Oe,{content:"View OpenAI documentation about File Search",children:e.jsx("a",{href:"https://platform.openai.com/docs/assistants/tools/file-search",title:"View OpenAI documentation about File Search","aria-label":"View OpenAI documentation about File Search",target:"_blank",className:"text-gray-11 -mb-1",children:e.jsx(H,{size:16})})})]})}),e.jsxs(I,{children:["Enable this if you want the bot to be able to read PDF files and scan them.",e.jsx("br",{}),e.jsx("br",{}),"File search enables the assistant with knowledge from files that you upload.",e.jsx("br",{}),"Once a file is uploaded, the assistant automatically decides when to retrieve content based on user requests."]})]}),e.jsxs(x,{children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{align:"center",children:[e.jsx(P,{control:s,name:"enable_code_interpreter",render:({field:o})=>e.jsx(W,{checked:!!o.value,onCheckedChange:h=>o.onChange(h?1:0)})}),e.jsx("span",{children:"Enable Code Interpreter"}),e.jsx(Oe,{content:"View OpenAI documentation about Code Interpreter",children:e.jsx("a",{href:"https://platform.openai.com/docs/assistants/tools/code-interpreter",title:"View OpenAI documentation about Code Interpreter","aria-label":"View OpenAI documentation about Code Interpreter",target:"_blank",className:"text-gray-11 -mb-1",children:e.jsx(H,{size:16})})})]})}),e.jsxs(I,{children:["Enable this if you want the bot to be able to process files like Excel sheets or data from Insights.",e.jsx("br",{}),e.jsx("br",{}),"OpenAI Assistants run code in a sandboxed environment (on OpenAI servers) to do this."]})]})]}),e.jsx(de,{className:"w-full"})]}),d&&e.jsxs(se,{size:"1",children:[e.jsx(ne,{children:e.jsx(H,{})}),e.jsx(te,{children:"Currently, code interpreter features are not available for Local LLM providers. These features require OpenAI's infrastructure."})]}),e.jsx(We,{as:"h5",size:"3",className:"not-cal",weight:"bold",children:"Advanced"}),e.jsxs(x,{maxWidth:"560px",children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{align:"center",children:[e.jsx(P,{control:s,name:"debug_mode",render:({field:o})=>e.jsx(W,{checked:!!o.value,onCheckedChange:h=>o.onChange(h?1:0)})}),e.jsx("span",{children:"Enable Debug Mode"})]})}),e.jsxs(I,{children:["If enabled, stack traces of errors will be sent as messages by the bot during runs.",e.jsx("br",{}),"This is helpful when you're testing your bots and want to know where things are going wrong."]})]}),e.jsxs(S,{gap:"8",align:"start",children:[e.jsxs(x,{maxWidth:"560px",children:[e.jsxs(S,{justify:"between",align:"center",children:[e.jsxs(E,{htmlFor:"temperature",children:["Temperature ",e.jsx(_,{as:"span",color:"gray",weight:"regular",children:"(Default: 1)"})]}),e.jsx(Y,{color:"gray",size:"2",variant:"ghost",weight:"regular",children:(c!=null?c:1).toFixed(2)})]}),e.jsx(P,{control:s,name:"temperature",render:({field:o})=>{var h;return e.jsx(ye,w(g({},o),{color:"gray",variant:"soft",defaultValue:[1],className:"w-full",value:[(h=o.value)!=null?h:1],onValueChange:f=>o.onChange(f[0]),max:2,min:0,step:.01}))}}),e.jsx(I,{children:"What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic."})]}),e.jsxs(x,{maxWidth:"560px",children:[e.jsxs(S,{justify:"between",align:"center",children:[e.jsxs(E,{htmlFor:"top_p",children:["Top P ",e.jsx(_,{as:"span",color:"gray",weight:"regular",children:"(Default: 1)"})]}),e.jsx(Y,{color:"gray",size:"2",variant:"ghost",weight:"regular",children:(u!=null?u:1).toFixed(2)})]}),e.jsx(P,{control:s,name:"top_p",render:({field:o})=>{var h;return e.jsx(ye,w(g({},o),{color:"gray",variant:"soft",className:"w-full",defaultValue:[1],value:[(h=o.value)!=null?h:1],onValueChange:f=>o.onChange(f[0]),max:1,min:0,step:.01}))}}),e.jsxs(I,{children:["An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.",e.jsx("br",{}),e.jsx("br",{}),"We generally recommend altering this or temperature but not both."]})]})]})]})},Rn=()=>{var c;const{control:t,formState:{errors:a},watch:s}=F(),{ravenSettings:n}=pe(),l=s("is_ai_bot");if(!l)return null;const i=n==null?void 0:n.enable_openai_services,r=n==null?void 0:n.enable_local_llm;return!i&&!r?e.jsxs(se,{color:"red",size:"1",children:[e.jsx(ne,{children:e.jsx(H,{})}),e.jsx(te,{children:"No AI providers are configured. Please configure OpenAI or Local LLM in AI Settings."})]}):e.jsxs(x,{width:"480px",children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"model_provider",isRequired:!0,children:"Model Provider"}),e.jsx(P,{control:t,name:"model_provider",rules:{required:l?"Please select a model provider":!1},defaultValue:i?"OpenAI":r?"Local LLM":"OpenAI",render:({field:u})=>e.jsxs(Ce,{value:u.value||(i?"OpenAI":"Local LLM"),name:u.name,onValueChange:d=>u.onChange(d),children:[e.jsx(Ae,{placeholder:"Select Provider",className:"w-full"}),e.jsxs(Pe,{children:[i?e.jsx(L,{value:"OpenAI",children:"OpenAI"}):null,r?e.jsx(L,{value:"Local LLM",children:"Local LLM"}):null]})]})})]}),a.model_provider&&e.jsx(X,{children:(c=a.model_provider)==null?void 0:c.message})]})},kn=()=>{var o,h;const{control:t,formState:{errors:a},watch:s}=F(),{ravenSettings:n}=pe(),l=s("is_ai_bot"),i=s("model_provider"),{data:r}=he("raven.api.ai_features.get_openai_available_models",void 0,i==="OpenAI"||!i?void 0:null,{revalidateOnFocus:!1,revalidateIfStale:!1}),{data:c}=he("raven.api.ai_features.test_llm_configuration",{provider:"Local LLM",api_url:n==null?void 0:n.local_llm_api_url,local_llm_provider:n==null?void 0:n.local_llm_provider},i==="Local LLM"&&(n!=null&&n.local_llm_api_url)?void 0:null,{revalidateOnFocus:!1,revalidateIfStale:!1}),u=((o=c==null?void 0:c.message.models)==null?void 0:o.map(f=>f.id))||[];if(!l)return null;const d=i==="Local LLM"?u:(r==null?void 0:r.message)||[],m=i==="Local LLM"?u[0]||"default-model":"gpt-4o",p=d.filter(f=>f&&f.trim()!=="");return e.jsxs(x,{maxWidth:"480px",children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"model",isRequired:!0,children:"Model"}),e.jsx(P,{control:t,name:"model",rules:{required:l?"Please select a model":!1},defaultValue:m,render:({field:f})=>e.jsxs(Ce,{value:f.value||m,name:f.name,onValueChange:C=>f.onChange(C),children:[e.jsx(Ae,{placeholder:"Select Model",className:"w-full"}),e.jsx(Pe,{children:p.length>0?p.map(C=>e.jsx(L,{value:C,children:C},C)):i==="Local LLM"?e.jsx(L,{value:"no-models",disabled:!0,children:"No models available"}):e.jsx(L,{value:m,children:m})})]})})]}),a.model&&e.jsx(X,{children:(h=a.model)==null?void 0:h.message}),e.jsx(I,{children:i==="Local LLM"?"Select a model available on your local LLM server.":"The model should be compatible with the OpenAI Assistants API. We recommend using models in the GPT-4 family for best results."})]})},Fn=()=>{const{control:t,watch:a}=F(),s=a("model"),n=a("is_ai_bot");return s&&s.startsWith("o")?e.jsxs(x,{maxWidth:"480px",children:[e.jsxs(D,{children:[e.jsx(E,{htmlFor:"reasoning_effort",isRequired:!0,children:"Reasoning Effort"}),e.jsx(P,{control:t,rules:{required:!!(s.startsWith("o")&&n)},defaultValue:"medium",name:"reasoning_effort",render:({field:l})=>e.jsxs(Ce,{value:l.value||"medium",name:l.name,onValueChange:i=>l.onChange(i),children:[e.jsx(Ae,{placeholder:"Select Reasoning Effort",className:"w-full"}),e.jsxs(Pe,{children:[e.jsx(L,{value:"low",children:"Low"}),e.jsx(L,{value:"medium",children:"Medium"}),e.jsx(L,{value:"high",children:"High"})]})]})})]}),e.jsx(I,{children:"The reasoning effort will be used to determine the depth of the reasoning process. This is only applicable for OpenAI's o-series models."})]}):null},En=t=>{switch(t){case"OCR_PROCESSOR":return["General text extraction","Multi-language documents","Handwriting recognition"];case"FORM_PARSER_PROCESSOR":return["Application forms","Surveys","Registration forms","Structured data"];case"BANK_STATEMENT_PROCESSOR":return["Financial analysis","Loan processing","Bank statement digitization"];case"INVOICE_PROCESSOR":return["Invoice processing","Accounts payable automation","Tax document preparation","Financial record keeping"];case"EXPENSE_PROCESSOR":return["Expense reports","Travel reimbursements","Receipt digitization"];default:return[]}},Ln=()=>{var m;const{control:t,watch:a,formState:{errors:s}}=F(),{ravenSettings:n}=pe(),l=a("use_google_document_parser"),i=n==null?void 0:n.enable_google_apis,{data:r,isLoading:c,error:u}=he("raven.ai.google_ai.get_list_of_processors",void 0,l&&i?void 0:null,{revalidateOnFocus:!1});if(!i)return e.jsx(x,{gap:"4",children:e.jsxs(se,{color:"red",size:"1",children:[e.jsx(ne,{children:e.jsx(H,{})}),e.jsx(te,{children:"Document Processors require Google Cloud APIs to be enabled in your Raven settings."})]})});const d=(r==null?void 0:r.message)&&r.message.length>0;return e.jsxs(x,{gap:"4",children:[e.jsxs(x,{className:"max-w-prose",children:[e.jsx(_,{as:"label",size:"2",children:e.jsxs(S,{align:"center",children:[e.jsx(P,{control:t,name:"use_google_document_parser",render:({field:p})=>e.jsx(W,{checked:!!p.value,onCheckedChange:o=>p.onChange(o?1:0)})}),e.jsx("span",{children:"Use Google Document/Vision AI to parse documents"})]})}),e.jsx(I,{children:"When images or PDFs are uploaded to the agent, Raven will automatically call Google Cloud APIs to process the document and send its results to the agent for better context."})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-full"}),e.jsxs(x,{gap:"4",children:[e.jsxs(x,{children:[e.jsx(_,{size:"3",weight:"medium",className:"text-gray-12",children:"Document Processor Selection"}),e.jsxs(z,{align:"center",gap:"1",children:[e.jsx(_,{size:"2",className:"text-gray-11",children:"Choose an existing document processor for this bot. Processors can be shared across multiple bots."}),e.jsx(_,{size:"2",className:"text-gray-11",children:e.jsx(ue,{to:"/settings/document-processors",target:"_blank",className:"text-accent-9 hover:underline",children:"Create Document Processors"})})]})]}),c&&e.jsx(Ys,{className:"h-10 w-full"}),u&&e.jsxs(se,{color:"red",size:"1",children:[e.jsx(ne,{children:e.jsx(H,{})}),e.jsxs(te,{children:["Error fetching processors: ",u.message]})]}),!c&&!u&&!d&&e.jsxs(se,{color:"amber",size:"1",children:[e.jsx(ne,{children:e.jsx(H,{})}),e.jsx(te,{children:e.jsxs(z,{gap:"2",children:[e.jsx(_,{children:"No document processors have been created yet. You need to create at least one processor before you can assign it to this bot."}),e.jsx(ue,{to:"/settings/document-processors",target:"_blank",className:"text-amber-800 dark:text-amber-500 hover:underline",children:"Create Document Processors"})]})})]}),!c&&d&&e.jsxs(x,{gap:"3",children:[e.jsx(P,{control:t,name:"google_document_processor_id",render:({field:p})=>e.jsx(Xs,{value:p.value,onValueChange:p.onChange,className:"flex flex-col gap-3",children:r.message.map(o=>e.jsx(Js,{value:o.id,className:"w-full cursor-pointer hover:bg-gray-2 transition-colors duration-200 border border-gray-6 rounded-md px-1 py-2",children:e.jsxs(z,{align:"center",className:"w-full p-2",gap:"0",children:[e.jsxs(z,{className:"w-1/3 px-2",align:"start",gap:"2",direction:"column",children:[e.jsx(_,{size:"3",weight:"bold",className:"text-gray-12 leading-tight",children:o.display_name}),e.jsx(xe,{color:o.state?"green":"red",variant:"soft",size:"1",className:"self-start",children:o.state?"Active":"Inactive"})]}),e.jsx(z,{className:"w-1/3 px-2",align:"start",gap:"2",direction:"column",children:e.jsx(_,{size:"2",className:"text-gray-11 leading-relaxed",children:o.type})}),e.jsx(z,{className:"w-1/3 px-2",direction:"column",gap:"1",children:En(o.type).map((h,f)=>e.jsxs(z,{align:"center",gap:"2",children:[e.jsx(Vs,{className:"text-accent-9 flex-shrink-0",size:"16"}),e.jsx(_,{size:"2",className:"text-gray-11 leading-tight",children:h})]},f))})]})},o.id))})}),e.jsx(I,{children:"This processor will be used to process any documents, images, or PDFs uploaded to the thread and send its results to the agent for better context."})]}),s.google_document_processor_id&&e.jsx(X,{children:(m=s.google_document_processor_id)==null?void 0:m.message})]})]}):null]})},B={size:18,className:"mr-1.5"},Un=({isEdit:t})=>{const{watch:a}=F(),s=!!a("is_ai_bot");return e.jsxs(Qs,{defaultValue:"general",children:[e.jsxs(Zs,{children:[e.jsxs(V,{value:"general",children:[e.jsx($s,g({},B))," General"]}),s?e.jsxs(V,{value:"ai",children:[e.jsx(Bs,g({},B))," AI"]}):null,s?e.jsxs(V,{value:"instructions",children:[e.jsx(be,g({},B))," Instructions"]}):null,s?e.jsxs(V,{value:"functions",children:[e.jsx(Ws,g({},B))," Functions"]}):null,s?e.jsxs(V,{value:"document-processors",children:[e.jsx(be,g({},B))," Document Processors"]}):null,s?e.jsxs(V,{value:"file-sources",children:[e.jsx(be,g({},B))," Files"]}):null,t?e.jsxs(V,{value:"api-docs",children:[e.jsx(Hs,g({},B))," API Docs"]}):null]}),e.jsxs(D,{pt:"4",children:[e.jsx($,{value:"general",children:e.jsx(Sn,{})}),e.jsx($,{value:"ai",children:e.jsx(Nn,{})}),e.jsx($,{value:"instructions",children:e.jsx(Ks,{allowUsingTemplate:!0,instructionRequired:!!s})}),e.jsx($,{value:"functions",children:e.jsx(yn,{})}),e.jsx($,{value:"document-processors",children:e.jsx(Ln,{})}),e.jsx($,{value:"file-sources",children:e.jsx(An,{})}),e.jsx($,{value:"api-docs",children:e.jsx(Cn,{})})]})]})};export{Un as B};
