var pe=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Q=(t,a,s)=>a in t?pe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,m=(t,a)=>{for(var s in a||(a={}))ge.call(a,s)&&Q(t,s,a[s]);if(X)for(var s of X(a))ve.call(a,s)&&Q(t,s,a[s]);return t},g=(t,a)=>me(t,fe(a));import{aJ as I,aK as _e,j as e,S as o,ax as D,i as A,aA as R,bV as ye,aS as J,a7 as be,n as ne,aN as Se,o as E,r as le,a6 as G,a8 as U,aa as K,M as ce,au as W,aM as oe,av as Y,ab as de,c4 as Ce,u as Fe,ai as De,p as f,L as v,b as F,c as p,aP as L,aD as $,aE as M,aF as O,aG as c,bu as V,aL as z,aH as C,ay as Te,da as ke,c5 as we,cb as B,b8 as qe,e as Z,bK as ee,dd as Le}from"./index-DnEovQPS.js";import{u as Ne}from"./useDoctypeMeta-DjAZrHMN.js";import{a as Ae}from"./DoctypeVariableDialogForm-Ccjb7Kef.js";import{m as Ve,d as Ee,P as se,f as w,b as Pe,T as q}from"./table-nq0vLMyc.js";import{C as $e}from"./CodeBlock-Bo9DX2EV.js";import{m as Me,b as Oe,P as te,f as ae}from"./tabs-2Eee-dAl.js";const Ie=t=>{const{control:a,watch:s}=I(),{fields:u,append:h,remove:d,update:j}=_e({control:a,name:"fields"}),n=l=>{h(l)},_=(l,S)=>{j(l,S)},b=s("action"),r=s("document_type");return e.jsxs(o,{children:[e.jsxs(D,{justify:"end",align:"center",children:[b==="Create Document"&&r&&e.jsx(ze,{append:n}),e.jsx(Be,{onAdd:n,doctype:r})]}),e.jsx(o,{children:e.jsxs(Ve,{variant:"surface",className:"rounded-sm",children:[e.jsx(Ee,{children:e.jsxs(se,{children:[e.jsx(w,{children:"Label"}),e.jsx(w,{children:"Fieldname"}),e.jsx(w,{children:"Required"}),e.jsx(w,{children:"Options"}),e.jsx(w,{children:"Default Value"}),e.jsx(w,{})]})}),e.jsx(Pe,{children:u.map((l,S)=>e.jsxs(se,{children:[e.jsxs(q,{children:[e.jsx(A,{as:"span",size:"2",weight:"medium",children:l.label})," ",e.jsx(R,{color:Re(l.type),className:"ml-2 rounded-md",children:l.type})]}),e.jsx(q,{children:e.jsx(ye,{variant:"ghost",children:l.fieldname})}),e.jsx(q,{children:e.jsx(J,{checked:!!l.is_required})}),e.jsx(q,{children:l.options?l.type==="Select"?e.jsx(be,{content:l.options.split(`
`).join(", "),children:e.jsxs(R,{color:"blue",className:"rounded-md",children:[l.options.split(`
`).length," Options"]})}):e.jsx(R,{color:"iris",variant:"soft",className:"rounded-md",children:l.options}):null}),e.jsx(q,{children:l.default_value}),e.jsx(q,{children:e.jsxs(D,{align:"center",pr:"2",gap:"4",children:[e.jsx(He,{onEdit:T=>_(S,T),field:l,doctype:r}),e.jsx(ne,{size:"2",color:"red",variant:"ghost",type:"button",onClick:()=>d(S),children:e.jsx(Se,{size:"16"})})]})})]},l.id))})]})})]})},Re=t=>{switch(t){case"Select":return"blue";case"Number":return"purple";case"Date":return"violet";case"Datetime":return"violet";case"Time":return"violet";case"Data":return"green";case"Checkbox":return"pink";case"Small Text":return"orange";case"Link":return"sky";default:return"gray"}},ue=t=>{switch(t){case"Select":return"Select";case"Autocomplete":return"Link";case"Link":return"Link";case"Int":return"Number";case"Currency":return"Number";case"Float":return"Number";case"Date":return"Date";case"Datetime":return"Datetime";case"Time":return"Time";case"Data":return"Data";case"Small Text":return"Small Text";case"Long Text":return"Small Text";case"Check":return"Checkbox";default:return"Small Text"}},he=t=>t?t==="Email"?"email":t==="Phone"?"tel":t==="URL"?"url":"":"",ze=({append:t})=>{const{watch:a,getValues:s}=I(),u=a("document_type"),{doc:h}=Ne(u!=null?u:""),d=()=>{var b;const j=(s("fields")||[]).map(r=>r.fieldname),n=(b=h==null?void 0:h.fields)==null?void 0:b.filter(r=>r.reqd&&r.fieldtype!=="Table"&&r.fieldtype!=="Table MultiSelect"),_=n==null?void 0:n.filter(r=>{var l;return!j.includes((l=r.fieldname)!=null?l:"")});_==null||_.forEach(r=>{t({fieldname:r.fieldname,label:r.label,helper_text:r.description,type:ue(r.fieldtype),is_required:r.reqd,options:r.fieldtype==="Data"?he(r.options):r.options,default_value_type:"Static",default_value:r.default})})};return e.jsxs(E,{variant:"outline",type:"button",className:"not-cal",onClick:d,children:["Import fields from ",u]})},Be=({onAdd:t,doctype:a})=>{const[s,u]=le.useState(!1),h=d=>{t(d),u(!1)};return e.jsxs(G,{open:s,onOpenChange:u,children:[e.jsx(U,{children:e.jsx(E,{type:"button",className:"not-cal",children:"Add"})}),e.jsxs(K,{className:ce(de,"static"),children:[e.jsx(W,{children:"Add Field"}),e.jsx(oe,{children:e.jsx(Y,{children:"Add a new field for this action."})}),e.jsx(xe,{doctype:a,onAdd:h})]})]})},He=({onEdit:t,field:a,doctype:s})=>{const[u,h]=le.useState(!1),d=j=>{t(j),h(!1)};return e.jsxs(G,{open:u,onOpenChange:h,children:[e.jsx(U,{children:e.jsx(ne,{size:"2",color:"gray",variant:"ghost",type:"button",children:e.jsx(Ce,{size:"16",className:"text-gray-10"})})}),e.jsxs(K,{className:ce(de,"static"),children:[e.jsx(W,{children:"Edit Field"}),e.jsx(oe,{children:e.jsxs(Y,{children:["Edit field - ",a.fieldname," for this action."]})}),e.jsx(xe,{doctype:s,field:a,onAdd:d})]})]})},xe=({doctype:t,field:a,onAdd:s})=>{var N,x,k;const u=Fe({defaultValues:a}),{register:h,watch:d,setValue:j,formState:{errors:n},control:_}=u,b=d("fieldname"),r=d("type"),l=d("default_value_type"),S=i=>{s(i)},T=i=>{var y;j("fieldname",(y=i.fieldname)!=null?y:""),i.label&&j("label",i.label),i.description&&j("helper_text",i.description),i.fieldtype&&j("type",ue(i.fieldtype)),i.options&&(i.fieldtype==="Data"?j("options",he(i.options)):(i.fieldtype==="Autocomplete"||i.fieldtype==="Link"||i.fieldtype==="Select")&&j("options",i.options))},P=i=>{i==="Link"&&j("options","")};return e.jsx(De,g(m({},u),{children:e.jsxs(o,{gap:"4",children:[e.jsxs(o,{gap:"4",children:[e.jsxs(D,{children:[t?e.jsx(Ae,{doctype:t,value:b,onFieldSelect:T}):e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{isRequired:!0,htmlFor:"fieldname",children:"Field Name"}),e.jsx(F,g(m({},h("fieldname",{required:"Field is required"})),{id:"fieldname"}))]}),n.fieldname&&e.jsx(p,{children:n.fieldname.message})]}),e.jsxs(o,{width:"50%",children:[e.jsxs(f,{children:[e.jsx(v,{isRequired:!0,htmlFor:"label",children:"Label"}),e.jsx(F,g(m({},h("label",{required:"Label is required"})),{id:"label"}))]}),n.label&&e.jsx(p,{children:n.label.message})]})]}),e.jsxs(D,{children:[e.jsxs(o,{width:"50%",children:[e.jsxs(f,{children:[e.jsx(v,{isRequired:!0,children:"Type"}),e.jsx(L,{control:_,name:"type",rules:{required:"Type is required",onChange:P},render:({field:{value:i,onChange:y}})=>e.jsxs($,{required:!0,value:i,onValueChange:je=>y(je),children:[e.jsx(M,{placeholder:"Select a type",className:"w-full"}),e.jsxs(O,{children:[e.jsx(c,{value:"Data",children:"Data"}),e.jsx(c,{value:"Number",children:"Number"}),e.jsx(c,{value:"Select",children:"Select"}),e.jsx(c,{value:"Link",children:"Link"}),e.jsx(c,{value:"Checkbox",children:"Checkbox"}),e.jsx(c,{value:"Date",children:"Date"}),e.jsx(c,{value:"Time",children:"Time"}),e.jsx(c,{value:"Datetime",children:"Datetime"}),e.jsx(c,{value:"Small Text",children:"Small Text"})]})]})})]}),n.type&&e.jsx(p,{children:(N=n.type)==null?void 0:N.message})]}),r==="Data"&&e.jsxs(o,{width:"50%",children:[e.jsxs(f,{children:[e.jsxs(v,{htmlFor:"options",children:["Validation ",e.jsx(A,{as:"span",weight:"regular",size:"2",color:"gray",children:" (optional)"})]}),e.jsx(F,g(m({},h("options",{required:!1,pattern:{value:/^("email"|"tel"|"url")$/,message:"Invalid validation"}})),{id:"options",placeholder:'"email", "tel", or "url"'}))]}),n.options&&e.jsx(p,{children:n.options.message})]})]}),e.jsx(f,{children:e.jsx(L,{control:_,name:"is_required",render:({field:i})=>e.jsx(A,{as:"label",size:"2",children:e.jsxs(D,{children:[e.jsx(J,{checked:!!i.value,onCheckedChange:y=>i.onChange(y?1:0)}),"Required"]})})})}),r==="Select"&&e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Options"}),e.jsx(V,g(m({},h("options",{required:r==="Select"?"Options are required":!1})),{placeholder:"Add options in new lines",rows:8}))]}),n.options&&e.jsx(p,{children:(x=n.options)==null?void 0:x.message})]}),r==="Link"&&e.jsxs(o,{children:[e.jsx(z,{name:"options",doctype:"DocType",label:"Document Type",filters:[["istable","=",0],["issingle","=",0]],required:!0,rules:{required:r==="Link"?"Document Type is required":!1}}),n.options&&e.jsx(p,{children:(k=n.options)==null?void 0:k.message})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"default_value_type",children:"Default Value Type"}),e.jsx(L,{control:_,name:"default_value_type",render:({field:{value:i,onChange:y}})=>e.jsxs($,{value:i,onValueChange:y,children:[e.jsx(M,{placeholder:"Select a default value type",className:"w-full",id:"default_value_type"}),e.jsxs(O,{children:[e.jsx(c,{value:"Static",children:"Static"}),e.jsx(c,{value:"Message Field",children:"Message Field"}),e.jsx(c,{value:"Jinja",children:"Jinja"})]})]})})]}),e.jsxs(C,{children:["You can choose between a static default value, message field or jinja template.",e.jsx("br",{}),"Message field will allow you to set a default value from the message selected.",e.jsx("br",{}),"Jinja tags can be used with the message as context."]}),n.default_value_type&&e.jsx(p,{children:n.default_value_type.message})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"default_value",children:"Default Value"}),l==="Static"&&e.jsx(F,g(m({},h("default_value")),{id:"default_value"})),l==="Message Field"&&e.jsx(L,{control:_,name:"default_value",render:({field:{value:i,onChange:y}})=>e.jsxs($,{value:i,onValueChange:y,children:[e.jsx(M,{placeholder:"Select a message field",className:"w-full",id:"default_value"}),e.jsxs(O,{children:[e.jsx(c,{value:"text",children:"Text (with HTML tags)"}),e.jsx(c,{value:"file",children:"File"}),e.jsx(c,{value:"content",children:"Content (Text content without HTML tags)"}),e.jsx(c,{value:"owner",children:"Owner (User)"}),e.jsx(c,{value:"creation",children:"Creation (Datetime)"}),e.jsx(c,{value:"message_type",children:"Message Type"}),e.jsx(c,{value:"link_doctype",children:"Linked DocType"}),e.jsx(c,{value:"link_document",children:"Linked Document"}),e.jsx(c,{value:"channel_id",children:"Channel ID"}),e.jsx(c,{value:"workspace_id",children:"Workspace ID"}),e.jsx(c,{value:"message_url",children:"Message URL"})]})]})}),l==="Jinja"&&e.jsx(V,g(m({},h("default_value")),{placeholder:"This is the message: {{ message.content }}",id:"default_value",rows:8}))]}),n.default_value&&e.jsx(p,{children:n.default_value.message})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsxs(v,{htmlFor:"helper_text",children:["Description ",e.jsx(A,{as:"span",weight:"regular",size:"2",color:"gray",children:" (optional)"})]}),e.jsx(F,g(m({},h("helper_text")),{id:"helper_text"}))]}),n.helper_text&&e.jsx(p,{children:n.helper_text.message})]})]}),e.jsxs(D,{justify:"end",children:[e.jsx(Te,{children:e.jsx(E,{variant:"soft",color:"gray",children:"Close"})}),e.jsx(E,{type:"button",onClick:u.handleSubmit(S),children:"Add"})]})]})}))},re={size:18,className:"mr-1.5"},Ze=()=>e.jsxs(Me,{defaultValue:"general",children:[e.jsxs(Oe,{children:[e.jsxs(te,{value:"general",children:[e.jsx(ke,m({},re))," General"]}),e.jsxs(te,{value:"fields",children:[e.jsx(we,m({},re))," Fields"]})]}),e.jsxs(f,{pt:"4",children:[e.jsx(ae,{value:"general",children:e.jsx(Je,{})}),e.jsx(ae,{value:"fields",children:e.jsx(Ie,{})})]})]}),Je=()=>{var _,b,r,l,S,T,P,N;const{register:t,control:a,formState:{errors:s},setValue:u,watch:h}=I(),d=B({control:a,name:"action"}),j=B({control:a,name:"server_script"}),n=x=>{x.target.value!=="Custom Function"&&u("custom_function_path",""),x.target.value!=="Create Document"&&u("document_type",""),x.target.value!=="Server Script"&&u("server_script","")};return e.jsxs(o,{gap:"4",children:[e.jsxs(qe,{columns:"2",gap:"4",align:"center",children:[e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"action_name",isRequired:!0,children:"Name"}),e.jsx(F,g(m({id:"action_name"},t("action_name",{required:"Name is required",onBlur:x=>{u("title",x.target.value.trim())}})),{placeholder:"Create support ticket","aria-invalid":s.action_name?"true":"false"}))]}),s.action_name&&e.jsx(p,{children:(_=s.action_name)==null?void 0:_.message})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"action",isRequired:!0,children:"Action Type"}),e.jsx(L,{control:a,name:"action",rules:{required:"Action Type is required",onChange:n},render:({field:x})=>e.jsxs($,{value:x.value,name:x.name,onValueChange:k=>x.onChange(k),children:[e.jsx(M,{placeholder:"Pick an action type",className:"w-full",autoFocus:!0}),e.jsxs(O,{children:[e.jsx(c,{value:"Create Document",children:"Create Document"}),e.jsx(c,{value:"Custom Function",children:"Custom Function (API)"}),e.jsx(c,{value:"Server Script",children:"Server Script"})]})]})})]}),s.action&&e.jsx(p,{children:(b=s.action)==null?void 0:b.message})]}),d==="Create Document"&&e.jsxs(o,{children:[e.jsx(z,{name:"document_type",label:"Document Type",required:!0,filters:[["istable","=",0],["issingle","=",0]],doctype:"DocType",rules:{required:d==="Create Document"?"Document Type is required":!1}}),e.jsx(C,{children:"The document you want this action to create."}),s.document_type&&e.jsx(p,{children:(r=s.document_type)==null?void 0:r.message})]}),d==="Custom Function"&&e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"custom_function_path",isRequired:d==="Custom Function",children:"Custom Function Path"}),e.jsx(V,g(m({id:"custom_function_path"},t("custom_function_path",{required:d==="Custom Function"?"Path is required":!1,validate:x=>x!=null&&x.includes(" ")?"Path cannot contain spaces":!0})),{placeholder:"myapp.api.my_custom_function"}))]}),e.jsx(C,{children:"Dotted path to the custom function/API. Cannot contain spaces."}),s.custom_function_path&&e.jsx(p,{children:(l=s.custom_function_path)==null?void 0:l.message}),H[d]?e.jsx("div",{children:e.jsx(ie,{})}):null]}),d==="Server Script"&&e.jsxs(o,{children:[e.jsx(z,{name:"server_script",label:"Server Script",required:!0,filters:[["disabled","=",0],["script_type","=","API"]],doctype:"Server Script",rules:{required:d==="Server Script"?"Server Script is required":!1}}),e.jsxs(C,{className:"leading-6",children:['The Server Script you want this action to run. Server Scripts need to be of type "API".',e.jsx("br",{}),j?e.jsxs(Z,{href:`/app/server-script/${j}`,target:"_blank",children:["Configure ",j," ",e.jsx(ee,{})]}):e.jsxs(Z,{href:"/app/server-script/list",target:"_blank",children:["View Server Scripts ",e.jsx(ee,{})]})]}),s.server_script&&e.jsx(p,{children:(S=s.server_script)==null?void 0:S.message}),H[d]?e.jsx("div",{children:e.jsx(ie,{})}):null]})]}),e.jsx(o,{children:e.jsx(A,{as:"label",size:"2",children:e.jsxs(D,{children:[e.jsx(L,{control:a,name:"enabled",render:({field:x})=>e.jsx(J,{checked:!!x.value,onCheckedChange:k=>x.onChange(k?1:0)})}),"Enabled"]})})}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"title",isRequired:!0,children:"Title"}),e.jsx(F,g(m({id:"title"},t("title",{required:"Title is required"})),{placeholder:"Create support ticket","aria-invalid":s.title?"true":"false"}))]}),e.jsx(C,{children:"Title of the message action dialog."}),s.title&&e.jsx(p,{children:(T=s.title)==null?void 0:T.message})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(V,g(m({},t("description")),{id:"description",placeholder:"Create a support ticket from the message."}))]}),s.description&&e.jsx(p,{children:(P=s.description)==null?void 0:P.message}),e.jsx(C,{children:"This is shown on the message action dialog."})]}),e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(v,{htmlFor:"success_message",children:"Success Message"}),e.jsx(V,g(m({},t("success_message")),{id:"success_message",placeholder:"Ticket created successfully."}))]}),s.success_message&&e.jsx(p,{children:(N=s.success_message)==null?void 0:N.message}),e.jsx(C,{children:"The message shown in the toast after performing the action."})]})]})},ie=()=>{const{control:t}=I(),a=B({control:t,name:"action"});return e.jsxs(G,{children:[e.jsx(U,{children:e.jsxs(E,{className:"not-cal",variant:"outline",children:[e.jsx(Le,{})," View Docs"]})}),e.jsxs(K,{children:[e.jsx(W,{children:"Documentation"}),e.jsxs(Y,{size:"2",children:["The following code sample shows how to use the message action values in a ",a,"."]}),e.jsx("div",{children:e.jsx($e,{code:H[a]})})]})]})},H={"Server Script":`# Server Scripts would get the values in "frappe.form_dict"
{
    "message_id": "123",
    "action_id": "abc",
    "values": {
    # Values from the fields in the message action dialog
        "field1": "value1",
        "field2": "value2"
    }
}

# You can use the values to perform any action like this:
print(frappe.form_dict.values.field1)`,"Create Document":"","Custom Function":` # The API would be called directly with the values from the message action dialog.

# Example:
@frappe.whitelist()
def create_ticket(field1, field2):
    # Do something with the values
    frappe.get_doc({
        "doctype": "Ticket",
        "field1": field1,
        "field2": field2
    }).insert()
`};export{Ze as M};
