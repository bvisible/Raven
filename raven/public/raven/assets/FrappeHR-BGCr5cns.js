var I=Object.defineProperty,K=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var F=(t,a,n)=>a in t?I(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,w=(t,a)=>{for(var n in a||(a={}))B.call(a,n)&&F(t,n,a[n]);if(E)for(var n of E(a))O.call(a,n)&&F(t,n,a[n]);return t},N=(t,a)=>K(t,M(a));import{aJ as L,aK as U,j as e,S as b,ax as R,i as h,_ as s,o as D,p as d,aL as G,c as P,aM as J,L as $,n as Q,aN as X,aO as Y,aP as v,aD as T,aE as q,aF as V,aG as S,aQ as Z,az as ee,u as ae,r as H,ah as se,ai as ne,d as re,C as te,aR as oe,E as ie,a as j,aS as W,aH as A,O as ce,a3 as le}from"./index-DLbNAGlT.js";import{P as de,S as me,a as he}from"./SettingsContentContainer-PpMfRXsE.js";import{u as pe}from"./useRavenSettings-CaSx_tcD.js";const ue=t=>{const{control:a,formState:{errors:n,disabled:o}}=L(),{fields:m,append:l,remove:C}=U({control:a,name:"company_workspace_mapping"}),k=()=>l({company:"",raven_workspace:""});return e.jsxs(b,{children:[e.jsxs(R,{justify:"between",align:"center",children:[e.jsx(h,{size:"2",weight:"medium",children:s("Choose workspaces based on companies")}),e.jsx(D,{className:"not-cal",disabled:o,type:"button",variant:"soft",size:"2",onClick:k,children:s("Add")})]}),e.jsxs(d,{className:"rounded-md overflow-hidden border border-gray-4",children:[e.jsxs(R,{className:"bg-gray-3 py-2 rounded-t-md",children:[e.jsx(d,{width:"45%",className:"px-2",children:e.jsx(h,{size:"2",weight:"medium",children:s("Company")})}),e.jsx(d,{width:"45%",className:"px-2",children:e.jsx(h,{size:"2",weight:"medium",children:s("Workspace")})}),e.jsx(d,{width:"10%",className:"px-2",children:e.jsx(h,{size:"2",weight:"medium",children:s("Actions")})})]}),m.map((f,i)=>{var y,_,p,g,u,x;return e.jsxs(R,{className:"px-2 py-2 border-b border-gray-4",children:[e.jsx(d,{width:"45%",children:e.jsxs(b,{gap:"1",children:[e.jsx(G,{doctype:"Company",hideLabel:!0,rules:{required:s("Company is required")},label:`Company in Row ${i+1}`,name:`company_workspace_mapping.${i}.company`}),e.jsx(P,{children:(p=(_=(y=n.company_workspace_mapping)==null?void 0:y[i])==null?void 0:_.company)==null?void 0:p.message})]})}),e.jsx(d,{width:"45%",children:e.jsxs(b,{gap:"1",children:[e.jsx(J,{children:e.jsxs($,{children:["Workspace in Row ",i+1]})}),e.jsx(xe,{name:`company_workspace_mapping.${i}.raven_workspace`}),e.jsx(P,{children:(x=(u=(g=n.company_workspace_mapping)==null?void 0:g[i])==null?void 0:u.raven_workspace)==null?void 0:x.message})]})}),e.jsx(d,{width:"10%",className:" px-6 flex justify-center items-center",children:e.jsx(Q,{"aria-label":"Remove",size:"2",color:"red",variant:"ghost",title:"Remove",disabled:o,type:"button",onClick:()=>C(i),children:e.jsx(X,{size:"16"})})})]},f.id)})]})]})},xe=({name:t})=>{const{control:a}=L(),{data:n}=Y();return e.jsx(v,{control:a,name:t,rules:{required:s("Workspace is required")},render:({field:o})=>{var m;return e.jsxs(T,{value:(m=o.value)!=null?m:"",disabled:o.disabled,name:o.name,onValueChange:o.onChange,children:[e.jsx(q,{className:"min-w-72"}),e.jsx(V,{children:n==null?void 0:n.message.map(l=>e.jsx(S,{value:l.name,children:l.name}))})]})}})},je=()=>{var u,x,z;const t=Z()||ee(),{ravenSettings:a,mutate:n}=pe(),o=ae({disabled:!t}),{handleSubmit:m,control:l,watch:C,reset:k}=o;H.useEffect(()=>{a&&k(a)},[a]);const{updateDoc:f,loading:i,error:y}=se(),_=((z=(x=(u=window==null?void 0:window.frappe)==null?void 0:u.boot)==null?void 0:x.versions)==null?void 0:z.hrms)!==void 0,p=r=>{le.promise(f("Raven Settings",null,w(w({},a!=null?a:{}),r)).then(c=>{n(c,{revalidate:!1})}),{loading:"Updating...",success:()=>s("Settings updated"),error:s("There was an error.")})};H.useEffect(()=>{const r=c=>{c.key==="s"&&(c.metaKey||c.ctrlKey)&&(c.preventDefault(),o.handleSubmit(p)())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]);const g=C("auto_create_department_channel");return e.jsx(de,{children:e.jsx(ne,N(w({},o),{children:e.jsx("form",{onSubmit:m(p),children:e.jsxs(me,{children:[e.jsx(he,{title:s("HR"),description:s("Connect your HR system to Raven to sync employee data and send notifications."),actions:e.jsxs(D,{type:"submit",disabled:i||!t,children:[i&&e.jsx(re,{className:"text-white"}),i?s("Saving"):s("Save")]})}),!_&&e.jsx(te,{iconChildren:e.jsx(oe,{}),rootProps:{color:"yellow",variant:"surface"},textChildren:s("HR is not installed on this site.")}),e.jsx(ie,{error:y}),e.jsxs(j,{direction:"column",gap:"2",maxWidth:"480px",children:[e.jsx(h,{as:"label",size:"2",children:e.jsxs(j,{gap:"2",children:[e.jsx(v,{control:l,defaultValue:a==null?void 0:a.auto_create_department_channel,name:"auto_create_department_channel",render:({field:r})=>e.jsx(W,{disabled:r.disabled,name:r.name,checked:!!r.value,onCheckedChange:c=>r.onChange(c?1:0)})}),s("Automatically create channels for departments")]})}),e.jsx(A,{children:s("If checked, a channel will be created for each department. Employees in the department will be synced with channel members.")})]}),g?e.jsxs(b,{children:[e.jsxs(j,{direction:"column",maxWidth:"320px",children:[e.jsx($,{isRequired:!0,htmlFor:"department_channel_type",children:s("Department Channel Type")}),e.jsx(v,{control:l,defaultValue:a==null?void 0:a.department_channel_type,name:"department_channel_type",render:({field:r})=>e.jsxs(T,{value:r.value,disabled:r.disabled,name:r.name,onValueChange:r.onChange,children:[e.jsx(q,{}),e.jsxs(V,{children:[e.jsx(S,{value:"Private",children:s("Private")}),e.jsx(S,{value:"Public",children:s("Public")})]})]})})]}),e.jsx(ue,{})]}):null,e.jsx(ce,{size:"4"}),e.jsxs(j,{direction:"column",gap:"2",maxWidth:"480px",children:[e.jsx(h,{as:"label",size:"2",children:e.jsxs(j,{gap:"2",children:[e.jsx(v,{control:l,defaultValue:a==null?void 0:a.show_if_a_user_is_on_leave,name:"show_if_a_user_is_on_leave",render:({field:r})=>e.jsx(W,{name:r.name,disabled:r.disabled,checked:!!r.value,onCheckedChange:c=>r.onChange(c?1:0)})}),s("Show if a user is on leave")]})}),e.jsx(A,{children:s("If checked, users on Raven are notified if another user is on leave.")})]})]})})}))})},be=je;export{be as Component};
