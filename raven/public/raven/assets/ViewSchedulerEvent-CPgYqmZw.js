var $=Object.defineProperty,D=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var a=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var h=(e,r,o)=>r in e?$(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,d=(e,r)=>{for(var o in r||(r={}))C.call(r,o)&&h(e,o,r[o]);if(a)for(var o of a(r))q.call(r,o)&&h(e,o,r[o]);return e},p=(e,r)=>D(e,k(r));import{bx as w,by as P,j as s,E as f,F,r as x,u as R,ah as L,ai as N,ax as B,ak as V,al as I,n as O,bk as H,an as K,ao as v,d9 as T,o as A,d as M,a3 as b}from"./index-R8dcyEON.js";import{D as U}from"./DeleteAlert-Bz2RPfiB.js";import{S as z}from"./SchedulerEventsForm-BrMctE-3.js";import{P as G,S as J,a as Q}from"./SettingsContentContainer-BMUEmzAQ.js";import{a as W}from"./validations-DJFqvO1k.js";import"./WebhookForm-DziH-MVk.js";import"./table-HDqE5ITd.js";import"./tabs-DQGMkBAG.js";import"./ServerScriptNotEnabledForm-BsuglF3I.js";const X=()=>{const{ID:e}=w(),{data:r,error:o,mutate:c,isLoading:i}=P("Raven Scheduler Event",e);return s.jsxs(G,{children:[o&&s.jsx(f,{error:o}),i&&s.jsx(F,{className:"h-64"}),r&&s.jsx(Y,{data:r,onUpdate:c})]})},Y=({data:e,onUpdate:r})=>{const[o,c]=x.useState(!1),i=R({defaultValues:{name:e.name,send_to:e.send_to,event_frequency:e.event_frequency,channel:e.channel,dm:e.dm,bot:e.bot,content:e.content,hour:e.cron_expression?e.cron_expression.split(" ")[1]:"",minute:e.cron_expression?e.cron_expression.split(" ")[0]:"",date:e.cron_expression?e.cron_expression.split(" ")[2]:"",month:e.cron_expression?e.cron_expression.split(" ")[3]:"",day:e.cron_expression?e.cron_expression.split(" ")[4]:""}}),{formState:{dirtyFields:y}}=i,S=!W(y),{updateDoc:u,error:j,loading:l}=L(),m=n=>{let t="";n.event_frequency==="Every Day"&&(t=`${n.minute} ${n.hour} * * *`),n.event_frequency==="Every Day of the week"&&(t=`${n.minute} ${n.hour} * * ${n.day}`),n.event_frequency==="Date of the month"&&(t=`${n.minute} ${n.hour} ${n.date} * *`),n.event_frequency==="Cron"&&(t=`${n.minute} ${n.hour} ${n.date} ${n.month} ${n.day}`),u("Raven Scheduler Event",n.name,{channel:n.channel,bot:n.bot,event_frequency:n.event_frequency,cron_expression:t,content:n.content}).then(()=>{r(),b.success("Scheduler Event updated")})},_=()=>{u("Raven Scheduler Event",e.name,{disabled:!e.disabled}).then(()=>{r(),b(`Scheduler Event ${e.name} ${e.disabled?"enabled":"disabled"}`)})},E=()=>{c(!1)};x.useEffect(()=>{const n=t=>{t.key==="s"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),i.handleSubmit(m)())};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]);const g=e.disabled?[{label:"Disabled",color:"gray"}]:[{label:"Enabled",color:"green"}];return s.jsx(N,p(d({},i),{children:s.jsx("form",{onSubmit:i.handleSubmit(m),children:s.jsxs(J,{children:[s.jsx(Q,{title:e.event_name,headerBadges:S?[{label:"Not Saved",color:"red"}]:g,actions:s.jsxs(B,{children:[s.jsxs(V,{children:[s.jsx(I,{children:s.jsx(O,{"aria-label":"Options",variant:"surface",color:"gray",children:s.jsx(H,{})})}),s.jsxs(K,{className:"min-w-32",children:[s.jsx(v,{onClick:_,children:e.disabled?"Enable":"Disable"}),s.jsx(T,{}),s.jsx(v,{color:"red",onClick:()=>c(!0),children:"Delete"})]})]}),s.jsxs(A,{type:"submit",disabled:l,children:[l&&s.jsx(M,{className:"text-white"}),l?"Saving":"Save"]})]}),breadcrumbs:[{label:"Scheduled Messages",href:"../"},{label:e.name,href:"",copyToClipboard:!0}]}),s.jsx(f,{error:j}),s.jsx(z,{edit:!0}),s.jsx(U,{doctype:"Raven Scheduler Event",docname:e.name,isOpen:o,onClose:E,path:"../../scheduled-messages"})]})})}))},ue=X;export{ue as Component};
