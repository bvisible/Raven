const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ViewFilesContent-Bg9wTPwD.js","assets/index-DhM1aug3.js","assets/index-BvP5pbmo.css","assets/useDebounce-DeHc-l-x.js","assets/usePagination-BxisAgdt.js","assets/TableLoader-8HqOeBd6.js","assets/Skeleton-CwvUWy7X.js","assets/table-DGmDSk0U.js","assets/hover-card-CQZySoZy.js","assets/TypingIndicator-BtMz4VA_.js","assets/index-DKQZRMKb.js","assets/useCurrentChannelData-CTq_SYHT.js","assets/useGetUserRecords-CVrS3xnU.js","assets/useRavenSettings-BYy_TMW0.js","assets/preferences-Dbwk5zts.js","assets/DoctypeLinkRenderer-2UyBGAP4.js","assets/useDoctypeMeta-Df8LdZCO.js","assets/skeleton-C82Qe8ow.js","assets/useCurrentChannelData-BsL46_d-.css","assets/EmptyState-aHnxwGP8.js","assets/DateSeparator-nqpz_ulG.js","assets/tabs-Dy4pJYvb.js","assets/tiptap-CwkfU7Sh.css"])))=>i.map(i=>d[i]);
var dn=Object.defineProperty,hn=Object.defineProperties;var xn=Object.getOwnPropertyDescriptors;var Ve=Object.getOwnPropertySymbols;var os=Object.prototype.hasOwnProperty,ds=Object.prototype.propertyIsEnumerable;var cs=(s,n,i)=>n in s?dn(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i,O=(s,n)=>{for(var i in n||(n={}))os.call(n,i)&&cs(s,i,n[i]);if(Ve)for(var i of Ve(n))ds.call(n,i)&&cs(s,i,n[i]);return s},J=(s,n)=>hn(s,xn(n));var Qe=(s,n)=>{var i={};for(var r in s)os.call(s,r)&&n.indexOf(r)<0&&(i[r]=s[r]);if(s!=null&&Ve)for(var r of Ve(s))n.indexOf(r)<0&&ds.call(s,r)&&(i[r]=s[r]);return i};var ie=(s,n,i)=>new Promise((r,a)=>{var c=l=>{try{h(i.next(l))}catch(d){a(d)}},o=l=>{try{h(i.throw(l))}catch(d){a(d)}},h=l=>l.done?r(l.value):Promise.resolve(l.value).then(c,o);h((i=i.apply(s,n)).next())});import{j as e,a as t,S as Ms,i as x,ah as Le,o as b,d as V,a3 as U,aB as zs,r as u,bd as _e,dR as Os,bx as ae,eR as un,dX as As,p as k,ej as jn,M as Ue,n as Pe,dV as mn,L as ze,ax as gn,aS as be,u as Ps,P,ai as Ts,au as Y,E as $,aP as Ls,b as Je,m as xe,bo as D,c as Me,ay as Ke,a6 as H,a8 as Re,bp as hs,aa as Z,ab as E,d_ as G,d$ as je,e0 as q,aI as pn,d6 as De,v as we,be as We,aD as re,aE as le,aF as te,c6 as Q,c7 as K,aG as N,dY as fe,b8 as es,a4 as ue,eS as Rs,bg as Bs,e as $s,dS as vn,cZ as Is,bm as Be,bl as oe,V as ss,a0 as Te,a1 as Ye,a2 as He,ac as Vs,ad as Ze,ae as ns,ag as Xe,el as fn,U as me,dn as is,O as he,cG as yn,cF as Us,br as Es,ak as Gs,al as qs,cw as bn,an as Js,ao as de,cH as Cn,aQ as Ws,eT as xs,eU as us,eV as Ee,eE as Ge,eW as qe,Q as rs,Y as ls,eX as _n,Z as Ys,bY as wn,bZ as Nn,aR as kn,b_ as Sn,bq as js,eY as Fn,G as Mn,bu as ms,aL as zn,bk as On,eZ as An,c1 as Pn,d9 as Tn,e_ as Ln,dp as Rn,aM as Bn,av as $n,dM as In,f as Hs,W as Zs,x as Xs,e2 as Vn,eQ as Un,aA as Se,eL as En,dC as Gn,F as qn,X as Jn}from"./index-DhM1aug3.js";import{u as $e,A as gs,a as Qs,b as Wn,c as Yn}from"./EmptyState-aHnxwGP8.js";import{u as Hn,a as Zn,b as Xn,F as Qn,C as Kn,T as Dn,c as ei,J as si}from"./TypingIndicator-BtMz4VA_.js";import{R as ni,u as Ks,g as ii,h as ri}from"./useCurrentChannelData-CTq_SYHT.js";import{P as Ds}from"./PageHeader-DJMlImL3.js";import{u as ts}from"./useDebounce-DeHc-l-x.js";import{u as en}from"./useGetUserRecords-CVrS3xnU.js";import{M as sn}from"./MessageBox-CmqDQ9AC.js";import{m as nn,b as rn,P as Oe,f as Ae}from"./tabs-Dy4pJYvb.js";import{i as li}from"./switch-CiXi9Z2E.js";import"./index-DKQZRMKb.js";/* empty css                      */import"./DoctypeLinkRenderer-2UyBGAP4.js";import"./useDoctypeMeta-Df8LdZCO.js";import"./skeleton-C82Qe8ow.js";import"./preferences-Dbwk5zts.js";import"./DateSeparator-nqpz_ulG.js";import"./useRavenSettings-BYy_TMW0.js";import"./hover-card-CQZySoZy.js";const ti=({channelID:s,isArchived:n,isMemberAdmin:i})=>n===1?e.jsx(ai,{channelID:s,isMemberAdmin:i}):null,ai=({channelID:s,isMemberAdmin:n})=>e.jsx(t,{direction:"column",align:"center",className:"border border-gray-6 rounded-md bg-surface animate-fadein sm:mb-0 mb-2",p:"4",children:e.jsxs(Ms,{justify:"center",align:"center",children:[e.jsx(x,{as:"span",color:"gray",children:"This channel has been archived."}),n===1?e.jsx(ci,{channelID:s}):null]})}),ci=({channelID:s})=>{const{updateDoc:n,loading:i}=Le(),r=()=>ie(null,null,function*(){return n("Raven Channel",s,{is_archived:0}).then(()=>{U.success("Channel restored.")}).catch(a=>{U.error(a.message)})});return e.jsxs(b,{size:"2",disabled:i,color:"gray",variant:"soft",className:"not-cal",onClick:r,children:[i&&e.jsx(V,{}),"Restore Channel"]})},ln=({channelData:s})=>{const{name:n}=zs(),{channelMembers:i,isLoading:r}=$e(s.name),{onUserType:a,stopTyping:c}=Hn(s.name),[o,h]=u.useState(null),l=f=>{h(f)},d=()=>{h(null)},{mutate:m}=_e(),j=u.useRef(null),y=f=>{m({path:`get_messages_for_channel_${s.name}`},z=>{var Ne,as;if(z&&(z!=null&&z.message.has_new_messages))return z;const ne=(Ne=z==null?void 0:z.message.messages)!=null?Ne:[],ve=[...ne];return f.forEach(ke=>{const Ie=ne.findIndex(on=>on.name===ke.name);Ie!==-1?ve[Ie]=J(O({},ke),{_liked_by:"",is_pinned:0,is_continuation:0}):ve.push(J(O({},ke),{_liked_by:"",is_pinned:0,is_continuation:0}))}),{message:{messages:ve.sort((ke,Ie)=>new Date(Ie.creation).getTime()-new Date(ke.creation).getTime()),has_new_messages:!1,has_old_messages:(as=z==null?void 0:z.message.has_old_messages)!=null?as:!1}}},{revalidate:!1}).then(()=>{var z,ne;(ne=j.current)==null||ne.scrollTo(0,(z=j.current)==null?void 0:z.scrollHeight)}),c(),d()},C=u.useMemo(()=>{var f;return n&&i&&(f=i[n])!=null?f:null},[n,i]),v=u.useRef(null),F=u.useCallback(()=>{var f;(f=v.current)==null||f.onUpArrow()},[]),_=u.useRef(null),S=Os(),M=u.useCallback(()=>{S||setTimeout(()=>{var f;(f=_.current)==null||f.focusEditor()},50)},[S]),{fileInputRef:A,files:T,setFiles:R,removeFile:ee,uploadFiles:w,addFile:se,fileUploadProgress:ge,compressImages:L,setCompressImages:pe}=Zn(s.name),{sendMessage:g,loading:W}=Xn(s.name,w,y,o),X=({selectedMessage:f})=>f?e.jsx(ni,{justify:"between",align:"center",className:"m-2",message:f,children:e.jsx(Pe,{color:"gray",size:"1",variant:"soft",onClick:d,children:e.jsx(mn,{size:"20"})})}):null,{canUserSendMessage:ce,shouldShowJoinBox:p}=u.useMemo(()=>{if(s.is_archived)return{canUserSendMessage:!1,shouldShowJoinBox:!1};if(s.type==="Open")return{canUserSendMessage:!0,shouldShowJoinBox:!1};if(C)return{canUserSendMessage:!0,shouldShowJoinBox:!1};const f=(s==null?void 0:s.is_direct_message)===1||(s==null?void 0:s.is_self_message)===1;return!C&&!f&&s&&!r?{shouldShowJoinBox:!0,canUserSendMessage:!1}:{canUserSendMessage:!1,shouldShowJoinBox:!1}},[C,s,r]),{threadID:I}=ae(),B=u.useCallback(f=>un(As(f.name))==="image",[T]);return e.jsx(di,{children:e.jsxs(Qn,{files:T,ref:A,onFileChange:R,width:I?"w-[calc((100vw-var(--sidebar-width)-var(--space-8))/2)]":void 0,maxFiles:10,maxFileSize:1e7,children:[e.jsx(Kn,{channelID:s.name,scrollRef:j,ref:v,onModalClose:M,pinnedMessagesString:s.pinned_messages_string,replyToMessage:l}),ce&&e.jsxs(Ms,{children:[e.jsx(Dn,{channel:s.name}),e.jsx(ei,{channelID:s.name,fileProps:{fileInputRef:A,addFile:se},ref:_,onUpArrow:F,clearReplyMessage:d,channelMembers:i,onUserType:a,replyMessage:o,sessionStorageKey:`tiptap-${s.name}`,onMessageSend:g,messageSending:W,slotBefore:e.jsxs(t,{direction:"column",justify:"center",hidden:!o&&!T.length,children:[o&&e.jsx(X,{selectedMessage:o}),T&&T.length>0&&e.jsx(t,{gap:"2",width:"100%",align:"stretch",px:"2",p:"2",wrap:"wrap",children:T.map(f=>e.jsx(k,{className:"grow-0",children:e.jsx(jn,{file:f,uploadProgress:ge,removeFile:()=>ee(f.fileID)})},f.fileID))}),T.length!==0&&T.some(f=>B(f))&&e.jsx(oi,{compressImages:L,setCompressImages:pe})]})},s.name)]}),p?e.jsx(si,{channelData:s,user:n}):null,e.jsx(ti,{channelID:s.name,isArchived:s.is_archived,isMemberAdmin:C==null?void 0:C.is_admin})]})})},oi=({compressImages:s,setCompressImages:n})=>e.jsx("div",{className:"px-3",children:e.jsx(ze,{size:"2",weight:"regular",children:e.jsxs(gn,{align:"center",gap:"2",children:[e.jsx(be,{checked:s,onCheckedChange:()=>{n(!s)}}),"Compress Images"]})})}),di=({children:s})=>{const{threadID:n}=ae();return e.jsx("div",{className:Ue("flex flex-col overflow-hidden px-2 pt-16 justify-end h-full",n?"sm:pl-4":"sm:px-4"),children:s})},ps=({channelID:s,channelName:n,type:i,onClose:r})=>{var F;const a=Ps({defaultValues:{channel_name:n}}),{control:c,handleSubmit:o,setValue:h,formState:{errors:l}}=a,{updateDoc:d,loading:m,error:j}=Le(),y=_=>ie(null,null,function*(){return d("Raven Channel",s!=null?s:null,{channel_name:_.channel_name}).then(()=>{U.success("Channel name updated"),r()})}),C=u.useCallback(_=>{var S;h("channel_name",(S=_.target.value)==null?void 0:S.toLowerCase().replace(" ","-"))},[h]),v=P();return e.jsx(Ts,J(O({},a),{children:e.jsxs("form",{onSubmit:o(y),children:[e.jsx(Y,{children:"Rename this channel"}),e.jsxs(t,{gap:"2",direction:"column",width:"100%",children:[e.jsx($,{error:j}),e.jsxs(k,{width:"100%",children:[e.jsx(ze,{htmlFor:"channel_name",isRequired:!0,children:"Name"}),e.jsx(Ls,{name:"channel_name",control:c,rules:{required:"Please add a channel name",maxLength:{value:50,message:"Channel name cannot be more than 50 characters."},minLength:{value:3,message:"Channel name cannot be less than 3 characters."},pattern:{value:/^[a-zA-Z0-9][a-zA-Z0-9-]*$/,message:"Channel name can only contain letters, numbers and hyphens."}},render:({field:_,fieldState:{error:S}})=>e.jsxs(Je,J(O({maxLength:50,required:!0,autoFocus:v,placeholder:"e.g. wedding-gone-wrong, joffrey-tributes",color:S?"red":void 0},_),{"aria-invalid":S?"true":"false",onChange:C,children:[e.jsx(xe,{side:"left",children:e.jsx(D,{type:i})}),e.jsx(xe,{side:"right",children:e.jsx(x,{size:"2",weight:"light",color:"gray",children:50-_.value.length})})]}))}),(l==null?void 0:l.channel_name)&&e.jsx(Me,{children:(F=l.channel_name)==null?void 0:F.message})]})]}),e.jsxs(t,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Ke,{disabled:m,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{type:"submit",disabled:m,children:[m&&e.jsx(V,{className:"text-white"}),m?"Saving":"Save"]})]})]})}))},tn=c=>{var o=c,{channelID:s,channel_name:n,channelType:i,buttonVisible:r=!1}=o,a=Qe(o,["channelID","channel_name","channelType","buttonVisible"]);const[h,l]=u.useState(!1),d=()=>{l(!1)};return P()?e.jsxs(H,{open:h,onOpenChange:l,children:[e.jsx(Re,{children:e.jsx(Pe,J(O({variant:"ghost",color:"gray",className:Ue(r?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},a),{children:e.jsx(hs,{size:"14"})}))}),e.jsx(Z,{className:E,children:e.jsx(ps,{channelID:s,channelName:n,onClose:d,type:i})})]}):e.jsxs(G,{open:h,onOpenChange:l,children:[e.jsx(je,{asChild:!0,children:e.jsx(Pe,J(O({variant:"ghost",color:"gray",className:Ue(r?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},a),{children:e.jsx(hs,{size:"14"})}))}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(ps,{channelID:s,channelName:n,onClose:d,type:i})})})]})},vs=u.lazy(()=>pn(()=>import("./ViewFilesContent-Bg9wTPwD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))),hi=({open:s,setOpen:n})=>P()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Z,{className:`${E} min-w-[64rem]`,children:e.jsx(u.Suspense,{fallback:e.jsx(t,{align:"center",justify:"center",className:"h-64",children:e.jsx(V,{})}),children:e.jsx(vs,{})})})}):e.jsx(G,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(t,{align:"center",justify:"center",className:"h-[80vh]",children:e.jsx(V,{})}),children:e.jsx(vs,{})})})}),xi=({open:s,setOpen:n})=>{const i=u.useCallback(()=>{n(!1)},[n]);return P()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Z,{className:"static",children:e.jsx(gs,{onClose:i})})}):e.jsx(G,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-96 px-1 overflow-auto",children:e.jsx(gs,{onClose:i})})})})},ui=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:i,isSaved:r,input:a,fromFilter:c,withFilter:o,inFilter:h})=>{var L,pe;const[l,d]=u.useState(a),m=ts(l),{channels:j,dm_channels:y}=u.useContext(De),[C,v]=u.useState(c),[F,_]=u.useState(h||((L=y.find(g=>g.peer_user_id==o))==null?void 0:L.name)),[S,M]=u.useState(),[A,T]=u.useState(),R=en(),ee=g=>{d(g.target.value)},{data:w,error:se,isLoading:ge}=we("raven.api.search.get_search_result",{filter_type:"File",search_text:m,from_user:C==="any"?void 0:C,in_channel:F==="any"?void 0:F,saved:r,date:S,file_type:A==="any"?void 0:A,message_type:A==="any"||A===void 0?void 0:A==="image"?"Image":"File",my_channel_only:n},void 0,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(t,{direction:"column",gap:"2",children:[e.jsxs(t,{align:"center",gap:"2",children:[e.jsxs(Je,{style:{width:"80%"},onChange:ee,type:"text",placeholder:"Search messages",value:l,autoFocus:!0,children:[e.jsx(xe,{side:"left",children:e.jsx(We,{})}),e.jsx(xe,{side:"right",children:ge&&e.jsx(V,{})})]}),e.jsxs(re,{value:A,onValueChange:T,children:[e.jsx(le,{placeholder:"File Type",className:"min-w-[20%]"}),e.jsx(te,{className:"z-50",children:e.jsxs(Q,{children:[e.jsx(K,{children:"File Type"}),e.jsx(N,{value:"any",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(k,{width:"16px",children:"ðŸ¤·ðŸ»â€â™€ï¸"}),"Any"]})}),e.jsx(N,{value:"pdf",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(fe,{ext:"pdf"}),"PDF"]})}),e.jsx(N,{value:"doc",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(fe,{ext:"doc"}),"Documents (.doc)"]})}),e.jsx(N,{value:"ppt",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(fe,{ext:"ppt"}),"Presentations (.ppt)"]})}),e.jsx(N,{value:"xls",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(fe,{ext:"xls"}),"Spreadsheets (.xls)"]})}),e.jsx(N,{value:"image",children:e.jsxs(t,{align:"center",gap:"1",children:[e.jsx(fe,{ext:"jpg"}),"Images"]})})]})})]})]}),e.jsxs(es,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(re,{value:C,onValueChange:v,children:[e.jsx(le,{placeholder:"From",id:"from-filter"}),e.jsxs(te,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(Q,{children:[e.jsx(K,{children:"Message from"}),Object.values(R).map(g=>e.jsx(N,{textValue:g.full_name,value:g.name,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(ue,{src:g.user_image,alt:g.full_name}),e.jsx(x,{children:g.full_name})]})},g.name))]})]})]}),e.jsxs(re,{value:F,onValueChange:_,children:[e.jsx(le,{placeholder:"Channel / DM"}),e.jsxs(te,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(Q,{children:[e.jsx(K,{children:"Channels"}),j.map(g=>e.jsx(N,{value:g.name,children:e.jsxs(t,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(D,{type:g.type}),e.jsx(x,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:g.channel_name})]})},g.name))]}),e.jsx(Rs,{}),e.jsxs(Q,{children:[e.jsx(K,{children:"Direct Messages"}),y.map(g=>{var W,X,ce,p,I,B,f;return e.jsx(N,{value:g.name,textValue:(X=(W=R[g.peer_user_id])==null?void 0:W.full_name)!=null?X:g.peer_user_id,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(ue,{src:(ce=R[g.peer_user_id])==null?void 0:ce.user_image,alt:(I=(p=R[g.peer_user_id])==null?void 0:p.full_name)!=null?I:g.peer_user_id}),e.jsx(x,{children:(f=(B=R[g.peer_user_id])==null?void 0:B.full_name)!=null?f:g.peer_user_id})]})},g.name)})]})]})]}),e.jsxs(re,{value:S,onValueChange:M,children:[e.jsx(le,{placeholder:"Date"}),e.jsx(te,{className:"z-50",children:e.jsxs(Q,{children:[e.jsx(K,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),an.map(g=>e.jsx(N,{value:g.value,children:g.label},g.value))]})})]}),e.jsx(x,{as:"label",size:"2",children:e.jsxs(t,{gap:"2",children:[e.jsx(be,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(x,{as:"label",size:"2",children:e.jsxs(t,{gap:"2",children:[e.jsx(be,{checked:r,onCheckedChange:i})," Saved"]})})]})]}),e.jsxs(Bs,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx($,{error:se}),((pe=w==null?void 0:w.message)==null?void 0:pe.length)===0&&e.jsx(Qs,{}),w!=null&&w.message&&w.message.length>0?e.jsx(t,{direction:"column",gap:"4",children:w.message.map(g=>{var W;return e.jsxs(t,{gap:"3",align:"center",children:[e.jsxs(t,{align:"center",justify:"center",className:"w-[10%] sm:w-[5%]",children:[g.message_type==="File"&&e.jsx(fe,{ext:As(g.file),size:"24"}),g.message_type==="Image"&&e.jsx("img",{src:g.file,alt:"File preview",className:"rounded-md object-cover",style:{width:"36px",height:"36px"}})]}),e.jsxs(t,{direction:"column",className:"w-[94%]",children:[g.file&&e.jsx($s,{weight:"medium",size:"1",href:g.file,target:"_blank",children:vn(g.file)}),R&&e.jsxs(x,{size:"1",color:"gray",children:["Shared by ",(W=Object.values(R).find(X=>X.name===g.owner))==null?void 0:W.full_name," on ",e.jsx(Is,{date:g.creation})]})]})]},g.name)})}):null]})]})},ji=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:i,isSaved:r,input:a,fromFilter:c,inFilter:o,withFilter:h,onClose:l})=>{var W,X,ce;const[d,m]=u.useState(a),j=ts(d),{channels:y,dm_channels:C}=u.useContext(De),[v,F]=u.useState(c),[_,S]=u.useState(o||((W=C.find(p=>p.peer_user_id==h))==null?void 0:W.name)),[M,A]=u.useState(),T=Be(),R=(p,I,B)=>{l();let f=`/channel/${p}`;B&&(f=`/${B}/${p}`),T({pathname:f,search:`message_id=${I}`})},ee=(p,I,B)=>ie(null,null,function*(){R(I,p,B)}),w=en(),se=p=>{m(p.target.value)},ge=u.useMemo(()=>{const p=_!==void 0,I=v!=="any"&&v!==void 0,B=M!=="any"&&M!==void 0;return j.length>2||p||I||B||n===!0},[j,_,v,n,M]),{data:L,error:pe,isLoading:g}=we("raven.api.search.get_search_result",{filter_type:"Message",search_text:j,from_user:v==="any"?void 0:v,in_channel:_==="any"?void 0:_,saved:r,date:M==="any"?void 0:M,my_channel_only:n},ge?void 0:null,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(t,{direction:"column",gap:"2",children:[e.jsxs(Je,{onChange:se,type:"text",placeholder:"Search messages",value:d,autoFocus:!0,children:[e.jsx(xe,{side:"left",children:e.jsx(We,{})}),e.jsx(xe,{side:"right",children:g&&e.jsx(V,{})})]}),e.jsxs(es,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(re,{value:v,onValueChange:F,children:[e.jsx(le,{placeholder:"From",id:"from-filter"}),e.jsxs(te,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(Q,{children:[e.jsx(K,{children:"Message from"}),Object.values(w).map(p=>e.jsx(N,{textValue:p.full_name,value:p.name,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(ue,{src:p.user_image,alt:p.full_name}),e.jsx(x,{children:p.full_name})]})},p.name))]})]})]}),e.jsxs(re,{value:_,onValueChange:S,children:[e.jsx(le,{placeholder:"Channel / DM"}),e.jsxs(te,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(Q,{children:[e.jsx(K,{children:"Channels"}),y.map(p=>e.jsx(N,{value:p.name,children:e.jsxs(t,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(D,{type:p.type}),e.jsx(x,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:p.channel_name})]})},p.name))]}),e.jsx(Rs,{}),e.jsxs(Q,{children:[e.jsx(K,{children:"Direct Messages"}),C.map(p=>{var I,B,f,z,ne,ve,Ne;return e.jsx(N,{value:p.name,textValue:(B=(I=w[p.peer_user_id])==null?void 0:I.full_name)!=null?B:p.peer_user_id,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(ue,{src:(f=w[p.peer_user_id])==null?void 0:f.user_image,alt:(ne=(z=w[p.peer_user_id])==null?void 0:z.full_name)!=null?ne:p.peer_user_id}),e.jsx(x,{children:(Ne=(ve=w[p.peer_user_id])==null?void 0:ve.full_name)!=null?Ne:p.peer_user_id})]})},p.name)})]})]})]}),e.jsxs(re,{value:M,onValueChange:A,children:[e.jsx(le,{placeholder:"Date"}),e.jsx(te,{className:"z-50",children:e.jsxs(Q,{children:[e.jsx(K,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),an.map(p=>e.jsx(N,{value:p.value,children:p.label},p.value))]})})]}),e.jsx(x,{as:"label",size:"2",children:e.jsxs(t,{gap:"2",children:[e.jsx(be,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(x,{as:"label",size:"2",children:e.jsxs(t,{gap:"2",children:[e.jsx(be,{checked:r,onCheckedChange:i})," Saved"]})})]})]}),e.jsxs(Bs,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx($,{error:pe}),((X=L==null?void 0:L.message)==null?void 0:X.length)===0&&e.jsx(Qs,{}),(ce=L==null?void 0:L.message)!=null&&ce.length&&(L==null?void 0:L.message.length)>0?e.jsx(t,{direction:"column",gap:"2",children:L.message.map(p=>e.jsx(sn,{message:J(O({},p),{message_type:"Text",is_continuation:0,is_reply:0,_liked_by:"[]"}),handleScrollToMessage:ee},p.name))}):!ge&&e.jsx(k,{className:"text-center",py:"8",children:e.jsx(x,{size:"2",className:"text-gray-11",children:"Add a search query above to see results."})})]})]})};function mi(s){const{isOpen:n,onClose:i}=s,r=c=>{c||i()};return P()?e.jsx(H,{open:n,onOpenChange:r,children:e.jsx(Z,{className:E,style:{width:"80vw",maxWidth:"80vw"},children:e.jsx(fs,O({},s))})}):e.jsx(G,{open:n,onClose:i,children:e.jsx(q,{children:e.jsx("div",{className:"h-[75vh] pb-24 overflow-y-scroll",children:e.jsx(fs,O({},s))})})})}const fs=s=>{const[n,{toggle:i}]=oe(),[r,{toggle:a}]=oe(),{tabIndex:c,input:o,fromFilter:h,withFilter:l,inFilter:d,onClose:m}=s;return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:"Search Results"}),e.jsx(t,{direction:"column",gap:"2",children:e.jsxs(nn,{defaultValue:c.toString(),children:[e.jsxs(rn,{children:[e.jsx(Oe,{value:"0",children:"Messages"}),e.jsx(Oe,{value:"1",children:"Files"})]}),e.jsxs(k,{pt:"3",pb:"2",children:[e.jsx(Ae,{value:"0",children:e.jsx(ji,{onToggleMyChannels:i,isOnlyInMyChannels:n,onToggleSaved:a,isSaved:r,input:o,fromFilter:h,inFilter:d,withFilter:l,onClose:m})}),e.jsx(Ae,{value:"1",children:e.jsx(ui,{onToggleMyChannels:i,isOnlyInMyChannels:n,onToggleSaved:a,isSaved:r,input:o,fromFilter:h,inFilter:d,withFilter:l})})]})]})})]})},an=[{label:"Today",value:ye(0)},{label:"Yesterday",value:ye(-1)},{label:"Last 7 days",value:ye(-6)},{label:"Last 30 days",value:ye(-29)},{label:"Last three months",value:ye(-89)},{label:"Last 12 months",value:ye(-364)}];function ye(s){const n=new Date;n.setDate(n.getDate()+s);const i=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${i}-${r}-${a} 00:00:00`}const ys=({onClose:s,channelData:n,isDrawer:i,closeDetailsModal:r})=>{const{call:a,loading:c,error:o}=ss("raven.api.raven_channel.leave_channel"),h=Be(),{mutate:l}=u.useContext(De),d=()=>ie(null,null,function*(){return a({channel_id:n==null?void 0:n.name}).then(()=>{U("You have left the channel"),s(),l(),h("../"),r()}).catch(C=>{U.error("Could not leave channel",{description:Vs(C)})})}),m=i?Y:Te,j=i?u.Fragment:Ye,y=i?u.Fragment:He;return e.jsxs(e.Fragment,{children:[e.jsx(m,{children:e.jsxs(t,{gap:"1",children:[e.jsx(x,{children:"Leave "}),e.jsx(D,{type:n==null?void 0:n.type,className:"mt-1"}),e.jsxs(x,{children:[n==null?void 0:n.channel_name,"?"]})]})}),e.jsxs(t,{direction:"column",gap:"2",children:[e.jsx($,{error:o}),(n==null?void 0:n.type)==="Private"?e.jsx(x,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to see any of its messages. To rejoin, youâ€™ll need to be invited."}):e.jsx(x,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to send anymore messages, you will have to rejoin the channel to continue participation."})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(j,{children:e.jsx(b,{variant:"soft",color:"gray",onClick:s,children:"Cancel"})}),e.jsx(y,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:d,disabled:c,children:[c&&e.jsx(V,{className:"text-white"}),c?"Leaving":"Leave"]})})]})]})},gi=({channelData:s,onClose:n})=>{const[i,r]=u.useState(!1),a=()=>{r(!1)};return P()?e.jsxs(Ze,{open:i,onOpenChange:r,children:[e.jsx(ns,{children:e.jsx(b,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(Xe,{className:E,children:e.jsx(ys,{onClose:a,closeDetailsModal:n,channelData:s})})]}):e.jsxs(G,{open:i,onOpenChange:r,children:[e.jsx(je,{asChild:!0,children:e.jsx(b,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(ys,{onClose:a,isDrawer:!0,closeDetailsModal:n,channelData:s})})})]})},pi=({channelID:s,channelMember:n})=>{const{mutate:i}=_e(),r=fn(),{call:a}=ss("raven.api.notification.toggle_push_notification_for_channel"),c=()=>{n&&a({member:n==null?void 0:n.channel_member_name,allow_notifications:n!=null&&n.allow_notifications?0:1}).then(o=>{o&&o.message&&i(["channel_members",s],h=>({message:J(O({},h.message),{[n.name]:J(O({},h.message[n.name]),{allow_notifications:o.message.allow_notifications})})}),{revalidate:!1})}).catch(()=>{U.error("Failed to update notification settings")})};return n?e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(t,{justify:"between",children:[e.jsxs(t,{direction:"column",gap:"1",children:[e.jsx(x,{as:"label",weight:"medium",htmlFor:"channel_push",size:"2",children:"Push Notifications"}),r?null:e.jsx(x,{size:"1",color:"gray",children:"Push notification is not enabled for the site. Please contact your administrator."})]}),e.jsx(t,{gap:"2",children:e.jsx(li,{size:"2",checked:!!n.allow_notifications,id:"channel_push",onCheckedChange:c,disabled:!r})})]})}):null},vi=({channelData:s,channelMembers:n,onClose:i})=>{var h;const{currentUser:r}=u.useContext(me),a=is(s.owner),{channelMember:c,isAdmin:o}=u.useMemo(()=>{const l=n[r];return{channelMember:l,isAdmin:(l==null?void 0:l.is_admin)==1}},[n,r]);return e.jsxs(t,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(t,{justify:"between",children:[e.jsxs(t,{direction:"column",children:[e.jsx(x,{weight:"medium",size:"2",children:"Channel name"}),e.jsxs(t,{gap:"1",pt:"1",align:"center",children:[e.jsx(D,{type:s.type,size:"14"}),e.jsx(x,{size:"2",children:s==null?void 0:s.channel_name})]})]}),e.jsx(tn,{channelID:s.name,channel_name:s.channel_name,className:"",channelType:s.type,disabled:s.is_archived==1&&!o})]})}),e.jsx(pi,{channelID:s.name,channelMember:c}),e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(t,{justify:"between",children:[e.jsxs(t,{direction:"column",gap:"1",children:[e.jsx(x,{weight:"medium",size:"2",children:"Channel description"}),e.jsx(x,{size:"1",color:"gray",children:s&&s.channel_description&&s.channel_description.length>0?s.channel_description:"No description"})]}),e.jsx(Wn,{channelData:s,is_in_box:!0,disabled:s.is_archived==1&&!o})]}),e.jsx(he,{className:"w-full"}),e.jsxs(t,{direction:"column",gap:"1",children:[e.jsx(x,{weight:"medium",size:"2",children:"Created by"}),e.jsxs(t,{gap:"1",children:[(s==null?void 0:s.owner)&&e.jsx(x,{size:"1",children:(h=a==null?void 0:a.full_name)!=null?h:s==null?void 0:s.owner}),s.creation&&e.jsxs(x,{size:"1",color:"gray",as:"span",children:["on ",e.jsx(Is,{date:s==null?void 0:s.creation})]})]})]}),c&&Object.keys(n).length>1&&(s==null?void 0:s.type)!="Open"&&s.is_archived==0&&e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-full"}),e.jsx(gi,{channelData:s,onClose:i})]})]})})]})},fi=({user:s,channelID:n,updateMembers:i})=>{const{updateDoc:r,loading:a,reset:c}=Le(),{data:o}=we("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:n,user_id:s.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),h=l=>ie(null,null,function*(){var d;return r("Raven Channel Member",(d=o==null?void 0:o.message.name)!=null?d:"",{is_admin:l}).then(()=>{U.success("Member has been made an admin"),i(),c()}).catch(m=>{U.error("Failed to update member status",{description:Vs(m)}),c()})});return s.is_admin?e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>h(0),children:[e.jsx(yn,{}),a?"Updating member status...":"Dismiss admin"]}):e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>h(1),children:[e.jsx(Us,{}),a?"Updating member status...":"Make channel admin"]})},bs=({onClose:s,member:n})=>{const{deleteDoc:i,error:r,loading:a}=Es(),{channelID:c}=ae(),{channel:o}=Ks(c!=null?c:""),{mutate:h}=_e(),l=o==null?void 0:o.channelData,{data:d,error:m}=we("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:c,user_id:n==null?void 0:n.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),j=()=>ie(null,null,function*(){return i("Raven Channel Member",d==null?void 0:d.message.name).then(()=>{U.success("Removed"),s(),h(["channel_members",c])})});return P()?e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsxs(t,{gap:"1",children:[e.jsxs(x,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(l==null?void 0:l.type)&&e.jsx(D,{type:l==null?void 0:l.type,className:"mt-1"}),e.jsxs(x,{children:[l==null?void 0:l.channel_name,"?"]})]})}),e.jsxs(t,{direction:"column",gap:"2",children:[e.jsx($,{error:m}),e.jsx($,{error:r}),e.jsx(x,{size:"2",children:"This person will no longer have access to the channel."})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(Ye,{children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(He,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:j,disabled:a,children:[a&&e.jsx(V,{className:"text-white"}),a?"Removing":"Remove"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs(t,{gap:"1",children:[e.jsxs(x,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(l==null?void 0:l.type)&&e.jsx(D,{type:l==null?void 0:l.type,className:"mt-1"}),e.jsxs(x,{children:[l==null?void 0:l.channel_name,"?"]})]})}),e.jsxs(t,{direction:"column",gap:"2",children:[e.jsx($,{error:m}),e.jsx($,{error:r}),e.jsx(x,{size:"1",children:"This person will no longer have access to the channel and can only rejoin by invitation."})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(b,{variant:"soft",color:"gray",onClick:s,children:"Cancel"}),e.jsxs(b,{variant:"solid",color:"red",onClick:j,disabled:a,children:[a&&e.jsx(V,{className:"text-white"}),a?"Removing":"Remove"]})]})]})},yi=()=>{const[s,n]=u.useState(null),i=u.useCallback(()=>{n(null)},[]);return{member:s,setRemoveMember:n,isOpen:s!==null,onClose:i}},bi=({member:s,isOpen:n,onClose:i})=>P()?e.jsx(Ze,{open:n,onOpenChange:i,children:e.jsx(Xe,{className:E,children:s&&e.jsx(bs,{onClose:i,member:s})})}):e.jsx(G,{open:n,children:e.jsx(q,{children:e.jsx("div",{className:"min-h-48",children:s&&e.jsx(bs,{onClose:i,member:s})})})}),Ci=({channelData:s,updateMembers:n,selectedMember:i})=>{const o=yi(),{setRemoveMember:r}=o,a=Qe(o,["setRemoveMember"]),c=()=>{r(i)};return e.jsxs(e.Fragment,{children:[e.jsxs(Gs,{children:[e.jsx(qs,{children:e.jsx(b,{variant:"ghost",color:"gray",className:"hover:bg-slate-3 cursor-pointer",size:"1",children:e.jsx(bn,{fontSize:"1rem"})})}),e.jsxs(Js,{className:"z-50",children:[e.jsx(de,{children:e.jsx(fi,{user:i,channelID:s.name,updateMembers:n})}),e.jsxs(de,{color:"red",onClick:c,className:"flex items-center gap-2",children:[e.jsx(Cn,{}),"Remove from channel"]})]})]}),e.jsx(bi,O({},a))]})},_i=({channelData:s,channelMembers:n,activeUsers:i,updateMembers:r})=>{const[a,c]=u.useState(""),o=ts(a,50),h=m=>{c(m.target.value)},{currentUser:l}=u.useContext(me),d=u.useMemo(()=>!!n[l],[l,n]);return e.jsxs(t,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsxs(t,{gap:"2",justify:"between",children:[e.jsx("div",{className:"w-full sm:w-full",children:e.jsx(Je,{autoFocus:!0,placeholder:"Find members",onChange:h,value:a,children:e.jsx(xe,{side:"left",children:e.jsx(We,{})})})}),d&&s.type!=="Open"&&s.is_archived==0&&e.jsx("div",{children:e.jsx(Yn,{channelData:s,variant:"soft",size:"2"})})]}),e.jsx(wi,{channelData:s,channelMembers:n,activeUsers:i,updateMembers:r,input:o})]})},wi=({channelData:s,channelMembers:n,activeUsers:i,updateMembers:r,input:a})=>{const{currentUser:c}=u.useContext(me),o=u.useMemo(()=>{const l=Object.values(n);if(!a)return l;const d=a.toLowerCase();return l.filter(m=>{var j;return(j=m==null?void 0:m.full_name)==null?void 0:j.toLowerCase().includes(d)})},[a,n]),h=u.useMemo(()=>!!(n[c]&&(n[c].is_admin==1||Ws())),[c,n]);return e.jsx(k,{className:"overflow-hidden overflow-y-scroll",children:e.jsx(t,{direction:"column",gap:"2",children:o.length>0?e.jsx(t,{direction:"column",children:o.map(l=>{var d,m;return e.jsx(k,{className:"hover:bg-slate-3 rounded-md",children:e.jsxs(t,{justify:"between",className:"pr-3",children:[e.jsxs(t,{className:"p-2",gap:"3",children:[e.jsx(ue,{src:(d=l.user_image)!=null?d:"",alt:l.full_name,size:"2",isActive:i.includes(l.name),availabilityStatus:l.availability_status}),e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(x,{size:"2",weight:"medium",children:l.first_name}),i.includes(l.name)?e.jsx(xs,{color:"green"}):e.jsx(xs,{}),e.jsxs(t,{gap:"1",children:[e.jsx(x,{weight:"light",size:"1",children:l.full_name}),l.name===c&&e.jsx(x,{weight:"light",size:"1",children:"(You)"}),((m=n[l.name])==null?void 0:m.is_admin)==1&&e.jsx(t,{align:"center",children:e.jsx(Us,{color:"#FFC53D"})})]})]})]}),n[c]&&h&&(s==null?void 0:s.type)!=="Open"&&s.is_archived==0&&e.jsx(t,{align:"center",children:e.jsx(Ci,{channelData:s,updateMembers:r,selectedMember:l})})]})},l.name)})}):e.jsx(k,{className:"text-center h-10",children:e.jsxs(x,{size:"1",children:["No matches found for ",e.jsx("strong",{children:a})]})})})})},Cs=({onClose:s,onCloseViewDetails:n,channelData:i,isDrawer:r})=>{const{updateDoc:a,loading:c,error:o}=Le(),h=Be(),l=()=>{var y;a("Raven Channel",(y=i==null?void 0:i.name)!=null?y:"",{is_archived:1}).then(()=>{s(),n(),h(`/${i.workspace}`),U("Channel archived")})},d=r?Y:Te,m=r?u.Fragment:Ye,j=r?u.Fragment:He;return e.jsxs(e.Fragment,{children:[r?e.jsx(d,{children:"Archive this channel? "}):e.jsx(Te,{children:"Archive this channel? "}),e.jsxs(t,{direction:"column",gap:"4",children:[e.jsx($,{error:o}),e.jsxs(x,{size:"2",children:["Please understand that when you archive ",e.jsx("strong",{children:i==null?void 0:i.channel_name}),":"]}),e.jsx(t,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(x,{size:"2",children:"It will be removed from your channel list"})}),e.jsx("li",{children:e.jsx(x,{size:"2",children:"No one will be able to send messages to this channel"})})]})}),e.jsx(x,{size:"2",children:"You will still be able to find the channelâ€™s contents via search. And you can always unarchive the channel in the future, if you want."})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(m,{children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(j,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:l,disabled:c,children:[c&&e.jsx(V,{className:"text-white"}),c?"Archiving":"Archive"]})})]})]})},Ni=({onClose:s,channelData:n,allowSettingChange:i})=>{const[r,a]=u.useState(!1),c=()=>{a(!1)};return P()?e.jsxs(Ze,{open:r,onOpenChange:a,children:[e.jsx(ns,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!i,children:[e.jsx(us,{}),"Archive channel"]})}),e.jsx(Xe,{className:E,children:e.jsx(Cs,{onClose:c,onCloseViewDetails:s,channelData:n})})]}):e.jsxs(G,{open:r,onOpenChange:a,children:[e.jsx(je,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!i,children:[e.jsx(us,{}),"Archive channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Cs,{onClose:c,isDrawer:!0,onCloseViewDetails:s,channelData:n})})})]})},Ce=({onClose:s,channelData:n,newChannelType:i})=>{const{mutate:r}=_e(),{updateDoc:a,loading:c,error:o}=Le(),h=l=>{var d;a("Raven Channel",(d=n==null?void 0:n.name)!=null?d:null,{type:l}).then(()=>{r(["channel_members",n.name]),U.success("Channel changed to "+l.toLocaleLowerCase()),s()})};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:["Change to a ",i.toLocaleLowerCase()," channel?"]}),e.jsxs(t,{gap:"2",direction:"column",width:"100%",children:[e.jsx($,{error:o}),i==="Public"&&e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(x,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a public channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(x,{size:"1",children:"Anyone from your organisation can join this channel and view its message history."})}),e.jsx("li",{children:e.jsx(x,{size:"1",children:"If you make this channel private, it will be visible to anyone who has joined the channel up until that point."})})]})]}),i==="Private"&&e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(x,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a private channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(x,{size:"1",children:"No changes will be made to the channel's history or members"})}),e.jsx("li",{children:e.jsx(x,{size:"1",children:"All files shared in this channel will become private and will be accessible only to the channel members"})})]})]}),i==="Open"&&e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(x,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a open channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(x,{size:"1",children:"Everyone from your organisation will become a channel member and will be able to view its message history."})}),e.jsx("li",{children:e.jsx(x,{size:"1",children:"If you later intend to make this private you will have to manually remove members that should not have access to this channel."})})]})]})]}),e.jsxs(t,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Ke,{disabled:c,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{onClick:()=>h(i),disabled:c,children:[c&&e.jsx(V,{className:"text-white"}),c?"Saving":`Change to ${i.toLocaleLowerCase()}`]})]})]})},ki=({channelData:s,allowSettingChange:n})=>e.jsxs(e.Fragment,{children:[s.type==="Public"&&e.jsxs(e.Fragment,{children:[e.jsx(_s,{channelData:s,allowSettingChange:n}),e.jsx(he,{className:"w-full"})]}),s.type==="Public"&&e.jsx(ws,{channelData:s,allowSettingChange:n}),s.type==="Private"&&e.jsxs(e.Fragment,{children:[e.jsx(_s,{channelData:s,allowSettingChange:n}),e.jsx(he,{className:"w-full"})]}),s.type==="Private"&&e.jsx(Ns,{channelData:s,allowSettingChange:n}),s.type==="Open"&&e.jsxs(e.Fragment,{children:[e.jsx(ws,{channelData:s,allowSettingChange:n}),e.jsx(he,{className:"w-full"})]}),s.type==="Open"&&e.jsx(Ns,{channelData:s,allowSettingChange:n})]}),_s=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),a=()=>{r(!1)};return P()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(Ee,{}):e.jsx(Ge,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(Z,{className:E,children:e.jsx(Ce,{newChannelType:s.type==="Public"?"Private":"Public",onClose:a,channelData:s})})]}):e.jsxs(G,{open:i,onOpenChange:r,children:[e.jsx(je,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(Ee,{}):e.jsx(Ge,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Ce,{newChannelType:s.type==="Public"?"Private":"Public",onClose:a,channelData:s})})})]})},ws=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),a=()=>{r(!1)};return P()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ge,{}):e.jsx(qe,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(Z,{className:E,children:e.jsx(Ce,{newChannelType:s.type==="Open"?"Public":"Open",onClose:a,channelData:s})})]}):e.jsxs(G,{open:i,onOpenChange:r,children:[e.jsx(je,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ge,{}):e.jsx(qe,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Ce,{newChannelType:s.type==="Open"?"Public":"Open",onClose:a,channelData:s})})})]})},Ns=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),a=()=>{r(!1)};return P()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Re,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ee,{}):e.jsx(qe,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(Z,{className:E,children:e.jsx(Ce,{newChannelType:s.type==="Open"?"Private":"Open",onClose:a,channelData:s})})]}):e.jsxs(G,{open:i,onOpenChange:r,children:[e.jsx(je,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ee,{}):e.jsx(qe,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Ce,{newChannelType:s.type==="Open"?"Private":"Open",onClose:a,channelData:s})})})]})},ks=({onClose:s,onCloseParent:n,isDrawer:i,channelData:r})=>{const{mutate:a}=_e(),{deleteDoc:c,error:o,loading:h,reset:l}=Es(),d=()=>{s(),l()},m=Be(),j=rs(ls),y=_n(Ys),C=()=>{r!=null&&r.name&&c("Raven Channel",r.name).then(()=>{a(["channel_members",r.name],void 0,{revalidate:!1}),s(),n(),y(),m(j?`/${j}`:"/"),U(`Channel ${r.channel_name} deleted.`)})},[v,F]=u.useState(!1),_=i?Y:Te,S=i?u.Fragment:Ye,M=i?u.Fragment:He;return e.jsxs(e.Fragment,{children:[e.jsx(_,{children:"Delete this channel?"}),e.jsxs(t,{direction:"column",gap:"4",children:[e.jsx($,{error:o}),e.jsxs(wn,{color:"red",size:"1",children:[e.jsx(Nn,{children:e.jsx(kn,{size:"18"})}),e.jsx(Sn,{children:"This action is permanent and cannot be undone."})]}),e.jsx(x,{size:"2",children:"When you delete a channel, all messages from this channel will be removed immediately."}),e.jsx(t,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(x,{as:"span",size:"2",children:"All messages, including files and images will be removed"})}),e.jsx("li",{children:e.jsx(x,{as:"span",size:"2",children:"You can archive this channel instead to preserve your messages"})})]})}),e.jsx(x,{size:"2",as:"label",children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(be,{onClick:()=>F(!v),color:"red"}),"Yes, I understand, permanently delete this channel"]})})]}),e.jsxs(t,{gap:"3",mt:"4",justify:"end",children:[e.jsx(S,{children:e.jsx(b,{variant:"soft",color:"gray",onClick:d,children:"Cancel"})}),e.jsx(M,{children:e.jsxs(b,{variant:"solid",color:"red",onClick:C,disabled:!v||h,children:[h&&e.jsx(V,{className:"text-white"}),h?"Deleting":"Delete"]})})]})]})},Si=({onClose:s,channelData:n,allowSettingChange:i})=>{const[r,a]=u.useState(!1),c=()=>{a(!1)};return P()?e.jsxs(Ze,{open:r,onOpenChange:a,children:[e.jsx(ns,{children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none rounded-b-md",disabled:!i,children:[e.jsx(js,{}),"Delete channel"]})}),e.jsx(Xe,{className:E,children:e.jsx(ks,{onClose:c,onCloseParent:s,channelData:n})})]}):e.jsxs(G,{open:r,onOpenChange:a,children:[e.jsx(je,{asChild:!0,children:e.jsxs(b,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none",disabled:!i,children:[e.jsx(js,{}),"Delete channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(ks,{onClose:c,isDrawer:!0,onCloseParent:s,channelData:n})})})]})},Fi=({onClose:s,channelData:n,allowSettingChange:i})=>e.jsx("div",{className:"h-96",children:e.jsxs(t,{direction:"column",gap:"3",children:[e.jsx(k,{className:"rounded-md border border-gray-6",children:e.jsxs(t,{direction:"column",children:[e.jsx(ki,{channelData:n,allowSettingChange:i}),e.jsx(he,{className:"w-full"}),e.jsx(Ni,{onClose:s,channelData:n,allowSettingChange:i}),e.jsx(he,{className:"w-full"}),e.jsx(Si,{onClose:s,channelData:n,allowSettingChange:i})]})}),e.jsxs(t,{direction:"column",gap:"1",children:[e.jsx(x,{size:"1",weight:"light",className:"px-1",children:"Only channel admins or Raven admins are allowed to change the channel settings"}),e.jsx(x,{size:"1",weight:"light",className:"px-1",children:"General channel cannot be modified/ removed"})]})]})}),Mi=({open:s,setOpen:n,channelData:i})=>P()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Z,{className:E,children:e.jsx(Ss,{open:s,setOpen:n,channelData:i})})}):e.jsx(G,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx(Ss,{open:s,setOpen:n,channelData:i})})}),Ss=({setOpen:s,channelData:n})=>{var j;const{data:i}=Fn(),r=(j=i==null?void 0:i.message)!=null?j:[],{channelMembers:a,mutate:c}=$e(n.name),o=Object.keys(a).length,{currentUser:h}=u.useContext(me),l=n.type,d=u.useCallback(()=>{s(!1)},[s]),m=u.useMemo(()=>{var y;return!!(((y=a[h])==null?void 0:y.is_admin)==1||a[h]&&Ws())},[a,h]);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs(t,{align:"center",gap:"2",children:[e.jsx(D,{className:"mt-1",type:l}),e.jsx(x,{children:n.channel_name})]})}),e.jsx(nn,{defaultValue:"About",children:e.jsxs(t,{direction:"column",gap:"4",children:[e.jsxs(rn,{children:[e.jsx(Oe,{value:"About",children:"About"}),e.jsx(Oe,{value:"Members",children:e.jsxs(t,{gap:"2",children:[e.jsx(x,{children:"Members"}),e.jsx(x,{children:o})]})}),e.jsx(Oe,{value:"Settings",children:"Settings"})]}),e.jsxs(k,{children:[e.jsx(Ae,{value:"About",children:e.jsx(vi,{channelData:n,channelMembers:a,onClose:d})}),e.jsx(Ae,{value:"Members",children:e.jsx(_i,{channelData:n,channelMembers:a,activeUsers:r,updateMembers:c})}),e.jsx(Ae,{value:"Settings",children:e.jsx(Fi,{channelData:n,onClose:d,allowSettingChange:m})})]})]})})]})};function zi(s){return Mn({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M960.496 415.056l-82.129-18.224c-6.4-20.48-14.784-40.08-24.4-58.927l44.431-74.032c16.592-26.512 24.976-65.52 0-90.512l-45.28-45.248c-24.976-24.992-67.151-20.496-92.623-2.832l-72.032 45.887c-18.689-9.696-38.225-18-58.529-24.56l-18.431-83.12C605.999 33.009 579.343 0 543.999 0h-64c-35.344 0-57.008 33.504-64 64l-20.528 82.128c-21.68 6.912-42.496 15.744-62.336 26.208l-73.84-47.024c-25.456-17.664-67.648-22.16-92.624 2.832l-45.264 45.248c-24.992 25.008-16.608 64 0 90.512l46.752 77.92c-8.767 17.664-16.544 35.936-22.544 55.024l-82.112 18.224C33.007 420.56 0 447.216 0 482.56v64c0 35.344 33.504 57.008 64 64l83.152 20.784c5.745 17.632 12.928 34.56 21.056 50.976l-46.8 78c-16.591 26.496-24.975 65.504 0 90.496l45.28 45.248c24.976 25.008 67.152 20.496 92.624 2.847l74-47.152c19.952 10.528 40.88 19.44 62.704 26.337L416.495 960c7.008 30.496 28.656 64 64 64h64c35.344 0 62-33.007 67.504-63.504l18.464-83.343c20.096-6.496 39.376-14.689 57.84-24.257l72.192 46c25.472 17.664 67.664 22.16 92.624-2.848L898.4 850.8c24.976-25.008 16.592-64 0-90.496l-44.463-74.128c8.944-17.568 16.688-35.84 22.912-54.848L960 610.56c30.496-7.008 64-28.656 64-64v-64c0-35.344-32.992-62-63.504-67.504zm-.465 126.992c-2.72 1.952-7.842 4.635-14.338 6.139l-118.656 29.631-11.008 33.632c-4.975 15.153-11.407 30.529-19.119 45.712l-16.064 31.569 62.688 104.528c4 6.4 5.872 12.127 6.432 15.503l-42.096 42.033c-4.064-1.28-8.688-2.945-10.912-4.464l-105.344-67.184-32.752 16.945c-15.776 8.192-31.969 14.976-48.097 20.192l-34.88 11.28-26.368 119.12c-1.216 6.368-4.624 11.504-6.96 13.344h-57.6c-1.951-2.72-4.623-7.84-6.112-14.32L449.39 827.9l-34.095-10.817c-17.569-5.536-35.088-12.912-52.144-21.904l-32.912-17.376-105.36 67.152c-4.304 2.912-8.912 4.56-13.088 4.56l-41.968-40.847c.56-3.311 2.304-8.783 5.792-14.367l65.456-109.056-15.568-31.344c-7.264-14.784-13.024-28.656-17.504-42.4l-10.992-33.664L79.518 548.46c-7.392-1.68-12.736-4.432-15.52-6.4v-59.504c.032.016.08.032.145.032 1.072 0 6.336-3.745 10.72-4.544l120.72-26.737 11.087-35.28c4.512-14.368 10.672-29.344 18.816-45.775l15.568-31.36-64.767-107.92c-4.016-6.432-5.872-12.16-6.432-15.52l42.08-42.065c4.08 1.312 8.672 2.96 10.88 4.48l107.312 68.4 32.88-17.344c16.88-8.895 34.336-16.239 51.904-21.823l34.016-10.832L478.11 79.501c1.697-7.391 4.416-12.735 6.4-15.52H544c-.433.657 3.68 6.24 4.527 10.865l26.88 121.408 34.848 11.264c16.336 5.28 32.752 12.16 48.72 20.448l32.752 17.008 103.152-65.712c4.32-2.945 8.944-4.576 13.088-4.576l42 40.816c-.56 3.328-2.32 8.816-5.808 14.416l-63.344 105.488 16.16 31.616c8.72 17.056 15.376 33.056 20.32 48.928l11.056 35.344L946.64 477.55c7.153 1.328 12.721 5.456 13.905 7.696zM512.43 319.674c-106.272 0-192.736 86.288-192.736 192.32 0 106.016 86.464 192.304 192.736 192.304s192.736-86.288 192.736-192.304c0-106.032-86.464-192.32-192.736-192.32zm-.432 320.32c-70.576 0-128-57.424-128-128 0-70.592 57.424-128 128-128 70.592 0 128 57.408 128 128 0 70.576-57.424 128-128 128z"},child:[]}]})(s)}const Fs=({onClose:s,channelData:n})=>{var _,S,M,A,T,R,ee;let i=`Meeting with #${n.channel_name}`;const{currentUser:r}=u.useContext(me),a=zs(),c=is((_=n.peer_user_id)!=null?_:void 0);n.is_direct_message&&(i=`Meeting between ${(S=c==null?void 0:c.full_name)!=null?S:n.peer_user_id} and ${(M=a==null?void 0:a.full_name)!=null?M:r}`);const o=Ps({defaultValues:{channel:n.name,subject:i,duration:"60"}}),{control:h,handleSubmit:l,register:d,setValue:m,formState:{errors:j}}=o;we("frappe.client.get_value",{doctype:"Google Calendar",fieldname:["name"],filters:{user:r,enable:1}},void 0,{onSuccess:w=>{w.message&&m("google_calendar",w.message.name)}});const{call:y,loading:C,error:v}=ss("raven.api.events.create_event"),F=w=>ie(null,null,function*(){return y(w).then(se=>{U.success("Meeting created",{description:e.jsx($s,{href:se.message.google_meet_link,underline:"always",className:"cursor-pointer",target:"_blank",rel:"noreferrer",children:se.message.google_meet_link})}),s()})});return e.jsx(Ts,J(O({},o),{children:e.jsxs("form",{onSubmit:l(F),children:[e.jsx(Y,{children:"Start a Meeting"}),e.jsxs(t,{gap:"2",direction:"column",width:"100%",children:[e.jsx($,{error:v}),e.jsx(k,{width:"100%",children:e.jsxs(t,{direction:"column",gap:"2",children:[e.jsxs(k,{children:[e.jsx(ze,{htmlFor:"subject",isRequired:!0,children:"Subject"}),e.jsx(ms,O({},d("subject",{required:"Subject is required"})))]}),(j==null?void 0:j.subject)&&e.jsx(Me,{children:(A=j.subject)==null?void 0:A.message})]})}),e.jsxs(t,{gap:"2",children:[e.jsx(k,{width:"100%",children:e.jsxs(t,{direction:"column",gap:"2",children:[e.jsxs(k,{width:"100%",children:[e.jsx(ze,{htmlFor:"duration",isRequired:!0,children:"Duration"}),e.jsx(Ls,{name:"duration",rules:{required:"Duration is required"},control:h,render:({field:w})=>e.jsxs(re,{value:w.value,name:w.name,required:!0,onValueChange:w.onChange,children:[e.jsx(le,{onBlur:w.onBlur,className:"w-full"}),e.jsxs(te,{children:[e.jsx(N,{value:"15",children:"15 minutes"}),e.jsx(N,{value:"30",children:"30 minutes"}),e.jsx(N,{value:"60",children:"1 hour"}),e.jsx(N,{value:"120",children:"2 hours"})]})]})})]}),(j==null?void 0:j.duration)&&e.jsx(Me,{children:(T=j.duration)==null?void 0:T.message})]})}),e.jsx(k,{width:"100%",children:e.jsxs(t,{direction:"column",gap:"2",children:[e.jsx(zn,{name:"google_calendar",label:"Google Calendar",required:!0,dropdownClass:"sm:w-[255px] w-[10rem]",rules:{required:"Calendar is required"},filters:[["enable","=",1],["user","=",r]],doctype:"Google Calendar"}),e.jsx(Me,{children:(R=o.formState.errors.google_calendar)==null?void 0:R.message})]})})]}),e.jsxs(k,{width:"100%",children:[e.jsxs(ze,{htmlFor:"description",children:["Description ",e.jsx(x,{as:"span",size:"1",color:"gray",children:" (Optional)"})]}),e.jsx(ms,O({},d("description"))),(j==null?void 0:j.description)&&e.jsx(Me,{children:(ee=j.description)==null?void 0:ee.message})]})]}),e.jsxs(t,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Ke,{disabled:C,children:e.jsx(b,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(b,{type:"submit",disabled:C,children:[C&&e.jsx(V,{className:"text-white"}),C?"Creating":"Create"]})]})]})}))},Oi=({isOpen:s,setOpen:n,channelData:i})=>P()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Z,{className:E,children:e.jsx(Fs,{channelData:i,onClose:()=>n(!1)})})}):e.jsx(G,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Fs,{channelData:i,onClose:()=>n(!1)})})})}),Fe="16",cn=({channelData:s})=>{const{channelID:n}=ae(),{currentUser:i}=u.useContext(me),{channelMembers:r}=$e(s.name),[a,{on:c},o]=oe(!1),[h,{on:l},d]=oe(!1),[m,{on:j,off:y}]=oe(!1),[C,{on:v},F]=oe(!1),[_,{on:S},M]=oe(!1),A=u.useMemo(()=>s.type==="Open"||s.is_archived===1||s.is_direct_message===1?!1:!!r[i],[s,r,i]);return e.jsxs(e.Fragment,{children:[e.jsxs(Gs,{children:[e.jsx(qs,{children:e.jsx(Pe,{color:"gray",className:"bg-transparent text-gray-12 hover:bg-gray-3",children:e.jsx(On,{})})}),e.jsxs(Js,{className:"min-w-48",children:[e.jsx(de,{onClick:S,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(An,{size:Fe}),"Start a Meeting"]})}),e.jsx(de,{onClick:j,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(We,{size:Fe}),"Search"]})}),e.jsx(de,{onClick:c,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(Pn,{size:Fe}),"View Files"]})}),s.is_direct_message===0&&e.jsxs(e.Fragment,{children:[e.jsx(Tn,{}),A&&e.jsx(de,{onClick:l,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(Ln,{size:Fe}),"Add Members"]})}),e.jsx(de,{onClick:v,children:e.jsxs(t,{gap:"2",align:"center",children:[e.jsx(zi,{size:Fe}),"Channel Settings"]})})]})]})]}),e.jsx(hi,{open:a,setOpen:o}),e.jsx(xi,{open:h,setOpen:d}),e.jsx(mi,{isOpen:m,onClose:y,tabIndex:0,input:"",inFilter:n}),e.jsx(Mi,{open:C,setOpen:F,channelData:s}),e.jsx(Oi,{isOpen:_,setOpen:M,channelData:s})]})},Ai=({channelData:s})=>{const{channelMembers:n}=$e(s.name),i=Object.keys(n).length,r=Math.min(i-3,9);return e.jsxs("div",{className:"flex items-center -space-x-1 rtl:space-x-reverse animate-fadein",children:[Object.entries(n).map(([a,c],o)=>{var h,l;if(o<3)return e.jsx(ue,{src:(h=c.user_image)!=null?h:void 0,alt:(l=c.full_name)!=null?l:c.name,radius:"full",variant:"solid",className:"border border-gray-2"},a)}),i>3&&e.jsx("span",{className:"inline-block",children:e.jsx(Rn,{fallback:`${r}+`,size:"1",variant:"soft",color:"gray",radius:"full",className:"border border-slate-4 text-[10px]"})})]})},Pi=({onClose:s})=>{var l;const{channelID:n}=ae(),{data:i,error:r}=we("raven.api.raven_message.get_pinned_messages",{channel_id:n},void 0,{revalidateOnFocus:!1}),a=Be(),{workspaceID:c}=ae(),o=(d,m,j)=>{let y="";m?y=`/${m}`:y=`/${c}`,a({pathname:`${y}/${d}`,search:`message_id=${j}`})},h=(d,m,j)=>{o(m,j,d),s()};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsxs(t,{justify:"between",align:"center",children:[e.jsx(x,{children:"Pinned Messages"}),e.jsx(Pe,{variant:"ghost",color:"gray","aria-label":"Close",onClick:s,children:e.jsx(ii,{size:"20"})})]})}),e.jsx(Bn,{children:e.jsx($n,{children:"Pinned Messages"})}),e.jsx($,{error:r}),e.jsx(t,{direction:"column",gap:"3",justify:"start",children:(l=i==null?void 0:i.message)==null?void 0:l.map(d=>e.jsx(sn,{message:d,handleScrollToMessage:h},d.name))})]})},Ti=({pinnedMessagesString:s})=>{const n=s?s.split(`
`).length:0,[i,r]=u.useState(!1),a=()=>{r(!1)};return n?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Re,{children:e.jsxs(b,{size:"1",variant:"soft",color:"gray","aria-label":"View pinned messages",title:"View pinned messages",children:[e.jsx(In,{size:"14"}),n]})}),e.jsx(Z,{className:Ue(E,"sm:min-w-[720px]"),children:e.jsx(Pi,{onClose:a})})]}):null},Li=({channelData:s})=>{var i;const n=rs(ls);return e.jsxs(Ds,{children:[e.jsxs(t,{align:"center",children:[e.jsx(Hs,{to:`/${n}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(Zs,{size:"24",className:"block text-gray-12"})}),e.jsxs(t,{gap:"4",align:"center",className:"group animate-fadein pr-4",children:[e.jsxs(t,{gap:"1",align:"center",children:[e.jsx(D,{type:s.type,size:"18"}),e.jsx(Xs,{size:{initial:"4",sm:"5"},className:"mb-0.5 text-ellipsis line-clamp-1",children:s.channel_name})]}),e.jsx(tn,{channelID:s.name,channel_name:s.channel_name,channelType:s.type,disabled:s.is_archived==1,buttonVisible:!!s.pinned_messages_string}),e.jsx(Ti,{pinnedMessagesString:(i=s.pinned_messages_string)!=null?i:""})]})]}),e.jsxs(t,{gap:"2",align:"center",className:"animate-fadein",children:[e.jsx(Ai,{channelData:s}),e.jsx(cn,{channelData:s})]})]})},Ri=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Li,{channelData:s}),e.jsx(ln,{channelData:s})]}),Bi=({channelData:s})=>{var C;const{currentUser:n}=u.useContext(me),{channelMembers:i}=$e(s.name),r=s.peer_user_id,a=Vn(s.peer_user_id),{isBot:c,fullName:o,userImage:h}=u.useMemo(()=>{var _,S;const v=i==null?void 0:i[r],F=(v==null?void 0:v.type)==="Bot";return{fullName:(_=v==null?void 0:v.full_name)!=null?_:r,userImage:(S=v==null?void 0:v.user_image)!=null?S:"",isBot:F}},[i,r]),l=is(r),d=ri(r),m=(C=o!=null?o:r)!=null?C:Un(s.channel_name,n),j=P(),y=rs(ls);return e.jsxs(Ds,{children:[e.jsxs(t,{gap:"3",align:"center",children:[e.jsx(Hs,{to:`/${y}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(Zs,{size:"24",className:"block text-gray-12"})}),e.jsx(ue,{alt:m,src:h,isActive:a,availabilityStatus:l==null?void 0:l.availability_status,skeletonSize:"6",isBot:c,size:j?"2":"1"},r),e.jsx(Xs,{size:{initial:"4",sm:"5"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[m,!l&&e.jsx(Se,{color:"gray",variant:"soft",children:"Deleted"}),(l==null?void 0:l.enabled)===0&&e.jsx(Se,{color:"gray",variant:"soft",children:"Disabled"}),(l==null?void 0:l.custom_status)&&e.jsx(Se,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:l.custom_status}),d&&e.jsx(Se,{color:"yellow",variant:"surface",children:"On Leave"}),c&&e.jsx(Se,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:"Bot"})]})})]}),e.jsx(t,{gap:"4",align:"center",children:e.jsx(cn,{channelData:s})})]})},$i=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Bi,{channelData:s}),e.jsx(ln,{channelData:s})]}),Ii=()=>{const{channelID:s}=ae();return e.jsx("div",{className:"scroll-smooth",children:s&&e.jsx(Vi,{channelID:s})})},ar=Ii,Vi=({channelID:s})=>{const{threadID:n}=ae(),i=Os(),{channel:r,error:a,isLoading:c}=Ks(s),{mutate:o,cache:h}=_e(),[l]=En(),d=l.get("message_id"),m=Gn(Ys);return u.useEffect(()=>{m(s);const j=h.get("unread_channel_count");j!=null&&j.data&&(d||o("unread_channel_count",y=>y&&{message:y.message.map(v=>v.name===s?J(O({},v),{unread_count:0}):v)},{revalidate:!1}))},[s,d]),e.jsxs(es,{columns:n&&!i?"2":"1",gap:"2",rows:"repeat(2, 64px)",width:"auto",className:"dark:bg-gray-2 bg-white h-screen",children:[n&&i?null:e.jsxs(k,{children:[c&&e.jsx(qn,{}),e.jsx($,{error:a}),r?r.type==="dm"?e.jsx($i,{channelData:r.channelData}):e.jsx(Ri,{channelData:r.channelData}):null]}),e.jsx(Jn,{})]})};export{ar as Component};
