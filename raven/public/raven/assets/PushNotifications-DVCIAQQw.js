var z=Object.defineProperty,Y=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var w=(i,s,a)=>s in i?z(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,o=(i,s)=>{for(var a in s||(s={}))M.call(s,a)&&w(i,a,s[a]);if(N)for(var a of N(s))B.call(s,a)&&w(i,a,s[a]);return i},d=(i,s)=>Y(i,H(s));import{az as $,r as j,h as G,u as O,ah as W,j as e,ai as J,_ as l,o as _,d as Q,C as X,aR as Z,E as ee,i as F,p as h,L as p,aP as se,aD as ie,aE as ae,aF as te,aG as S,aH as L,S as ne,e as E,bK as A,b as g,c as C,a3 as y,V as oe,ac as re}from"./index-DLbNAGlT.js";import{P as ce,S as le,a as ue}from"./SettingsContentContainer-PpMfRXsE.js";import{u as de}from"./useRavenSettings-CaSx_tcD.js";import{r as q}from"./strong-DsMPld-B.js";const he=()=>{var b,P,k;const i=$(),{ravenSettings:s,mutate:a,error:f}=de(),{call:m}=j.useContext(G),u=O({disabled:!i}),{handleSubmit:I,control:K,watch:D,reset:T,register:x,formState:{errors:t},setValue:U}=u;j.useEffect(()=>{s&&T(s)},[s]);const{updateDoc:V,loading:v}=W(),R=n=>{y.promise(V("Raven Settings",null,o(o({},s!=null?s:{}),n)).then(c=>{a(c,{revalidate:!1})}),{loading:"Updating...",success:()=>"Settings updated",error:"There was an error."})};j.useEffect(()=>{const n=c=>{c.key==="s"&&(c.metaKey||c.ctrlKey)&&(c.preventDefault(),u.handleSubmit(R)())};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]);const r=D("push_notification_service")==="Raven";return e.jsx(ce,{children:e.jsx(J,d(o({},u),{children:e.jsx("form",{onSubmit:I(R),children:e.jsxs(le,{children:[e.jsx(ue,{title:l("Push Notifications"),description:l("Configure the push notification service here."),actions:e.jsxs(_,{type:"submit",disabled:v||!i,children:[v&&e.jsx(Q,{className:"text-white"}),v?"Saving":"Save"]})}),!i&&e.jsx(X,{iconChildren:e.jsx(Z,{}),rootProps:{color:"blue",variant:"surface"},textChildren:l("You need to be a System Manager to manage the push notification service.")}),e.jsx(ee,{error:f}),e.jsxs(F,{size:"2",children:["To send push notifications, you have two options:",e.jsx("br",{}),e.jsx("br",{}),e.jsxs("ol",{className:"list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx(q,{children:"Raven Cloud"})," - this is recommended. If you are self hosting, this is the only option."]}),e.jsxs("li",{children:[e.jsx(q,{children:"Frappe Cloud"})," - if you are using Frappe Cloud, you can use this option."]})]})]}),e.jsxs(h,{className:"max-w-96",children:[e.jsx(p,{isRequired:!0,htmlFor:"push_notification_service",children:l("Push Notification Service")}),e.jsx(se,{control:K,defaultValue:s==null?void 0:s.push_notification_service,name:"push_notification_service",rules:{required:"Please select a push notification service",onChange:n=>{U("push_notification_server_url","https://cloud.ravenchat.ai")}},render:({field:n})=>e.jsxs(ie,{value:n.value,disabled:n.disabled,name:n.name,onValueChange:n.onChange,children:[e.jsx(ae,{className:"w-full"}),e.jsxs(te,{children:[e.jsx(S,{value:"Raven",children:l("Raven Cloud")}),e.jsx(S,{value:"Frappe Cloud",children:l("Frappe Cloud")})]})]})}),e.jsx(L,{children:"We recommend using Raven Cloud for push notifications."})]}),r?e.jsxs(ne,{gap:"3",children:[e.jsxs(F,{size:"2",children:["To get started with Raven Cloud, you need to first ",e.jsxs(E,{href:"https://cloud.ravenchat.ai",target:"_blank",children:["create an account ",e.jsx(A,{})]})," and get your API Key and API Secret."]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_server_url",isRequired:!0,children:"Push Notification Server URL"}),e.jsx(g,d(o({autoFocus:!0,maxLength:140,className:"w-48 sm:w-96",id:"push_notification_server_url",autoComplete:"off",required:!0,placeholder:"https://push.raven.chat"},x("push_notification_server_url",{required:r?"Please add your Push Notification Server URL":!1,maxLength:{value:300,message:"URL cannot be more than 300 characters."}})),{"aria-invalid":t.push_notification_server_url?"true":"false"})),(t==null?void 0:t.push_notification_server_url)&&e.jsx(C,{children:(b=t.push_notification_server_url)==null?void 0:b.message}),e.jsxs(L,{size:"2",children:['You can keep this as "https://cloud.ravenchat.ai" if you are using the default Raven Cloud instance.',e.jsx("br",{}),"Only change this if you are using a custom Raven Cloud instance."]})]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_api_key",children:"Push Notification API Key"}),e.jsx(g,d(o({maxLength:140,className:"w-48 sm:w-96",id:"push_notification_api_key",autoComplete:"off",placeholder:"Your API Key"},x("push_notification_api_key",{maxLength:{value:140,message:"API Key cannot be more than 140 characters."}})),{"aria-invalid":t.push_notification_api_key?"true":"false"})),(t==null?void 0:t.push_notification_api_key)&&e.jsx(C,{children:(P=t.push_notification_api_key)==null?void 0:P.message})]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_api_secret",isRequired:!0,children:"API Secret"}),e.jsx(g,d(o({className:"w-48 sm:w-96",id:"push_notification_api_secret",required:!0,type:"password",autoComplete:"off",placeholder:"••••••••••••••••••••••••••••••••"},x("push_notification_api_secret",{required:r?"Please add your Push Notification API Secret":!1})),{"aria-invalid":t.push_notification_api_secret?"true":"false"})),(t==null?void 0:t.push_notification_api_secret)&&e.jsx(C,{children:(k=t.push_notification_api_secret)==null?void 0:k.message})]})]}):null,e.jsxs("div",{className:"flex gap-2",children:[r&&(s==null?void 0:s.push_notification_service)==="Raven"&&(s==null?void 0:s.push_notification_server_url)&&e.jsx(pe,{mutate:a,ravenSettings:s}),r&&(s==null?void 0:s.push_notification_service)==="Raven"&&(s==null?void 0:s.push_notification_server_url)&&(s==null?void 0:s.vapid_public_key)&&e.jsx(_,{onClick:()=>m.post("raven.api.notification.sync_user_tokens_to_raven_cloud").then(()=>{y.success("Data syncing to Raven Cloud...")}),type:"button",variant:"soft",className:"not-cal",children:"Sync Data to Raven Cloud"}),!r&&e.jsx(_,{asChild:!0,color:"gray",variant:"outline",className:"not-cal",children:e.jsxs(E,{color:"gray",target:"_blank",underline:"none",href:"/app/push-notification-settings",children:["Configure Frappe Push Notifications",e.jsx(A,{})]})})]})]})})}))})},pe=({mutate:i,ravenSettings:s})=>{const{call:a,loading:f}=oe("raven.api.notification.register_site_on_raven_cloud"),m=()=>{y.promise(a({}).then(()=>i()),{loading:"Registering site on Raven Cloud...",success:"Site registered on Raven Cloud. You can now send push notifications.",error:u=>"Failed to register site on Raven Cloud. "+re(u)})};return e.jsx(_,{onClick:m,disabled:f,variant:"soft",type:"button",className:"not-cal",children:s.vapid_public_key?"Re-Register Site on Raven Cloud":"Register Site on Raven Cloud"})},je=he;export{je as Component};
