var H=Object.defineProperty,M=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var S=(s,i,a)=>i in s?H(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,r=(s,i)=>{for(var a in i||(i={}))$.call(i,a)&&S(s,a,i[a]);if(E)for(var a of E(i))G.call(i,a)&&S(s,a,i[a]);return s},d=(s,i)=>M(s,B(i));import{az as O,r as g,h as J,u as Q,ah as W,j as e,ai as X,_ as o,o as _,d as Z,C as y,aR as A,E as ee,i as q,p as h,L as p,aP as ie,aD as se,aE as ae,aF as te,aG as C,aH as I,S as ne,e as K,bK as D,b,c as R,a3 as P,V as oe,ac as re}from"./index-BeJbNZtk.js";import{P as ce,S as le,a as ue}from"./SettingsContentContainer-Bofz0qeL.js";import{u as de}from"./useRavenSettings-Dp_V5Hht.js";import{r as F}from"./strong-DgHjcpwu.js";const he=()=>{var k,N,L;const s=O(),{ravenSettings:i,mutate:a,error:f}=de(),{call:m}=g.useContext(J),u=Q({disabled:!s}),{handleSubmit:T,control:U,watch:x,reset:V,register:v,formState:{errors:t},setValue:z}=u;g.useEffect(()=>{i&&V(i)},[i]);const{updateDoc:Y,loading:j}=W(),w=n=>{P.promise(Y("Raven Settings",null,r(r({},i!=null?i:{}),n)).then(l=>{a(l,{revalidate:!1})}),{loading:"Updating...",success:()=>"Settings updated",error:"There was an error."})};g.useEffect(()=>{const n=l=>{l.key==="s"&&(l.metaKey||l.ctrlKey)&&(l.preventDefault(),u.handleSubmit(w)())};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]);const c=x("push_notification_service")==="Raven";return e.jsx(ce,{children:e.jsx(X,d(r({},u),{children:e.jsx("form",{onSubmit:T(w),children:e.jsxs(le,{children:[e.jsx(ue,{title:o("Push Notifications"),description:o("Configure the push notification service here."),actions:e.jsxs(_,{type:"submit",disabled:j||!s,children:[j&&e.jsx(Z,{className:"text-white"}),j?"Saving":"Save"]})}),!s&&e.jsx(y,{iconChildren:e.jsx(A,{}),rootProps:{color:"blue",variant:"surface"},textChildren:o("You need to be a System Manager to manage the push notification service.")}),e.jsx(ee,{error:f}),e.jsxs(q,{size:"2",children:["To send push notifications, you have three options:",e.jsx("br",{}),e.jsx("br",{}),e.jsxs("ol",{className:"list-decimal list-inside",children:[e.jsxs("li",{children:[e.jsx(F,{children:"Firebase"})," - recommended for self-hosting with your own Firebase project."]}),e.jsxs("li",{children:[e.jsx(F,{children:"Raven Cloud"})," - uses Raven's managed push notification service."]}),e.jsxs("li",{children:[e.jsx(F,{children:"Frappe Cloud"})," - if you are using Frappe Cloud, you can use this option."]})]})]}),e.jsxs(h,{className:"max-w-96",children:[e.jsx(p,{isRequired:!0,htmlFor:"push_notification_service",children:o("Push Notification Service")}),e.jsx(ie,{control:U,defaultValue:i==null?void 0:i.push_notification_service,name:"push_notification_service",rules:{required:"Please select a push notification service",onChange:n=>{z("push_notification_server_url","https://cloud.ravenchat.ai")}},render:({field:n})=>e.jsxs(se,{value:n.value,disabled:n.disabled,name:n.name,onValueChange:n.onChange,children:[e.jsx(ae,{className:"w-full"}),e.jsxs(te,{children:[e.jsx(C,{value:"Firebase",children:o("Firebase")}),e.jsx(C,{value:"Raven",children:o("Raven Cloud")}),e.jsx(C,{value:"Frappe Cloud",children:o("Frappe Cloud")})]})]})}),e.jsx(I,{children:"For self-hosted instances, we recommend using Firebase with your own Firebase project."})]}),x("push_notification_service")==="Firebase"&&(i!=null&&i.vapid_public_key)?e.jsx(y,{rootProps:{color:"green",variant:"surface"},textChildren:o("Firebase is configured and ready to send push notifications.")}):x("push_notification_service")==="Firebase"&&!(i!=null&&i.vapid_public_key)?e.jsx(y,{iconChildren:e.jsx(A,{}),rootProps:{color:"yellow",variant:"surface"},textChildren:o("Firebase configuration is pending. Run 'bench migrate' to auto-configure.")}):null,c?e.jsxs(ne,{gap:"3",children:[e.jsxs(q,{size:"2",children:["To get started with Raven Cloud, you need to first ",e.jsxs(K,{href:"https://cloud.ravenchat.ai",target:"_blank",children:["create an account ",e.jsx(D,{})]})," and get your API Key and API Secret."]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_server_url",isRequired:!0,children:"Push Notification Server URL"}),e.jsx(b,d(r({autoFocus:!0,maxLength:140,className:"w-48 sm:w-96",id:"push_notification_server_url",autoComplete:"off",required:!0,placeholder:"https://push.raven.chat"},v("push_notification_server_url",{required:c?"Please add your Push Notification Server URL":!1,maxLength:{value:300,message:"URL cannot be more than 300 characters."}})),{"aria-invalid":t.push_notification_server_url?"true":"false"})),(t==null?void 0:t.push_notification_server_url)&&e.jsx(R,{children:(k=t.push_notification_server_url)==null?void 0:k.message}),e.jsxs(I,{size:"2",children:['You can keep this as "https://cloud.ravenchat.ai" if you are using the default Raven Cloud instance.',e.jsx("br",{}),"Only change this if you are using a custom Raven Cloud instance."]})]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_api_key",children:"Push Notification API Key"}),e.jsx(b,d(r({maxLength:140,className:"w-48 sm:w-96",id:"push_notification_api_key",autoComplete:"off",placeholder:"Your API Key"},v("push_notification_api_key",{maxLength:{value:140,message:"API Key cannot be more than 140 characters."}})),{"aria-invalid":t.push_notification_api_key?"true":"false"})),(t==null?void 0:t.push_notification_api_key)&&e.jsx(R,{children:(N=t.push_notification_api_key)==null?void 0:N.message})]}),e.jsxs(h,{children:[e.jsx(p,{htmlFor:"push_notification_api_secret",isRequired:!0,children:"API Secret"}),e.jsx(b,d(r({className:"w-48 sm:w-96",id:"push_notification_api_secret",required:!0,type:"password",autoComplete:"off",placeholder:"••••••••••••••••••••••••••••••••"},v("push_notification_api_secret",{required:c?"Please add your Push Notification API Secret":!1})),{"aria-invalid":t.push_notification_api_secret?"true":"false"})),(t==null?void 0:t.push_notification_api_secret)&&e.jsx(R,{children:(L=t.push_notification_api_secret)==null?void 0:L.message})]})]}):null,e.jsxs("div",{className:"flex gap-2",children:[c&&(i==null?void 0:i.push_notification_service)==="Raven"&&(i==null?void 0:i.push_notification_server_url)&&e.jsx(pe,{mutate:a,ravenSettings:i}),c&&(i==null?void 0:i.push_notification_service)==="Raven"&&(i==null?void 0:i.push_notification_server_url)&&(i==null?void 0:i.vapid_public_key)&&e.jsx(_,{onClick:()=>m.post("raven.api.notification.sync_user_tokens_to_raven_cloud").then(()=>{P.success("Data syncing to Raven Cloud...")}),type:"button",variant:"soft",className:"not-cal",children:"Sync Data to Raven Cloud"}),!c&&e.jsx(_,{asChild:!0,color:"gray",variant:"outline",className:"not-cal",children:e.jsxs(K,{color:"gray",target:"_blank",underline:"none",href:"/app/push-notification-settings",children:["Configure Frappe Push Notifications",e.jsx(D,{})]})})]})]})})}))})},pe=({mutate:s,ravenSettings:i})=>{const{call:a,loading:f}=oe("raven.api.notification.register_site_on_raven_cloud"),m=()=>{P.promise(a({}).then(()=>s()),{loading:"Registering site on Raven Cloud...",success:"Site registered on Raven Cloud. You can now send push notifications.",error:u=>"Failed to register site on Raven Cloud. "+re(u)})};return e.jsx(_,{onClick:m,disabled:f,variant:"soft",type:"button",className:"not-cal",children:i.vapid_public_key?"Re-Register Site on Raven Cloud":"Register Site on Raven Cloud"})},je=he;export{je as Component};
